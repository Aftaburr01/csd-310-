;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="d77c76ed-9145-9896-4c3e-ae1ce76b39d4")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,764767,(e,t,n)=>{"use strict";var r=e.i(33699),i=function(e){if(e=e||{},this.Promise=e.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=e.domainReentrant||!1,this.domainReentrant){if(void 0===r.default||void 0===r.default.domain)throw Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=e.timeout||i.DEFAULT_TIMEOUT,this.maxOccupationTime=e.maxOccupationTime||i.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=e.maxExecutionTime||i.DEFAULT_MAX_EXECUTION_TIME,e.maxPending===1/0||Number.isInteger(e.maxPending)&&e.maxPending>=0?this.maxPending=e.maxPending:this.maxPending=i.DEFAULT_MAX_PENDING};i.DEFAULT_TIMEOUT=0,i.DEFAULT_MAX_OCCUPATION_TIME=0,i.DEFAULT_MAX_EXECUTION_TIME=0,i.DEFAULT_MAX_PENDING=1e3,i.prototype.acquire=function(e,t,n,i){if(Array.isArray(e))return this._acquireBatch(e,t,n,i);if("function"!=typeof t)throw Error("You must pass a function to execute");var o=null,a=null,s=null;"function"!=typeof n&&(i=n,n=null,s=new this.Promise(function(e,t){o=e,a=t})),i=i||{};var l=!1,c=null,u=null,p=null,d=this,y=function(t,r,i){u&&(clearTimeout(u),u=null),p&&(clearTimeout(p),p=null),t&&(d.queues[e]&&0===d.queues[e].length&&delete d.queues[e],d.domainReentrant&&delete d.domains[e]),l||(s?r?a(r):o(i):"function"==typeof n&&n(r,i),l=!0),t&&d.queues[e]&&d.queues[e].length>0&&d.queues[e].shift()()},f=function(n){if(l)return y(n);c&&(clearTimeout(c),c=null),d.domainReentrant&&n&&(d.domains[e]=r.default.domain);var o=i.maxExecutionTime||d.maxExecutionTime;if(o&&(p=setTimeout(function(){d.queues[e]&&y(n,Error("Maximum execution time is exceeded "+e))},o)),1===t.length){var a=!1;try{t(function(e,t){a||(a=!0,y(n,e,t))})}catch(e){a||(a=!0,y(n,e))}}else d._promiseTry(function(){return t()}).then(function(e){y(n,void 0,e)},function(e){y(n,e)})};d.domainReentrant&&r.default.domain&&(f=r.default.domain.bind(f));var h=i.maxPending||d.maxPending;if(d.queues[e])if(d.domainReentrant&&r.default.domain&&r.default.domain===d.domains[e])f(!1);else if(d.queues[e].length>=h)y(!1,Error("Too many pending tasks in queue "+e));else{var g=function(){f(!0)};i.skipQueue?d.queues[e].unshift(g):d.queues[e].push(g);var T=i.timeout||d.timeout;T&&(c=setTimeout(function(){c=null,y(!1,Error("async-lock timed out in queue "+e))},T))}else d.queues[e]=[],f(!0);var v=i.maxOccupationTime||d.maxOccupationTime;if(v&&(u=setTimeout(function(){d.queues[e]&&y(!1,Error("Maximum occupation time is exceeded in queue "+e))},v)),s)return s},i.prototype._acquireBatch=function(e,t,n,r){"function"!=typeof n&&(r=n,n=null);var i=this,o=e.reduceRight(function(e,t){return function(n){i.acquire(t,e,n,r)}},t);if("function"!=typeof n)return new this.Promise(function(e,t){1===o.length?o(function(n,r){n?t(n):e(r)}):e(o())});o(n)},i.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},i.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(e){return this.Promise.reject(e)}},t.exports=i},650392,(e,t,n)=>{"use strict";t.exports=e.r(764767)},267710,644464,17886,e=>{"use strict";var t=e.i(297083),n=e.i(817556),r=e.i(862927),i=e.i(650392),o=e.i(906368);function a(e,t){return"string"==typeof e&&(e=Error(e)),o.withScope(function(n){n.setTag("ai-chat",!0),t&&n.setExtras(t),o.captureException(e)}),e}e.s(["sendErrorToSentry",()=>a],644464);var s=e.i(960933);e.i(837399),s.Type.Object({replId:s.Type.Union([s.Type.String(),s.Type.Null()]),orgId:s.Type.Optional(s.Type.String())}),s.Type.Object({userId:s.Type.Number(),orgId:s.Type.Optional(s.Type.String()),replId:s.Type.Optional(s.Type.String())});var l=s.Type.Object({token:s.Type.String()}),c=s.Type.Object({isAuthorized:s.Type.Literal(!0),code:s.Type.Literal("authorized"),message:s.Type.String()}),u=s.Type.Object({isAuthorized:s.Type.Literal(!1),code:s.Type.Union([s.Type.Literal("feature_disabled"),s.Type.Literal("feature_unsupported_for_non_teams"),s.Type.Literal("feature_unsupported_for_replit_teams"),s.Type.Literal("feature_unsupported_for_teams_edu"),s.Type.Literal("feature_unsupported_for_teams_pro"),s.Type.Literal("feature_unsupported_for_teams_free"),s.Type.Literal("insufficient_permissions"),s.Type.Literal("insufficient_quota"),s.Type.Literal("insufficient_budget"),s.Type.Literal("requires_payment_method"),s.Type.Literal("requires_active_subscription")]),message:s.Type.String()}),p=s.Type.Union([c,u]);s.Type.Object({basicModel:p,advancedModel:p,paidAgent:p,freeAgent:p,basicAssistant:p,advancedAssistant:p,modelFarm:p,openRouter:p,openAI:p,anthropic:p,gemini:p});var d={},y=new i.default;function f(e,i,o){return(0,t._)(function(){return(0,n._)(this,function(s){return[2,y.acquire(null!=e?e:"non-repl-key",function(){return(0,t._)(function(){var s,c,u;return(0,n._)(this,function(p){switch(p.label){case 0:if((s=d[i])&&new Date().getTime()<s.expiration)return[2,s.token];return[4,(0,t._)(function(){var t;return(0,n._)(this,function(n){switch(n.label){case 0:return[4,fetch("/ai/auth",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({replId:e,orgId:o})})];case 1:return[4,n.sent().json()];case 2:if(t=n.sent(),!r.Value.Check(l,t))throw a("Authentication to chat service failed",{detail:t});return[2,t.token]}})})()];case 1:return c=p.sent(),u=new Date().getTime()+18e5,d[i]={token:c,expiration:u},[2,c]}})})()})]})})()}e.s(["auth",()=>f],267710);var h=function(){var e=window.location.hostname;return e.includes("replit.com")&&!e.includes("staging.replit.com")};e.s(["isEnvProduction",()=>h],17886)},660670,993228,806240,230153,351677,187822,170039,813702,281128,957410,e=>{"use strict";var t,n,r,i,o,a,s,l,c,u,p,d,y,f,h,g,T,v,m,S,E,b,C,_,R,I,O,k,A,U,w,N,M,D,x,P,L,j,B,F,q,G,V,H,W,$,z,K,Q,Y,X,J,Z,ee,et,en,er,ei=e.i(394212),eo=e.i(297083),ea=e.i(904851),es=e.i(90659),el=e.i(721281),ec=e.i(167626),eu=e.i(878420),ep=e.i(64386),ed=e.i(530658),ey=e.i(346715),ef=e.i(817556),eh=e.i(960933),eg=e.i(132592),eT=e.i(50452),ev=e.i(164760),em=e.i(619379),eS=e.i(231693),eE=e.i(364520),eb=e.i(468930),eC=e.i(862927),e_="UNCAUGHT_ERROR",eR="UNEXPECTED_DISCONNECT",eI="INVALID_REQUEST",eO="CANCEL",ek=function(e){return eh.Type.Object({ok:eh.Type.Literal(!1),payload:e})},eA=eh.Type.Object({path:eh.Type.String(),message:eh.Type.String()});function eU(e){var t=[],n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t.push({path:s.path,message:s.message})}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t}eh.Type.Array(eA);var ew=eh.Type.Object({code:eh.Type.Literal(eO),message:eh.Type.String()}),eN=ek(ew),eM=eh.Type.Union([eh.Type.Object({code:eh.Type.Literal(e_),message:eh.Type.String()}),eh.Type.Object({code:eh.Type.Literal(eR),message:eh.Type.String()}),eh.Type.Object({code:eh.Type.Literal(eI),message:eh.Type.String(),extras:eh.Type.Optional(eh.Type.Object({firstValidationErrors:eh.Type.Array(eA),totalErrors:eh.Type.Number()}))}),ew]),eD=ek(eM);function ex(e){return"Union"===e[eg.Kind]}function eP(e){return JSON.parse(JSON.stringify(e))}function eL(e){return"responseError"in e&&"Never"!==e.responseError[eg.Kind]?eP(function(e){if(!ex(e))return e;var t=[];return!function e(n){if(ex(n)){var r=!0,i=!1,o=void 0;try{for(var a,s=n.anyOf[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;e(l)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}else t.push(n)}(e),eh.Type.Union(t)}(eh.Type.Union([e.responseError,eM]))):eP(eM)}var ej=function(){function e(t){(0,ea._)(this,e),(0,el._)(this,"config",void 0),this.config=t}return(0,es._)(e,[{key:"procedures",value:function(e){return e}},{key:"finalize",value:function(e){return(function(){function e(t,n){(0,ea._)(this,e),(0,el._)(this,"initializeState",void 0),(0,el._)(this,"procedures",void 0),this.initializeState=t.initializeState,this.procedures=n}return(0,es._)(e,[{key:"serialize",value:function(){return{procedures:Object.fromEntries(Object.entries(this.procedures).map(function(e){var t=(0,ed._)(e,2),n=t[0],r=t[1];return[n,(0,eu._)((0,ep._)((0,eu._)({init:eP(r.requestInit),output:eP(r.responseData),errors:eL(r)},"description"in r?{description:r.description}:{}),{type:r.type}),"requestData"in r?{input:eP(r.requestData)}:{})]}))}}},{key:"serializeV1Compat",value:function(){return{procedures:Object.fromEntries(Object.entries(this.procedures).map(function(e){var t=(0,ed._)(e,2),n=t[0],r=t[1];return"rpc"===r.type||"subscription"===r.type?[n,(0,ep._)((0,eu._)({input:eP(r.requestInit),output:eP(r.responseData),errors:eL(r)},"description"in r?{description:r.description}:{}),{type:r.type})]:[n,(0,ep._)((0,eu._)({init:eP(r.requestInit),output:eP(r.responseData),errors:eL(r)},"description"in r?{description:r.description}:{}),{type:r.type,input:eP(r.requestData)})]}))}}},{key:"instantiate",value:function(e){var t=this.initializeState(e);return Object.freeze((0,el._)({state:t,procedures:this.procedures},Symbol.asyncDispose,function(){return(0,eo._)(function(){var e,n;return(0,ef._)(this,function(r){switch(r.label){case 0:return[4,null==(e=t[Symbol.asyncDispose])?void 0:e.call(t)];case 1:return r.sent(),null==(n=t[Symbol.dispose])||n.call(t),[2]}})})()}))}}],[{key:"scaffold",value:function(e){return new ej(e)}},{key:"define",value:function(t,n){var r,i;if("initializeState"in t&&"function"==typeof t.initializeState){if(!n)throw Error("Expected procedures to be defined");r=t,i=n}else r={initializeState:function(){return{}}},i=t;return new e(r,i)}}]),e})().define(this.config,e)}}]),e}(),eB=eh.Type.Union([eh.Type.Object({ok:eh.Type.Literal(!1),payload:eh.Type.Object({code:eh.Type.String(),message:eh.Type.String(),extras:eh.Type.Optional(eh.Type.Unknown())})}),eh.Type.Object({ok:eh.Type.Literal(!0),payload:eh.Type.Unknown()})]);function eF(e){return{ok:!0,payload:e}}function eq(e){return{ok:!1,payload:e}}var eG={code:"READABLE_BROKEN",message:"Readable was broken before it is fully consumed"},eV=function(){function e(){(0,ea._)(this,e),(0,el._)(this,"closed",!1),(0,el._)(this,"locked",!1),(0,el._)(this,"broken",!1),(0,el._)(this,"brokenWithValuesLeftToRead",!1),(0,el._)(this,"queue",[]),(0,el._)(this,"next",null)}return(0,es._)(e,[{key:Symbol.asyncIterator,value:function(){var e=this;if(this.locked)throw TypeError("Readable is already locked");this.locked=!0;var t=!1;return{next:function(){return(0,eo._)(function(){return(0,ef._)(this,function(e){switch(e.label){case 0:if(t)return[2,{done:!0,value:void 0}];e.label=1;case 1:var n,r;if(0!==this.queue.length)return[3,3];if(this.closed&&!this.brokenWithValuesLeftToRead)return[2,{done:!0,value:void 0}];if(this.broken)return t=!0,[2,{done:!1,value:eq(eG)}];return this.next||(this.next={promise:new Promise(function(e,t){n=e,r=t}),resolve:n,reject:r}),[4,this.next.promise];case 2:return e.sent(),this.next=null,[3,1];case 3:return[2,{done:!1,value:this.queue.shift()}]}})}).call(e)},return:function(){return(0,eo._)(function(){return(0,ef._)(this,function(e){return this.break(),[2,{done:!0,value:void 0}]})}).call(e)}}}},{key:"collect",value:function(){return(0,eo._)(function(){var e,t,n,r,i,o,a,s;return(0,ef._)(this,function(l){switch(l.label){case 0:e=[],t=!1,n=!1,l.label=1;case 1:l.trys.push([1,6,7,12]),i=(0,ei._)(this),l.label=2;case 2:return[4,i.next()];case 3:if(!(t=!(o=l.sent()).done))return[3,5];a=o.value,e.push(a),l.label=4;case 4:return t=!1,[3,2];case 5:return[3,12];case 6:return s=l.sent(),n=!0,r=s,[3,12];case 7:if(l.trys.push([7,,10,11]),!(t&&null!=i.return))return[3,9];return[4,i.return()];case 8:l.sent(),l.label=9;case 9:return[3,11];case 10:if(n)throw r;return[7];case 11:return[7];case 12:return[2,e]}})}).call(this)}},{key:"break",value:function(){var e;this.broken||(this.locked=!0,this.broken=!0,this.brokenWithValuesLeftToRead=this.queue.length>0,this.queue.length=0,null==(e=this.next)||e.resolve())}},{key:"isReadable",value:function(){return!this.locked&&!this.broken}},{key:"_pushValue",value:function(e){var t;if(!this.broken){if(this.closed)throw Error("Cannot push to closed Readable");this.queue.push(e),null==(t=this.next)||t.resolve()}}},{key:"_triggerClose",value:function(){var e;if(this.closed)throw Error("Unexpected closing multiple times");this.closed=!0,null==(e=this.next)||e.resolve()}},{key:"_hasValuesInQueue",value:function(){return this.queue.length>0}},{key:"isClosed",value:function(){return this.closed}}]),e}(),eH=function(){function e(t){(0,ea._)(this,e),(0,el._)(this,"writeCb",void 0),(0,el._)(this,"closeCb",void 0),(0,el._)(this,"closed",!1),this.writeCb=t.writeCb,this.closeCb=t.closeCb}return(0,es._)(e,[{key:"write",value:function(e){if(this.closed)throw Error("Cannot write to closed Writable");this.writeCb(e)}},{key:"isWritable",value:function(){return!this.closed}},{key:"close",value:function(e){this.closed||(void 0!==e&&this.writeCb(e),this.closed=!0,this.writeCb=function(){},this.closeCb(),this.closeCb=function(){})}},{key:"isClosed",value:function(){return this.closed}}]),e}(),eW=(0,eT.customAlphabet)("1234567890abcdefghijklmnopqrstuvxyzABCDEFGHIJKLMNOPQRSTUVXYZ"),e$=function(){return eW(12)},ez=eh.Type.Object({type:eh.Type.Literal("ACK")}),eK=eh.Type.Object({type:eh.Type.Literal("CLOSE")}),eQ="v2.0",eY=["v1.1",eQ];function eX(e){return eY.includes(e)}var eJ=eh.Type.Object({type:eh.Type.Literal("HANDSHAKE_REQ"),protocolVersion:eh.Type.String(),sessionId:eh.Type.String(),expectedSessionState:eh.Type.Object({nextExpectedSeq:eh.Type.Integer(),nextSentSeq:eh.Type.Integer()}),metadata:eh.Type.Optional(eh.Type.Unknown())}),eZ=eh.Type.Union([eh.Type.Literal("SESSION_STATE_MISMATCH")]),e0=eh.Type.Union([eh.Type.Literal("REJECTED_UNSUPPORTED_CLIENT"),eh.Type.Literal("REJECTED_BY_CUSTOM_HANDLER")]),e1=eh.Type.Union([e0,eh.Type.Literal("MALFORMED_HANDSHAKE_META"),eh.Type.Literal("MALFORMED_HANDSHAKE"),eh.Type.Literal("PROTOCOL_VERSION_MISMATCH")]),e2=eh.Type.Union([eZ,e1]),e3=eh.Type.Object({type:eh.Type.Literal("HANDSHAKE_RESP"),status:eh.Type.Union([eh.Type.Object({ok:eh.Type.Literal(!0),sessionId:eh.Type.String()}),eh.Type.Object({ok:eh.Type.Literal(!1),reason:eh.Type.String(),code:e2})])}),e4=eh.Type.Union([eK,ez,eJ,e3]),e6=(t=eh.Type.Unknown(),eh.Type.Object({id:eh.Type.String(),from:eh.Type.String(),to:eh.Type.String(),seq:eh.Type.Integer(),ack:eh.Type.Integer(),serviceName:eh.Type.Optional(eh.Type.String()),procedureName:eh.Type.Optional(eh.Type.String()),streamId:eh.Type.String(),controlFlags:eh.Type.Integer(),tracing:eh.Type.Optional(eh.Type.Object({traceparent:eh.Type.String(),tracestate:eh.Type.String()})),payload:t}));function e8(e){var t=e.from,n=e.to,r=e.sessionId,i=e.expectedSessionState,o=e.metadata,a=e.tracing;return{id:e$(),from:t,to:n,seq:0,ack:0,streamId:e$(),controlFlags:0,tracing:a,payload:{type:"HANDSHAKE_REQ",protocolVersion:eQ,sessionId:r,expectedSessionState:i,metadata:o}}}function e5(e){var t=e.from,n=e.to,r=e.status;return{id:e$(),from:t,to:n,seq:0,ack:0,streamId:e$(),controlFlags:0,payload:{type:"HANDSHAKE_RESP",status:r}}}function e9(e){return{streamId:e,controlFlags:8,payload:{type:"CLOSE"}}}function e7(e,t){return{streamId:e,controlFlags:4,payload:t}}function te(e){return(1&e)==1}function tt(e){var t={traceparent:"",tracestate:""};return eE.propagation.inject(e,t),t}function tn(e,t,n,r,i){var o=i?eE.propagation.extract(eS.context.active(),i):eS.context.active(),a=e.startSpan("river.session",{attributes:{component:"river","river.session.id":t,"river.session.to":n,"river.session.from":r}},o),s=eb.trace.setSpan(o,a);return{span:a,ctx:s}}function tr(e,t,n){var r=e.startSpan("river.connection",{attributes:{component:"river","river.connection.id":t.id},links:[{context:n.span.spanContext()}]},n.ctx),i=eb.trace.setSpan(n.ctx,r);return{span:r,ctx:i}}function ti(e,t){e.setStatus({code:em.SpanStatusCode.ERROR,message:t.message}),e.setAttributes({"river.error_code":t.code,"river.error_message":t.message})}function to(){return eb.trace.getTracer("river",tg)}var ta=function(){},ts={connectOnInvoke:!0,eagerlyConnect:!0};function tl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.handshakeOptions&&e.extendHandshake(n.handshakeOptions);var r=(0,eu._)({},ts,n);return r.eagerlyConnect&&e.connect(t),function e(t,n){return new Proxy(ta,{get:function(r,i){if("string"==typeof i)return e(t,(0,ey._)(n).concat([i]))},apply:function(e,r,i){return t({path:n,args:i})}})}(function(n){var i=(0,ed._)((0,ey._)(n.path),3),o=i[0],a=i[1],s=i[2];if(!(o&&a&&s))throw Error("invalid river call, ensure the service and procedure you are calling exists");var l=(0,ed._)(n.args,2),c=l[0],u=l[1];if(r.connectOnInvoke&&!e.sessions.has(t)&&e.connect(t),"rpc"!==s&&"subscribe"!==s&&"stream"!==s&&"upload"!==s)throw Error("invalid river call, unknown procedure type ".concat(s));return function(e,t,n,r,i,o,a){if("closed"===t.getStatus()){var s,l,c,u;return s=e,l=new eV,c=eq({code:eR,message:"transport is closed"}),l._pushValue(c),l._triggerClose(),(u=new eH({writeCb:function(){},closeCb:function(){}})).close(),tc(s,l,u)}var p,d,y,f,h,g,T,v=null!=(T=t.sessions.get(n))?T:t.createUnconnectedSession(n),m=t.getSessionBoundSendFn(n,v.id),S="rpc"===e||"subscription"===e,E=e$(),b=(p=t.tracer,y=eS.context.active(),f=p.startSpan("river.client.".concat(i,".").concat(o),{attributes:{component:"river","river.method.kind":e,"river.method.service":i,"river.method.name":o,"river.streamId":E,"span.kind":"client"},links:[{context:v.telemetry.span.spanContext()}],kind:ev.SpanKind.CLIENT},y),h=eb.trace.setSpan(y,f),g=(0,ep._)((0,eu._)({},v.loggingMetadata),{transportMessage:{procedureName:o,serviceName:i}}),f.isRecording()&&(g.telemetry={traceId:f.spanContext().traceId,spanId:f.spanContext().spanId}),null==(d=v.log)||d.info("invoked ".concat(i,".").concat(o),g),{span:f,ctx:h}),C=b.span,_=b.ctx,R=!0,I=new eH({writeCb:function(e){m({streamId:E,payload:e,controlFlags:0})},closeCb:function(){C.addEvent("reqWritable closed"),!S&&R&&m(e9(E)),O.isClosed()&&A()}}),O=new eV,k=function(){O._triggerClose(),C.addEvent("resReadable closed"),I.isClosed()&&A()};function A(){t.removeEventListener("message",w),t.removeEventListener("sessionStatus",N),null==a||a.removeEventListener("abort",U),C.end()}function U(){O.isClosed()&&I.isClosed()||(C.addEvent("sending cancel"),R=!1,O.isClosed()||(O._pushValue(eq({code:eO,message:"cancelled by client"})),k()),I.close(),m(e7(E,eq({code:eO,message:"cancelled by client"}))))}function w(e){var n,r,i,o,a,s;if(e.streamId===E){if(e.to!==t.clientId){null==(n=t.log)||n.error("got stream message from unexpected client",{clientId:t.clientId,transportMessage:e});return}if((4&e.controlFlags)==4){R=!1,C.addEvent("received cancel"),eC.Value.Check(eD,e.payload)?r=e.payload:(r=eq({code:eO,message:"stream cancelled with invalid payload"}),null==(i=t.log)||i.warn("got stream cancel without a valid protocol error",{clientId:t.clientId,transportMessage:e,validationErrors:(0,ey._)(eC.Value.Errors(eD,e.payload))})),O.isClosed()||(O._pushValue(r),k()),I.close();return}if(O.isClosed()){C.recordException("received message after response stream is closed"),null==(o=t.log)||o.error("received message after response stream is closed",{clientId:t.clientId,transportMessage:e});return}eC.Value.Check(eK,e.payload)||(eC.Value.Check(eB,e.payload)?O._pushValue(e.payload):null==(a=t.log)||a.error("Got non-control payload, but was not a valid result",{clientId:t.clientId,transportMessage:e,validationErrors:(0,ey._)(eC.Value.Errors(eB,e.payload))})),(8&e.controlFlags)==8&&(C.addEvent("received response close"),O.isClosed()?null==(s=t.log)||s.error("received stream close but readable was already closed"):k())}}function N(e){"closing"===e.status&&e.session.to===n&&v.id===e.session.id&&(R=!1,O.isClosed()||(O._pushValue(eq({code:eR,message:"".concat(n," unexpectedly disconnected")})),k()),I.close())}return null==a||a.addEventListener("abort",U),t.addEventListener("message",w),t.addEventListener("sessionStatus",N),m({streamId:E,serviceName:i,procedureName:o,tracing:tt(_),payload:r,controlFlags:S?10:2}),S&&I.close(),tc(e,O,I,t.log)}("subscribe"===s?"subscription":s,e,t,c,o,a,u?u.signal:void 0)},[])}function tc(e,t,n,r){if("subscription"===e)return{resReadable:t};if("rpc"===e)return tu(t,r);if("upload"===e){var i=!1;return{reqWritable:n,finalize:function(){if(i)throw Error("upload stream already finalized");return i=!0,n.isClosed()||n.close(),tu(t,r)}}}return{resReadable:t,reqWritable:n}}function tu(e,t){return(0,eo._)(function(){var n;return(0,ef._)(this,function(r){switch(r.label){case 0:return[4,e.collect()];case 1:return(n=r.sent()).length>1&&(null==t||t.error("Expected single message from server, got multiple")),[2,n[0]]}})})()}function tp(e){return(0,ec._)(e,Error)?e.message||"unknown reason":"[coerced to error] ".concat(String(e))}(0,es._)(function e(t,n,r,i){var o=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:200,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];(0,ea._)(this,e),(0,el._)(this,"transport",void 0),(0,el._)(this,"contextMap",void 0),(0,el._)(this,"log",void 0),(0,el._)(this,"middlewares",void 0),(0,el._)(this,"serverCancelledStreams",void 0),(0,el._)(this,"maxCancelledStreamTombstonesPerSession",void 0),(0,el._)(this,"streams",void 0),(0,el._)(this,"services",void 0),(0,el._)(this,"unregisterTransportListeners",void 0);var l={};this.middlewares=s,this.services=l,this.contextMap=new Map,i=null!=i?i:{};var c=!0,u=!1,p=void 0;try{for(var d,y=Object.entries(n)[Symbol.iterator]();!(c=(d=y.next()).done);c=!0){var f=(0,ed._)(d.value,2),h=f[0],g=f[1].instantiate(i);l[h]=g,this.contextMap.set(g,(0,ep._)((0,eu._)({},i),{state:g.state}))}}catch(e){u=!0,p=e}finally{try{c||null==y.return||y.return()}finally{if(u)throw p}}r&&t.extendHandshake(r),this.transport=t,this.streams=new Map,this.serverCancelledStreams=new Map,this.maxCancelledStreamTombstonesPerSession=a,this.log=t.log;var T=function(e){if(e.to!==o.transport.clientId){null==(d=o.log)||d.info("got msg with destination that isn't this server, ignoring",{clientId:o.transport.clientId,transportMessage:e});return}var n,r,i,a,s,l,c,u,p,d,y=e.streamId,f=o.streams.get(y);if(f)return void f.handleMsg(e);if(null==(p=o.serverCancelledStreams.get(e.from))||!p.has(y)){var h=o.validateNewProcStream(e);h&&(n=t.tracer,r=h.initialSession,i=h.procedure.type,a=h.serviceName,s=h.procedureName,l=h.streamId,c=h.tracingCtx,u=c?eE.propagation.extract(eS.context.active(),c):eS.context.active(),n.startActiveSpan("river.server.".concat(a,".").concat(s),{attributes:{component:"river","river.method.kind":i,"river.method.service":a,"river.method.name":s,"river.streamId":l,"span.kind":"server"},links:[{context:r.telemetry.span.spanContext()}],kind:ev.SpanKind.SERVER},u,function(e){o.createNewProcStream(e,h)}))}},v=function(e){if("closing"===e.status){var t=e.session.to;null==(a=o.log)||a.info("got session disconnect from ".concat(t,", cleaning up streams"),e.session.loggingMetadata);var n=!0,r=!1,i=void 0;try{for(var a,s,l=o.streams.values()[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;c.from===t&&c.handleSessionDisconnect()}}catch(e){r=!0,i=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}o.serverCancelledStreams.delete(t)}},m=function(e){"closed"===e.status&&o.unregisterTransportListeners()};this.unregisterTransportListeners=function(){o.transport.removeEventListener("message",T),o.transport.removeEventListener("sessionStatus",v),o.transport.removeEventListener("transportStatus",m)},this.transport.addEventListener("message",T),this.transport.addEventListener("sessionStatus",v),this.transport.addEventListener("transportStatus",m)},[{key:"createNewProcStream",value:function(e,t){var n=this,r=t.streamId,i=t.initialSession,o=t.procedureName,a=t.serviceName,s=t.procedure,l=t.sessionMetadata,c=t.serviceContext,u=t.initPayload,p=t.procClosesWithInit,d=t.passInitAsDataForBackwardsCompat,y=i.to,f=i.loggingMetadata,h=i.protocolVersion,g=i.id;f.telemetry={traceId:e.spanContext().traceId,spanId:e.spanContext().spanId};var T=!0,v=new AbortController,m=this.transport.getSessionBoundSendFn(y,g),S=function(e,t){n.cancelStream(y,m,e,t)},E=function(t){if(ti(e,t),!(_.isClosed()&&I.isClosed())){T=!1;var n=eq(t);_.isClosed()||(_._pushValue(n),R()),I.close(),S(r,n)}},b=function(){v.abort(),n.streams.delete(r)},C="rpc"===s.type||"upload"===s.type,_=new eV,R=function(){_._triggerClose(),"v1.1"!==h||C||I.isClosed()||I.close(),I.isClosed()&&b()};d&&_._pushValue(eF(u));var I=new eH({writeCb:function(t){t.ok||ti(e,t.payload),m({streamId:r,controlFlags:C?tf(h):0,payload:t}),C&&I.close()},closeCb:function(){if(!C&&T){var e=e9(r);e.controlFlags=tf(h),m(e)}"v1.1"!==h||_.isClosed()||R(),_.isClosed()&&b()}}),O=function(e,t){var r,i=tp(e);t.recordException((0,ec._)(e,Error)?e:Error(i)),null==(r=n.log)||r.error("".concat(a,".").concat(o," handler threw an uncaught error"),(0,ep._)((0,eu._)({},f),{transportMessage:{procedureName:o,serviceName:a},extras:{error:i,originalException:e},tags:["uncaught-handler-error"]})),E({code:e_,message:i})};p&&R();var k=(0,ep._)((0,eu._)({},c),{from:y,sessionId:g,metadata:l,span:e,cancel:function(e){var t={code:eO,message:null!=e?e:"cancelled by server procedure handler"};return E(t),eq(t)},signal:v.signal}),A=(0,ep._)((0,eu._)({},c),{sessionId:g,from:y,metadata:l,span:e,signal:v.signal,streamId:r,procedureName:o,serviceName:a});this.middlewares.reduceRight(function(e,t){return function(){t({ctx:A,reqInit:u,next:e})}},function(){(0,eo._)(function(){var t,n;return(0,ef._)(this,function(r){switch(r.label){case 0:switch(s.type){case"rpc":return[3,1];case"stream":return[3,6];case"subscription":return[3,11];case"upload":return[3,16]}return[3,21];case 1:return r.trys.push([1,3,4,5]),[4,s.handler({ctx:k,reqInit:u})];case 2:if(t=r.sent(),I.isClosed())return[2];return I.write(t),[3,5];case 3:return O(r.sent(),e),[3,5];case 4:case 9:case 14:case 19:return e.end(),[7];case 5:case 10:case 15:case 20:return[3,21];case 6:return r.trys.push([6,8,9,10]),[4,s.handler({ctx:k,reqInit:u,reqReadable:_,resWritable:I})];case 7:return r.sent(),[3,10];case 8:return O(r.sent(),e),[3,10];case 11:return r.trys.push([11,13,14,15]),[4,s.handler({ctx:k,reqInit:u,resWritable:I})];case 12:return r.sent(),[3,15];case 13:return O(r.sent(),e),[3,15];case 16:return r.trys.push([16,18,19,20]),[4,s.handler({ctx:k,reqInit:u,reqReadable:_})];case 17:if(n=r.sent(),I.isClosed())return[2];return I.write(n),[3,20];case 18:return O(r.sent(),e),[3,20];case 21:return[2]}})})()})(),v.signal.aborted||this.streams.set(r,{from:y,streamId:r,procedureName:o,serviceName:a,sessionMetadata:l,procedure:s,handleMsg:function(e){var t,r,i,o,a,l,c,u;if(e.from!==y){null==(r=n.log)||r.error("got stream message from unexpected client",(0,ep._)((0,eu._)({},f),{transportMessage:e,tags:["invariant-violation"]}));return}if(u=e.controlFlags,"v1.1"!==h&&(4&u)==4){eC.Value.Check(eN,e.payload)?i=e.payload:(i=eq({code:eO,message:"stream cancelled, client sent invalid payload"}),null==(o=n.log)||o.warn("got stream cancel without a valid protocol error",(0,ep._)((0,eu._)({},f),{transportMessage:e,validationErrors:(0,ey._)(eC.Value.Errors(eN,e.payload)),tags:["invalid-request"]}))),_.isClosed()||(_._pushValue(i),R()),I.close();return}if(_.isClosed()){null==(a=n.log)||a.warn("received message after request stream is closed",(0,ep._)((0,eu._)({},f),{transportMessage:e,tags:["invalid-request"]})),E({code:eI,message:"received message after request stream is closed"});return}if("requestData"in s&&eC.Value.Check(s.requestData,e.payload)){_._pushValue(eF(e.payload)),ty(e.controlFlags,h)&&R();return}eC.Value.Check(e4,e.payload)&&ty(e.controlFlags,h)?R():("requestData"in s?(c="message in requestData position did not match schema",l=eU(eC.Value.Errors(s.requestData,e.payload))):(l=eU(eC.Value.Errors(e4,e.payload)),c="message in control payload position did not match schema"),null==(t=n.log)||t.warn(c,(0,ep._)((0,eu._)({},f),{transportMessage:e,validationErrors:l.map(function(e){return{path:e.path,message:e.message}}),tags:["invalid-request"]})),E({code:eI,message:c,extras:{totalErrors:l.length,firstValidationErrors:l.slice(0,5)}}))},handleSessionDisconnect:function(){T=!1,_.isClosed()||(_._pushValue(eq({code:eR,message:"client unexpectedly disconnected"})),R()),I.close()}})}},{key:"getContext",value:function(e,t){var n=this.contextMap.get(e);if(!n){var r,i="no context found for ".concat(t);throw null==(r=this.log)||r.error(i,{clientId:this.transport.clientId,tags:["invariant-violation"]}),Error(i)}return n}},{key:"validateNewProcStream",value:function(e){var t=this,n=this.transport.sessions.get(e.from);if(!n)return null==(a=this.log)||a.error("couldn't find session for ".concat(e.from),{clientId:this.transport.clientId,transportMessage:e,tags:["invariant-violation"]}),null;var r=this.transport.getSessionBoundSendFn(e.from,n.id),i=function(n,i){t.cancelStream(e.from,r,n,i)},o=this.transport.sessionHandshakeMetadata.get(n.to);if(!o){var a,s,l="session doesn't have handshake metadata";return null==(s=this.log)||s.error(l,(0,ep._)((0,eu._)({},n.loggingMetadata),{tags:["invariant-violation"]})),i(e.streamId,eq({code:e_,message:l})),null}if((2&e.controlFlags)!=2){var c,u="can't create a new procedure stream from a message that doesn't have the stream open bit set";return null==(c=this.log)||c.warn(u,(0,ep._)((0,eu._)({},n.loggingMetadata),{clientId:this.transport.clientId,transportMessage:e,tags:["invalid-request"]})),i(e.streamId,eq({code:eI,message:u})),null}if(!e.serviceName){var p,d="missing service name in stream open message";return null==(p=this.log)||p.warn(d,(0,ep._)((0,eu._)({},n.loggingMetadata),{transportMessage:e,tags:["invalid-request"]})),i(e.streamId,eq({code:eI,message:d})),null}if(!e.procedureName){var y,f="missing procedure name in stream open message";return null==(y=this.log)||y.warn(f,(0,ep._)((0,eu._)({},n.loggingMetadata),{transportMessage:e,tags:["invalid-request"]})),i(e.streamId,eq({code:eI,message:f})),null}if(!(e.serviceName in this.services)){var h,g="couldn't find service ".concat(e.serviceName);return null==(h=this.log)||h.warn(g,(0,ep._)((0,eu._)({},n.loggingMetadata),{clientId:this.transport.clientId,transportMessage:e,tags:["invalid-request"]})),i(e.streamId,eq({code:eI,message:g})),null}var T=this.services[e.serviceName];if(!(e.procedureName in T.procedures)){var v,m="couldn't find a matching procedure for ".concat(e.serviceName,".").concat(e.procedureName);return null==(v=this.log)||v.warn(m,(0,ep._)((0,eu._)({},n.loggingMetadata),{transportMessage:e,tags:["invalid-request"]})),i(e.streamId,eq({code:eI,message:m})),null}var S=this.getContext(T,e.serviceName),E=T.procedures[e.procedureName];if(!["rpc","upload","stream","subscription"].includes(E.type))return null==(C=this.log)||C.error("got request for invalid procedure type ".concat(E.type," at ").concat(e.serviceName,".").concat(e.procedureName),(0,ep._)((0,eu._)({},n.loggingMetadata),{transportMessage:e,tags:["invariant-violation"]})),null;var b=!1;if("v1.1"===n.protocolVersion&&("upload"===E.type||"stream"===E.type)&&eC.Value.Check(E.requestData,e.payload)&&eC.Value.Check(E.requestInit,{}))b=!0;else if(!eC.Value.Check(E.requestInit,e.payload)){var C,_,R="procedure init failed validation";return null==(_=this.log)||_.warn(R,(0,ep._)((0,eu._)({},n.loggingMetadata),{clientId:this.transport.clientId,transportMessage:e,tags:["invalid-request"]})),i(e.streamId,eq({code:eI,message:R})),null}return{initialSession:n,streamId:e.streamId,procedureName:e.procedureName,serviceName:e.serviceName,tracingCtx:e.tracing,initPayload:e.payload,sessionMetadata:o,procedure:E,serviceContext:S,procClosesWithInit:ty(e.controlFlags,n.protocolVersion),passInitAsDataForBackwardsCompat:b}}},{key:"cancelStream",value:function(e,t,n,r){var i=this.serverCancelledStreams.get(e);i||(i=new td(this.maxCancelledStreamTombstonesPerSession),this.serverCancelledStreams.set(e,i)),i.add(n),t(e7(n,r))}},{key:"close",value:function(){return(0,eo._)(function(){var e,t,n,r,i,o,a;return(0,ef._)(this,function(s){switch(s.label){case 0:this.unregisterTransportListeners(),e=!0,t=!1,n=void 0,s.label=1;case 1:s.trys.push([1,6,7,8]),r=Object.keys(this.services)[Symbol.iterator](),s.label=2;case 2:if(e=(i=r.next()).done)return[3,5];return o=i.value,[4,this.services[o][Symbol.asyncDispose]()];case 3:s.sent(),s.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return a=s.sent(),t=!0,n=a,[3,8];case 7:try{e||null==r.return||r.return()}finally{if(t)throw n}return[7];case 8:return[2]}})}).call(this)}}]);var td=function(){function e(t){(0,ea._)(this,e),(0,el._)(this,"items",void 0),(0,el._)(this,"maxItems",void 0),this.items=new Set,this.maxItems=t}return(0,es._)(e,[{key:"add",value:function(e){if(this.items.has(e))this.items.delete(e);else if(this.items.size>=this.maxItems){var t=this.items.values().next();t.done||this.items.delete(t.value)}this.items.add(e)}},{key:"has",value:function(e){return this.items.has(e)}}]),e}();function ty(e,t){return"v1.1"===t?(4&e)==4:(8&e)==8}function tf(e){return"v1.1"===e?4:8}function th(e,t){return{schema:e,construct:t}}var tg="0.209.8";e.s(["ControlMessageHandshakeRequestSchema",()=>eJ,"ControlMessageHandshakeResponseSchema",()=>e3,"Err",()=>eq,"HandshakeErrorCustomHandlerFatalResponseCodes",()=>e0,"HandshakeErrorRetriableResponseCodes",()=>eZ,"Ok",()=>eF,"OpaqueTransportMessageSchema",()=>e6,"acceptedProtocolVersions",()=>eY,"coerceErrorString",()=>tp,"createClient",()=>tl,"createClientHandshakeOptions",()=>th,"createConnectionTelemetryInfo",()=>tr,"createSessionTelemetryInfo",()=>tn,"currentProtocolVersion",()=>eQ,"generateId",()=>e$,"getPropagationContext",()=>tt,"getTracer",()=>to,"handshakeRequestMessage",()=>e8,"handshakeResponseMessage",()=>e5,"isAcceptedProtocolVersion",()=>eX,"isAck",()=>te,"version",()=>tg],993228);var tT=e.i(399119),tv=e.i(663355),tm=e.i(862470),tS=e.i(445789),tE=e.i(119468),tb=e.i(463348),tC=e.i(886513),t_={debug:-1,info:0,warn:1,error:2},tR=function(e){return function(t,n){if(n&&!n.telemetry){var r=eb.trace.getSpan(eS.context.active());r&&(n.telemetry={traceId:r.spanContext().traceId,spanId:r.spanContext().spanId})}if(!(null==n?void 0:n.transportMessage))return void e(t,n);var i=n.transportMessage;i.payload,n.transportMessage=(0,tC._)(i,["payload"]),e(t,n)}},tI=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";(0,ea._)(this,e),(0,el._)(this,"minLevel",void 0),(0,el._)(this,"output",void 0),this.minLevel=n,this.output=t}return(0,es._)(e,[{key:"debug",value:function(e,t){t_[this.minLevel]<=t_.debug&&this.output(e,null!=t?t:{},"debug")}},{key:"info",value:function(e,t){t_[this.minLevel]<=t_.info&&this.output(e,null!=t?t:{},"info")}},{key:"warn",value:function(e,t){t_[this.minLevel]<=t_.warn&&this.output(e,null!=t?t:{},"warn")}},{key:"error",value:function(e,t){t_[this.minLevel]<=t_.error&&this.output(e,null!=t?t:{},"error")}}]),e}(),tO=function(e){return{debug:tR(e.debug.bind(e)),info:tR(e.info.bind(e)),warn:tR(e.warn.bind(e)),error:tR(e.error.bind(e))}},tk=e.i(944661),tA=e.i(259535),tU=e.i(726753),tw=e.i(770663),tN="conn_retry_exceeded",tM="handshake_failed",tD="invalid_message",tx="message_send_failure",tP=function(){function e(){(0,ea._)(this,e),(0,el._)(this,"eventListeners",{})}return(0,es._)(e,[{key:"removeAllListeners",value:function(){this.eventListeners={}}},{key:"numberOfListeners",value:function(e){var t,n;return null!=(n=null==(t=this.eventListeners[e])?void 0:t.size)?n:0}},{key:"addEventListener",value:function(e,t){var n;this.eventListeners[e]||(this.eventListeners[e]=new Set),null==(n=this.eventListeners[e])||n.add(t)}},{key:"removeEventListener",value:function(e,t){var n;this.eventListeners[e]&&(null==(n=this.eventListeners[e])||n.delete(t))}},{key:"dispatchEvent",value:function(e,t){var n=this.eventListeners[e];if(n){var r=(0,ey._)(n),i=!0,o=!1,a=void 0;try{for(var s,l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0)(0,s.value)(t)}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}}}}]),e}(),tL=new TextEncoder,tj=new TextDecoder,tB={heartbeatIntervalMs:1e3,heartbeatsUntilDead:2,sessionDisconnectGraceMs:5e3,connectionTimeoutMs:2e3,handshakeTimeoutMs:1e3,enableTransparentSessionReconnects:!0,codec:{toBuffer:function(e){return tL.encode(JSON.stringify(e,function(e){var t,n=this[e];return(0,ec._)(n,Uint8Array)?{$t:(t="",n.forEach(function(e){t+=String.fromCharCode(e)}),btoa(t))}:(void 0===n?"undefined":(0,tE._)(n))==="bigint"?{$b:n.toString()}:n}))},fromBuffer:function(e){var t=JSON.parse(tj.decode(e),function(e,t){return(null==t?void 0:t.$t)!==void 0?function(e){for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(t.$t):(null==t?void 0:t.$b)!==void 0?BigInt(t.$b):t});if((void 0===t?"undefined":(0,tE._)(t))!=="object"||null===t)throw Error("unpacked msg is not an object");return t}}},tF=(0,eu._)({},tB,{baseIntervalMs:150,maxJitterMs:200,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:200,isFatalConnectionError:function(){return!1}}),tq=(0,eu._)({},tB),tG=((n=tG||{}).NoConnection="NoConnection",n.BackingOff="BackingOff",n.Connecting="Connecting",n.Handshaking="Handshaking",n.Connected="Connected",n.WaitingForHandshake="WaitingForHandshake",n),tV="session state has been consumed and is no longer valid",tH=function(e){function t(e){var n,r=e.from,i=e.options,o=e.log,a=e.tracer,s=e.codec;return(0,ea._)(this,t),n=(0,tT._)(this,t),(0,el._)(n,"from",void 0),(0,el._)(n,"options",void 0),(0,el._)(n,"codec",void 0),(0,el._)(n,"tracer",void 0),(0,el._)(n,"log",void 0),n.from=r,n.options=i,n.log=o,n.tracer=a,n.codec=s,n}return(0,tS._)(t,e),t}(function(){function e(){return(0,ea._)(this,e),(0,el._)(this,"_isConsumed",void 0),this._isConsumed=!1,new Proxy(this,{get:function(e,t){if("_isConsumed"===t||"id"===t||"state"===t)return Reflect.get(e,t);if("_handleStateExit"===t)return function(){e._isConsumed=!0,e._handleStateExit()};if("_handleClose"===t)return function(){e._isConsumed=!0,e._handleStateExit(),e._handleClose()};if(e._isConsumed)throw Error("".concat(tV,": getting ").concat(t.toString()," on consumed state"));return Reflect.get(e,t)},set:function(e,t,n){if(e._isConsumed)throw Error("".concat(tV,": setting ").concat(t.toString()," on consumed state"));return Reflect.set(e,t,n)}})}return(0,es._)(e,[{key:"close",value:function(){this._handleClose()}}]),e}()),tW=function(e){function t(e){(0,ea._)(this,t);var n,r=e.id,i=e.to,o=e.seq,a=e.ack,s=e.sendBuffer,l=e.telemetry,c=e.log,u=e.protocolVersion,p=e.seqSent;return n=(0,tT._)(this,t,[e]),(0,el._)(n,"id",void 0),(0,el._)(n,"telemetry",void 0),(0,el._)(n,"to",void 0),(0,el._)(n,"protocolVersion",void 0),(0,el._)(n,"seq",void 0),(0,el._)(n,"seqSent",void 0),(0,el._)(n,"ack",void 0),(0,el._)(n,"sendBuffer",void 0),n.id=r,n.to=i,n.seq=o,n.ack=a,n.sendBuffer=s,n.telemetry=l,n.log=c,n.protocolVersion=u,n.seqSent=p,n}return(0,tS._)(t,e),(0,es._)(t,[{key:"loggingMetadata",get:function(){var e={clientId:this.from,connectedTo:this.to,sessionId:this.id};if(this.telemetry.span.isRecording()){var t=this.telemetry.span.spanContext();e.telemetry={traceId:t.traceId,spanId:t.spanId}}return e}},{key:"constructMsg",value:function(e){var t=(0,ep._)((0,eu._)({},e),{id:e$(),to:this.to,from:this.from,seq:this.seq,ack:this.ack});return this.seq++,t}},{key:"nextSeq",value:function(){return this.sendBuffer.length>0?this.sendBuffer[0].seq:this.seq}},{key:"send",value:function(e){var t=this.constructMsg(e);return this.sendBuffer.push(t),{ok:!0,value:t.id}}},{key:"_handleStateExit",value:function(){}},{key:"_handleClose",value:function(){this.sendBuffer.length=0,this.telemetry.span.end()}}]),t}(tH),t$=function(e){function t(e){var n;return(0,ea._)(this,t),n=(0,tT._)(this,t,[e]),(0,el._)(n,"graceExpiryTime",void 0),(0,el._)(n,"gracePeriodTimeout",void 0),(0,el._)(n,"listeners",void 0),n.listeners=e.listeners,n.graceExpiryTime=e.graceExpiryTime,n.gracePeriodTimeout=setTimeout(function(){n.listeners.onSessionGracePeriodElapsed()},n.graceExpiryTime-Date.now()),n}return(0,tS._)(t,e),(0,es._)(t,[{key:"_handleStateExit",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleStateExit",this).call(this),this.gracePeriodTimeout&&(clearTimeout(this.gracePeriodTimeout),this.gracePeriodTimeout=void 0)}},{key:"_handleClose",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleClose",this).call(this)}}]),t}(tW);function tz(e,t,n){var r=t.toBuffer(n);return r.ok?e.send(r.value)?{ok:!0,value:n.id}:{ok:!1,reason:"failed to send message"}:r}var tK=function(e){function t(e){var n;return(0,ea._)(this,t),n=(0,tT._)(this,t,[e]),(0,el._)(n,"state","Connecting"),(0,el._)(n,"connPromise",void 0),(0,el._)(n,"listeners",void 0),(0,el._)(n,"connectionTimeout",void 0),n.connPromise=e.connPromise,n.listeners=e.listeners,n.connPromise.then(function(e){n._isConsumed||n.listeners.onConnectionEstablished(e)},function(e){n._isConsumed||n.listeners.onConnectionFailed(e)}),n.connectionTimeout=setTimeout(function(){n.listeners.onConnectionTimeout()},n.options.connectionTimeoutMs),n}return(0,tS._)(t,e),(0,es._)(t,[{key:"bestEffortClose",value:function(){var e=this.log,t=this.loggingMetadata;this.connPromise.then(function(n){n.close(),null==e||e.info("connection eventually resolved but session has transitioned, closed connection",(0,eu._)({},t,n.loggingMetadata))}).catch(function(){})}},{key:"_handleStateExit",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleStateExit",this).call(this),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)}},{key:"_handleClose",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleClose",this).call(this),this.bestEffortClose()}}]),t}(t$),tQ=function(e){function t(){var e;return(0,ea._)(this,t),e=(0,tT._)(this,t,arguments),(0,el._)(e,"state","NoConnection"),e}return(0,tS._)(t,e),(0,es._)(t,[{key:"_handleClose",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleClose",this).call(this)}},{key:"_handleStateExit",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleStateExit",this).call(this)}}]),t}(t$),tY=function(e){function t(e){var n;return(0,ea._)(this,t),n=(0,tT._)(this,t,[e]),(0,el._)(n,"state","WaitingForHandshake"),(0,el._)(n,"conn",void 0),(0,el._)(n,"listeners",void 0),(0,el._)(n,"handshakeTimeout",void 0),(0,el._)(n,"onHandshakeData",function(e){var t=n.codec.fromBuffer(e);t.ok?n.listeners.onHandshake(t.value):n.listeners.onInvalidHandshake("could not parse handshake message: ".concat(t.reason),"MALFORMED_HANDSHAKE")}),n.conn=e.conn,n.listeners=e.listeners,n.handshakeTimeout=setTimeout(function(){n.listeners.onHandshakeTimeout()},n.options.handshakeTimeoutMs),n.conn.setDataListener(n.onHandshakeData),n.conn.setErrorListener(n.listeners.onConnectionErrored),n.conn.setCloseListener(n.listeners.onConnectionClosed),n}return(0,tS._)(t,e),(0,es._)(t,[{key:"loggingMetadata",get:function(){return(0,eu._)({clientId:this.from,connId:this.conn.id},this.conn.loggingMetadata)}},{key:"sendHandshake",value:function(e){return tz(this.conn,this.codec,e)}},{key:"_handleStateExit",value:function(){this.conn.removeDataListener(),this.conn.removeErrorListener(),this.conn.removeCloseListener(),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0}},{key:"_handleClose",value:function(){this.conn.close()}}]),t}(tH),tX=function(e){function t(e){var n;return(0,ea._)(this,t),n=(0,tT._)(this,t,[e]),(0,el._)(n,"state","Handshaking"),(0,el._)(n,"conn",void 0),(0,el._)(n,"listeners",void 0),(0,el._)(n,"handshakeTimeout",void 0),(0,el._)(n,"onHandshakeData",function(e){var t=n.codec.fromBuffer(e);t.ok?n.listeners.onHandshake(t.value):n.listeners.onInvalidHandshake("could not parse handshake message: ".concat(t.reason),"MALFORMED_HANDSHAKE")}),n.conn=e.conn,n.listeners=e.listeners,n.handshakeTimeout=setTimeout(function(){n.listeners.onHandshakeTimeout()},n.options.handshakeTimeoutMs),n.conn.setDataListener(n.onHandshakeData),n.conn.setErrorListener(n.listeners.onConnectionErrored),n.conn.setCloseListener(n.listeners.onConnectionClosed),n}return(0,tS._)(t,e),(0,es._)(t,[{key:"loggingMetadata",get:function(){return(0,eu._)({},(0,tv._)((0,tm._)(t.prototype),"loggingMetadata",this),this.conn.loggingMetadata)}},{key:"sendHandshake",value:function(e){return tz(this.conn,this.codec,e)}},{key:"_handleStateExit",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleStateExit",this).call(this),this.conn.removeDataListener(),this.conn.removeErrorListener(),this.conn.removeCloseListener(),this.handshakeTimeout&&(clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0)}},{key:"_handleClose",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleClose",this).call(this),this.conn.close()}}]),t}(t$),tJ=function(e){function t(e){var n;return(0,ea._)(this,t),n=(0,tT._)(this,t,[e]),(0,el._)(n,"state","Connected"),(0,el._)(n,"conn",void 0),(0,el._)(n,"listeners",void 0),(0,el._)(n,"heartbeatHandle",void 0),(0,el._)(n,"heartbeatMissTimeout",void 0),(0,el._)(n,"isActivelyHeartbeating",!1),(0,el._)(n,"onMessageData",function(e){var t=n.codec.fromBuffer(e);if(!t.ok)return void n.listeners.onInvalidMessage("could not parse message: ".concat(t.reason));var r=t.value;if(r.seq!==n.ack){if(r.seq<n.ack)null==(a=n.log)||a.debug("received duplicate msg (got seq: ".concat(r.seq,", wanted seq: ").concat(n.ack,"), discarding"),(0,ep._)((0,eu._)({},n.loggingMetadata),{transportMessage:r}));else{var i,o,a,s,l="received out-of-order msg, closing connection (got seq: ".concat(r.seq,", wanted seq: ").concat(n.ack,")");null==(s=n.log)||s.error(l,(0,ep._)((0,eu._)({},n.loggingMetadata),{transportMessage:r,tags:["invariant-violation"]})),n.telemetry.span.setStatus({code:em.SpanStatusCode.ERROR,message:l}),n.conn.close()}return}(null==(i=n.log)||i.debug("received msg",(0,ep._)((0,eu._)({},n.loggingMetadata),{transportMessage:r})),n.updateBookkeeping(r.ack,r.seq),te(r.controlFlags))?(null==(o=n.log)||o.debug("discarding msg (ack bit set)",(0,ep._)((0,eu._)({},n.loggingMetadata),{transportMessage:r})),n.isActivelyHeartbeating||n.sendHeartbeat()):n.listeners.onMessage(r)}),n.conn=e.conn,n.listeners=e.listeners,n.conn.setDataListener(n.onMessageData),n.conn.setCloseListener(n.listeners.onConnectionClosed),n.conn.setErrorListener(n.listeners.onConnectionErrored),n}return(0,tS._)(t,e),(0,es._)(t,[{key:"updateBookkeeping",value:function(e,t){this.sendBuffer=this.sendBuffer.filter(function(t){return t.seq>=e}),this.ack=t+1,this.heartbeatMissTimeout&&clearTimeout(this.heartbeatMissTimeout),this.startMissingHeartbeatTimeout()}},{key:"assertSendOrdering",value:function(e){if(e.seq>this.seqSent+1){var t,n="invariant violation: would have sent out of order msg (seq: ".concat(e.seq,", expected: ").concat(this.seqSent," + 1)");throw null==(t=this.log)||t.error(n,(0,ep._)((0,eu._)({},this.loggingMetadata),{transportMessage:e,tags:["invariant-violation"]})),Error(n)}}},{key:"send",value:function(e){var t=this.constructMsg(e);this.assertSendOrdering(t),this.sendBuffer.push(t);var n=tz(this.conn,this.codec,t);return n.ok?this.seqSent=t.seq:this.listeners.onMessageSendFailure(t,n.reason),n}},{key:"sendBufferedMessages",value:function(){if(this.sendBuffer.length>0){null==(r=this.log)||r.info("sending ".concat(this.sendBuffer.length," buffered messages, starting at seq ").concat(this.nextSeq()),this.loggingMetadata);var e=!0,t=!1,n=void 0;try{for(var r,i,o=this.sendBuffer[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this.assertSendOrdering(a);var s=tz(this.conn,this.codec,a);if(!s.ok)return this.listeners.onMessageSendFailure(a,s.reason),s;this.seqSent=a.seq}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}return{ok:!0,value:void 0}}},{key:"loggingMetadata",get:function(){return(0,eu._)({},(0,tv._)((0,tm._)(t.prototype),"loggingMetadata",this),this.conn.loggingMetadata)}},{key:"startMissingHeartbeatTimeout",value:function(){var e=this,t=this.options.heartbeatsUntilDead,n=t*this.options.heartbeatIntervalMs;this.heartbeatMissTimeout=setTimeout(function(){var r;null==(r=e.log)||r.info("closing connection to ".concat(e.to," due to inactivity (missed ").concat(t," heartbeats which is ").concat(n,"ms)"),e.loggingMetadata),e.telemetry.span.addEvent("closing connection due to missing heartbeat"),e.conn.close()},n)}},{key:"startActiveHeartbeat",value:function(){var e=this;this.isActivelyHeartbeating=!0,this.heartbeatHandle=setInterval(function(){e.sendHeartbeat()},this.options.heartbeatIntervalMs)}},{key:"sendHeartbeat",value:function(){var e;null==(e=this.log)||e.debug("sending heartbeat",this.loggingMetadata),this.send({streamId:"heartbeat",controlFlags:1,payload:{type:"ACK"}})}},{key:"_handleStateExit",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleStateExit",this).call(this),this.conn.removeDataListener(),this.conn.removeCloseListener(),this.conn.removeErrorListener(),this.heartbeatHandle&&(clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0),this.heartbeatMissTimeout&&(clearTimeout(this.heartbeatMissTimeout),this.heartbeatMissTimeout=void 0)}},{key:"_handleClose",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleClose",this).call(this),this.conn.close()}}]),t}(tW),tZ=function(e){function t(e){var n;return(0,ea._)(this,t),n=(0,tT._)(this,t,[e]),(0,el._)(n,"state","BackingOff"),(0,el._)(n,"listeners",void 0),(0,el._)(n,"backoffTimeout",void 0),n.listeners=e.listeners,n.backoffTimeout=setTimeout(function(){n.listeners.onBackoffFinished()},e.backoffMs),n}return(0,tS._)(t,e),(0,es._)(t,[{key:"_handleClose",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleClose",this).call(this)}},{key:"_handleStateExit",value:function(){(0,tv._)((0,tm._)(t.prototype),"_handleStateExit",this).call(this),this.backoffTimeout&&(clearTimeout(this.backoffTimeout),this.backoffTimeout=void 0)}}]),t}(t$),t0=new tA.ExtensionCodec;t0.register({type:0,encode:function(e){return(void 0===e?"undefined":(0,tE._)(e))!=="bigint"?null:e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER?(0,tw.encode)(Number(e)):(0,tw.encode)(String(e))},decode:function(e){var t=(0,tU.decode)(e);if("string"!=typeof t&&"number"!=typeof t)throw new tk.DecodeError("unexpected BigInt source: ".concat(void 0===t?"undefined":(0,tE._)(t)));return BigInt(t)}});var t1=function(){function e(t){(0,ea._)(this,e),this.codec=t}return(0,es._)(e,[{key:"toBuffer",value:function(e){try{return{ok:!0,value:this.codec.toBuffer(e)}}catch(e){return{ok:!1,reason:tp(e)}}}},{key:"fromBuffer",value:function(e){try{var t=this.codec.fromBuffer(e);if(!eC.Value.Check(e6,t))return{ok:!1,reason:"transport message schema mismatch"};return{ok:!0,value:t}}catch(e){return{ok:!1,reason:tp(e)}}}}]),e}();function t2(e){return{id:e.id,from:e.from,to:e.to,seq:e.seq,ack:e.ack,seqSent:e.seqSent,sendBuffer:e.sendBuffer,telemetry:e.telemetry,options:e.options,log:e.log,tracer:e.tracer,protocolVersion:e.protocolVersion,codec:e.codec}}function t3(e){return(0,ep._)((0,eu._)({},t2(e)),{graceExpiryTime:e.graceExpiryTime})}var t4=function(e,t,n,r,i,o,a){var s,l="session-".concat(e$()),c=tn(o,l,e,t),u=new tQ({listeners:n,id:l,from:t,to:e,seq:0,ack:0,seqSent:0,graceExpiryTime:Date.now()+r.sessionDisconnectGraceMs,sendBuffer:[],telemetry:c,options:r,protocolVersion:i,tracer:o,log:a,codec:new t1(r.codec)});return null==(s=u.log)||s.info("session ".concat(u.id," created in NoConnection state"),(0,ep._)((0,eu._)({},u.loggingMetadata),{tags:["state-transition"]})),u},t6=function(e,t,n,r,i,o){var a,s=new tY({conn:t,listeners:n,from:e,options:r,tracer:i,log:o,codec:new t1(r.codec)});return null==(a=s.log)||a.info("session created in WaitingForHandshake state",(0,ep._)((0,eu._)({},s.loggingMetadata),{tags:["state-transition"]})),s},t8={NoConnectionToBackingOff:function(e,t,n){var r,i=t3(e);e._handleStateExit();var o=new tZ((0,eu._)({backoffMs:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from NoConnection to BackingOff"),(0,ep._)((0,eu._)({},o.loggingMetadata),{tags:["state-transition"]})),o},BackingOffToConnecting:function(e,t,n){var r,i=t3(e);e._handleStateExit();var o=new tK((0,eu._)({connPromise:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from BackingOff to Connecting"),(0,ep._)((0,eu._)({},o.loggingMetadata),{tags:["state-transition"]})),o},ConnectingToHandshaking:function(e,t,n){var r,i=t3(e);e._handleStateExit();var o=new tX((0,eu._)({conn:t,listeners:n},i));return t.telemetry=tr(o.tracer,t,o.telemetry),null==(r=o.log)||r.info("session ".concat(o.id," transition from Connecting to Handshaking"),(0,ep._)((0,eu._)({},o.loggingMetadata),{tags:["state-transition"]})),o},HandshakingToConnected:function(e,t){var n,r=t2(e),i=e.conn;e._handleStateExit();var o=new tJ((0,eu._)({conn:i,listeners:t},r));return o.startMissingHeartbeatTimeout(),null==(n=o.log)||n.info("session ".concat(o.id," transition from Handshaking to Connected"),(0,ep._)((0,eu._)({},o.loggingMetadata),{tags:["state-transition"]})),o},WaitingForHandshakeToConnected:function(e,t,n,r,i,o,a){var s,l=e.conn,c=e.from,u=e.options,p=t?t2(t):{id:n,from:c,to:r,seq:0,ack:0,seqSent:0,sendBuffer:[],telemetry:tn(e.tracer,n,r,c,i),options:u,tracer:e.tracer,log:e.log,protocolVersion:a,codec:new t1(u.codec)};e._handleStateExit(),null==t||t._handleStateExit();var d=new tJ((0,eu._)({conn:l,listeners:o},p));return d.startMissingHeartbeatTimeout(),l.telemetry=tr(d.tracer,l,d.telemetry),null==(s=d.log)||s.info("session ".concat(d.id," transition from WaitingForHandshake to Connected"),(0,ep._)((0,eu._)({},d.loggingMetadata),{tags:["state-transition"]})),d},BackingOffToNoConnection:function(e,t){var n,r=t3(e);e._handleStateExit();var i=new tQ((0,eu._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from BackingOff to NoConnection"),(0,ep._)((0,eu._)({},i.loggingMetadata),{tags:["state-transition"]})),i},ConnectingToNoConnection:function(e,t){var n,r=t3(e);e.bestEffortClose(),e._handleStateExit();var i=new tQ((0,eu._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from Connecting to NoConnection"),(0,ep._)((0,eu._)({},i.loggingMetadata),{tags:["state-transition"]})),i},HandshakingToNoConnection:function(e,t){var n,r=t3(e);e.conn.close(),e._handleStateExit();var i=new tQ((0,eu._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from Handshaking to NoConnection"),(0,ep._)((0,eu._)({},i.loggingMetadata),{tags:["state-transition"]})),i},ConnectedToNoConnection:function(e,t){var n,r=t2(e),i=Date.now()+e.options.sessionDisconnectGraceMs;e.conn.close(),e._handleStateExit();var o=new tQ((0,eu._)({listeners:t,graceExpiryTime:i},r));return null==(n=o.log)||n.info("session ".concat(o.id," transition from Connected to NoConnection"),(0,ep._)((0,eu._)({},o.loggingMetadata),{tags:["state-transition"]})),o}},t5={entrypoint:t4,transition:{NoConnectionToBackingOff:t8.NoConnectionToBackingOff,BackingOffToConnecting:t8.BackingOffToConnecting,ConnectingToHandshaking:t8.ConnectingToHandshaking,HandshakingToConnected:t8.HandshakingToConnected,BackingOffToNoConnection:t8.BackingOffToNoConnection,ConnectingToNoConnection:t8.ConnectingToNoConnection,HandshakingToNoConnection:t8.HandshakingToNoConnection,ConnectedToNoConnection:t8.ConnectedToNoConnection}},t9={entrypoint:t6,transition:{WaitingForHandshakeToConnected:t8.WaitingForHandshakeToConnected,ConnectedToNoConnection:t8.ConnectedToNoConnection}},t7=function(){function e(t,n){(0,ea._)(this,e),(0,el._)(this,"status",void 0),(0,el._)(this,"clientId",void 0),(0,el._)(this,"eventDispatcher",void 0),(0,el._)(this,"options",void 0),(0,el._)(this,"log",void 0),(0,el._)(this,"tracer",void 0),(0,el._)(this,"sessions",void 0),this.options=(0,eu._)({},tB,n),this.eventDispatcher=new tP,this.clientId=t,this.status="open",this.sessions=new Map,this.tracer=to()}return(0,es._)(e,[{key:"bindLogger",value:function(e,t){if("function"==typeof e){this.log=tO(new tI(e,t));return}this.log=tO(e)}},{key:"handleMsg",value:function(e){"open"===this.getStatus()&&this.eventDispatcher.dispatchEvent("message",e)}},{key:"addEventListener",value:function(e,t){this.eventDispatcher.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.eventDispatcher.removeEventListener(e,t)}},{key:"protocolError",value:function(e){this.eventDispatcher.dispatchEvent("protocolError",e)}},{key:"close",value:function(){this.status="closed";var e=Array.from(this.sessions.values()),t=!0,n=!1,r=void 0;try{for(var i,o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;this.deleteSession(s)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}this.eventDispatcher.dispatchEvent("transportStatus",{status:this.status}),this.eventDispatcher.removeAllListeners(),null==(i=this.log)||i.info("manually closed transport",{clientId:this.clientId})}},{key:"getStatus",value:function(){return this.status}},{key:"createSession",value:function(e){var t=this.sessions.get(e.to);if(t){var n,r="attempt to create session for ".concat(e.to," but active session (").concat(t.id,") already exists");throw null==(n=this.log)||n.error(r,(0,ep._)((0,eu._)({},e.loggingMetadata),{tags:["invariant-violation"]})),Error(r)}this.sessions.set(e.to,e),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"created",session:e}),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,id:e.id})}},{key:"updateSession",value:function(e){var t=this.sessions.get(e.to);if(!t){var n,r="attempt to transition session for ".concat(e.to," but no active session exists");throw null==(n=this.log)||n.error(r,(0,ep._)((0,eu._)({},e.loggingMetadata),{tags:["invariant-violation"]})),Error(r)}if(t.id!==e.id){var i,o="attempt to transition active session for ".concat(e.to," but active session (").concat(t.id,") is different from handle (").concat(e.id,")");throw null==(i=this.log)||i.error(o,(0,ep._)((0,eu._)({},e.loggingMetadata),{tags:["invariant-violation"]})),Error(o)}this.sessions.set(e.to,e),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,id:e.id})}},{key:"deleteSession",value:function(e,t){if(!e._isConsumed){var n,r=e.loggingMetadata;r.tags&&(null==t?void 0:t.unhealthy)&&r.tags.push("unhealthy-session"),null==(n=e.log)||n.info("closing session ".concat(e.id),r),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"closing",session:e});var i=e.to;e.close(),this.sessions.delete(i),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"closed",session:{id:e.id,to:i}})}}},{key:"onSessionGracePeriodElapsed",value:function(e){var t;null==(t=this.log)||t.info("session to ".concat(e.to," grace period elapsed, closing"),e.loggingMetadata),this.deleteSession(e)}},{key:"onConnectingFailed",value:function(e){var t=this,n=t8.ConnectingToNoConnection(e,{onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(n)}});return this.updateSession(n),n}},{key:"onConnClosed",value:function(e){var t,n=this;return t="Handshaking"===e.state?t8.HandshakingToNoConnection(e,{onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(t)}}):t8.ConnectedToNoConnection(e,{onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(t)}}),this.updateSession(t),t}},{key:"getSessionBoundSendFn",value:function(e,t){var n=this;if("open"!==this.getStatus())throw Error("cannot get a bound send function on a closed transport");return function(r){var i=n.sessions.get(e);if(!i)throw Error("session scope for ".concat(t," has ended (close), can't send"));if(i.id!==t||i._isConsumed)throw Error("session scope for ".concat(t," has ended (transition), can't send"));var o=i.send(r);if(!o.ok)throw Error(o.reason);return o.value}}}]),e}(),ne=function(){function e(t){(0,ea._)(this,e),(0,el._)(this,"budgetConsumed",void 0),(0,el._)(this,"intervalHandle",void 0),(0,el._)(this,"options",void 0),this.options=t,this.budgetConsumed=0}return(0,es._)(e,[{key:"getBackoffMs",value:function(){if(0===this.getBudgetConsumed())return 0;var e=Math.max(0,this.getBudgetConsumed()-1),t=Math.floor(Math.random()*this.options.maxJitterMs);return Math.min(this.options.baseIntervalMs*Math.pow(2,e),this.options.maxBackoffMs)+t}},{key:"totalBudgetRestoreTime",get:function(){return this.options.budgetRestoreIntervalMs*this.options.attemptBudgetCapacity}},{key:"consumeBudget",value:function(){this.stopLeak(),this.budgetConsumed=this.getBudgetConsumed()+1}},{key:"getBudgetConsumed",value:function(){return this.budgetConsumed}},{key:"hasBudget",value:function(){return this.getBudgetConsumed()<this.options.attemptBudgetCapacity}},{key:"startRestoringBudget",value:function(){var e=this;this.intervalHandle||(this.intervalHandle=setInterval(function(){var t=e.budgetConsumed;if(!t)return void e.stopLeak();var n=t-1;0!==n&&(e.budgetConsumed=n)},this.options.budgetRestoreIntervalMs))}},{key:"stopLeak",value:function(){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0)}},{key:"close",value:function(){this.stopLeak()}}]),e}(),nt=function(e){function t(e,n){var r;return(0,ea._)(this,t),r=(0,tT._)(this,t,[e,n]),(0,el._)(r,"options",void 0),(0,el._)(r,"retryBudget",void 0),(0,el._)(r,"reconnectOnConnectionDrop",!0),(0,el._)(r,"handshakeExtensions",void 0),(0,el._)(r,"sessions",void 0),r.sessions=new Map,r.options=(0,eu._)({},tF,n),r.retryBudget=new ne(r.options),r}return(0,tS._)(t,e),(0,es._)(t,[{key:"extendHandshake",value:function(e){this.handshakeExtensions=e}},{key:"tryReconnecting",value:function(e){var t=this.sessions.get(e);!this.options.enableTransparentSessionReconnects&&t&&this.deleteSession(t),this.reconnectOnConnectionDrop&&"open"===this.getStatus()&&this.connect(e)}},{key:"createUnconnectedSession",value:function(e){var t=this,n=t5.entrypoint(e,this.clientId,{onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(n)}},this.options,eQ,this.tracer,this.log);return this.createSession(n),n}},{key:"onConnectingFailed",value:function(e){var n=(0,tv._)((0,tm._)(t.prototype),"onConnectingFailed",this).call(this,e);return this.tryReconnecting(n.to),n}},{key:"onConnClosed",value:function(e){var n=(0,tv._)((0,tm._)(t.prototype),"onConnClosed",this).call(this,e);return this.tryReconnecting(n.to),n}},{key:"onConnectionEstablished",value:function(e,t){var n=this,r=t5.transition.ConnectingToHandshaking(e,t,{onConnectionErrored:function(e){var t,i=tp(e);null==(t=n.log)||t.error("connection to ".concat(r.to," errored during handshake: ").concat(i),r.loggingMetadata)},onConnectionClosed:function(){var e;null==(e=n.log)||e.warn("connection to ".concat(r.to," closed during handshake"),r.loggingMetadata),n.onConnClosed(r)},onHandshake:function(e){n.onHandshakeResponse(r,e)},onInvalidHandshake:function(t,i){var o;null==(o=n.log)||o.error("invalid handshake: ".concat(t),r.loggingMetadata),n.deleteSession(e,{unhealthy:!0}),n.protocolError({type:tM,code:i,message:t})},onHandshakeTimeout:function(){var e;null==(e=n.log)||e.error("connection to ".concat(r.to," timed out during handshake"),r.loggingMetadata),n.onConnClosed(r)},onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(r)}});return this.updateSession(r),this.sendHandshake(r),r}},{key:"rejectHandshakeResponse",value:function(e,t,n){var r,i;null==(r=e.conn.telemetry)||r.span.setStatus({code:em.SpanStatusCode.ERROR,message:t}),null==(i=this.log)||i.warn(t,n),this.deleteSession(e,{unhealthy:!0})}},{key:"onHandshakeResponse",value:function(e,t){var n,r=this;if(!eC.Value.Check(e3,t.payload))return void this.rejectHandshakeResponse(e,"received invalid handshake response",(0,ep._)((0,eu._)({},e.loggingMetadata),{transportMessage:t,validationErrors:(0,ey._)(eC.Value.Errors(e3,t.payload))}));if(!t.payload.status.ok){var i=eC.Value.Check(eZ,t.payload.status.code),o="handshake failed: ".concat(t.payload.status.reason),a=e.to;this.rejectHandshakeResponse(e,o,(0,ep._)((0,eu._)({},e.loggingMetadata),{transportMessage:t})),i?this.tryReconnecting(a):this.protocolError({type:tM,code:t.payload.status.code,message:o});return}if(t.payload.status.sessionId!==e.id){var s="session id mismatch: expected ".concat(e.id,", got ").concat(t.payload.status.sessionId);this.rejectHandshakeResponse(e,s,(0,ep._)((0,eu._)({},e.loggingMetadata),{transportMessage:t}));return}null==(n=this.log)||n.info("handshake from ".concat(t.from," ok"),(0,ep._)((0,eu._)({},e.loggingMetadata),{transportMessage:t}));var l=t5.transition.HandshakingToConnected(e,{onConnectionErrored:function(e){var t,n,i=tp(e);(0,ec._)(e,Error)&&r.options.isFatalConnectionError(e)?(null==(t=r.log)||t.warn("connection to ".concat(l.to," fatally errored: ").concat(i),l.loggingMetadata),r.reconnectOnConnectionDrop=!1):null==(n=r.log)||n.warn("connection to ".concat(l.to," errored: ").concat(i),l.loggingMetadata)},onConnectionClosed:function(){var e;null==(e=r.log)||e.info("connection to ".concat(l.to," closed"),l.loggingMetadata),r.onConnClosed(l)},onMessage:function(e){r.handleMsg(e)},onInvalidMessage:function(e){var n;null==(n=r.log)||n.error("invalid message: ".concat(e),(0,ep._)((0,eu._)({},l.loggingMetadata),{transportMessage:t})),r.protocolError({type:tD,message:e}),r.deleteSession(l,{unhealthy:!0})},onMessageSendFailure:function(e,t){var n;null==(n=r.log)||n.error("failed to send message: ".concat(t),(0,ep._)((0,eu._)({},l.loggingMetadata),{transportMessage:e})),r.protocolError({type:tx,message:t}),r.deleteSession(l,{unhealthy:!0})}});l.sendBufferedMessages().ok&&(this.updateSession(l),this.retryBudget.startRestoringBudget())}},{key:"connect",value:function(e){var t=this;if("open"!==this.getStatus()){null==(i=this.log)||i.info("transport state is no longer open, cancelling attempt to connect to ".concat(e));return}var n=null!=(o=this.sessions.get(e))?o:this.createUnconnectedSession(e);if("NoConnection"!==n.state){null==(a=this.log)||a.debug("session to ".concat(e," has state ").concat(n.state,", skipping connect attempt"),n.loggingMetadata);return}if(!this.retryBudget.hasBudget()){var r,i,o,a,s,l=this.retryBudget.getBudgetConsumed(),c="tried to connect to ".concat(e," but retry budget exceeded (more than ").concat(l," attempts in the last ").concat(this.retryBudget.totalBudgetRestoreTime,"ms)");null==(s=this.log)||s.error(c,n.loggingMetadata),this.protocolError({type:tN,message:c});return}var u=this.retryBudget.getBackoffMs();null==(r=this.log)||r.info("attempting connection to ".concat(e," (").concat(u,"ms backoff)"),n.loggingMetadata),this.retryBudget.consumeBudget();var p=t5.transition.NoConnectionToBackingOff(n,u,{onBackoffFinished:function(){t.onBackoffFinished(p)},onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(p)}});this.updateSession(p)}},{key:"hardDisconnect",value:function(){var e=Array.from(this.sessions.values()),t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.deleteSession(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"onBackoffFinished",value:function(e){var t=this,n=e.tracer.startActiveSpan("connect",function(n){return(0,eo._)(function(){var t,r;return(0,ef._)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,3,4]),[4,this.createNewOutgoingConnection(e.to)];case 1:return[2,i.sent()];case 2:throw r=tp(t=i.sent()),n.recordException(r),n.setStatus({code:em.SpanStatusCode.ERROR}),t;case 3:return n.end(),[7];case 4:return[2]}})}).call(t)}),r=t5.transition.BackingOffToConnecting(e,n,{onConnectionEstablished:function(e){var n;null==(n=t.log)||n.debug("connection to ".concat(r.to," established"),(0,eu._)({},e.loggingMetadata,r.loggingMetadata)),t.onConnectionEstablished(r,e)},onConnectionFailed:function(e){var n,i=tp(e);null==(n=t.log)||n.error("error connecting to ".concat(r.to,": ").concat(i),r.loggingMetadata),t.onConnectingFailed(r)},onConnectionTimeout:function(){var e;null==(e=t.log)||e.error("connection to ".concat(r.to," timed out"),r.loggingMetadata),t.onConnectingFailed(r)},onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(r)}});this.updateSession(r)}},{key:"sendHandshake",value:function(e){return(0,eo._)(function(){var t,n,r,i,o;return(0,ef._)(this,function(a){switch(a.label){case 0:if(n=void 0,!this.handshakeExtensions)return[3,2];return[4,this.handshakeExtensions.construct()];case 1:n=a.sent(),a.label=2;case 2:if(e._isConsumed)return[2];return r=e8({from:this.clientId,to:e.to,sessionId:e.id,expectedSessionState:{nextExpectedSeq:e.ack,nextSentSeq:e.nextSeq()},metadata:n,tracing:tt(e.telemetry.ctx)}),null==(t=this.log)||t.debug("sending handshake request to ".concat(e.to),(0,ep._)((0,eu._)({},e.loggingMetadata),{transportMessage:r})),(i=e.sendHandshake(r)).ok||(null==(o=this.log)||o.error("failed to send handshake request: ".concat(i.reason),(0,ep._)((0,eu._)({},e.loggingMetadata),{transportMessage:r})),this.protocolError({type:tx,message:i.reason}),this.deleteSession(e,{unhealthy:!0})),[2]}})}).call(this)}},{key:"close",value:function(){this.retryBudget.close(),(0,tv._)((0,tm._)(t.prototype),"close",this).call(this)}}]),t}(t7);function nn(e,t){var n,r;return(0,ea._)(this,nn),n=(0,tT._)(this,nn,[e,t]),(0,el._)(n,"options",void 0),(0,el._)(n,"handshakeExtensions",void 0),(0,el._)(n,"sessionHandshakeMetadata",new Map),(0,el._)(n,"sessions",new Map),(0,el._)(n,"pendingSessions",new Set),n.sessions=new Map,n.options=(0,eu._)({},tq,t),null==(r=n.log)||r.info("initiated server transport",{clientId:n.clientId,protocolVersion:eQ}),n}(0,tS._)(nn,t7),(0,es._)(nn,[{key:"extendHandshake",value:function(e){this.handshakeExtensions=e}},{key:"deletePendingSession",value:function(e){e.close(),this.pendingSessions.delete(e)}},{key:"deleteSession",value:function(e,t){this.sessionHandshakeMetadata.delete(e.to),(0,tv._)((0,tm._)(nn.prototype),"deleteSession",this).call(this,e,t)}},{key:"handleConnection",value:function(e){var t,n=this;if("open"===this.getStatus()){null==(t=this.log)||t.info("new incoming connection",(0,ep._)((0,eu._)({},e.loggingMetadata),{clientId:this.clientId}));var r=!1,i=t9.entrypoint(this.clientId,e,{onConnectionClosed:function(){var e;null==(e=n.log)||e.warn("connection from unknown closed before handshake finished",i.loggingMetadata),n.deletePendingSession(i)},onConnectionErrored:function(e){var t,r=tp(e);null==(t=n.log)||t.warn("connection from unknown errored before handshake finished: ".concat(r),i.loggingMetadata),n.deletePendingSession(i)},onHandshakeTimeout:function(){var e;null==(e=n.log)||e.warn("connection from unknown timed out before handshake finished",i.loggingMetadata),n.deletePendingSession(i)},onHandshake:function(e){if(r){var t;null==(t=n.log)||t.error("received multiple handshake messages from pending session",(0,ep._)((0,eu._)({},i.loggingMetadata),{connectedTo:e.from,transportMessage:e})),n.deletePendingSession(i);return}r=!0,n.onHandshakeRequest(i,e)},onInvalidHandshake:function(e,t){var r;null==(r=n.log)||r.error("invalid handshake: ".concat(e),i.loggingMetadata),n.deletePendingSession(i),n.protocolError({type:tM,code:t,message:e})}},this.options,this.tracer,this.log);this.pendingSessions.add(i)}}},{key:"rejectHandshakeRequest",value:function(e,t,n,r,i){null==(o=e.conn.telemetry)||o.span.setStatus({code:em.SpanStatusCode.ERROR,message:n}),null==(a=this.log)||a.warn(n,i);var o,a,s,l=e5({from:this.clientId,to:t,status:{ok:!1,code:r,reason:n}}),c=e.sendHandshake(l);if(!c.ok){null==(s=this.log)||s.error("failed to send handshake response: ".concat(c.reason),(0,ep._)((0,eu._)({},e.loggingMetadata),{transportMessage:l})),this.protocolError({type:tx,message:c.reason}),this.deletePendingSession(e);return}this.protocolError({type:tM,code:r,message:n}),this.deletePendingSession(e)}},{key:"onHandshakeRequest",value:function(e,t){return(0,eo._)(function(){var n,r,i,o,a,s,l,c,u,p,d,y,f,h,g,T,v,m,S,E;return(0,ef._)(this,function(b){switch(b.label){case 0:if(n=this,!eC.Value.Check(eJ,t.payload))return this.rejectHandshakeRequest(e,t.from,"received invalid handshake request","MALFORMED_HANDSHAKE",(0,ep._)((0,eu._)({},e.loggingMetadata),{transportMessage:t,connectedTo:t.from,validationErrors:(0,ey._)(eC.Value.Errors(eJ,t.payload))})),[2];if(!eX(i=t.payload.protocolVersion))return this.rejectHandshakeRequest(e,t.from,"expected protocol version oneof [".concat(eY.toString(),"], got ").concat(i),"PROTOCOL_VERSION_MISMATCH",(0,ep._)((0,eu._)({},e.loggingMetadata),{connectedTo:t.from,transportMessage:t})),[2];if(o={},!this.handshakeExtensions)return[3,2];if(!eC.Value.Check(this.handshakeExtensions.schema,t.payload.metadata))return this.rejectHandshakeRequest(e,t.from,"received malformed handshake metadata","MALFORMED_HANDSHAKE_META",(0,ep._)((0,eu._)({},e.loggingMetadata),{connectedTo:t.from,validationErrors:(0,ey._)(eC.Value.Errors(this.handshakeExtensions.schema,t.payload.metadata))})),[2];return a=this.sessionHandshakeMetadata.get(t.from),[4,this.handshakeExtensions.validate(t.payload.metadata,a)];case 1:if(s=b.sent(),e._isConsumed)return[2];if(eC.Value.Check(e0,s))return this.rejectHandshakeRequest(e,t.from,"rejected by handshake handler",s,(0,ep._)((0,eu._)({},e.loggingMetadata),{connectedTo:t.from,clientId:this.clientId})),[2];o=s,b.label=2;case 2:if(l="new session",c=t.payload.expectedSessionState.nextExpectedSeq,u=t.payload.expectedSessionState.nextSentSeq,p=this.sessions.get(t.from),this.options.enableTransparentSessionReconnects&&p&&p.id===t.payload.sessionId){if(l="transparent reconnection",d=p.nextSeq(),u>(y=p.ack))return this.rejectHandshakeRequest(e,t.from,"client is in the future: server wanted next message to be ".concat(y," but client would have sent ").concat(u),"SESSION_STATE_MISMATCH",(0,ep._)((0,eu._)({},e.loggingMetadata),{connectedTo:t.from,transportMessage:t})),[2];if(d>c)return this.rejectHandshakeRequest(e,t.from,"server is in the future: client wanted next message to be ".concat(c," but server would have sent ").concat(d),"SESSION_STATE_MISMATCH",(0,ep._)((0,eu._)({},e.loggingMetadata),{connectedTo:t.from,transportMessage:t})),[2];"NoConnection"!==p.state&&(p=f=t9.transition.ConnectedToNoConnection(p,{onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(f)}}),this.updateSession(p))}else p&&(l="hard reconnection",null==(h=this.log)||h.info("client is reconnecting to a new session (".concat(t.payload.sessionId,") with an old session (").concat(p.id,") already existing, closing old session"),(0,ep._)((0,eu._)({},e.loggingMetadata),{connectedTo:t.from,sessionId:t.payload.sessionId})),this.deleteSession(p),p=void 0);if(!p&&(u>0||c>0))return l="unknown session",g=this.options.enableTransparentSessionReconnects?"client is trying to reconnect to a session the server don't know about: ".concat(t.payload.sessionId):"client is attempting a transparent reconnect to a session but the server does not support it: ".concat(t.payload.sessionId),this.rejectHandshakeRequest(e,t.from,g,"SESSION_STATE_MISMATCH",(0,ep._)((0,eu._)({},e.loggingMetadata),{connectedTo:t.from,transportMessage:t})),[2];if(T=t.payload.sessionId,null==(r=this.log)||r.info("handshake from ".concat(t.from," ok (").concat(l,"), responding with handshake success"),(0,ep._)((0,eu._)({},e.loggingMetadata),{connectedTo:t.from})),v=e5({from:this.clientId,to:t.from,status:{ok:!0,sessionId:T}}),!(m=e.sendHandshake(v)).ok)return null==(S=this.log)||S.error("failed to send handshake response: ".concat(m.reason),(0,ep._)((0,eu._)({},e.loggingMetadata),{transportMessage:v})),this.protocolError({type:tx,message:m.reason}),this.deletePendingSession(e),[2];if(this.pendingSessions.delete(e),!(E=t9.transition.WaitingForHandshakeToConnected(e,p,T,t.from,t.tracing,{onConnectionErrored:function(e){var t,r=tp(e);null==(t=n.log)||t.warn("connection to ".concat(E.to," errored: ").concat(r),E.loggingMetadata)},onConnectionClosed:function(){var e;null==(e=n.log)||e.info("connection to ".concat(E.to," closed"),E.loggingMetadata),n.onConnClosed(E)},onMessage:function(e){n.handleMsg(e)},onInvalidMessage:function(e){var r;null==(r=n.log)||r.error("invalid message: ".concat(e),(0,ep._)((0,eu._)({},E.loggingMetadata),{transportMessage:t})),n.protocolError({type:tD,message:e}),n.deleteSession(E,{unhealthy:!0})},onMessageSendFailure:function(e,t){var r;null==(r=n.log)||r.error("failed to send message: ".concat(t),(0,ep._)((0,eu._)({},E.loggingMetadata),{transportMessage:e})),n.protocolError({type:tx,message:t}),n.deleteSession(E,{unhealthy:!0})}},i)).sendBufferedMessages().ok)return[2];return this.sessionHandshakeMetadata.set(E.to,o),p?this.updateSession(E):this.createSession(E),E.startActiveHeartbeat(),[2]}})}).call(this)}}]);var nr=function(){function e(){(0,ea._)(this,e),(0,el._)(this,"id",void 0),(0,el._)(this,"telemetry",void 0),(0,el._)(this,"dataListener",void 0),(0,el._)(this,"closeListener",void 0),(0,el._)(this,"errorListener",void 0),this.id="conn-".concat(e$())}return(0,es._)(e,[{key:"loggingMetadata",get:function(){var e,t={connId:this.id};if(null==(e=this.telemetry)?void 0:e.span.isRecording()){var n=this.telemetry.span.spanContext();t.telemetry={traceId:n.traceId,spanId:n.spanId}}return t}},{key:"onData",value:function(e){var t;null==(t=this.dataListener)||t.call(this,e)}},{key:"onError",value:function(e){var t;null==(t=this.errorListener)||t.call(this,e)}},{key:"onClose",value:function(){var e,t;null==(e=this.closeListener)||e.call(this),null==(t=this.telemetry)||t.span.end()}},{key:"setDataListener",value:function(e){this.dataListener=e}},{key:"removeDataListener",value:function(){this.dataListener=void 0}},{key:"setCloseListener",value:function(e){this.closeListener=e}},{key:"removeCloseListener",value:function(){this.closeListener=void 0}},{key:"setErrorListener",value:function(e){this.errorListener=e}},{key:"removeErrorListener",value:function(){this.errorListener=void 0}}]),e}(),ni=function(e){function t(e,n){var r;return(0,ea._)(this,t),r=(0,tT._)(this,t,["websocket closed with code and reason: ".concat(e," - ").concat(n)]),(0,el._)(r,"code",void 0),(0,el._)(r,"reason",void 0),r.code=e,r.reason=n,r}return(0,tS._)(t,e),t}((0,tb._)(Error)),no=function(e){function t(e,n){(0,ea._)(this,t),r=(0,tT._)(this,t),(0,el._)(r,"ws",void 0),(0,el._)(r,"extras",void 0),r.ws=e,r.extras=n,r.ws.binaryType="arraybuffer";var r,i=!1;return r.ws.onerror=function(){i=!0},r.ws.onclose=function(e){var t=e.code,n=e.reason;if(i){var o=new ni(t,n);r.onError(o)}r.onClose()},r.ws.onmessage=function(e){r.onData(e.data)},r}return(0,tS._)(t,e),(0,es._)(t,[{key:"loggingMetadata",get:function(){var e=(0,tv._)((0,tm._)(t.prototype),"loggingMetadata",this);return this.extras&&(e.extras=this.extras),e}},{key:"send",value:function(e){try{return this.ws.send(e),!0}catch(e){return!1}}},{key:"close",value:function(){this.ws.close(1e3)}}]),t}(nr),na={codec:{toBuffer:function(e){return(0,tw.encode)(e,{ignoreUndefined:!0,extensionCodec:t0})},fromBuffer:function(e){var t=(0,tU.decode)(e,{extensionCodec:t0});if((void 0===t?"undefined":(0,tE._)(t))!=="object"||null===t)throw Error("unpacked msg is not an object");return t}},heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!0,sessionDisconnectGraceMs:15e3,connectionTimeoutMs:1e4,handshakeTimeoutMs:1e4};(0,eu._)({},na);var ns=(0,ep._)((0,eu._)({},na),{baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3}),nl=eh.Type.Object({token:eh.Type.String()}),nc=((r={})[r.AGENT_STATE_UNKNOWN=0]="AGENT_STATE_UNKNOWN",r[r.AGENT_STATE_RUNNING=1]="AGENT_STATE_RUNNING",r[r.AGENT_STATE_PAUSING=2]="AGENT_STATE_PAUSING",r[r.AGENT_STATE_PAUSED=3]="AGENT_STATE_PAUSED",r[r.AGENT_STATE_NOT_STARTED=4]="AGENT_STATE_NOT_STARTED",r),nu=((i={})[i.AGENT_FEEDBACK_UNKNOWN=0]="AGENT_FEEDBACK_UNKNOWN",i[i.AGENT_FEEDBACK_THUMB_UP=1]="AGENT_FEEDBACK_THUMB_UP",i[i.AGENT_FEEDBACK_THUMB_DOWN=2]="AGENT_FEEDBACK_THUMB_DOWN",i),np=((o={})[o.SECRET_UNKNOWN=0]="SECRET_UNKNOWN",o[o.SECRET_COMPLETED=1]="SECRET_COMPLETED",o[o.SECRET_IGNORED=2]="SECRET_IGNORED",o),nd=((a={})[a.UNKNOWN=0]="UNKNOWN",a[a.LOVABLE=1]="LOVABLE",a[a.BOLT=2]="BOLT",a[a.REPLIT=3]="REPLIT",a[a.OTHER_GITHUB=4]="OTHER_GITHUB",a[a.FIGMA=5]="FIGMA",a[a.VERCEL=6]="VERCEL",a),ny=((s={})[s.UNSPECIFIED=0]="UNSPECIFIED",s[s.PENDING=1]="PENDING",s[s.IN_PROGRESS=2]="IN_PROGRESS",s[s.COMPLETED=3]="COMPLETED",s[s.COMPLETED_PENDING_REVIEW=4]="COMPLETED_PENDING_REVIEW",s),nf=((l={})[l.STEP_UNKNOWN=0]="STEP_UNKNOWN",l[l.STEP_NOT_STARTED=1]="STEP_NOT_STARTED",l[l.STEP_IN_PROGRESS=2]="STEP_IN_PROGRESS",l[l.STEP_COMPLETE=3]="STEP_COMPLETE",l[l.STEP_FAILED=4]="STEP_FAILED",l[l.STEP_ABORTED=5]="STEP_ABORTED",l),nh=((c={})[c.UNKNOWN=0]="UNKNOWN",c[c.NEON_DATABASE=1]="NEON_DATABASE",c),ng=((u={})[u.NONE=0]="NONE",u[u.FLASK_VANILLA_JS=1]="FLASK_VANILLA_JS",u[u.PYTHON_API=2]="PYTHON_API",u[u.STREAMLIT=3]="STREAMLIT",u[u.FULLSTACK_JS=4]="FULLSTACK_JS",u[u.GAMESTACK_JS=5]="GAMESTACK_JS",u[u.CUSTOM=6]="CUSTOM",u[u.EXPO=7]="EXPO",u[u.AGENT=8]="AGENT",u),nT=((p={})[p.UNKNOWN_TRIGGER_TYPE=0]="UNKNOWN_TRIGGER_TYPE",p[p.SLACK_MESSAGE=1]="SLACK_MESSAGE",p[p.TELEGRAM_MESSAGE=2]="TELEGRAM_MESSAGE",p[p.TIME_BASED=3]="TIME_BASED",p[p.CONNECTOR_TRIGGER=4]="CONNECTOR_TRIGGER",p),nv=((d={})[d.UNSPECIFIED=0]="UNSPECIFIED",d[d.FEATURE=1]="FEATURE",d[d.STACK=2]="STACK",d[d.STYLING=3]="STYLING",d),nm=((y={})[y.UNSPECIFIED=0]="UNSPECIFIED",y[y.GENERAL=1]="GENERAL",y[y.REPLIT_DOCUMENTATION=2]="REPLIT_DOCUMENTATION",y),nS=((f={})[f.UNKNOWN=0]="UNKNOWN",f[f.SUCCESSFUL=1]="SUCCESSFUL",f[f.RECURSION_LIMIT_REACHED=2]="RECURSION_LIMIT_REACHED",f[f.EXCEPTION=3]="EXCEPTION",f),nE=((h={})[h.UNKNOWN=0]="UNKNOWN",h[h.REPL_CREATION_V1=1]="REPL_CREATION_V1",h),nb=((g={})[g.UNSPECIFIED=0]="UNSPECIFIED",g[g.URL_SCREENSHOT=1]="URL_SCREENSHOT",g[g.URL_CRAWL_CONTENT=2]="URL_CRAWL_CONTENT",g[g.URL_AS_PROMPT=3]="URL_AS_PROMPT",g[g.URL_CRAWL_HTML=4]="URL_CRAWL_HTML",g[g.URL_CRAWL_BRANDING=5]="URL_CRAWL_BRANDING",g),nC=((T={})[T.GENERATION_STATE_UNKNOWN=0]="GENERATION_STATE_UNKNOWN",T[T.GENERATION_IN_PROGRESS=1]="GENERATION_IN_PROGRESS",T[T.GENERATION_REGENERATING=2]="GENERATION_REGENERATING",T[T.GENERATION_COMPLETE=3]="GENERATION_COMPLETE",T[T.GENERATION_ERROR=4]="GENERATION_ERROR",T),n_=((v={})[v.UNKNOWN=0]="UNKNOWN",v[v.ENGLISH=1]="ENGLISH",v[v.CRON=2]="CRON",v),nR=((m={})[m.UNKNOWN=0]="UNKNOWN",m[m.BASIC=1]="BASIC",m[m.ADVANCED=2]="ADVANCED",m[m.OVERRIDE=3]="OVERRIDE",m),nI=((S={})[S.UNKNOWN=0]="UNKNOWN",S[S.FILE=1]="FILE",S[S.INLINE=2]="INLINE",S),nO=((E={})[E.UNKNOWN=0]="UNKNOWN",E[E.CONSOLE=1]="CONSOLE",E[E.LSP=2]="LSP",E),nk=((b={})[b.UNKNOWN=0]="UNKNOWN",b[b.IN_PROGRESS=1]="IN_PROGRESS",b[b.COMPLETE=2]="COMPLETE",b),nA=((C={})[C.UNKNOWN=0]="UNKNOWN",C[C.EXPLAIN_CODE=1]="EXPLAIN_CODE",C[C.DEBUGGER=2]="DEBUGGER",C[C.GENERATE_CODE=3]="GENERATE_CODE",C[C.TRANSFORM_CODE=4]="TRANSFORM_CODE",C),nU=((_={})[_.UNKNOWN=0]="UNKNOWN",_[_.USER=1]="USER",_[_.AI=2]="AI",_[_.SERVICE=3]="SERVICE",_),nw=((R={})[R.UNKNOWN=0]="UNKNOWN",R[R.CHAT=1]="CHAT",R[R.INLINE_CHAT=2]="INLINE_CHAT",R[R.SINGLE_USE_SESSION=3]="SINGLE_USE_SESSION",R[R.REPL_CREATION=4]="REPL_CREATION",R[R.AGENT_SESSION=5]="AGENT_SESSION",R[R.HOSTING_DEBUG_SUMMARY=6]="HOSTING_DEBUG_SUMMARY",R[R.REPL_CREATION_V2=7]="REPL_CREATION_V2",R[R.REPL_CREATION_V3=8]="REPL_CREATION_V3",R[R.AGENT_REPLAY_SESSION=9]="AGENT_REPLAY_SESSION",R[R.SAMPLING_SESSION=10]="SAMPLING_SESSION",R[R.SUB_AGENT=11]="SUB_AGENT",R),nN=((I={})[I.UNKNOWN=0]="UNKNOWN",I[I.MAX_TOKENS=1]="MAX_TOKENS",I[I.STOP_TOKEN=2]="STOP_TOKEN",I[I.SAFETY=3]="SAFETY",I[I.RECITATION=4]="RECITATION",I[I.TOOL_CALLS=5]="TOOL_CALLS",I[I.CONTENT_FILTER=6]="CONTENT_FILTER",I),nM=((O={})[O.UNKNOWN=0]="UNKNOWN",O[O.NONE=1]="NONE",O[O.REPLIT_DOCS=2]="REPLIT_DOCS",O[O.GENERATE=3]="GENERATE",O[O.EXPLAIN=4]="EXPLAIN",O[O.TRANSFORM=5]="TRANSFORM",O[O.DEBUG=6]="DEBUG",O[O.FIND_INTENT=7]="FIND_INTENT",O[O.AGENT=8]="AGENT",O[O.ITERATIVE_AGENT=9]="ITERATIVE_AGENT",O),nD=((k={})[k.UNKNOWN=0]="UNKNOWN",k[k.FREE=1]="FREE",k[k.CORE=2]="CORE",k[k.TEAMS=3]="TEAMS",k),nx=((A={})[A.UNKNOWN=0]="UNKNOWN",A[A.MANUALLY_ABORTED=1]="MANUALLY_ABORTED",A[A.INCOMPLETE_UPDATE=2]="INCOMPLETE_UPDATE",A[A.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",A[A.USAGE_LIMIT=4]="USAGE_LIMIT",A[A.TEST_ERROR=5]="TEST_ERROR",A[A.INVALID_INPUT=6]="INVALID_INPUT",A[A.UNAUTHORIZED=7]="UNAUTHORIZED",A[A.AGENT_EXECUTION_ERROR=8]="AGENT_EXECUTION_ERROR",A[A.AI_QUOTA_ERROR_UNKNOWN=9]="AI_QUOTA_ERROR_UNKNOWN",A[A.AI_QUOTA_INSUFFICIENT_BUDGET=10]="AI_QUOTA_INSUFFICIENT_BUDGET",A[A.AI_QUOTA_REQUIRES_PAYMENT_METHOD=11]="AI_QUOTA_REQUIRES_PAYMENT_METHOD",A[A.AI_QUOTA_REQUIRES_ACTIVE_SUBSCRIPTION=12]="AI_QUOTA_REQUIRES_ACTIVE_SUBSCRIPTION",A),nP=((U={})[U.UNSPECIFIED=0]="UNSPECIFIED",U[U.GENERAL=1]="GENERAL",U[U.DISCUSSION=2]="DISCUSSION",U[U.INITIAL_PLANNING=3]="INITIAL_PLANNING",U[U.QUICK_EDIT=4]="QUICK_EDIT",U),nL=((w={})[w.UNSPECIFIED=0]="UNSPECIFIED",w[w.SYNC=1]="SYNC",w[w.ASYNC=2]="ASYNC",w[w.DESIGN=3]="DESIGN",w[w.BUILD=4]="BUILD",w),nj=((N={})[N.UNSPECIFIED=0]="UNSPECIFIED",N[N.LOW=1]="LOW",N[N.MEDIUM=2]="MEDIUM",N[N.HIGH=3]="HIGH",N[N.MAX=4]="MAX",N),nB=((M={})[M.UNSPECIFIED=0]="UNSPECIFIED",M[M.STANDARD=1]="STANDARD",M[M.ADVANCED=2]="ADVANCED",M),nF=((D={})[D.SET=0]="SET",D[D.ADD=1]="ADD",D[D.CLEAR=2]="CLEAR",D[D.APPEND=3]="APPEND",D),nq=((x={})[x.UNSPECIFIED=0]="UNSPECIFIED",x[x.INSUFFICIENT_BUDGET=1]="INSUFFICIENT_BUDGET",x[x.REQUIRES_PAYMENT_METHOD=2]="REQUIRES_PAYMENT_METHOD",x[x.REQUIRES_ACTIVE_SUBSCRIPTION=3]="REQUIRES_ACTIVE_SUBSCRIPTION",x[x.AGENT_UNKNOWN_AUTHORIZATION_ERROR=4]="AGENT_UNKNOWN_AUTHORIZATION_ERROR",x[x.INSUFFICIENT_PERMISSIONS=5]="INSUFFICIENT_PERMISSIONS",x[x.INSUFFICIENT_QUOTA=6]="INSUFFICIENT_QUOTA",x[x.PAYMENT_DELINQUENT=7]="PAYMENT_DELINQUENT",x),nG=((P={})[P.NULL_VALUE=0]="NULL_VALUE",P),nV=((L={})[L.STRING=0]="STRING",L[L.INTEGER=1]="INTEGER",L),nH=((j={})[j.AGENT=0]="AGENT",j[j.USER=1]="USER",j[j.DEPLOYMENT=2]="DEPLOYMENT",j),nW=((B={})[B.UNSPECIFIED=0]="UNSPECIFIED",B[B.ZERO_RATED=1]="ZERO_RATED",B[B.NORMAL=2]="NORMAL",B),n$=((F={})[F.UNSPECIFIED=0]="UNSPECIFIED",F[F.RAPID_BUILD_FEEDBACK=1]="RAPID_BUILD_FEEDBACK",F[F.FEEDBACK_REQUESTED=2]="FEEDBACK_REQUESTED",F[F.AGENT_USAGE_MAX_THRESHOLD=3]="AGENT_USAGE_MAX_THRESHOLD",F[F.AGENT_USAGE_LIMIT_THRESHOLD=4]="AGENT_USAGE_LIMIT_THRESHOLD",F[F.USER_RESPONSE=5]="USER_RESPONSE",F[F.PROPOSE_PLAN_TOOL=6]="PROPOSE_PLAN_TOOL",F[F.LAST_MESSAGE=7]="LAST_MESSAGE",F[F.SESSION_START=8]="SESSION_START",F[F.NEON_DATABASE_EVENT=9]="NEON_DATABASE_EVENT",F[F.GENERATE_3D_MODEL=10]="GENERATE_3D_MODEL",F[F.CONTINUE_WITH_PLAN=11]="CONTINUE_WITH_PLAN",F[F.WORKSPACE_TRIGGERED_AGENT=12]="WORKSPACE_TRIGGERED_AGENT",F[F.WORKSPACE_TRIGGERED_USER=13]="WORKSPACE_TRIGGERED_USER",F[F.WORKSPACE_TRIGGERED_DEPLOYMENT=14]="WORKSPACE_TRIGGERED_DEPLOYMENT",F[F.PROPOSE_MVP_PLAN=15]="PROPOSE_MVP_PLAN",F[F.INTERMEDIATE_CHECKPOINT=16]="INTERMEDIATE_CHECKPOINT",F[F.PREREVERT=17]="PREREVERT",F[F.REVERT=18]="REVERT",F[F.TEST=19]="TEST",F[F.PLAN_APPROVED=20]="PLAN_APPROVED",F[F.REACT_LOOP_CAP_HIT=21]="REACT_LOOP_CAP_HIT",F[F.SUCCESS_TOOL=22]="SUCCESS_TOOL",F[F.LOOP_END=23]="LOOP_END",F[F.AGENT_PAUSE=24]="AGENT_PAUSE",F[F.COMPLETED_TASK=25]="COMPLETED_TASK",F[F.PLAN_TO_BUILD_TRANSITION=26]="PLAN_TO_BUILD_TRANSITION",F),nz=((q={})[q.DISCOUNTED_EFFORT_UNSPECIFIED=0]="DISCOUNTED_EFFORT_UNSPECIFIED",q[q.DISCOUNTED_EFFORT_FREE_HIGH_POWERED_MODE=1]="DISCOUNTED_EFFORT_FREE_HIGH_POWERED_MODE",q),nK=((G={})[G.REVERT_DATA_STAGE_UNKNOWN=0]="REVERT_DATA_STAGE_UNKNOWN",G[G.REVERT_DATA_STAGE_LOADING_PREVIOUS_STATE=1]="REVERT_DATA_STAGE_LOADING_PREVIOUS_STATE",G[G.REVERT_DATA_STAGE_SHUTTING_DOWN_WORKFLOWS=2]="REVERT_DATA_STAGE_SHUTTING_DOWN_WORKFLOWS",G[G.REVERT_DATA_STAGE_REVERTING_COMMIT=3]="REVERT_DATA_STAGE_REVERTING_COMMIT",G[G.REVERT_DATA_STAGE_RESTARTING_WORKFLOWS=4]="REVERT_DATA_STAGE_RESTARTING_WORKFLOWS",G[G.REVERT_DATA_STAGE_COMPLETE=5]="REVERT_DATA_STAGE_COMPLETE",G[G.REVERT_DATA_STAGE_ROLLING_BACK_DATABASE=6]="REVERT_DATA_STAGE_ROLLING_BACK_DATABASE",G[G.REVERT_DATA_STAGE_ROLLING_BACK_DEPLOYMENT=7]="REVERT_DATA_STAGE_ROLLING_BACK_DEPLOYMENT",G),nQ=((V={})[V.MEDIA_TYPE_UNKNOWN=0]="MEDIA_TYPE_UNKNOWN",V[V.MEDIA_TYPE_IMAGE=1]="MEDIA_TYPE_IMAGE",V[V.MEDIA_TYPE_VIDEO=2]="MEDIA_TYPE_VIDEO",V[V.MEDIA_TYPE_3D_MODEL=3]="MEDIA_TYPE_3D_MODEL",V),nY=((H={})[H.UNSPECIFIED=0]="UNSPECIFIED",H[H.ONE=1]="ONE",H[H.ALL=2]="ALL",H),nX=((W={})[W.UNSPECIFIED=0]="UNSPECIFIED",W[W.PENDING=1]="PENDING",W[W.ACKNOWLEDGED_CONTINUE_CURRENT_STEP=2]="ACKNOWLEDGED_CONTINUE_CURRENT_STEP",W[W.ACKNOWLEDGED_ABORT_CURRENT_STEP=3]="ACKNOWLEDGED_ABORT_CURRENT_STEP",W),nJ=(($={})[$.SUCCESS=0]="SUCCESS",$[$.FAILURE=1]="FAILURE",$[$.UNABLE=3]="UNABLE",$),nZ=((z={})[z.UNKNOWN=0]="UNKNOWN",z[z.THOUGHTS_ONLY=1]="THOUGHTS_ONLY",z[z.ALL_EVENTS=2]="ALL_EVENTS",z),n0=((K={})[K.UNSPECIFIED=0]="UNSPECIFIED",K[K.ENVIRONMENT_SETUP=1]="ENVIRONMENT_SETUP",K[K.SAMPLING=2]="SAMPLING",K[K.RANKING=3]="RANKING",K[K.APPLYING=4]="APPLYING",K[K.CONCLUDED=5]="CONCLUDED",K),n1=((Q={})[Q.UNSPECIFIED=0]="UNSPECIFIED",Q[Q.ENVIRONMENT_SETUP=5]="ENVIRONMENT_SETUP",Q[Q.IN_PROGRESS=1]="IN_PROGRESS",Q[Q.SUCCESSFUL=2]="SUCCESSFUL",Q[Q.FAILED=3]="FAILED",Q[Q.CHOSEN=4]="CHOSEN",Q),n2=((Y={})[Y.VISUAL_STARTED=0]="VISUAL_STARTED",Y[Y.VISUAL_COMPLETE_PENDING_REVIEW=1]="VISUAL_COMPLETE_PENDING_REVIEW",Y[Y.VISUAL_COMPLETE=2]="VISUAL_COMPLETE",Y[Y.MVP_STARTED=3]="MVP_STARTED",Y[Y.MVP_COMPLETE_PENDING_REVIEW=4]="MVP_COMPLETE_PENDING_REVIEW",Y[Y.MVP_COMPLETE=5]="MVP_COMPLETE",Y),n3=((X={})[X.UNKNOWN=0]="UNKNOWN",X[X.LOG_FILE=1]="LOG_FILE",X),n4=((J={})[J.UNSPECIFIED=0]="UNSPECIFIED",J[J.INFO=1]="INFO",J[J.WARNING=2]="WARNING",J[J.ERROR=3]="ERROR",J),n6=((Z={})[Z.NONE=0]="NONE",Z[Z.OPEN_MCP_PANE=1]="OPEN_MCP_PANE",Z),n8=((ee={})[ee.UNSPECIFIED=0]="UNSPECIFIED",ee[ee.DEVELOPMENT=1]="DEVELOPMENT",ee[ee.PRODUCTION=2]="PRODUCTION",ee[ee.SHARED=3]="SHARED",ee),n5=((et={})[et.UNSPECIFIED=0]="UNSPECIFIED",et[et.ENV=1]="ENV",et[et.SECRET=2]="SECRET",et);e.s(["AgentAuthorizationFailedCode",()=>nq,"AgentInitialBuildMode",()=>nL,"AgentMode",()=>nP,"AgentPlanStepStatus",()=>nf,"AgentRunState",()=>nc,"AgentStackTriggerType",()=>nT,"AgentUserFeedbackType",()=>nu,"AlertLevel",()=>n4,"AlertNextAction",()=>n6,"AttachedFormType",()=>nE,"AutonomyLevel",()=>nj,"BYOPromptResponseParameterType",()=>nV,"BenchmarkConclusionReason",()=>nS,"BlueprintCategory",()=>nv,"CheckpointTriggerReason",()=>n$,"CodeReferenceType",()=>nI,"CommitAuthor",()=>nH,"CommitBillingRate",()=>nW,"DebugErrorSource",()=>nO,"DiscountedEffortType",()=>nz,"EnvironmentType",()=>n8,"EnvironmentVariableType",()=>n5,"EventErrorType",()=>nx,"EventState",()=>nk,"FileChangeGenerationState",()=>nC,"GeneralSubagentEventFilter",()=>nZ,"GeneratedMediaType",()=>nQ,"InitialBuildPhase",()=>n2,"InlineMessageType",()=>nA,"MembershipType",()=>nD,"MessageAction",()=>nM,"MessageStopReason",()=>nN,"ModelProfile",()=>nB,"ModelType",()=>nR,"NullValue",()=>nG,"ProjectImportSource",()=>nd,"RequestFeatureAddType",()=>nh,"RevertStatus",()=>nK,"SamplingEventState",()=>n0,"SessionType",()=>nw,"SpecialFileType",()=>n3,"StackBlueprint",()=>ng,"StepTooComplexEventContentsState",()=>nX,"TaskStatus",()=>ny,"TrajectoryState",()=>n1,"TranslationTarget",()=>n_,"UITestingSubagentResultType",()=>nJ,"UpdateEventOperationType",()=>nF,"UrlIntent",()=>nb,"UserSecretResponseStatus",()=>np,"UserType",()=>nU,"WaitingForBackgroundJobType",()=>nY,"WebSearchType",()=>nm],806240);var n9=eh.Type.Module({AgentRunState:eh.Type.Enum(nc),AgentUserFeedbackType:eh.Type.Enum(nu),UserSecretResponseStatus:eh.Type.Enum(np),ProjectImportSource:eh.Type.Enum(nd),TaskStatus:eh.Type.Enum(ny),AgentPlanStepStatus:eh.Type.Enum(nf),RequestFeatureAddType:eh.Type.Enum(nh),StackBlueprint:eh.Type.Enum(ng),AgentStackTriggerType:eh.Type.Enum(nT),BlueprintCategory:eh.Type.Enum(nv),WebSearchType:eh.Type.Enum(nm),BenchmarkConclusionReason:eh.Type.Enum(nS),AttachedFormType:eh.Type.Enum(nE),UrlIntent:eh.Type.Enum(nb),FileChangeGenerationState:eh.Type.Enum(nC),TranslationTarget:eh.Type.Enum(n_),ModelType:eh.Type.Enum(nR),CodeReferenceType:eh.Type.Enum(nI),DebugErrorSource:eh.Type.Enum(nO),EventState:eh.Type.Enum(nk),InlineMessageType:eh.Type.Enum(nA),UserType:eh.Type.Enum(nU),SessionType:eh.Type.Enum(nw),MessageStopReason:eh.Type.Enum(nN),MessageAction:eh.Type.Enum(nM),MembershipType:eh.Type.Enum(nD),EventErrorType:eh.Type.Enum(nx),AgentMode:eh.Type.Enum(nP),AgentInitialBuildMode:eh.Type.Enum(nL),AutonomyLevel:eh.Type.Enum(nj),ModelProfile:eh.Type.Enum(nB),UpdateEventOperationType:eh.Type.Enum(nF),AgentAuthorizationFailedCode:eh.Type.Enum(nq),NullValue:eh.Type.Enum(nG),BYOPromptResponseParameterType:eh.Type.Enum(nV),CommitAuthor:eh.Type.Enum(nH),CommitBillingRate:eh.Type.Enum(nW),CheckpointTriggerReason:eh.Type.Enum(n$),DiscountedEffortType:eh.Type.Enum(nz),RevertStatus:eh.Type.Enum(nK),GeneratedMediaType:eh.Type.Enum(nQ),WaitingForBackgroundJobType:eh.Type.Enum(nY),StepTooComplexEventContentsState:eh.Type.Enum(nX),UITestingSubagentResultType:eh.Type.Enum(nJ),GeneralSubagentEventFilter:eh.Type.Enum(nZ),SamplingEventState:eh.Type.Enum(n0),TrajectoryState:eh.Type.Enum(n1),InitialBuildPhase:eh.Type.Enum(n2),SpecialFileType:eh.Type.Enum(n3),AlertLevel:eh.Type.Enum(n4),AlertNextAction:eh.Type.Enum(n6),EnvironmentType:eh.Type.Enum(n8),EnvironmentVariableType:eh.Type.Enum(n5),RevertToCommitRequest:eh.Type.Object({replId:eh.Type.String(),targetCommitId:eh.Type.String(),newSessionTitle:eh.Type.String(),originalSessionId:eh.Type.String(),databaseRollbackTimestamp:eh.Type.String(),deploymentBuildId:eh.Type.String(),rollbackDatabase:eh.Type.Boolean(),revertedToSessionId:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),revertedToEventId:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()]))}),RevertToCommitResponse:eh.Type.Object({revertedSessionId:eh.Type.String()}),CloneSessionRequest:eh.Type.Object({sessionId:eh.Type.String(),newReplId:eh.Type.String(),sessionType:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("SessionType"),eh.Type.Undefined()]))}),CloneSessionResponse:eh.Type.Object({clonedSessionId:eh.Type.String()}),Ping:eh.Type.Object({}),Pong:eh.Type.Object({}),Event:eh.Type.Object({id:eh.Type.String(),parentEventId:eh.Type.String(),contents:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventContents"),eh.Type.Undefined()])),context:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventContext"),eh.Type.Undefined()])),state:eh.Type.Ref("EventState"),created:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()])),updated:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()])),sender:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("UserContext"),eh.Type.Undefined()])),sessionId:eh.Type.String(),updateEventOperations:eh.Type.Array(eh.Type.Ref("UpdateEventOperation")),typedUpdateEventOperations:eh.Type.Array(eh.Type.Ref("TypedUpdateEventOperation")),error:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventError"),eh.Type.Undefined()])),agentStepId:eh.Type.String()}),EventShape:eh.Type.Object({id:eh.Type.String(),parentEventId:eh.Type.String(),created:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()]))}),AgentUserFeedback:eh.Type.Object({type:eh.Type.Ref("AgentUserFeedbackType"),comment:eh.Type.String()}),SubmitAgentUserFeedbackRequest:eh.Type.Object({sessionId:eh.Type.String(),sourceEventId:eh.Type.String(),feedback:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentUserFeedback"),eh.Type.Undefined()])),sessionType:eh.Type.Ref("SessionType")}),SubmitAgentUserFeedbackResponse:eh.Type.Object({}),ReplAgentState:eh.Type.Object({activeAgentSessionId:eh.Type.String()}),Session:eh.Type.Object({id:eh.Type.String(),title:eh.Type.String(),sessionType:eh.Type.Ref("SessionType"),replId:eh.Type.String(),events:eh.Type.Array(eh.Type.Ref("Event")),sessionCreationEventId:eh.Type.String(),archived:eh.Type.Boolean(),lastEventTime:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()])),created:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()])),updated:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()])),activeEventId:eh.Type.String(),readOnly:eh.Type.Boolean(),taskId:eh.Type.String(),revertedToSessionId:eh.Type.String(),revertedToEventId:eh.Type.String()}),Secret:eh.Type.Object({description:eh.Type.String(),key:eh.Type.String()}),SecretRequestAction:eh.Type.Object({secrets:eh.Type.Array(eh.Type.Ref("Secret"))}),UserSecretResponse:eh.Type.Object({key:eh.Type.String(),status:eh.Type.Ref("UserSecretResponseStatus")}),DeployRequest:eh.Type.Object({}),DeployResponse:eh.Type.Object({success:eh.Type.Boolean()}),MessageButton:eh.Type.Object({name:eh.Type.String(),description:eh.Type.String(),responseText:eh.Type.String()}),DeployRequestAction:eh.Type.Object({}),MessageButtonAction:eh.Type.Object({buttons:eh.Type.Array(eh.Type.Ref("MessageButton"))}),AgentUserSecretsRequest:eh.Type.Object({secrets:eh.Type.Array(eh.Type.Ref("Secret")),message:eh.Type.String()}),AgentUserSecretsResponse:eh.Type.Object({providedSecrets:eh.Type.Array(eh.Type.Ref("UserSecretResponse"))}),AgentDebugRequest:eh.Type.Object({enabled:eh.Type.Boolean(),isSelected:eh.Type.Boolean()}),AgentDebugResponse:eh.Type.Object({accepted:eh.Type.Boolean()}),AgentContinueRequest:eh.Type.Object({enabled:eh.Type.Boolean(),isSelected:eh.Type.Boolean()}),AgentContinueResponse:eh.Type.Object({accepted:eh.Type.Boolean()}),AgentNewFeatureRequest:eh.Type.Object({featureName:eh.Type.String(),id:eh.Type.Number(),isSelected:eh.Type.Boolean()}),UserMessageContents:eh.Type.Object({content:eh.Type.String(),uploadedFiles:eh.Type.Array(eh.Type.Ref("UploadedFile")),attachedUrls:eh.Type.Array(eh.Type.Ref("AttachedUrl"))}),AgentNewFeatureResponse:eh.Type.Object({selectedFeatureId:eh.Type.Number(),featureName:eh.Type.String(),userMessage:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("UserMessageContents"),eh.Type.Undefined()]))}),AgentDeployRequest:eh.Type.Object({}),AgentDeployResponse:eh.Type.Object({}),AgentAction:eh.Type.Object({optionType:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("messageButtonAction"),value:eh.Type.Ref("MessageButtonAction")}),eh.Type.Object({$case:eh.Type.Literal("secretRequestAction"),value:eh.Type.Ref("SecretRequestAction")}),eh.Type.Object({$case:eh.Type.Literal("deployRequestAction"),value:eh.Type.Ref("DeployRequestAction")}),eh.Type.Undefined()]))}),AgentNextStepRequest:eh.Type.Object({newFeatureRequests:eh.Type.Array(eh.Type.Ref("AgentNewFeatureRequest")),debugRequest:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentDebugRequest"),eh.Type.Undefined()])),keepWorkingRequest:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentContinueRequest"),eh.Type.Undefined()]))}),AgentNextStepResponse:eh.Type.Object({response:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("newFeatureResponse"),value:eh.Type.Ref("AgentNewFeatureResponse")}),eh.Type.Object({$case:eh.Type.Literal("debugResponse"),value:eh.Type.Ref("AgentDebugResponse")}),eh.Type.Object({$case:eh.Type.Literal("keepWorkingResponse"),value:eh.Type.Ref("AgentContinueResponse")}),eh.Type.Undefined()]))}),AgentQueryBoolean:eh.Type.Object({question:eh.Type.String(),confirmText:eh.Type.String(),rejectText:eh.Type.String(),allowAutoConfirm:eh.Type.Boolean()}),AgentQueryChoice:eh.Type.Object({question:eh.Type.String(),options:eh.Type.Array(eh.Type.String())}),AgentQueryText:eh.Type.Object({question:eh.Type.String(),responsePlaceholderText:eh.Type.String()}),AgentQuery:eh.Type.Object({queryType:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("booleanQuery"),value:eh.Type.Ref("AgentQueryBoolean")}),eh.Type.Object({$case:eh.Type.Literal("choiceQuery"),value:eh.Type.Ref("AgentQueryChoice")}),eh.Type.Object({$case:eh.Type.Literal("textQuery"),value:eh.Type.Ref("AgentQueryText")}),eh.Type.Undefined()]))}),AgentQueryBooleanResponse:eh.Type.Object({response:eh.Type.Boolean(),reason:eh.Type.String()}),AgentQueryChoiceResponse:eh.Type.Object({response:eh.Type.String(),reason:eh.Type.String()}),AgentQueryTextResponse:eh.Type.Object({response:eh.Type.String()}),AgentQueryNoResponse:eh.Type.Object({}),AgentQueryResponse:eh.Type.Object({responseType:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("booleanResponse"),value:eh.Type.Ref("AgentQueryBooleanResponse")}),eh.Type.Object({$case:eh.Type.Literal("choiceResponse"),value:eh.Type.Ref("AgentQueryChoiceResponse")}),eh.Type.Object({$case:eh.Type.Literal("textResponse"),value:eh.Type.Ref("AgentQueryTextResponse")}),eh.Type.Object({$case:eh.Type.Literal("noResponse"),value:eh.Type.Ref("AgentQueryNoResponse")}),eh.Type.Undefined()]))}),QueryResponseContent:eh.Type.Object({responses:eh.Type.Array(eh.Type.Ref("AgentQueryResponse"))}),QueryRequestContent:eh.Type.Object({contextSummary:eh.Type.String(),queries:eh.Type.Array(eh.Type.Ref("AgentQuery"))}),MarkTaskCompleteRequest:eh.Type.Object({taskId:eh.Type.String()}),UserMarkedTaskComplete:eh.Type.Object({taskId:eh.Type.String()}),ApproveTaskListRequest:eh.Type.Object({taskListEventId:eh.Type.String()}),ApproveTaskListResponse:eh.Type.Object({taskListEventId:eh.Type.String(),approved:eh.Type.Boolean(),tasks:eh.Type.Array(eh.Type.Ref("Task")),agentConfig:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentConfig"),eh.Type.Undefined()]))}),ApproveInitialBuildMVPRequest:eh.Type.Object({taskListEventId:eh.Type.String(),userSecretsRequest:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentUserSecretsRequest"),eh.Type.Undefined()])),addingIntegrationRequest:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AddingIntegrationsRequest"),eh.Type.Undefined()]))}),ApproveInitialBuildMVPResponse:eh.Type.Object({approved:eh.Type.Boolean(),userSecretsResponse:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentUserSecretsResponse"),eh.Type.Undefined()])),addingIntegrationsResponse:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AddingIntegrationsResponse"),eh.Type.Undefined()])),agentConfig:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentConfig"),eh.Type.Undefined()]))}),ApproveInitialBuildVisualPhaseRequest:eh.Type.Object({userSecretsRequest:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentUserSecretsRequest"),eh.Type.Undefined()])),addingIntegrationRequest:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AddingIntegrationsRequest"),eh.Type.Undefined()]))}),ApproveInitialBuildVisualPhaseResponse:eh.Type.Object({approved:eh.Type.Boolean(),userSecretsResponse:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentUserSecretsResponse"),eh.Type.Undefined()])),addingIntegrationsResponse:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AddingIntegrationsResponse"),eh.Type.Undefined()])),agentConfig:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentConfig"),eh.Type.Undefined()]))}),ApproveSqlQueryRequest:eh.Type.Object({sqlQuery:eh.Type.String(),executionReason:eh.Type.String()}),ApproveSqlQueryResponse:eh.Type.Object({sqlQueryEventId:eh.Type.String(),approved:eh.Type.Boolean()}),ApproveBlueprintRequest:eh.Type.Object({blueprintName:eh.Type.String(),blueprintDisplayName:eh.Type.String()}),ApproveBlueprintResponse:eh.Type.Object({blueprintEventId:eh.Type.String(),approved:eh.Type.Boolean(),blueprintName:eh.Type.String()}),ConvertMockupToAppRequest:eh.Type.Object({}),ConvertMockupToAppResponse:eh.Type.Object({approved:eh.Type.Boolean(),additionalComments:eh.Type.String()}),AgentAskUserForActionRequest:eh.Type.Object({request:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("nextStepRequest"),value:eh.Type.Ref("AgentNextStepRequest")}),eh.Type.Object({$case:eh.Type.Literal("userSecretsRequest"),value:eh.Type.Ref("AgentUserSecretsRequest")}),eh.Type.Object({$case:eh.Type.Literal("deployRequest"),value:eh.Type.Ref("AgentDeployRequest")}),eh.Type.Object({$case:eh.Type.Literal("queryRequest"),value:eh.Type.Ref("QueryRequestContent")}),eh.Type.Object({$case:eh.Type.Literal("markTaskCompleteRequest"),value:eh.Type.Ref("MarkTaskCompleteRequest")}),eh.Type.Object({$case:eh.Type.Literal("approveTaskListRequest"),value:eh.Type.Ref("ApproveTaskListRequest")}),eh.Type.Object({$case:eh.Type.Literal("approveSqlQueryRequest"),value:eh.Type.Ref("ApproveSqlQueryRequest")}),eh.Type.Object({$case:eh.Type.Literal("addingIntegrationRequest"),value:eh.Type.Ref("AddingIntegrationsRequest")}),eh.Type.Object({$case:eh.Type.Literal("approveInitialBuildMvpRequest"),value:eh.Type.Ref("ApproveInitialBuildMVPRequest")}),eh.Type.Object({$case:eh.Type.Literal("approveInitialBuildVisualPhaseRequest"),value:eh.Type.Ref("ApproveInitialBuildVisualPhaseRequest")}),eh.Type.Object({$case:eh.Type.Literal("approveBlueprintRequest"),value:eh.Type.Ref("ApproveBlueprintRequest")}),eh.Type.Object({$case:eh.Type.Literal("environmentConfigRequest"),value:eh.Type.Ref("EnvironmentConfigRequest")}),eh.Type.Object({$case:eh.Type.Literal("convertMockupToAppRequest"),value:eh.Type.Ref("ConvertMockupToAppRequest")}),eh.Type.Undefined()])),message:eh.Type.String()}),AgentAskUserForActionResponse:eh.Type.Object({response:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("nextStepResponse"),value:eh.Type.Ref("AgentNextStepResponse")}),eh.Type.Object({$case:eh.Type.Literal("userSecretsResponse"),value:eh.Type.Ref("AgentUserSecretsResponse")}),eh.Type.Object({$case:eh.Type.Literal("deployResponse"),value:eh.Type.Ref("AgentDeployResponse")}),eh.Type.Object({$case:eh.Type.Literal("queryResponse"),value:eh.Type.Ref("QueryResponseContent")}),eh.Type.Object({$case:eh.Type.Literal("userMarkedTaskComplete"),value:eh.Type.Ref("UserMarkedTaskComplete")}),eh.Type.Object({$case:eh.Type.Literal("approveTaskListResponse"),value:eh.Type.Ref("ApproveTaskListResponse")}),eh.Type.Object({$case:eh.Type.Literal("approveSqlQueryResponse"),value:eh.Type.Ref("ApproveSqlQueryResponse")}),eh.Type.Object({$case:eh.Type.Literal("addingIntegrationsResponse"),value:eh.Type.Ref("AddingIntegrationsResponse")}),eh.Type.Object({$case:eh.Type.Literal("approveInitialBuildMvpResponse"),value:eh.Type.Ref("ApproveInitialBuildMVPResponse")}),eh.Type.Object({$case:eh.Type.Literal("approveInitialBuildVisualPhaseResponse"),value:eh.Type.Ref("ApproveInitialBuildVisualPhaseResponse")}),eh.Type.Object({$case:eh.Type.Literal("approveBlueprintResponse"),value:eh.Type.Ref("ApproveBlueprintResponse")}),eh.Type.Object({$case:eh.Type.Literal("envVarsResponse"),value:eh.Type.Ref("EnvironmentConfigResponse")}),eh.Type.Object({$case:eh.Type.Literal("convertMockupToAppResponse"),value:eh.Type.Ref("ConvertMockupToAppResponse")}),eh.Type.Undefined()])),requestEventId:eh.Type.String()}),SetupImportedProjectEventContents:eh.Type.Object({importSource:eh.Type.Ref("ProjectImportSource"),agentConfig:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentConfig"),eh.Type.Undefined()]))}),ProjectImportCompletedData:eh.Type.Object({}),MemoryCompressionData:eh.Type.Object({}),TaskListData:eh.Type.Object({tasks:eh.Type.Array(eh.Type.Ref("Task")),commitData:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("CommitData"),eh.Type.Undefined()])),agentMode:eh.Type.Ref("AgentMode"),estimatedUsageCents:eh.Type.Number()}),Task:eh.Type.Object({id:eh.Type.String(),content:eh.Type.String(),status:eh.Type.Ref("TaskStatus"),oldStatus:eh.Type.Ref("TaskStatus"),updated:eh.Type.Boolean(),summary:eh.Type.String(),extraDetails:eh.Type.String()}),EventContents:eh.Type.Object({contents:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("sessionCreationEventContents"),value:eh.Type.Ref("SessionCreationEventContents")}),eh.Type.Object({$case:eh.Type.Literal("messageEventContents"),value:eh.Type.Ref("MessageEventContents")}),eh.Type.Object({$case:eh.Type.Literal("inlineActionEventContents"),value:eh.Type.Ref("InlineActionEventContents")}),eh.Type.Object({$case:eh.Type.Literal("localShellExecutionEventContents"),value:eh.Type.Ref("LocalShellExecutionEventContents")}),eh.Type.Object({$case:eh.Type.Literal("shellSuggestionEventContents"),value:eh.Type.Ref("ShellSuggestionEventContents")}),eh.Type.Object({$case:eh.Type.Literal("translateEventContents"),value:eh.Type.Ref("TranslateEventContents")}),eh.Type.Object({$case:eh.Type.Literal("byoPromptEventContents"),value:eh.Type.Ref("BYOPromptEventContents")}),eh.Type.Object({$case:eh.Type.Literal("agentPlanEventContents"),value:eh.Type.Ref("AgentPlanEventContents")}),eh.Type.Object({$case:eh.Type.Literal("agentTimelineEventContents"),value:eh.Type.Ref("AgentTimelineEventContents")}),eh.Type.Object({$case:eh.Type.Literal("benchmarkConclusion"),value:eh.Type.Ref("BenchmarkConclusionEventContents")}),eh.Type.Object({$case:eh.Type.Literal("revertEventContents"),value:eh.Type.Ref("RevertEventContents")}),eh.Type.Object({$case:eh.Type.Literal("hostingDebugSummaryEventContents"),value:eh.Type.Ref("HostingDebugSummaryEventContents")}),eh.Type.Object({$case:eh.Type.Literal("approvePlanEventContents"),value:eh.Type.Ref("ApprovePlanEventContents")}),eh.Type.Object({$case:eh.Type.Literal("userSecretsResponseEventContents"),value:eh.Type.Ref("UserSecretsResponseEventContents")}),eh.Type.Object({$case:eh.Type.Literal("replCreationEventContents"),value:eh.Type.Ref("ReplCreationEventContents")}),eh.Type.Object({$case:eh.Type.Literal("iterativeAgentEventContents"),value:eh.Type.Ref("IterativeAgentEventContents")}),eh.Type.Object({$case:eh.Type.Literal("stepTooComplexEventContents"),value:eh.Type.Ref("StepTooComplexEventContents")}),eh.Type.Object({$case:eh.Type.Literal("stepTooComplexAcknowledgementEventContents"),value:eh.Type.Ref("StepTooComplexAcknowledgementEventContents")}),eh.Type.Object({$case:eh.Type.Literal("agentAskUserForActionRequest"),value:eh.Type.Ref("AgentAskUserForActionRequest")}),eh.Type.Object({$case:eh.Type.Literal("agentAskUserForActionResponse"),value:eh.Type.Ref("AgentAskUserForActionResponse")}),eh.Type.Object({$case:eh.Type.Literal("integrationTestEventContents"),value:eh.Type.Ref("IntegrationTestEventContents")}),eh.Type.Object({$case:eh.Type.Literal("contextComplexityEventContents"),value:eh.Type.Ref("ContextComplexityEventContents")}),eh.Type.Object({$case:eh.Type.Literal("eventTooLargeEventContents"),value:eh.Type.Ref("EventTooLargeEventContents")}),eh.Type.Object({$case:eh.Type.Literal("startRapidBuildEventContents"),value:eh.Type.Ref("StartRapidBuildEventContents")}),eh.Type.Object({$case:eh.Type.Literal("databaseNudgeEventContents"),value:eh.Type.Ref("DatabaseNudgeEventContents")}),eh.Type.Object({$case:eh.Type.Literal("rapidBuildConcluded"),value:eh.Type.Ref("RapidBuildConcludedData")}),eh.Type.Object({$case:eh.Type.Literal("versionMigrated"),value:eh.Type.Ref("VersionMigratedData")}),eh.Type.Object({$case:eh.Type.Literal("rapidBuildStarted"),value:eh.Type.Ref("RapidBuildStartedData")}),eh.Type.Object({$case:eh.Type.Literal("requestFeatureAddData"),value:eh.Type.Ref("RequestFeatureAdd")}),eh.Type.Object({$case:eh.Type.Literal("triggerCheckpointEventContents"),value:eh.Type.Ref("TriggerCheckpointEventContents")}),eh.Type.Object({$case:eh.Type.Literal("setupImportedProjectEventContents"),value:eh.Type.Ref("SetupImportedProjectEventContents")}),eh.Type.Object({$case:eh.Type.Literal("tipRecommendation"),value:eh.Type.Ref("UserTipRecommendationData")}),eh.Type.Object({$case:eh.Type.Literal("subagentRunning"),value:eh.Type.Ref("SubagentRunningData")}),eh.Type.Object({$case:eh.Type.Literal("uiTestingSubagentExecutionEventContents"),value:eh.Type.Ref("UITestingSubagentExecutionEventContents")}),eh.Type.Object({$case:eh.Type.Literal("initialBuildStateUpdateEventContents"),value:eh.Type.Ref("InitialBuildStateUpdateEventContents")}),eh.Type.Object({$case:eh.Type.Literal("agentConfigUpdateEventContents"),value:eh.Type.Ref("AgentConfigUpdateEventContents")}),eh.Type.Undefined()])),benchmarkParameters:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("BenchmarkParameters"),eh.Type.Undefined()]))}),EventContext:eh.Type.Object({metadata:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("sessionCreationEventContext"),value:eh.Type.Ref("SessionCreationEventContext")}),eh.Type.Object({$case:eh.Type.Literal("messageEventContext"),value:eh.Type.Ref("MessageEventContext")}),eh.Type.Object({$case:eh.Type.Literal("inlineActionEventContext"),value:eh.Type.Ref("InlineActionEventContext")}),eh.Type.Object({$case:eh.Type.Literal("localShellExecutionEventContext"),value:eh.Type.Ref("LocalShellExecutionEventContext")}),eh.Type.Object({$case:eh.Type.Literal("shellSuggestionEventContext"),value:eh.Type.Ref("ShellSuggestionEventContext")}),eh.Type.Object({$case:eh.Type.Literal("translateEventContext"),value:eh.Type.Ref("TranslateEventContext")}),eh.Type.Object({$case:eh.Type.Literal("byoPromptEventContext"),value:eh.Type.Ref("BYOPromptEventContext")}),eh.Type.Object({$case:eh.Type.Literal("agentPlanEventContext"),value:eh.Type.Ref("AgentPlanEventContext")}),eh.Type.Object({$case:eh.Type.Literal("agentTimelineEventContext"),value:eh.Type.Ref("AgentTimelineEventContext")}),eh.Type.Object({$case:eh.Type.Literal("hostingDebugSummaryEventContext"),value:eh.Type.Ref("HostingDebugSummaryEventContext")}),eh.Type.Object({$case:eh.Type.Literal("replCreationEventContext"),value:eh.Type.Ref("ReplCreationEventContext")}),eh.Type.Object({$case:eh.Type.Literal("userSecretsResponseEventContext"),value:eh.Type.Ref("UserSecretsResponseEventContext")}),eh.Type.Object({$case:eh.Type.Literal("revertEventContext"),value:eh.Type.Ref("RevertEventContext")}),eh.Type.Object({$case:eh.Type.Literal("iterativeAgentEventContext"),value:eh.Type.Ref("IterativeAgentEventContext")}),eh.Type.Object({$case:eh.Type.Literal("integrationTestEventContext"),value:eh.Type.Ref("IntegrationTestEventContext")}),eh.Type.Undefined()]))}),StartRapidBuildEventContents:eh.Type.Object({mvpObjective:eh.Type.String(),stack:eh.Type.String(),followupSteps:eh.Type.Array(eh.Type.String()),uploadedFiles:eh.Type.Array(eh.Type.Ref("UploadedRapidBuildFile")),extraDetails:eh.Type.String(),techStack:eh.Type.String(),mvpSuccessCriteria:eh.Type.String()}),RapidBuildStartedData:eh.Type.Object({}),SessionCreationEventContents:eh.Type.Object({}),DatabaseNudgeEventContents:eh.Type.Object({}),CodeChangeStats:eh.Type.Object({linesAdded:eh.Type.Number(),linesRemoved:eh.Type.Number(),commitId:eh.Type.String()}),AgentPlanStep:eh.Type.Recursive(function(e){return eh.Type.Object({id:eh.Type.String(),name:eh.Type.String(),status:eh.Type.Ref("AgentPlanStepStatus"),message:eh.Type.String(),metadata:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("codeChangeStats"),value:eh.Type.Ref("CodeChangeStats")}),eh.Type.Undefined()])),timelineEventId:eh.Type.String(),subSteps:eh.Type.Array(e),blueprints:eh.Type.Array(eh.Type.String()),blueprintData:eh.Type.Array(eh.Type.Ref("BlueprintData")),mode:eh.Type.String(),commitId:eh.Type.String()})}),BlueprintsSetup:eh.Type.Object({blueprintData:eh.Type.Array(eh.Type.Ref("BlueprintData"))}),RequestFeatureAdd:eh.Type.Object({type:eh.Type.Ref("RequestFeatureAddType")}),AgentPlanObjective:eh.Type.Object({description:eh.Type.String()}),AgentPlanEventContents:eh.Type.Object({planId:eh.Type.String(),objective:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentPlanObjective"),eh.Type.Undefined()])),step:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentPlanStep"),eh.Type.Undefined()])),requiresApproval:eh.Type.Boolean(),initialCommitId:eh.Type.String(),approver:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("UserContext"),eh.Type.Undefined()])),stackBlueprint:eh.Type.Ref("StackBlueprint"),designReferenceFilePaths:eh.Type.Array(eh.Type.String()),approvedDesignReferenceFilePath:eh.Type.String(),customStackReplId:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),userSecretsRequest:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentUserSecretsRequest"),eh.Type.Undefined()])),agentStackTriggerType:eh.Type.Ref("AgentStackTriggerType")}),AgentPlanEventContext:eh.Type.Object({}),RevertEventContext:eh.Type.Object({}),BlueprintData:eh.Type.Object({category:eh.Type.Ref("BlueprintCategory"),displayName:eh.Type.String(),name:eh.Type.String(),secrets:eh.Type.Array(eh.Type.Ref("Secret"))}),ShellExecutionData:eh.Type.Object({command:eh.Type.String(),shellId:eh.Type.String(),stdout:eh.Type.String(),stderr:eh.Type.String(),exitCode:eh.Type.Number(),processId:eh.Type.String(),isExecuting:eh.Type.Boolean(),output:eh.Type.String()}),FileEditData:eh.Type.Object({filePath:eh.Type.String(),diff:eh.Type.String(),removedLines:eh.Type.Number(),addedLines:eh.Type.Number()}),CreateFileData:eh.Type.Object({filePath:eh.Type.String(),content:eh.Type.String()}),ReadFileData:eh.Type.Object({filePath:eh.Type.String(),content:eh.Type.String(),startLine:eh.Type.Number(),endLine:eh.Type.Number()}),ReadDirData:eh.Type.Object({path:eh.Type.String(),paths:eh.Type.Array(eh.Type.String())}),PackagerInstallData:eh.Type.Object({inputLanguage:eh.Type.String(),inputPackages:eh.Type.Array(eh.Type.String()),output:eh.Type.String(),processId:eh.Type.String(),isExecuting:eh.Type.Boolean()}),PackagerUninstallData:eh.Type.Object({inputLanguage:eh.Type.String(),inputPackages:eh.Type.Array(eh.Type.String())}),SearchFilesystemData:eh.Type.Object({queryDescription:eh.Type.String(),filePaths:eh.Type.Array(eh.Type.String()),classNames:eh.Type.Array(eh.Type.String()),functionNames:eh.Type.Array(eh.Type.String()),resultFileNames:eh.Type.Array(eh.Type.String()),resultFileSummaries:eh.Type.Array(eh.Type.String())}),WebSearchResultPage:eh.Type.Object({title:eh.Type.String(),url:eh.Type.String()}),GoogleSuggestedSearch:eh.Type.Object({webSearchQueries:eh.Type.Array(eh.Type.String())}),WebSearchData:eh.Type.Object({query:eh.Type.String(),response:eh.Type.String(),pageResults:eh.Type.Array(eh.Type.Ref("WebSearchResultPage")),googleSuggestedSearch:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("GoogleSuggestedSearch"),eh.Type.Undefined()])),searchType:eh.Type.Ref("WebSearchType")}),WebPageVisitData:eh.Type.Object({url:eh.Type.String(),title:eh.Type.String(),snippet:eh.Type.String(),favicon:eh.Type.String()}),ScreenshotData:eh.Type.Object({port:eh.Type.Number(),path:eh.Type.String(),imageUrl:eh.Type.String()}),ToolchainInstallData:eh.Type.Object({modules:eh.Type.Array(eh.Type.String())}),WorkflowsGetOutputToolData:eh.Type.Object({name:eh.Type.String(),output:eh.Type.String()}),WorkflowsRemoveRunConfigToolData:eh.Type.Object({name:eh.Type.String()}),WorkflowsRestartToolData:eh.Type.Object({name:eh.Type.String()}),WorkflowsSetRunConfigToolData:eh.Type.Object({name:eh.Type.String(),command:eh.Type.String()}),WorkflowsStartToolData:eh.Type.Object({name:eh.Type.String()}),WorkflowsStopToolData:eh.Type.Object({name:eh.Type.String()}),SuggestRollbackData:eh.Type.Object({suggestRollbackReason:eh.Type.String(),checkpointCommitSha:eh.Type.String()}),PresentResultsToolData:eh.Type.Object({resultType:eh.Type.String(),shellCommand:eh.Type.String(),websitePort:eh.Type.Number(),shellCommandWorkflowName:eh.Type.String(),websiteRoute:eh.Type.String()}),SearchFileData:eh.Type.Object({filePath:eh.Type.String(),query:eh.Type.String()}),SuggestGeneralBuildModeData:eh.Type.Object({message:eh.Type.String(),suggestedAutonomyLevel:eh.Type.Ref("AutonomyLevel")}),AgentTimelineEventContents:eh.Type.Object({toolName:eh.Type.String(),planStepId:eh.Type.String(),message:eh.Type.String(),toolData:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("shellExecutionData"),value:eh.Type.Ref("ShellExecutionData")}),eh.Type.Object({$case:eh.Type.Literal("fileEditData"),value:eh.Type.Ref("FileEditData")}),eh.Type.Object({$case:eh.Type.Literal("createFileData"),value:eh.Type.Ref("CreateFileData")}),eh.Type.Object({$case:eh.Type.Literal("readFileData"),value:eh.Type.Ref("ReadFileData")}),eh.Type.Object({$case:eh.Type.Literal("packagerInstallData"),value:eh.Type.Ref("PackagerInstallData")}),eh.Type.Object({$case:eh.Type.Literal("searchFilesystemData"),value:eh.Type.Ref("SearchFilesystemData")}),eh.Type.Object({$case:eh.Type.Literal("messageData"),value:eh.Type.Ref("MessageEventContents")}),eh.Type.Object({$case:eh.Type.Literal("packagerUninstallData"),value:eh.Type.Ref("PackagerUninstallData")}),eh.Type.Object({$case:eh.Type.Literal("screenshotData"),value:eh.Type.Ref("ScreenshotData")}),eh.Type.Object({$case:eh.Type.Literal("toolchainInstallData"),value:eh.Type.Ref("ToolchainInstallData")}),eh.Type.Object({$case:eh.Type.Literal("workflowsGetOutputToolData"),value:eh.Type.Ref("WorkflowsGetOutputToolData")}),eh.Type.Object({$case:eh.Type.Literal("workflowsRemoveRunConfigToolData"),value:eh.Type.Ref("WorkflowsRemoveRunConfigToolData")}),eh.Type.Object({$case:eh.Type.Literal("workflowsRestartToolData"),value:eh.Type.Ref("WorkflowsRestartToolData")}),eh.Type.Object({$case:eh.Type.Literal("workflowsSetRunConfigToolData"),value:eh.Type.Ref("WorkflowsSetRunConfigToolData")}),eh.Type.Object({$case:eh.Type.Literal("workflowsStartToolData"),value:eh.Type.Ref("WorkflowsStartToolData")}),eh.Type.Object({$case:eh.Type.Literal("workflowsStopToolData"),value:eh.Type.Ref("WorkflowsStopToolData")}),eh.Type.Object({$case:eh.Type.Literal("planProgressData"),value:eh.Type.Ref("PlanProgressData")}),eh.Type.Object({$case:eh.Type.Literal("summarizeObjectiveData"),value:eh.Type.Ref("SummarizeObjectiveData")}),eh.Type.Object({$case:eh.Type.Literal("presentResultsToolData"),value:eh.Type.Ref("PresentResultsToolData")}),eh.Type.Object({$case:eh.Type.Literal("searchFileData"),value:eh.Type.Ref("SearchFileData")}),eh.Type.Object({$case:eh.Type.Literal("systemDependencyInstallData"),value:eh.Type.Ref("SystemDependencyInstallData")}),eh.Type.Object({$case:eh.Type.Literal("systemDependencyUninstallData"),value:eh.Type.Ref("SystemDependencyUninstallData")}),eh.Type.Object({$case:eh.Type.Literal("deployData"),value:eh.Type.Ref("DeployData")}),eh.Type.Object({$case:eh.Type.Literal("revertData"),value:eh.Type.Ref("RevertData")}),eh.Type.Object({$case:eh.Type.Literal("deployConfigData"),value:eh.Type.Ref("DeployConfigData")}),eh.Type.Object({$case:eh.Type.Literal("agentPlanStepBegin"),value:eh.Type.Ref("AgentPlanStepBeginData")}),eh.Type.Object({$case:eh.Type.Literal("acknowledgeUserMessage"),value:eh.Type.Ref("AcknowledgeUserMessage")}),eh.Type.Object({$case:eh.Type.Literal("createPostgresqlDatabaseData"),value:eh.Type.Ref("CreatePostgreSQLDatabaseData")}),eh.Type.Object({$case:eh.Type.Literal("sqlExecutionData"),value:eh.Type.Ref("SqlExecutionData")}),eh.Type.Object({$case:eh.Type.Literal("newSessionNudge"),value:eh.Type.Ref("NewSessionNudge")}),eh.Type.Object({$case:eh.Type.Literal("commitData"),value:eh.Type.Ref("CommitData")}),eh.Type.Object({$case:eh.Type.Literal("readDirData"),value:eh.Type.Ref("ReadDirData")}),eh.Type.Object({$case:eh.Type.Literal("thoughts"),value:eh.Type.Ref("AgentThoughtsData")}),eh.Type.Object({$case:eh.Type.Literal("blueprintsSetup"),value:eh.Type.Ref("BlueprintsSetup")}),eh.Type.Object({$case:eh.Type.Literal("webPageVisitData"),value:eh.Type.Ref("WebPageVisitData")}),eh.Type.Object({$case:eh.Type.Literal("webSearchData"),value:eh.Type.Ref("WebSearchData")}),eh.Type.Object({$case:eh.Type.Literal("imageGenerationData"),value:eh.Type.Ref("ImageGenerationData")}),eh.Type.Object({$case:eh.Type.Literal("projectImportCompleted"),value:eh.Type.Ref("ProjectImportCompletedData")}),eh.Type.Object({$case:eh.Type.Literal("memoryCompressionData"),value:eh.Type.Ref("MemoryCompressionData")}),eh.Type.Object({$case:eh.Type.Literal("suggestRollbackData"),value:eh.Type.Ref("SuggestRollbackData")}),eh.Type.Object({$case:eh.Type.Literal("taskListData"),value:eh.Type.Ref("TaskListData")}),eh.Type.Object({$case:eh.Type.Literal("samplingEvent"),value:eh.Type.Ref("SamplingEvent")}),eh.Type.Object({$case:eh.Type.Literal("setupObjectStorageData"),value:eh.Type.Ref("SetupObjectStorageData")}),eh.Type.Object({$case:eh.Type.Literal("endOfRunSummaryData"),value:eh.Type.Ref("EndOfRunSummaryData")}),eh.Type.Object({$case:eh.Type.Literal("stockImageData"),value:eh.Type.Ref("StockImageData")}),eh.Type.Object({$case:eh.Type.Literal("searchIntegrationsData"),value:eh.Type.Ref("SearchIntegrationsData")}),eh.Type.Object({$case:eh.Type.Literal("viewIntegrationData"),value:eh.Type.Ref("ViewIntegrationData")}),eh.Type.Object({$case:eh.Type.Literal("setupModelfarmData"),value:eh.Type.Ref("SetupModelfarmData")}),eh.Type.Object({$case:eh.Type.Literal("viewLogsData"),value:eh.Type.Ref("ViewLogsData")}),eh.Type.Object({$case:eh.Type.Literal("uiTestingSubagentTakeOverData"),value:eh.Type.Ref("UITestingSubagentTakeOverData")}),eh.Type.Object({$case:eh.Type.Literal("viewSpecialFiles"),value:eh.Type.Ref("ViewSpecialFilesData")}),eh.Type.Object({$case:eh.Type.Literal("designGuidelinesData"),value:eh.Type.Ref("DesignGuidelinesData")}),eh.Type.Object({$case:eh.Type.Literal("mcpToolData"),value:eh.Type.Ref("MCPToolData")}),eh.Type.Object({$case:eh.Type.Literal("alertData"),value:eh.Type.Ref("AlertData")}),eh.Type.Object({$case:eh.Type.Literal("viewEnvVarData"),value:eh.Type.Ref("ViewEnvVarData")}),eh.Type.Object({$case:eh.Type.Literal("setEnvVarData"),value:eh.Type.Ref("SetEnvVarData")}),eh.Type.Object({$case:eh.Type.Literal("deleteEnvVarData"),value:eh.Type.Ref("DeleteEnvVarData")}),eh.Type.Object({$case:eh.Type.Literal("videoGenerationData"),value:eh.Type.Ref("VideoGenerationData")}),eh.Type.Object({$case:eh.Type.Literal("generateMediaData"),value:eh.Type.Ref("GenerateMediaData")}),eh.Type.Object({$case:eh.Type.Literal("waitingForBackgroundJobsData"),value:eh.Type.Ref("WaitingForBackgroundJobsData")}),eh.Type.Object({$case:eh.Type.Literal("suggestGeneralBuildModeData"),value:eh.Type.Ref("SuggestGeneralBuildModeData")}),eh.Type.Undefined()]))}),AgentPlanStepBeginData:eh.Type.Object({planStep:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentPlanStep"),eh.Type.Undefined()])),starts:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()]))}),SummarizeObjectiveData:eh.Type.Object({summarizedObjective:eh.Type.String()}),AgentThoughtsData:eh.Type.Object({thoughts:eh.Type.String(),redactedThoughtsMarkers:eh.Type.Array(eh.Type.Ref("RedactedThoughtsMarker")),totalTimeTakenMs:eh.Type.Number(),summary:eh.Type.String()}),RedactedThoughtsMarker:eh.Type.Object({index:eh.Type.Number()}),RapidBuildConcludedData:eh.Type.Object({willContinueWorking:eh.Type.Boolean()}),VersionMigratedData:eh.Type.Object({version:eh.Type.Number()}),PlanProgressData:eh.Type.Object({updatedPlanStep:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentPlanStep"),eh.Type.Undefined()]))}),BenchmarkConclusionEventContents:eh.Type.Object({completionReason:eh.Type.Ref("BenchmarkConclusionReason"),steps:eh.Type.Number(),exception:eh.Type.String(),datasetId:eh.Type.String(),instanceId:eh.Type.String(),runId:eh.Type.String(),metrics:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("BenchmarkMetrics"),eh.Type.Undefined()]))}),BenchmarkMetrics:eh.Type.Object({increment:eh.Type.Array(eh.Type.Ref("Metric")),decrement:eh.Type.Array(eh.Type.Ref("Metric")),gauge:eh.Type.Array(eh.Type.Ref("Metric")),histogram:eh.Type.Array(eh.Type.Ref("Metric")),distribution:eh.Type.Array(eh.Type.Ref("Metric")),timing:eh.Type.Array(eh.Type.Ref("Metric"))}),Metric:eh.Type.Object({name:eh.Type.String(),metrics:eh.Type.Array(eh.Type.Ref("MetricByTag"))}),MetricByTag:eh.Type.Object({tags:eh.Type.Array(eh.Type.String()),values:eh.Type.Array(eh.Type.Number())}),AgentTimelineEventContext:eh.Type.Object({}),Range:eh.Type.Object({indexFrom:eh.Type.Number(),indexTo:eh.Type.Number(),lineFrom:eh.Type.Number(),lineTo:eh.Type.Number()}),CodeReference:eh.Type.Object({code:eh.Type.String(),filePath:eh.Type.String(),fileVersion:eh.Type.Number(),fileContent:eh.Type.String(),range:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("Range"),eh.Type.Undefined()])),language:eh.Type.String(),referenceType:eh.Type.Ref("CodeReferenceType")}),MessageEventContents:eh.Type.Object({content:eh.Type.String(),intent:eh.Type.Ref("MessageAction"),stopReason:eh.Type.Ref("MessageStopReason"),debugFullPrompt:eh.Type.String(),codeReference:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("CodeReference"),eh.Type.Undefined()])),debugErrorSource:eh.Type.Ref("DebugErrorSource"),media:eh.Type.Array(eh.Type.Ref("MediaReference")),usedModelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()])),sources:eh.Type.Array(eh.Type.Ref("Source")),extraActions:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("suggestedTemplates"),value:eh.Type.Ref("SuggestedTemplates")}),eh.Type.Object({$case:eh.Type.Literal("proposedFileChanges"),value:eh.Type.Ref("ProposedFileChanges")}),eh.Type.Undefined()])),benchmarkMode:eh.Type.Boolean(),benchmarkParameters:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("BenchmarkParameters"),eh.Type.Undefined()])),agentAction:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentAction"),eh.Type.Undefined()])),uploadedFiles:eh.Type.Array(eh.Type.Ref("UploadedFile")),attachedUrls:eh.Type.Array(eh.Type.Ref("AttachedUrl")),commitId:eh.Type.String(),lastSeenWebviewLogTimestamp:eh.Type.Number(),assistantProposedActions:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AssistantProposedActions"),eh.Type.Undefined()])),ragContext:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("SelectedRagContext"),eh.Type.Undefined()])),attachedForm:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AttachedForm"),eh.Type.Undefined()])),enableDeepThinking:eh.Type.Boolean(),targetedElement:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("TargetedElement"),eh.Type.Undefined()])),requestedStackBlueprint:eh.Type.Ref("StackBlueprint"),quickEdit:eh.Type.Boolean(),agentConfig:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentConfig"),eh.Type.Undefined()])),customStackReplId:eh.Type.String(),themeConfig:eh.Type.String(),agentStackTriggerType:eh.Type.Ref("AgentStackTriggerType")}),TargetedElement:eh.Type.Object({filePath:eh.Type.String(),lineNumber:eh.Type.Number(),componentName:eh.Type.String(),textContent:eh.Type.String(),imageSourceUrl:eh.Type.String(),hasChildElements:eh.Type.Boolean(),siblingCount:eh.Type.Number(),parent:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("RelatedElement"),eh.Type.Undefined()])),nextSibling:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("RelatedElement"),eh.Type.Undefined()])),grandparent:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("RelatedElement"),eh.Type.Undefined()]))}),RelatedElement:eh.Type.Object({tagName:eh.Type.String(),className:eh.Type.String(),textContent:eh.Type.String(),id:eh.Type.String()}),AttachedForm:eh.Type.Object({formType:eh.Type.Ref("AttachedFormType"),fields:eh.Type.Array(eh.Type.Ref("AttachedFormField"))}),AttachedFormField:eh.Type.Object({path:eh.Type.String(),formType:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("string"),value:eh.Type.Ref("AttachedFormStringField")}),eh.Type.Object({$case:eh.Type.Literal("files"),value:eh.Type.Ref("AttachedFormFilesField")}),eh.Type.Undefined()]))}),AttachedFormStringField:eh.Type.Object({value:eh.Type.String()}),AttachedFormFilesField:eh.Type.Object({files:eh.Type.Array(eh.Type.Ref("AttachedFormFiles"))}),AttachedFormFiles:eh.Type.Object({name:eh.Type.String(),url:eh.Type.String(),mimeType:eh.Type.String()}),UpdateAttachedFormStringFieldSet:eh.Type.Object({path:eh.Type.String(),value:eh.Type.String()}),UpdateAttachedFormStringFieldAppend:eh.Type.Object({path:eh.Type.String(),value:eh.Type.String()}),SelectedRagContext:eh.Type.Object({replitDocumentationQuery:eh.Type.String(),fileSearchQuery:eh.Type.String(),selectedFiles:eh.Type.String(),selectedClasses:eh.Type.String()}),AssistantProposedActions:eh.Type.Object({summary:eh.Type.String(),commitId:eh.Type.String(),shellCommands:eh.Type.Array(eh.Type.Ref("ProposedShellCommand")),fileChanges:eh.Type.Array(eh.Type.Ref("ProposedFileChange")),workspaceToolNudges:eh.Type.Array(eh.Type.Ref("ProposedWorkspaceToolNudge")),packageInstalls:eh.Type.Array(eh.Type.Ref("ProposedPackageInstall")),didCreateCheckpoint:eh.Type.Boolean(),didCountEditRequest:eh.Type.Boolean(),runConfigurations:eh.Type.Array(eh.Type.Ref("ProposedRunConfiguration")),deploymentConfigurations:eh.Type.Array(eh.Type.Ref("ProposedDeploymentConfiguration")),workflowConfigurations:eh.Type.Array(eh.Type.Ref("ProposedWorkflowConfiguration"))}),IntegrationTestEventContents:eh.Type.Object({expectedResponseString:eh.Type.String(),streamedResponse:eh.Type.Boolean(),timeBetweenChunks:eh.Type.Number()}),ContextComplexityEventContents:eh.Type.Object({fullness:eh.Type.Number()}),EventTooLargeEventContents:eh.Type.Object({}),IntegrationTestEventContext:eh.Type.Object({}),AttachedUrl:eh.Type.Object({url:eh.Type.String(),intent:eh.Type.Ref("UrlIntent")}),UploadedFile:eh.Type.Object({path:eh.Type.String(),mimeType:eh.Type.String()}),UploadedRapidBuildFile:eh.Type.Object({fileName:eh.Type.String(),downloadUrl:eh.Type.String()}),BenchmarkParameters:eh.Type.Object({datasetId:eh.Type.String(),instanceId:eh.Type.String(),runId:eh.Type.String(),replDescription:eh.Type.String(),disableSandbox:eh.Type.Boolean(),commandPrefix:eh.Type.Array(eh.Type.String()),overrideShellExecuteTimeoutSeconds:eh.Type.Number(),overrideMaxSteps:eh.Type.Number()}),SuggestedTemplates:eh.Type.Object({suggestedTemplates:eh.Type.Array(eh.Type.Ref("SuggestedTemplate"))}),SuggestedTemplate:eh.Type.Object({name:eh.Type.String(),replId:eh.Type.String(),description:eh.Type.String(),icon:eh.Type.String(),language:eh.Type.String(),id:eh.Type.String(),ownerUsername:eh.Type.String(),slug:eh.Type.String()}),ProposedFileChanges:eh.Type.Object({changes:eh.Type.Array(eh.Type.Ref("ProposedFileChange")),commitId:eh.Type.String(),summary:eh.Type.String()}),ProposedFileChange:eh.Type.Object({filePath:eh.Type.String(),content:eh.Type.String(),changeSummary:eh.Type.String(),state:eh.Type.Ref("FileChangeGenerationState"),messageContentsOffset:eh.Type.Number(),diff:eh.Type.String()}),ProposedShellCommand:eh.Type.Object({messageContentsOffset:eh.Type.Number(),command:eh.Type.String(),workingDirectory:eh.Type.String(),isDangerous:eh.Type.Boolean()}),ProposedPackageInstall:eh.Type.Object({messageContentsOffset:eh.Type.Number(),language:eh.Type.String(),packageList:eh.Type.Array(eh.Type.String())}),ProposedWorkspaceToolNudge:eh.Type.Object({messageContentsOffset:eh.Type.Number(),toolName:eh.Type.String(),reason:eh.Type.String(),description:eh.Type.String()}),ProposedRunConfiguration:eh.Type.Object({messageContentsOffset:eh.Type.Number(),workflowName:eh.Type.String(),setRunButton:eh.Type.Boolean(),oldCommand:eh.Type.String(),newCommand:eh.Type.String()}),ProposedWorkflowConfiguration:eh.Type.Object({messageContentsOffset:eh.Type.Number(),workflowName:eh.Type.String(),commands:eh.Type.Array(eh.Type.String()),setRunButton:eh.Type.Boolean(),mode:eh.Type.String()}),ProposedDeploymentConfiguration:eh.Type.Object({messageContentsOffset:eh.Type.Number(),buildCommand:eh.Type.String(),runCommand:eh.Type.String()}),Source:eh.Type.Object({url:eh.Type.String(),contents:eh.Type.String(),lineNumber:eh.Type.Number(),id:eh.Type.String()}),InlineActionEventContents:eh.Type.Object({messageType:eh.Type.Ref("InlineMessageType"),debugErrorSource:eh.Type.Ref("DebugErrorSource"),content:eh.Type.String(),codeReference:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("CodeReference"),eh.Type.Undefined()])),usedModelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()])),media:eh.Type.Array(eh.Type.Ref("MediaReference")),sources:eh.Type.Array(eh.Type.Ref("Source"))}),ShellSuggestionEventContents:eh.Type.Object({content:eh.Type.String()}),SessionCreationEventContext:eh.Type.Object({}),TranslateEventContents:eh.Type.Object({inputTarget:eh.Type.Ref("TranslationTarget"),outputTarget:eh.Type.Ref("TranslationTarget"),content:eh.Type.String()}),TranslateEventContext:eh.Type.Object({modelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()]))}),LocalShellExecutionEventContents:eh.Type.Object({command:eh.Type.String(),result:eh.Type.String(),eventId:eh.Type.String(),index:eh.Type.Number(),exitCode:eh.Type.Number(),channelName:eh.Type.String(),executed:eh.Type.Boolean()}),LocalShellExecutionEventContext:eh.Type.Object({}),ShellSuggestionEventContext:eh.Type.Object({modelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()]))}),ModelSelector:eh.Type.Object({type:eh.Type.Ref("ModelType"),overrideModelName:eh.Type.String()}),EventError:eh.Type.Object({type:eh.Type.Ref("EventErrorType"),message:eh.Type.String(),shortMessage:eh.Type.String()}),MediaReference:eh.Type.Object({identifier:eh.Type.String(),url:eh.Type.String(),mimeType:eh.Type.String()}),AgentConfig:eh.Type.Object({maxSteps:eh.Type.Number(),enablePlanMode:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),enableHumanInLoop:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),thinkingEnabled:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),modelProfile:eh.Type.Ref("ModelProfile"),enableAutomatedTesting:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),samplingRate:eh.Type.Number(),webSearchEnabled:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),agentMode:eh.Type.Ref("AgentMode"),imageGenerationEnabled:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),initialBuildMode:eh.Type.Ref("AgentInitialBuildMode"),maxAutonomyEnabled:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),autonomyLevel:eh.Type.Ref("AutonomyLevel")}),MessageEventContext:eh.Type.Object({mostRecentFile:eh.Type.String(),fileContext:eh.Type.Array(eh.Type.Ref("CodeReference")),modelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()])),intent:eh.Type.Ref("MessageAction"),extraResources:eh.Type.Array(eh.Type.String()),useRag:eh.Type.Boolean(),agentConfig:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentConfig"),eh.Type.Undefined()]))}),InlineActionEventContext:eh.Type.Object({mostRecentFile:eh.Type.String(),fileContext:eh.Type.Array(eh.Type.Ref("CodeReference")),modelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()])),extraResources:eh.Type.Array(eh.Type.String()),useRag:eh.Type.Boolean()}),UpdateEventOperation:eh.Type.Object({id:eh.Type.String(),operationType:eh.Type.Ref("UpdateEventOperationType"),key:eh.Type.String(),value:eh.Type.String(),intValue:eh.Type.Number(),boolValue:eh.Type.Boolean(),protobufValue:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("Any"),eh.Type.Undefined()])),structValue:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("Struct"),eh.Type.Undefined()]))}),TypedUpdateEventOperation:eh.Type.Object({id:eh.Type.String(),operation:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("messageContentsUpdate"),value:eh.Type.Ref("MessageContentsUpdate")}),eh.Type.Object({$case:eh.Type.Literal("shellSuggestionContentsUpdate"),value:eh.Type.Ref("ShellSuggestionContentsUpdate")}),eh.Type.Object({$case:eh.Type.Literal("addSourcesUpdate"),value:eh.Type.Ref("AddSourcesUpdate")}),eh.Type.Object({$case:eh.Type.Literal("addSuggestedTemplatesUpdate"),value:eh.Type.Ref("AddSuggestedTemplatesUpdate")}),eh.Type.Object({$case:eh.Type.Literal("byoPromptResultUpdate"),value:eh.Type.Ref("BYOPromptResultUpdate")}),eh.Type.Object({$case:eh.Type.Literal("messageContentsSet"),value:eh.Type.Ref("MessageContentsSet")}),eh.Type.Object({$case:eh.Type.Literal("agentTimelineEventSet"),value:eh.Type.Ref("AgentTimelineEventSet")}),eh.Type.Object({$case:eh.Type.Literal("hostingDebugSummaryEventSet"),value:eh.Type.Ref("HostingDebugSummaryEventSet")}),eh.Type.Object({$case:eh.Type.Literal("replCreationEventSet"),value:eh.Type.Ref("ReplCreationEventSet")}),eh.Type.Object({$case:eh.Type.Literal("localShellExecutionEventSet"),value:eh.Type.Ref("LocalShellExecutionEventSet")}),eh.Type.Object({$case:eh.Type.Literal("agentTimelineEventCreateFileAddContent"),value:eh.Type.Ref("AgentTimelineEventCreateFileAddContent")}),eh.Type.Object({$case:eh.Type.Literal("addProposedFileChange"),value:eh.Type.Ref("AddProposedFileChange")}),eh.Type.Object({$case:eh.Type.Literal("updateProposedFileChange"),value:eh.Type.Ref("UpdateProposedFileChange")}),eh.Type.Object({$case:eh.Type.Literal("addProposedFileChangesMetadata"),value:eh.Type.Ref("AddProposedFileChangesMetadata")}),eh.Type.Object({$case:eh.Type.Literal("addProposedShellCommand"),value:eh.Type.Ref("AddProposedShellCommand")}),eh.Type.Object({$case:eh.Type.Literal("addProposedActionsMetadata"),value:eh.Type.Ref("AddProposedActionsMetadata")}),eh.Type.Object({$case:eh.Type.Literal("agentAskUserForActionRequestSet"),value:eh.Type.Ref("AgentAskUserForActionRequestSet")}),eh.Type.Object({$case:eh.Type.Literal("addRagContext"),value:eh.Type.Ref("AddRagContext")}),eh.Type.Object({$case:eh.Type.Literal("addProposedWorkspaceToolNudge"),value:eh.Type.Ref("AddProposedWorkspaceToolNudge")}),eh.Type.Object({$case:eh.Type.Literal("integrationTestEventContents"),value:eh.Type.Ref("IntegrationTestEventContentsUpdate")}),eh.Type.Object({$case:eh.Type.Literal("addProposedPackageInstall"),value:eh.Type.Ref("AddProposedPackageInstall")}),eh.Type.Object({$case:eh.Type.Literal("updateRevertStatus"),value:eh.Type.Ref("UpdateRevertStatus")}),eh.Type.Object({$case:eh.Type.Literal("updateAttachedFormStringFieldSet"),value:eh.Type.Ref("UpdateAttachedFormStringFieldSet")}),eh.Type.Object({$case:eh.Type.Literal("updateAttachedFormStringFieldAppend"),value:eh.Type.Ref("UpdateAttachedFormStringFieldAppend")}),eh.Type.Object({$case:eh.Type.Literal("addProposedRunConfiguration"),value:eh.Type.Ref("AddProposedRunConfiguration")}),eh.Type.Object({$case:eh.Type.Literal("addProposedDeploymentConfiguration"),value:eh.Type.Ref("AddProposedDeploymentConfiguration")}),eh.Type.Object({$case:eh.Type.Literal("appendTimelineMessageContentsUpdate"),value:eh.Type.Ref("AppendTimelineMessageContentsUpdate")}),eh.Type.Object({$case:eh.Type.Literal("appendThoughtContentsUpdate"),value:eh.Type.Ref("AppendThoughtContentsUpdate")}),eh.Type.Object({$case:eh.Type.Literal("appendRedactedThoughtsMarker"),value:eh.Type.Ref("AppendRedactedThoughtsMarkerUpdate")}),eh.Type.Object({$case:eh.Type.Literal("addProposedWorkflowConfiguration"),value:eh.Type.Ref("AddProposedWorkflowConfiguration")}),eh.Type.Object({$case:eh.Type.Literal("updateFileEditLineCounts"),value:eh.Type.Ref("UpdateFileEditLineCountsUpdate")}),eh.Type.Object({$case:eh.Type.Literal("addDesignReferenceFile"),value:eh.Type.Ref("AddDesignReferenceFile")}),eh.Type.Object({$case:eh.Type.Literal("updatePlanContents"),value:eh.Type.Ref("UpdatePlanContents")}),eh.Type.Object({$case:eh.Type.Literal("updatePlanApprovalStatus"),value:eh.Type.Ref("UpdatePlanApprovalStatus")}),eh.Type.Object({$case:eh.Type.Literal("newThoughtSummaryUpdate"),value:eh.Type.Ref("NewThoughtSummaryUpdate")}),eh.Type.Object({$case:eh.Type.Literal("samplingEventUpdate"),value:eh.Type.Ref("SamplingEventUpdate")}),eh.Type.Object({$case:eh.Type.Literal("samplingEventStateUpdate"),value:eh.Type.Ref("SamplingEventStateUpdate")}),eh.Type.Object({$case:eh.Type.Literal("uiTestingSubagentExecutionEventUpdate"),value:eh.Type.Ref("UITestingSubagentExecutionEventContentsUpdate")}),eh.Type.Object({$case:eh.Type.Literal("subagentRunningDataUpdate"),value:eh.Type.Ref("SubagentRunningDataUpdate")}),eh.Type.Object({$case:eh.Type.Literal("upsertGeneratedMediaData"),value:eh.Type.Ref("UpsertGeneratedMediaData")}),eh.Type.Undefined()]))}),AppendTimelineMessageContentsUpdate:eh.Type.Object({content:eh.Type.String()}),AppendThoughtContentsUpdate:eh.Type.Object({content:eh.Type.String(),totalTimeTakenMs:eh.Type.Number()}),NewThoughtSummaryUpdate:eh.Type.Object({summary:eh.Type.String()}),AppendRedactedThoughtsMarkerUpdate:eh.Type.Object({marker:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("RedactedThoughtsMarker"),eh.Type.Undefined()]))}),AgentTimelineEventSet:eh.Type.Object({contents:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentTimelineEventContents"),eh.Type.Undefined()]))}),HostingDebugSummaryEventSet:eh.Type.Object({contents:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("HostingDebugSummaryEventContents"),eh.Type.Undefined()]))}),ReplCreationEventSet:eh.Type.Object({contents:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ReplCreationEventContents"),eh.Type.Undefined()]))}),MessageContentsUpdate:eh.Type.Object({content:eh.Type.String()}),IntegrationTestEventContentsUpdate:eh.Type.Object({content:eh.Type.String()}),AgentAskUserForActionRequestSet:eh.Type.Object({request:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentAskUserForActionRequest"),eh.Type.Undefined()]))}),MessageContentsSet:eh.Type.Object({content:eh.Type.String()}),ShellSuggestionContentsUpdate:eh.Type.Object({content:eh.Type.String()}),LocalShellExecutionEventSet:eh.Type.Object({contents:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("LocalShellExecutionEventContents"),eh.Type.Undefined()]))}),AgentTimelineEventCreateFileAddContent:eh.Type.Object({content:eh.Type.String()}),AddSourcesUpdate:eh.Type.Object({sources:eh.Type.Array(eh.Type.Ref("Source"))}),AddSuggestedTemplatesUpdate:eh.Type.Object({templates:eh.Type.Array(eh.Type.Ref("SuggestedTemplate"))}),AddProposedActionsMetadata:eh.Type.Object({summary:eh.Type.String(),commitId:eh.Type.String(),didCreateCheckpoint:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),didCountEditRequest:eh.Type.Boolean()}),AddRagContext:eh.Type.Object({newContext:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("SelectedRagContext"),eh.Type.Undefined()]))}),AddProposedFileChangesMetadata:eh.Type.Object({summary:eh.Type.String()}),AddProposedFileChange:eh.Type.Object({change:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ProposedFileChange"),eh.Type.Undefined()])),commitId:eh.Type.String()}),UpdateProposedFileChange:eh.Type.Object({update:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ProposedFileChange"),eh.Type.Undefined()])),replacement:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ProposedFileChange"),eh.Type.Undefined()]))}),AddProposedShellCommand:eh.Type.Object({command:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ProposedShellCommand"),eh.Type.Undefined()]))}),AddProposedPackageInstall:eh.Type.Object({packageInstalls:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ProposedPackageInstall"),eh.Type.Undefined()]))}),UpdateRevertStatus:eh.Type.Object({newStatus:eh.Type.Ref("RevertStatus")}),AddProposedWorkspaceToolNudge:eh.Type.Object({nudge:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ProposedWorkspaceToolNudge"),eh.Type.Undefined()]))}),AddProposedRunConfiguration:eh.Type.Object({runConfiguration:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ProposedRunConfiguration"),eh.Type.Undefined()]))}),AddProposedWorkflowConfiguration:eh.Type.Object({workflowConfiguration:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ProposedWorkflowConfiguration"),eh.Type.Undefined()]))}),UpdateFileEditLineCountsUpdate:eh.Type.Object({removedLines:eh.Type.Number(),addedLines:eh.Type.Number()}),AddProposedDeploymentConfiguration:eh.Type.Object({deploymentConfiguration:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ProposedDeploymentConfiguration"),eh.Type.Undefined()]))}),AddDesignReferenceFile:eh.Type.Object({filePath:eh.Type.String()}),UpdatePlanContents:eh.Type.Object({planId:eh.Type.String(),step:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentPlanStep"),eh.Type.Undefined()])),objective:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentPlanObjective"),eh.Type.Undefined()])),initialCommitId:eh.Type.String(),stackBlueprint:eh.Type.Ref("StackBlueprint"),agentStackTriggerType:eh.Type.Ref("AgentStackTriggerType")}),UpdatePlanApprovalStatus:eh.Type.Object({requiresApproval:eh.Type.Boolean()}),BYOPromptResultUpdate:eh.Type.Object({jsonResult:eh.Type.String()}),GovalToken:eh.Type.Object({token:eh.Type.String(),gurl:eh.Type.String()}),AuthToken:eh.Type.Object({user:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("UserContext"),eh.Type.Undefined()])),replIds:eh.Type.Array(eh.Type.String()),issuer:eh.Type.String(),overrideGovalToken:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("GovalToken"),eh.Type.Undefined()])),forkReplId:eh.Type.String()}),UserContext:eh.Type.Object({type:eh.Type.Ref("UserType"),id:eh.Type.String(),username:eh.Type.String(),membership:eh.Type.Ref("MembershipType"),roles:eh.Type.Array(eh.Type.String()),isTeam:eh.Type.Boolean(),orgId:eh.Type.String(),timeCreated:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()])),flaggingContext:eh.Type.String(),modelfarmDisabled:eh.Type.Boolean(),openrouterDisabled:eh.Type.Boolean(),openaiDisabled:eh.Type.Boolean(),anthropicDisabled:eh.Type.Boolean(),geminiDisabled:eh.Type.Boolean(),isEnterprise:eh.Type.Boolean()}),CreateEventRequest:eh.Type.Object({parentEventId:eh.Type.String(),sessionId:eh.Type.String(),state:eh.Type.Ref("EventState"),contents:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventContents"),eh.Type.Undefined()])),context:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventContext"),eh.Type.Undefined()])),eventId:eh.Type.String(),error:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventError"),eh.Type.Undefined()])),isActive:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),addToChild:eh.Type.Boolean()}),CreateEventResponse:eh.Type.Object({eventId:eh.Type.String(),parentEventId:eh.Type.String(),created:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()]))}),CreateEventRequestWithUser:eh.Type.Object({request:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("CreateEventRequest"),eh.Type.Undefined()])),user:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("UserContext"),eh.Type.Undefined()]))}),BatchCreateEventsRequest:eh.Type.Object({events:eh.Type.Array(eh.Type.Ref("CreateEventRequestWithUser"))}),BatchCreateEventsResponse:eh.Type.Object({eventIds:eh.Type.Array(eh.Type.String())}),UpdateEventRequest:eh.Type.Object({eventId:eh.Type.String(),operations:eh.Type.Array(eh.Type.Ref("UpdateEventOperation")),typedOperations:eh.Type.Array(eh.Type.Ref("TypedUpdateEventOperation")),state:eh.Type.Ref("EventState"),error:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventError"),eh.Type.Undefined()])),requireCompletion:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()]))}),UpdateEventResponse:eh.Type.Object({}),UpdateAgentStateRequest:eh.Type.Object({replId:eh.Type.String(),sessionId:eh.Type.String(),runState:eh.Type.Ref("AgentRunState"),transitionReason:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentStateTransitionReason"),eh.Type.Undefined()]))}),GetAgentStateRequest:eh.Type.Object({replId:eh.Type.String(),sessionId:eh.Type.String()}),GetAgentStateResponse:eh.Type.Object({runState:eh.Type.Ref("AgentRunState"),transitionReason:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentStateTransitionReason"),eh.Type.Undefined()]))}),UpdateAgentStateResponse:eh.Type.Object({runState:eh.Type.Ref("AgentRunState"),transitionReason:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentStateTransitionReason"),eh.Type.Undefined()]))}),UpdateAgentStateMessage:eh.Type.Object({replId:eh.Type.String(),sessionId:eh.Type.String(),runState:eh.Type.Ref("AgentRunState"),transitionReason:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentStateTransitionReason"),eh.Type.Undefined()]))}),BroadcastAgentStateRequest:eh.Type.Object({replId:eh.Type.String(),sessionId:eh.Type.String(),runState:eh.Type.Ref("AgentRunState"),transitionReason:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentStateTransitionReason"),eh.Type.Undefined()]))}),BroadcastAgentStateResponse:eh.Type.Object({}),AgentStateTransitionReason:eh.Type.Object({reasons:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("userPaused"),value:eh.Type.Ref("AgentStateTransitionReasonUserPaused")}),eh.Type.Object({$case:eh.Type.Literal("stepLimitExceeded"),value:eh.Type.Ref("AgentStateTransitionReasonStepLimitExceeded")}),eh.Type.Object({$case:eh.Type.Literal("rateLimited"),value:eh.Type.Ref("AgentStateTransitionReasonRateLimited")}),eh.Type.Object({$case:eh.Type.Literal("waitingOnUserResponse"),value:eh.Type.Ref("AgentStateTransitionReasonWaitingOnUserResponse")}),eh.Type.Object({$case:eh.Type.Literal("waitingOnPlanApproval"),value:eh.Type.Ref("AgentStateTransitionReasonWaitingOnPlanApproval")}),eh.Type.Object({$case:eh.Type.Literal("requestedSecrets"),value:eh.Type.Ref("AgentStateTransitionReasonRequestedSecrets")}),eh.Type.Object({$case:eh.Type.Literal("testConcluded"),value:eh.Type.Ref("AgentStateTransitionReasonTestConcluded")}),eh.Type.Object({$case:eh.Type.Literal("error"),value:eh.Type.Ref("AgentStateTransitionReasonError")}),eh.Type.Object({$case:eh.Type.Literal("planConcluded"),value:eh.Type.Ref("AgentStateTransitionReasonPlanConcluded")}),eh.Type.Object({$case:eh.Type.Literal("reverted"),value:eh.Type.Ref("AgentStateTransitionReasonReverted")}),eh.Type.Object({$case:eh.Type.Literal("authorizationFailed"),value:eh.Type.Ref("AgentStateTransitionReasonAuthorizationFailed")}),eh.Type.Object({$case:eh.Type.Literal("stepTooComplex"),value:eh.Type.Ref("AgentStateTransitionReasonStepTooComplex")}),eh.Type.Object({$case:eh.Type.Literal("triggerCheckpoint"),value:eh.Type.Ref("AgentStateTransitionReasonTriggerCheckpoint")}),eh.Type.Undefined()]))}),AgentStateTransitionReasonUserPaused:eh.Type.Object({}),AgentStateTransitionReasonStepLimitExceeded:eh.Type.Object({maxSteps:eh.Type.Number()}),AgentStateTransitionReasonRateLimited:eh.Type.Object({timeWhenReset:eh.Type.String()}),AgentStateTransitionReasonAuthorizationFailed:eh.Type.Object({code:eh.Type.Ref("AgentAuthorizationFailedCode"),message:eh.Type.String()}),AgentStateTransitionReasonWaitingOnUserResponse:eh.Type.Object({}),AgentStateTransitionReasonRequestedSecrets:eh.Type.Object({}),AgentStateTransitionReasonWaitingOnPlanApproval:eh.Type.Object({}),AgentStateTransitionReasonTestConcluded:eh.Type.Object({}),AgentStateTransitionReasonPlanConcluded:eh.Type.Object({}),AgentStateTransitionReasonError:eh.Type.Object({}),AgentStateTransitionReasonReverted:eh.Type.Object({}),AgentStateTransitionReasonStepTooComplex:eh.Type.Object({}),AgentStateTransitionReasonTriggerCheckpoint:eh.Type.Object({}),ReprocessEventRequest:eh.Type.Object({eventId:eh.Type.String(),context:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventContext"),eh.Type.Undefined()]))}),ReprocessEventResponse:eh.Type.Object({}),GetResourceUploadUrlRequest:eh.Type.Object({mimeType:eh.Type.String()}),GetResourceUploadUrlResponse:eh.Type.Object({uploadUrl:eh.Type.String(),downloadUrl:eh.Type.String(),identifier:eh.Type.String()}),GetUrlScreenshotRequest:eh.Type.Object({url:eh.Type.String()}),GetUrlScreenshotResponse:eh.Type.Object({imageDownloadUrl:eh.Type.String()}),GetUrlScrapedContentRequest:eh.Type.Object({url:eh.Type.String()}),GetUrlScrapedContentResponse:eh.Type.Object({content:eh.Type.String()}),GetUrlBrandingRequest:eh.Type.Object({url:eh.Type.String()}),GetUrlBrandingResponse:eh.Type.Object({branding:eh.Type.String()}),AbortEventRequest:eh.Type.Object({eventId:eh.Type.String()}),AbortEventResponse:eh.Type.Object({eventId:eh.Type.String()}),GetReplSessionsRequest:eh.Type.Object({beforeTimestamp:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()])),limit:eh.Type.Number(),includeFirstSessionEvents:eh.Type.Boolean(),firstSessionEventsLimit:eh.Type.Number(),replId:eh.Type.String(),sessionTypes:eh.Type.Array(eh.Type.Ref("SessionType")),archived:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()]))}),GetReplSessionsResponse:eh.Type.Object({hasMore:eh.Type.Boolean(),sessions:eh.Type.Array(eh.Type.Ref("Session")),replAgentState:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ReplAgentState"),eh.Type.Undefined()]))}),EnhanceAgentPromptRequest:eh.Type.Object({userPrompt:eh.Type.String(),uploadedFiles:eh.Type.Array(eh.Type.Ref("UploadedFile")),attachedUrls:eh.Type.Array(eh.Type.Ref("AttachedUrl")),selectedTheme:eh.Type.String()}),EnhanceAgentPromptResponse:eh.Type.Object({enhancedPrompt:eh.Type.String()}),GetSessionEventsRequest:eh.Type.Object({sessionId:eh.Type.String(),limit:eh.Type.Number(),excludeContents:eh.Type.Boolean(),afterTimestamp:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()]))}),GetSessionEventsResponse:eh.Type.Object({events:eh.Type.Array(eh.Type.Ref("Event")),session:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("Session"),eh.Type.Undefined()]))}),BatchGetEventsRequest:eh.Type.Object({sessionId:eh.Type.String(),eventIds:eh.Type.Array(eh.Type.String())}),BatchGetEventsResponse:eh.Type.Object({events:eh.Type.Array(eh.Type.Ref("Event"))}),CreateSessionRequest:eh.Type.Object({replId:eh.Type.String(),sessionType:eh.Type.Ref("SessionType"),title:eh.Type.String(),seededAiFirstEventContents:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventContents"),eh.Type.Undefined()])),taskId:eh.Type.String(),revertedToSessionId:eh.Type.String(),revertedToEventId:eh.Type.String()}),CreateSessionResponse:eh.Type.Object({sessionId:eh.Type.String(),sessionCreationEventId:eh.Type.String(),seededAiFirstEventId:eh.Type.String()}),GetEventListRequest:eh.Type.Object({sessionId:eh.Type.String(),limit:eh.Type.Number(),ancestorsOf:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),afterTimestamp:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()]))}),GetEventListResponse:eh.Type.Object({shapes:eh.Type.Array(eh.Type.Ref("EventShape")),hasMore:eh.Type.Boolean()}),SubscribeToReplEventsRequest:eh.Type.Object({replId:eh.Type.String()}),ReplEventsSubscriptionMessage:eh.Type.Object({sender:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("UserContext"),eh.Type.Undefined()])),seqno:eh.Type.Number(),message:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("subscriptionStatusMessage"),value:eh.Type.Ref("SubscriptionStatusMessage")}),eh.Type.Object({$case:eh.Type.Literal("createEventMessage"),value:eh.Type.Ref("CreateEventMessage")}),eh.Type.Object({$case:eh.Type.Literal("createSessionMessage"),value:eh.Type.Ref("CreateSessionMessage")}),eh.Type.Object({$case:eh.Type.Literal("updateEventMessage"),value:eh.Type.Ref("UpdateEventMessage")}),eh.Type.Object({$case:eh.Type.Literal("updateSessionMessage"),value:eh.Type.Ref("UpdateSessionMessage")}),eh.Type.Object({$case:eh.Type.Literal("abortEventMessage"),value:eh.Type.Ref("AbortEventMessage")}),eh.Type.Object({$case:eh.Type.Literal("updateAgentStateMessage"),value:eh.Type.Ref("UpdateAgentStateMessage")}),eh.Type.Undefined()]))}),SubscriptionStatusMessage:eh.Type.Object({}),CreateEventMessage:eh.Type.Object({eventId:eh.Type.String(),parentEventId:eh.Type.String(),sessionId:eh.Type.String(),state:eh.Type.Ref("EventState"),contents:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventContents"),eh.Type.Undefined()])),sender:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("UserContext"),eh.Type.Undefined()])),error:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventError"),eh.Type.Undefined()])),isActive:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),created:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()]))}),CreateSessionMessage:eh.Type.Object({sessionId:eh.Type.String(),title:eh.Type.String(),replId:eh.Type.String(),sessionCreationEventId:eh.Type.String(),sessionType:eh.Type.Ref("SessionType"),archived:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),taskId:eh.Type.String(),revertedToSessionId:eh.Type.String(),revertedToEventId:eh.Type.String()}),UpdateEventMessage:eh.Type.Object({sessionId:eh.Type.String(),eventId:eh.Type.String(),operations:eh.Type.Array(eh.Type.Ref("UpdateEventOperation")),typedOperations:eh.Type.Array(eh.Type.Ref("TypedUpdateEventOperation")),state:eh.Type.Ref("EventState"),error:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventError"),eh.Type.Undefined()]))}),UpdateSessionMessage:eh.Type.Object({sessionId:eh.Type.String(),title:eh.Type.String(),sessionType:eh.Type.Ref("SessionType"),archived:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),replId:eh.Type.String(),activeEventId:eh.Type.String(),isActiveAgentSession:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),readOnly:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),taskId:eh.Type.String()}),AbortEventMessage:eh.Type.Object({replId:eh.Type.String(),sessionId:eh.Type.String(),eventId:eh.Type.String()}),Limit:eh.Type.Object({limit:eh.Type.Number(),usage:eh.Type.Number(),resetTime:eh.Type.Optional(eh.Type.Union([eh.Type.Date(),eh.Type.Undefined()]))}),GetAvailableModelRequest:eh.Type.Object({overrideModel:eh.Type.String()}),ModelName:eh.Type.Object({readable:eh.Type.String(),qualified:eh.Type.String()}),GetAvailableModelsResponse:eh.Type.Object({basicModel:eh.Type.Array(eh.Type.Ref("ModelName")),advancedModel:eh.Type.Array(eh.Type.Ref("ModelName")),overrideModel:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelName"),eh.Type.Undefined()]))}),UpdateSessionRequest:eh.Type.Object({id:eh.Type.String(),title:eh.Type.String(),sessionType:eh.Type.Ref("SessionType"),archived:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),replId:eh.Type.String(),activeEventId:eh.Type.String(),isActiveAgentSession:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),readOnly:eh.Type.Optional(eh.Type.Union([eh.Type.Boolean(),eh.Type.Undefined()])),taskId:eh.Type.String()}),UpdateSessionResponse:eh.Type.Object({}),ProcessEventRequest:eh.Type.Object({replId:eh.Type.String(),contents:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventContents"),eh.Type.Undefined()])),context:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("EventContext"),eh.Type.Undefined()])),sessionId:eh.Type.String()}),ProcessEventResponseMessage:eh.Type.Object({message:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("startMessage"),value:eh.Type.Ref("ProcessEventStartMessage")}),eh.Type.Object({$case:eh.Type.Literal("createEventMessage"),value:eh.Type.Ref("CreateEventMessage")}),eh.Type.Object({$case:eh.Type.Literal("updateEventMessage"),value:eh.Type.Ref("UpdateEventMessage")}),eh.Type.Undefined()]))}),ProcessEventStartMessage:eh.Type.Object({rootId:eh.Type.String()}),GenerateReplNameRequest:eh.Type.Object({replId:eh.Type.String(),prompt:eh.Type.String()}),GenerateReplNameResponse:eh.Type.Object({replName:eh.Type.String()}),GenerateIconRequest:eh.Type.Object({replId:eh.Type.String(),prompt:eh.Type.String()}),GenerateIconResponse:eh.Type.Object({imageUrl:eh.Type.String()}),Any:eh.Type.Object({typeUrl:eh.Type.String(),value:eh.Type.Uint8Array()}),Struct:eh.Type.Object({fields:eh.Type.Array(eh.Type.Ref("StructField")),type:eh.Type.String()}),StructField:eh.Type.Object({key:eh.Type.String(),value:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("Value"),eh.Type.Undefined()]))}),Value:eh.Type.Object({kind:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("nullValue"),value:eh.Type.Ref("NullValue")}),eh.Type.Object({$case:eh.Type.Literal("numberValue"),value:eh.Type.Number()}),eh.Type.Object({$case:eh.Type.Literal("stringValue"),value:eh.Type.String()}),eh.Type.Object({$case:eh.Type.Literal("boolValue"),value:eh.Type.Boolean()}),eh.Type.Object({$case:eh.Type.Literal("structValue"),value:eh.Type.Ref("Struct")}),eh.Type.Object({$case:eh.Type.Literal("listValue"),value:eh.Type.Ref("ListValue")}),eh.Type.Undefined()]))}),ListValue:eh.Type.Object({values:eh.Type.Array(eh.Type.Ref("Value"))}),BYOPromptMessage:eh.Type.Object({role:eh.Type.String(),content:eh.Type.String()}),BYOPromptResponseParameter:eh.Type.Object({name:eh.Type.String(),required:eh.Type.Boolean(),parameterType:eh.Type.Ref("BYOPromptResponseParameterType"),description:eh.Type.String(),enums:eh.Type.Array(eh.Type.String())}),BYOPromptEventContents:eh.Type.Object({historicalPrompt:eh.Type.String(),messages:eh.Type.Array(eh.Type.Ref("BYOPromptMessage")),parameters:eh.Type.Array(eh.Type.Ref("BYOPromptResponseParameter")),result:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("Struct"),eh.Type.Undefined()])),jsonResult:eh.Type.String(),forceJson:eh.Type.Boolean(),promptName:eh.Type.String()}),BYOPromptEventContext:eh.Type.Object({modelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()]))}),RevertEventContents:eh.Type.Object({commitId:eh.Type.String(),message:eh.Type.String(),eventIdBeforeRevert:eh.Type.String(),originalSessionId:eh.Type.String(),databaseRollbackTimestamp:eh.Type.String(),deploymentBuildId:eh.Type.String(),rollbackDatabase:eh.Type.Boolean(),revertedToSessionId:eh.Type.String(),revertedToEventId:eh.Type.String()}),TriggerCheckpointEventContents:eh.Type.Object({description:eh.Type.String(),onlyIfDiff:eh.Type.Boolean(),author:eh.Type.Ref("CommitAuthor"),deploymentBuildId:eh.Type.String()}),StepTooComplexAcknowledgementEventContents:eh.Type.Object({cancelCurrentStep:eh.Type.Boolean()}),AgentCapabilityUsage:eh.Type.Object({standardModelProfileLlmCalls:eh.Type.Number(),advancedModelProfileLlmCalls:eh.Type.Number(),thinkingEnabledLlmCalls:eh.Type.Number(),webSearchCalls:eh.Type.Number(),rapidBuild:eh.Type.Boolean(),testingSubagentRuns:eh.Type.Number(),architectSubagentRuns:eh.Type.Number(),generalSubagentRuns:eh.Type.Number()}),TaskEffort:eh.Type.Object({taskId:eh.Type.String(),description:eh.Type.String()}),GeneralEffort:eh.Type.Object({}),AgentInitializationEffort:eh.Type.Object({}),FreeQuickEditEffort:eh.Type.Object({}),DiscountedEffort:eh.Type.Object({effortType:eh.Type.Ref("DiscountedEffortType")}),RelatedEffortBreakdown:eh.Type.Object({effortType:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("task"),value:eh.Type.Ref("TaskEffort")}),eh.Type.Object({$case:eh.Type.Literal("general"),value:eh.Type.Ref("GeneralEffort")}),eh.Type.Object({$case:eh.Type.Literal("initialization"),value:eh.Type.Ref("AgentInitializationEffort")}),eh.Type.Object({$case:eh.Type.Literal("freeQuickEdit"),value:eh.Type.Ref("FreeQuickEditEffort")}),eh.Type.Object({$case:eh.Type.Literal("discountedEffort"),value:eh.Type.Ref("DiscountedEffort")}),eh.Type.Undefined()])),commitId:eh.Type.String(),usageCents:eh.Type.Number(),workDurationSeconds:eh.Type.Number(),numLocRead:eh.Type.Number(),numFilesRead:eh.Type.Number(),addedLinesOfCode:eh.Type.Number(),removedLinesOfCode:eh.Type.Number()}),CommitData:eh.Type.Object({commitId:eh.Type.String(),screenshotUrl:eh.Type.String(),description:eh.Type.String(),billingRate:eh.Type.Ref("CommitBillingRate"),author:eh.Type.Ref("CommitAuthor"),progressSummary:eh.Type.String(),usageCents:eh.Type.Number(),workDurationSeconds:eh.Type.Number(),addedLinesOfCode:eh.Type.Number(),removedLinesOfCode:eh.Type.Number(),toolCalls:eh.Type.Number(),triggerReason:eh.Type.Ref("CheckpointTriggerReason"),capabilityUsage:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentCapabilityUsage"),eh.Type.Undefined()])),ubbV2:eh.Type.Boolean(),numLocRead:eh.Type.Number(),numFilesRead:eh.Type.Number(),refunded:eh.Type.Boolean(),relatedEffortBreakdowns:eh.Type.Array(eh.Type.Ref("RelatedEffortBreakdown")),heliumCheckpointCreated:eh.Type.Boolean()}),ApprovePlanEventContents:eh.Type.Object({planEventId:eh.Type.String(),approver:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("UserContext"),eh.Type.Undefined()])),initialBuildMode:eh.Type.Ref("AgentInitialBuildMode"),userSecretsResponse:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentUserSecretsResponse"),eh.Type.Undefined()])),agentConfig:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentConfig"),eh.Type.Undefined()]))}),ApprovePlanEventContext:eh.Type.Object({}),UserSecretsResponseEventContents:eh.Type.Object({response:eh.Type.Array(eh.Type.Ref("UserSecretResponse"))}),HostingDebugSummaryErrorPorts:eh.Type.Object({exposeLocalhost:eh.Type.Boolean(),localPort:eh.Type.String(),externalPort:eh.Type.String()}),HostingDebugSummaryError:eh.Type.Object({provider:eh.Type.String(),buildCommand:eh.Type.String(),runCommand:eh.Type.String(),publicDir:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),appType:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),logs:eh.Type.Array(eh.Type.String()),envKeys:eh.Type.Array(eh.Type.String()),ports:eh.Type.Array(eh.Type.Ref("HostingDebugSummaryErrorPorts")),entrypointFilePath:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()]))}),HostingDebugSummarySuggestion:eh.Type.Object({name:eh.Type.String(),type:eh.Type.String(),description:eh.Type.String(),before:eh.Type.String(),after:eh.Type.String(),file:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()]))}),HostingDebugSummaryResult:eh.Type.Object({errors:eh.Type.Array(eh.Type.String()),suggestions:eh.Type.Array(eh.Type.Ref("HostingDebugSummarySuggestion"))}),HostingDebugSummaryEventContents:eh.Type.Object({error:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("HostingDebugSummaryError"),eh.Type.Undefined()])),result:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("HostingDebugSummaryResult"),eh.Type.Undefined()])),usedModelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()]))}),HostingDebugSummaryEventContext:eh.Type.Object({modelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()]))}),ReplCreationEventContents:eh.Type.Object({errors:eh.Type.Array(eh.Type.String()),generatedReplName:eh.Type.String(),isAgentRecommended:eh.Type.Boolean(),bestTemplate:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("SuggestedTemplate"),eh.Type.Undefined()])),matchedPlanNames:eh.Type.Array(eh.Type.String()),scaffoldTemplateName:eh.Type.String()}),ReplCreationEventContext:eh.Type.Object({modelSelector:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("ModelSelector"),eh.Type.Undefined()]))}),UserSecretsResponseEventContext:eh.Type.Object({}),IterativeAgentEventContents:eh.Type.Object({contents:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("appliedFileChanges"),value:eh.Type.Ref("IterativeAgentAppliedFileChanges")}),eh.Type.Object({$case:eh.Type.Literal("revertedFileChanges"),value:eh.Type.Ref("IterativeAgentRevertedFileChanges")}),eh.Type.Object({$case:eh.Type.Literal("installingPackages"),value:eh.Type.Ref("IterativeAgentInstallingPackages")}),eh.Type.Object({$case:eh.Type.Literal("installedPackages"),value:eh.Type.Ref("IterativeAgentInstalledPackages")}),eh.Type.Object({$case:eh.Type.Literal("startedShellExecution"),value:eh.Type.Ref("IterativeAgentStartedShellExecution")}),eh.Type.Object({$case:eh.Type.Literal("finishedShellExecution"),value:eh.Type.Ref("IterativeAgentFinishedShellExecution")}),eh.Type.Object({$case:eh.Type.Literal("appliedRunConfiguration"),value:eh.Type.Ref("IterativeAgentAppliedRunConfiguration")}),eh.Type.Object({$case:eh.Type.Literal("appliedDeploymentConfiguration"),value:eh.Type.Ref("IterativeAgentAppliedDeploymentConfiguration")}),eh.Type.Object({$case:eh.Type.Literal("appliedWorkflowConfiguration"),value:eh.Type.Ref("IterativeAgentAppliedWorkflowConfiguration")}),eh.Type.Undefined()]))}),IterativeAgentAppliedFileChanges:eh.Type.Object({eventWhichProposedChanges:eh.Type.String(),appliedChanges:eh.Type.Array(eh.Type.Ref("AppliedFileChange")),commitHash:eh.Type.String()}),IterativeAgentRevertedFileChanges:eh.Type.Object({eventWhichProposedChanges:eh.Type.String(),eventWhichAppliedChanges:eh.Type.String(),revertedChanges:eh.Type.Array(eh.Type.Ref("RevertedFileChange"))}),IterativeAgentInstallingPackages:eh.Type.Object({eventWhichProposedPackageInstall:eh.Type.String(),messageContentsOffset:eh.Type.Number(),processId:eh.Type.String()}),IterativeAgentInstalledPackages:eh.Type.Object({eventWhichProposedPackageInstall:eh.Type.String(),messageContentsOffset:eh.Type.Number(),installationOutput:eh.Type.String(),processId:eh.Type.String(),exitCode:eh.Type.Number()}),AppliedFileChange:eh.Type.Object({filePath:eh.Type.String(),linesAdded:eh.Type.Number(),linesRemoved:eh.Type.Number(),changeSummary:eh.Type.String()}),RevertedFileChange:eh.Type.Object({filePath:eh.Type.String(),changeSummary:eh.Type.String()}),IterativeAgentStartedShellExecution:eh.Type.Object({eventWhichProposedShellExecution:eh.Type.String(),messageContentsOffset:eh.Type.Number(),processId:eh.Type.String()}),IterativeAgentFinishedShellExecution:eh.Type.Object({eventWhichProposedShellExecution:eh.Type.String(),messageContentsOffset:eh.Type.Number(),processId:eh.Type.String(),commandOutput:eh.Type.String(),exitCode:eh.Type.Number()}),IterativeAgentAppliedRunConfiguration:eh.Type.Object({eventWhichProposedRunConfiguration:eh.Type.String(),messageContentsOffset:eh.Type.Number()}),IterativeAgentAppliedWorkflowConfiguration:eh.Type.Object({eventWhichProposedWorkflowConfiguration:eh.Type.String(),messageContentsOffset:eh.Type.Number()}),IterativeAgentAppliedDeploymentConfiguration:eh.Type.Object({eventWhichProposedDeploymentConfiguration:eh.Type.String(),messageContentsOffset:eh.Type.Number()}),IterativeAgentEventContext:eh.Type.Object({}),SystemDependencyInstallData:eh.Type.Object({deps:eh.Type.Array(eh.Type.String())}),SystemDependencyUninstallData:eh.Type.Object({deps:eh.Type.Array(eh.Type.String())}),DeployConfigData:eh.Type.Object({deploymentTarget:eh.Type.String(),run:eh.Type.Array(eh.Type.String()),build:eh.Type.Array(eh.Type.String()),publicDir:eh.Type.String(),ignorePorts:eh.Type.Boolean()}),DeployData:eh.Type.Object({}),RevertData:eh.Type.Object({eventIdBeforeRevert:eh.Type.String(),checkpointCommit:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),status:eh.Type.Ref("RevertStatus"),originalSessionId:eh.Type.String(),checkpointTitle:eh.Type.String()}),AcknowledgeUserMessage:eh.Type.Object({eventIds:eh.Type.Array(eh.Type.String())}),CreatePostgreSQLDatabaseData:eh.Type.Object({}),SqlExecutionData:eh.Type.Object({command:eh.Type.String(),output:eh.Type.String(),status:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("isExecuting"),value:eh.Type.Boolean()}),eh.Type.Object({$case:eh.Type.Literal("exitCode"),value:eh.Type.Number()}),eh.Type.Undefined()]))}),ImageGenerationData:eh.Type.Object({imagePath:eh.Type.String(),imageDescription:eh.Type.String()}),VideoGenerationData:eh.Type.Object({videoPath:eh.Type.String(),videoDescription:eh.Type.String()}),GeneratedMedia:eh.Type.Object({id:eh.Type.String(),path:eh.Type.String(),description:eh.Type.String(),mediaType:eh.Type.Ref("GeneratedMediaType"),error:eh.Type.String()}),GenerateMediaData:eh.Type.Object({media:eh.Type.Array(eh.Type.Ref("GeneratedMedia")),asynchronous:eh.Type.Boolean()}),UpsertGeneratedMediaData:eh.Type.Object({media:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("GeneratedMedia"),eh.Type.Undefined()]))}),WaitingForBackgroundJobsData:eh.Type.Object({waitingType:eh.Type.Ref("WaitingForBackgroundJobType"),maxWaitTimeSeconds:eh.Type.Number(),actualWaitTimeSeconds:eh.Type.Number()}),NewSessionNudge:eh.Type.Object({}),StepTooComplexEventContents:eh.Type.Object({stepId:eh.Type.String(),state:eh.Type.Ref("StepTooComplexEventContentsState")}),UserTipRecommendationData:eh.Type.Object({tipId:eh.Type.String(),title:eh.Type.String(),recommendedReason:eh.Type.String()}),EndOfRunSummaryData:eh.Type.Object({runId:eh.Type.String(),usageCents:eh.Type.Number(),preDiscountsUsageCents:eh.Type.Number(),workDurationSeconds:eh.Type.Number(),addedLinesOfCode:eh.Type.Number(),removedLinesOfCode:eh.Type.Number(),toolCalls:eh.Type.Number(),capabilityUsage:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("AgentCapabilityUsage"),eh.Type.Undefined()])),numLocRead:eh.Type.Number(),numFilesRead:eh.Type.Number(),refunded:eh.Type.Boolean(),relatedEffortBreakdowns:eh.Type.Array(eh.Type.Ref("RelatedEffortBreakdown")),rollbackCheckpointSha:eh.Type.String()}),UITestingSubagentEventContents:eh.Type.Object({testingPlan:eh.Type.String(),finalSummary:eh.Type.String(),title:eh.Type.String(),resultType:eh.Type.Ref("UITestingSubagentResultType")}),GeneralSubagentEventContents:eh.Type.Object({task:eh.Type.String(),taskSummary:eh.Type.String(),result:eh.Type.String(),resultSummary:eh.Type.String(),taskTitle:eh.Type.String(),eventFilter:eh.Type.Ref("GeneralSubagentEventFilter")}),SubagentRunningData:eh.Type.Object({subagentId:eh.Type.String(),childSessionId:eh.Type.String(),totalExecutionTimeSeconds:eh.Type.Number(),subagentName:eh.Type.String(),contents:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("uiTestingSubagentEventContents"),value:eh.Type.Ref("UITestingSubagentEventContents")}),eh.Type.Object({$case:eh.Type.Literal("generalSubagentEventContents"),value:eh.Type.Ref("GeneralSubagentEventContents")}),eh.Type.Undefined()]))}),UITestingSubagentExecutionEventContents:eh.Type.Object({gcsDownloadUrl:eh.Type.String(),mimeType:eh.Type.String(),narration:eh.Type.String(),miniNarration:eh.Type.String()}),UITestingSubagentTakeOverResultSuccess:eh.Type.Object({userNotes:eh.Type.String()}),UITestingSubagentTakeOverResultDeclined:eh.Type.Object({}),UITestingSubagentTakeOverResultTimedOut:eh.Type.Object({}),UITestingSubagentTakeOverData:eh.Type.Object({userInstructions:eh.Type.String(),result:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("success"),value:eh.Type.Ref("UITestingSubagentTakeOverResultSuccess")}),eh.Type.Object({$case:eh.Type.Literal("declined"),value:eh.Type.Ref("UITestingSubagentTakeOverResultDeclined")}),eh.Type.Object({$case:eh.Type.Literal("timedOut"),value:eh.Type.Ref("UITestingSubagentTakeOverResultTimedOut")}),eh.Type.Undefined()]))}),AgentConfigUpdateEventContents:eh.Type.Object({operation:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("automatedTesting"),value:eh.Type.Ref("AgentConfigUpdateAutomatedTesting")}),eh.Type.Undefined()]))}),AgentConfigUpdateAutomatedTesting:eh.Type.Object({enabled:eh.Type.Boolean(),reason:eh.Type.String()}),SamplingTrajectory:eh.Type.Object({id:eh.Type.String(),contents:eh.Type.String(),state:eh.Type.Ref("TrajectoryState")}),SamplingEvent:eh.Type.Object({state:eh.Type.Ref("SamplingEventState"),trajectories:eh.Type.Array(eh.Type.Ref("SamplingTrajectory"))}),SamplingEventUpdate:eh.Type.Object({trajectoryId:eh.Type.String(),contents:eh.Type.String(),state:eh.Type.Ref("TrajectoryState")}),SamplingEventStateUpdate:eh.Type.Object({state:eh.Type.Ref("SamplingEventState")}),UITestingSubagentExecutionEventContentsUpdate:eh.Type.Object({state:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("UITestingSubagentExecutionEventContents"),eh.Type.Undefined()]))}),SubagentRunningDataUpdate:eh.Type.Object({state:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("SubagentRunningData"),eh.Type.Undefined()])),totalExecutionTimeSeconds:eh.Type.Number()}),SetupObjectStorageData:eh.Type.Object({bucketName:eh.Type.String(),bucketId:eh.Type.String()}),MoveEventsBetweenSessionsRequest:eh.Type.Object({sourceSessionId:eh.Type.String(),destinationSessionId:eh.Type.String()}),MoveEventsBetweenSessionsResponse:eh.Type.Object({}),AbortSubagentRequest:eh.Type.Object({replId:eh.Type.String(),sessionId:eh.Type.String(),subagentId:eh.Type.String()}),AbortSubagentResponse:eh.Type.Object({}),WarmAgentRequest:eh.Type.Object({replId:eh.Type.String(),sessionId:eh.Type.String()}),WarmAgentResponse:eh.Type.Object({}),StockImageData:eh.Type.Object({imageDescription:eh.Type.String(),numberOfImages:eh.Type.Number(),imageUrls:eh.Type.Array(eh.Type.String())}),AddingIntegrationsRequest:eh.Type.Object({connectorIds:eh.Type.Array(eh.Type.String()),connectionIds:eh.Type.Array(eh.Type.String())}),AddingIntegrationsResponse:eh.Type.Object({connectionIds:eh.Type.Array(eh.Type.String()),rejectedConnectionIds:eh.Type.Array(eh.Type.String()),rejectedConnectorIds:eh.Type.Array(eh.Type.String())}),InitialBuildStateUpdateEventContents:eh.Type.Object({phase:eh.Type.Ref("InitialBuildPhase")}),SearchIntegrationsData:eh.Type.Object({query:eh.Type.String(),numResults:eh.Type.Number()}),ViewIntegrationData:eh.Type.Object({name:eh.Type.String()}),ViewLogsData:eh.Type.Object({webviewConsole:eh.Type.Boolean(),workflows:eh.Type.Boolean(),deployment:eh.Type.Boolean(),lsp:eh.Type.Boolean()}),SetupModelfarmData:eh.Type.Object({}),ViewSpecialFilesData:eh.Type.Object({fileType:eh.Type.Ref("SpecialFileType")}),DesignGuidelinesData:eh.Type.Object({}),MCPToolData:eh.Type.Object({toolName:eh.Type.String(),serverName:eh.Type.String(),parameters:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("Struct"),eh.Type.Undefined()])),result:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("MCPToolResult"),eh.Type.Undefined()])),progress:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("MCPToolProgress"),eh.Type.Undefined()])),insecureError:eh.Type.String()}),MCPToolParameter:eh.Type.Object({key:eh.Type.String(),value:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("Any"),eh.Type.Undefined()]))}),MCPToolResult:eh.Type.Object({content:eh.Type.String(),contentBlocks:eh.Type.Array(eh.Type.Ref("MCPContentBlock")),structuredContent:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("Struct"),eh.Type.Undefined()])),isError:eh.Type.Boolean()}),MCPToolProgress:eh.Type.Object({progress:eh.Type.Number(),total:eh.Type.Optional(eh.Type.Union([eh.Type.Number(),eh.Type.Undefined()])),message:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()]))}),MCPContentBlock:eh.Type.Object({block:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("textContent"),value:eh.Type.Ref("MCPContentBlockTextContent")}),eh.Type.Object({$case:eh.Type.Literal("imageContent"),value:eh.Type.Ref("MCPContentBlockImageContent")}),eh.Type.Object({$case:eh.Type.Literal("audioContent"),value:eh.Type.Ref("MCPContentBlockAudioContent")}),eh.Type.Object({$case:eh.Type.Literal("resourceLink"),value:eh.Type.Ref("MCPContentBlockResourceLink")}),eh.Type.Object({$case:eh.Type.Literal("embeddedResource"),value:eh.Type.Ref("MCPContentBlockEmbeddedResource")}),eh.Type.Undefined()]))}),MCPAnnotations:eh.Type.Object({audience:eh.Type.Array(eh.Type.String()),priority:eh.Type.Optional(eh.Type.Union([eh.Type.Number(),eh.Type.Undefined()]))}),MCPContentBlockTextContent:eh.Type.Object({text:eh.Type.String(),annotations:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("MCPAnnotations"),eh.Type.Undefined()])),meta:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()]))}),MCPContentBlockImageContent:eh.Type.Object({data:eh.Type.String(),mimeType:eh.Type.String(),annotations:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("MCPAnnotations"),eh.Type.Undefined()])),meta:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()]))}),MCPContentBlockAudioContent:eh.Type.Object({data:eh.Type.String(),mimeType:eh.Type.String(),annotations:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("MCPAnnotations"),eh.Type.Undefined()])),meta:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()]))}),MCPContentBlockResourceLink:eh.Type.Object({name:eh.Type.String(),title:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),uri:eh.Type.String(),description:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),mimeType:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),size:eh.Type.Optional(eh.Type.Union([eh.Type.Number(),eh.Type.Undefined()])),annotations:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("MCPAnnotations"),eh.Type.Undefined()])),meta:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()]))}),MCPResourceContents:eh.Type.Object({uri:eh.Type.String(),mimeType:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),meta:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()])),contents:eh.Type.Optional(eh.Type.Union([eh.Type.Object({$case:eh.Type.Literal("text"),value:eh.Type.String()}),eh.Type.Object({$case:eh.Type.Literal("blob"),value:eh.Type.String()}),eh.Type.Undefined()]))}),MCPContentBlockEmbeddedResource:eh.Type.Object({resource:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("MCPResourceContents"),eh.Type.Undefined()])),annotations:eh.Type.Optional(eh.Type.Union([eh.Type.Ref("MCPAnnotations"),eh.Type.Undefined()])),meta:eh.Type.Optional(eh.Type.Union([eh.Type.String(),eh.Type.Undefined()]))}),AlertData:eh.Type.Object({alertLevel:eh.Type.Ref("AlertLevel"),message:eh.Type.String(),nextAction:eh.Type.Ref("AlertNextAction")}),EnvVar:eh.Type.Object({key:eh.Type.String(),environment:eh.Type.Ref("EnvironmentType")}),EnvironmentConfigRequest:eh.Type.Object({envVars:eh.Type.Array(eh.Type.Ref("EnvVar")),message:eh.Type.String()}),ProvidedEnvVar:eh.Type.Object({key:eh.Type.String(),value:eh.Type.String(),environment:eh.Type.Ref("EnvironmentType")}),EnvironmentConfigResponse:eh.Type.Object({providedEnvVars:eh.Type.Array(eh.Type.Ref("ProvidedEnvVar"))}),ViewEnvVarData:eh.Type.Object({type:eh.Type.Ref("EnvironmentVariableType"),environment:eh.Type.Ref("EnvironmentType"),keys:eh.Type.Array(eh.Type.String())}),SetEnvVarData:eh.Type.Object({type:eh.Type.Ref("EnvironmentVariableType"),environment:eh.Type.Ref("EnvironmentType"),keys:eh.Type.Array(eh.Type.String())}),DeleteEnvVarData:eh.Type.Object({type:eh.Type.Ref("EnvironmentVariableType"),environment:eh.Type.Ref("EnvironmentType"),keys:eh.Type.Array(eh.Type.String())})});n9.Import("AgentRunState"),n9.Import("AgentUserFeedbackType"),n9.Import("UserSecretResponseStatus"),n9.Import("ProjectImportSource"),n9.Import("TaskStatus"),n9.Import("AgentPlanStepStatus"),n9.Import("RequestFeatureAddType"),n9.Import("StackBlueprint"),n9.Import("AgentStackTriggerType"),n9.Import("BlueprintCategory"),n9.Import("WebSearchType"),n9.Import("BenchmarkConclusionReason"),n9.Import("AttachedFormType"),n9.Import("UrlIntent"),n9.Import("FileChangeGenerationState"),n9.Import("TranslationTarget"),n9.Import("ModelType"),n9.Import("CodeReferenceType"),n9.Import("DebugErrorSource"),n9.Import("EventState"),n9.Import("InlineMessageType"),n9.Import("UserType");var n7=n9.Import("SessionType");n9.Import("MessageStopReason"),n9.Import("MessageAction"),n9.Import("MembershipType"),n9.Import("EventErrorType"),n9.Import("AgentMode"),n9.Import("AgentInitialBuildMode"),n9.Import("AutonomyLevel"),n9.Import("ModelProfile"),n9.Import("UpdateEventOperationType"),n9.Import("AgentAuthorizationFailedCode"),n9.Import("NullValue"),n9.Import("BYOPromptResponseParameterType"),n9.Import("CommitAuthor"),n9.Import("CommitBillingRate"),n9.Import("CheckpointTriggerReason"),n9.Import("DiscountedEffortType"),n9.Import("RevertStatus"),n9.Import("GeneratedMediaType"),n9.Import("WaitingForBackgroundJobType"),n9.Import("StepTooComplexEventContentsState"),n9.Import("UITestingSubagentResultType"),n9.Import("GeneralSubagentEventFilter"),n9.Import("SamplingEventState"),n9.Import("TrajectoryState"),n9.Import("InitialBuildPhase"),n9.Import("SpecialFileType"),n9.Import("AlertLevel"),n9.Import("AlertNextAction"),n9.Import("EnvironmentType"),n9.Import("EnvironmentVariableType"),n9.Import("RevertToCommitRequest"),n9.Import("RevertToCommitResponse"),n9.Import("CloneSessionRequest"),n9.Import("CloneSessionResponse"),n9.Import("Ping"),n9.Import("Pong"),n9.Import("Event"),n9.Import("EventShape"),n9.Import("AgentUserFeedback"),n9.Import("SubmitAgentUserFeedbackRequest"),n9.Import("SubmitAgentUserFeedbackResponse"),n9.Import("ReplAgentState"),n9.Import("Session"),n9.Import("Secret"),n9.Import("SecretRequestAction"),n9.Import("UserSecretResponse"),n9.Import("DeployRequest"),n9.Import("DeployResponse"),n9.Import("MessageButton"),n9.Import("DeployRequestAction"),n9.Import("MessageButtonAction"),n9.Import("AgentUserSecretsRequest"),n9.Import("AgentUserSecretsResponse"),n9.Import("AgentDebugRequest"),n9.Import("AgentDebugResponse"),n9.Import("AgentContinueRequest"),n9.Import("AgentContinueResponse"),n9.Import("AgentNewFeatureRequest"),n9.Import("UserMessageContents"),n9.Import("AgentNewFeatureResponse"),n9.Import("AgentDeployRequest"),n9.Import("AgentDeployResponse"),n9.Import("AgentAction"),n9.Import("AgentNextStepRequest"),n9.Import("AgentNextStepResponse"),n9.Import("AgentQueryBoolean"),n9.Import("AgentQueryChoice"),n9.Import("AgentQueryText"),n9.Import("AgentQuery"),n9.Import("AgentQueryBooleanResponse"),n9.Import("AgentQueryChoiceResponse"),n9.Import("AgentQueryTextResponse"),n9.Import("AgentQueryNoResponse"),n9.Import("AgentQueryResponse"),n9.Import("QueryResponseContent"),n9.Import("QueryRequestContent"),n9.Import("MarkTaskCompleteRequest"),n9.Import("UserMarkedTaskComplete"),n9.Import("ApproveTaskListRequest"),n9.Import("ApproveTaskListResponse"),n9.Import("ApproveInitialBuildMVPRequest"),n9.Import("ApproveInitialBuildMVPResponse"),n9.Import("ApproveInitialBuildVisualPhaseRequest"),n9.Import("ApproveInitialBuildVisualPhaseResponse"),n9.Import("ApproveSqlQueryRequest"),n9.Import("ApproveSqlQueryResponse"),n9.Import("ApproveBlueprintRequest"),n9.Import("ApproveBlueprintResponse"),n9.Import("ConvertMockupToAppRequest"),n9.Import("ConvertMockupToAppResponse"),n9.Import("AgentAskUserForActionRequest"),n9.Import("AgentAskUserForActionResponse"),n9.Import("SetupImportedProjectEventContents"),n9.Import("ProjectImportCompletedData"),n9.Import("MemoryCompressionData"),n9.Import("TaskListData"),n9.Import("Task"),n9.Import("EventContents"),n9.Import("EventContext"),n9.Import("StartRapidBuildEventContents"),n9.Import("RapidBuildStartedData"),n9.Import("SessionCreationEventContents"),n9.Import("DatabaseNudgeEventContents"),n9.Import("CodeChangeStats"),n9.Import("AgentPlanStep"),n9.Import("BlueprintsSetup"),n9.Import("RequestFeatureAdd"),n9.Import("AgentPlanObjective"),n9.Import("AgentPlanEventContents"),n9.Import("AgentPlanEventContext"),n9.Import("RevertEventContext"),n9.Import("BlueprintData"),n9.Import("ShellExecutionData"),n9.Import("FileEditData"),n9.Import("CreateFileData"),n9.Import("ReadFileData"),n9.Import("ReadDirData"),n9.Import("PackagerInstallData"),n9.Import("PackagerUninstallData"),n9.Import("SearchFilesystemData"),n9.Import("WebSearchResultPage"),n9.Import("GoogleSuggestedSearch"),n9.Import("WebSearchData"),n9.Import("WebPageVisitData"),n9.Import("ScreenshotData"),n9.Import("ToolchainInstallData"),n9.Import("WorkflowsGetOutputToolData"),n9.Import("WorkflowsRemoveRunConfigToolData"),n9.Import("WorkflowsRestartToolData"),n9.Import("WorkflowsSetRunConfigToolData"),n9.Import("WorkflowsStartToolData"),n9.Import("WorkflowsStopToolData"),n9.Import("SuggestRollbackData"),n9.Import("PresentResultsToolData"),n9.Import("SearchFileData"),n9.Import("SuggestGeneralBuildModeData"),n9.Import("AgentTimelineEventContents"),n9.Import("AgentPlanStepBeginData"),n9.Import("SummarizeObjectiveData"),n9.Import("AgentThoughtsData"),n9.Import("RedactedThoughtsMarker"),n9.Import("RapidBuildConcludedData"),n9.Import("VersionMigratedData"),n9.Import("PlanProgressData"),n9.Import("BenchmarkConclusionEventContents"),n9.Import("BenchmarkMetrics"),n9.Import("Metric"),n9.Import("MetricByTag"),n9.Import("AgentTimelineEventContext"),n9.Import("Range"),n9.Import("CodeReference");var re=n9.Import("MessageEventContents");n9.Import("TargetedElement"),n9.Import("RelatedElement"),n9.Import("AttachedForm"),n9.Import("AttachedFormField"),n9.Import("AttachedFormStringField"),n9.Import("AttachedFormFilesField"),n9.Import("AttachedFormFiles"),n9.Import("UpdateAttachedFormStringFieldSet"),n9.Import("UpdateAttachedFormStringFieldAppend"),n9.Import("SelectedRagContext"),n9.Import("AssistantProposedActions"),n9.Import("IntegrationTestEventContents"),n9.Import("ContextComplexityEventContents"),n9.Import("EventTooLargeEventContents"),n9.Import("IntegrationTestEventContext"),n9.Import("AttachedUrl"),n9.Import("UploadedFile"),n9.Import("UploadedRapidBuildFile"),n9.Import("BenchmarkParameters"),n9.Import("SuggestedTemplates"),n9.Import("SuggestedTemplate"),n9.Import("ProposedFileChanges"),n9.Import("ProposedFileChange"),n9.Import("ProposedShellCommand"),n9.Import("ProposedPackageInstall"),n9.Import("ProposedWorkspaceToolNudge"),n9.Import("ProposedRunConfiguration"),n9.Import("ProposedWorkflowConfiguration"),n9.Import("ProposedDeploymentConfiguration"),n9.Import("Source"),n9.Import("InlineActionEventContents"),n9.Import("ShellSuggestionEventContents"),n9.Import("SessionCreationEventContext"),n9.Import("TranslateEventContents"),n9.Import("TranslateEventContext"),n9.Import("LocalShellExecutionEventContents"),n9.Import("LocalShellExecutionEventContext"),n9.Import("ShellSuggestionEventContext"),n9.Import("ModelSelector"),n9.Import("EventError"),n9.Import("MediaReference");var rt=n9.Import("AgentConfig");n9.Import("MessageEventContext"),n9.Import("InlineActionEventContext"),n9.Import("UpdateEventOperation"),n9.Import("TypedUpdateEventOperation"),n9.Import("AppendTimelineMessageContentsUpdate"),n9.Import("AppendThoughtContentsUpdate"),n9.Import("NewThoughtSummaryUpdate"),n9.Import("AppendRedactedThoughtsMarkerUpdate"),n9.Import("AgentTimelineEventSet"),n9.Import("HostingDebugSummaryEventSet"),n9.Import("ReplCreationEventSet"),n9.Import("MessageContentsUpdate"),n9.Import("IntegrationTestEventContentsUpdate"),n9.Import("AgentAskUserForActionRequestSet"),n9.Import("MessageContentsSet"),n9.Import("ShellSuggestionContentsUpdate"),n9.Import("LocalShellExecutionEventSet"),n9.Import("AgentTimelineEventCreateFileAddContent"),n9.Import("AddSourcesUpdate"),n9.Import("AddSuggestedTemplatesUpdate"),n9.Import("AddProposedActionsMetadata"),n9.Import("AddRagContext"),n9.Import("AddProposedFileChangesMetadata"),n9.Import("AddProposedFileChange"),n9.Import("UpdateProposedFileChange"),n9.Import("AddProposedShellCommand"),n9.Import("AddProposedPackageInstall"),n9.Import("UpdateRevertStatus"),n9.Import("AddProposedWorkspaceToolNudge"),n9.Import("AddProposedRunConfiguration"),n9.Import("AddProposedWorkflowConfiguration"),n9.Import("UpdateFileEditLineCountsUpdate"),n9.Import("AddProposedDeploymentConfiguration"),n9.Import("AddDesignReferenceFile"),n9.Import("UpdatePlanContents"),n9.Import("UpdatePlanApprovalStatus"),n9.Import("BYOPromptResultUpdate"),n9.Import("GovalToken"),n9.Import("AuthToken"),n9.Import("UserContext"),n9.Import("CreateEventRequest"),n9.Import("CreateEventResponse"),n9.Import("CreateEventRequestWithUser"),n9.Import("BatchCreateEventsRequest"),n9.Import("BatchCreateEventsResponse"),n9.Import("UpdateEventRequest"),n9.Import("UpdateEventResponse"),n9.Import("UpdateAgentStateRequest"),n9.Import("GetAgentStateRequest"),n9.Import("GetAgentStateResponse"),n9.Import("UpdateAgentStateResponse"),n9.Import("UpdateAgentStateMessage"),n9.Import("BroadcastAgentStateRequest"),n9.Import("BroadcastAgentStateResponse"),n9.Import("AgentStateTransitionReason"),n9.Import("AgentStateTransitionReasonUserPaused"),n9.Import("AgentStateTransitionReasonStepLimitExceeded"),n9.Import("AgentStateTransitionReasonRateLimited"),n9.Import("AgentStateTransitionReasonAuthorizationFailed"),n9.Import("AgentStateTransitionReasonWaitingOnUserResponse"),n9.Import("AgentStateTransitionReasonRequestedSecrets"),n9.Import("AgentStateTransitionReasonWaitingOnPlanApproval"),n9.Import("AgentStateTransitionReasonTestConcluded"),n9.Import("AgentStateTransitionReasonPlanConcluded"),n9.Import("AgentStateTransitionReasonError"),n9.Import("AgentStateTransitionReasonReverted"),n9.Import("AgentStateTransitionReasonStepTooComplex"),n9.Import("AgentStateTransitionReasonTriggerCheckpoint"),n9.Import("ReprocessEventRequest"),n9.Import("ReprocessEventResponse"),n9.Import("GetResourceUploadUrlRequest"),n9.Import("GetResourceUploadUrlResponse"),n9.Import("GetUrlScreenshotRequest"),n9.Import("GetUrlScreenshotResponse"),n9.Import("GetUrlScrapedContentRequest"),n9.Import("GetUrlScrapedContentResponse"),n9.Import("GetUrlBrandingRequest"),n9.Import("GetUrlBrandingResponse"),n9.Import("AbortEventRequest"),n9.Import("AbortEventResponse"),n9.Import("GetReplSessionsRequest"),n9.Import("GetReplSessionsResponse"),n9.Import("EnhanceAgentPromptRequest"),n9.Import("EnhanceAgentPromptResponse"),n9.Import("GetSessionEventsRequest"),n9.Import("GetSessionEventsResponse"),n9.Import("BatchGetEventsRequest"),n9.Import("BatchGetEventsResponse"),n9.Import("CreateSessionRequest"),n9.Import("CreateSessionResponse"),n9.Import("GetEventListRequest"),n9.Import("GetEventListResponse"),n9.Import("SubscribeToReplEventsRequest"),n9.Import("ReplEventsSubscriptionMessage"),n9.Import("SubscriptionStatusMessage"),n9.Import("CreateEventMessage"),n9.Import("CreateSessionMessage"),n9.Import("UpdateEventMessage"),n9.Import("UpdateSessionMessage"),n9.Import("AbortEventMessage"),n9.Import("Limit"),n9.Import("GetAvailableModelRequest"),n9.Import("ModelName"),n9.Import("GetAvailableModelsResponse"),n9.Import("UpdateSessionRequest"),n9.Import("UpdateSessionResponse"),n9.Import("ProcessEventRequest"),n9.Import("ProcessEventResponseMessage"),n9.Import("ProcessEventStartMessage"),n9.Import("GenerateReplNameRequest"),n9.Import("GenerateReplNameResponse"),n9.Import("GenerateIconRequest"),n9.Import("GenerateIconResponse"),n9.Import("Any"),n9.Import("Struct"),n9.Import("StructField"),n9.Import("Value"),n9.Import("ListValue"),n9.Import("BYOPromptMessage"),n9.Import("BYOPromptResponseParameter"),n9.Import("BYOPromptEventContents"),n9.Import("BYOPromptEventContext"),n9.Import("RevertEventContents"),n9.Import("TriggerCheckpointEventContents"),n9.Import("StepTooComplexAcknowledgementEventContents"),n9.Import("AgentCapabilityUsage"),n9.Import("TaskEffort"),n9.Import("GeneralEffort"),n9.Import("AgentInitializationEffort"),n9.Import("FreeQuickEditEffort"),n9.Import("DiscountedEffort"),n9.Import("RelatedEffortBreakdown"),n9.Import("CommitData"),n9.Import("ApprovePlanEventContents"),n9.Import("ApprovePlanEventContext"),n9.Import("UserSecretsResponseEventContents"),n9.Import("HostingDebugSummaryErrorPorts"),n9.Import("HostingDebugSummaryError"),n9.Import("HostingDebugSummarySuggestion"),n9.Import("HostingDebugSummaryResult"),n9.Import("HostingDebugSummaryEventContents"),n9.Import("HostingDebugSummaryEventContext"),n9.Import("ReplCreationEventContents"),n9.Import("ReplCreationEventContext"),n9.Import("UserSecretsResponseEventContext"),n9.Import("IterativeAgentEventContents"),n9.Import("IterativeAgentAppliedFileChanges"),n9.Import("IterativeAgentRevertedFileChanges"),n9.Import("IterativeAgentInstallingPackages"),n9.Import("IterativeAgentInstalledPackages"),n9.Import("AppliedFileChange"),n9.Import("RevertedFileChange"),n9.Import("IterativeAgentStartedShellExecution"),n9.Import("IterativeAgentFinishedShellExecution"),n9.Import("IterativeAgentAppliedRunConfiguration"),n9.Import("IterativeAgentAppliedWorkflowConfiguration"),n9.Import("IterativeAgentAppliedDeploymentConfiguration"),n9.Import("IterativeAgentEventContext"),n9.Import("SystemDependencyInstallData"),n9.Import("SystemDependencyUninstallData"),n9.Import("DeployConfigData"),n9.Import("DeployData"),n9.Import("RevertData"),n9.Import("AcknowledgeUserMessage"),n9.Import("CreatePostgreSQLDatabaseData"),n9.Import("SqlExecutionData"),n9.Import("ImageGenerationData"),n9.Import("VideoGenerationData"),n9.Import("GeneratedMedia"),n9.Import("GenerateMediaData"),n9.Import("UpsertGeneratedMediaData"),n9.Import("WaitingForBackgroundJobsData"),n9.Import("NewSessionNudge"),n9.Import("StepTooComplexEventContents"),n9.Import("UserTipRecommendationData"),n9.Import("EndOfRunSummaryData"),n9.Import("UITestingSubagentEventContents"),n9.Import("GeneralSubagentEventContents"),n9.Import("SubagentRunningData"),n9.Import("UITestingSubagentExecutionEventContents"),n9.Import("UITestingSubagentTakeOverResultSuccess"),n9.Import("UITestingSubagentTakeOverResultDeclined"),n9.Import("UITestingSubagentTakeOverResultTimedOut"),n9.Import("UITestingSubagentTakeOverData"),n9.Import("AgentConfigUpdateEventContents"),n9.Import("AgentConfigUpdateAutomatedTesting"),n9.Import("SamplingTrajectory"),n9.Import("SamplingEvent"),n9.Import("SamplingEventUpdate"),n9.Import("SamplingEventStateUpdate"),n9.Import("UITestingSubagentExecutionEventContentsUpdate"),n9.Import("SubagentRunningDataUpdate"),n9.Import("SetupObjectStorageData"),n9.Import("MoveEventsBetweenSessionsRequest"),n9.Import("MoveEventsBetweenSessionsResponse"),n9.Import("AbortSubagentRequest"),n9.Import("AbortSubagentResponse"),n9.Import("WarmAgentRequest"),n9.Import("WarmAgentResponse"),n9.Import("StockImageData"),n9.Import("AddingIntegrationsRequest"),n9.Import("AddingIntegrationsResponse"),n9.Import("InitialBuildStateUpdateEventContents"),n9.Import("SearchIntegrationsData"),n9.Import("ViewIntegrationData"),n9.Import("ViewLogsData"),n9.Import("SetupModelfarmData"),n9.Import("ViewSpecialFilesData"),n9.Import("DesignGuidelinesData"),n9.Import("MCPToolData"),n9.Import("MCPToolParameter"),n9.Import("MCPToolResult"),n9.Import("MCPToolProgress"),n9.Import("MCPContentBlock"),n9.Import("MCPAnnotations"),n9.Import("MCPContentBlockTextContent"),n9.Import("MCPContentBlockImageContent"),n9.Import("MCPContentBlockAudioContent"),n9.Import("MCPContentBlockResourceLink"),n9.Import("MCPResourceContents"),n9.Import("MCPContentBlockEmbeddedResource"),n9.Import("AlertData"),n9.Import("EnvVar"),n9.Import("EnvironmentConfigRequest"),n9.Import("ProvidedEnvVar"),n9.Import("EnvironmentConfigResponse"),n9.Import("ViewEnvVarData"),n9.Import("SetEnvVarData"),n9.Import("DeleteEnvVarData"),e.s(["AgentConfigSchema",()=>rt,"MessageEventContentsSchema",()=>re,"SessionTypeSchema",()=>n7],230153),Error("timeout while waiting for mutex to become available"),Error("mutex already locked");var rn=Error("request for lock canceled"),rr=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;(0,ea._)(this,e),this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}return(0,es._)(e,[{key:"acquire",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t<=0)throw Error("invalid weight ".concat(t,": must be positive"));return new Promise(function(r,i){var o={resolve:r,reject:i,weight:t,priority:n},a=ri(e._queue,function(e){return n<=e.priority});-1===a&&t<=e._value?e._dispatchItem(o):e._queue.splice(a+1,0,o)})}},{key:"runExclusive",value:function(e){var t,n,r,i;return t=this,n=arguments,r=void 0,i=function(e){var t,n,r,i,o,a=arguments;return(0,ef._)(this,function(s){switch(s.label){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:1,n=a.length>2&&void 0!==a[2]?a[2]:0,[4,this.acquire(t,n)];case 1:i=(r=ed._.apply(void 0,[s.sent(),2]))[0],o=r[1],s.label=2;case 2:return s.trys.push([2,,4,5]),[4,e(i)];case 3:return[2,s.sent()];case 4:return o(),[7];case 5:return[2]}})},new(r||(r=Promise))(function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,(0,ec._)(n,r)?n:new r(function(e){e(n)})).then(a,s)}l((i=i.apply(t,n||[])).next())})}},{key:"waitForUnlock",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t<=0)throw Error("invalid weight ".concat(t,": must be positive"));return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(function(r){var i,o,a;e._weightedWaiters[t-1]||(e._weightedWaiters[t-1]=[]),i=e._weightedWaiters[t-1],o={resolve:r,priority:n},a=ri(i,function(e){return o.priority<=e.priority}),i.splice(a+1,0,o)})}},{key:"isLocked",value:function(){return this._value<=0}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e){this._value=e,this._dispatchQueue()}},{key:"release",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e<=0)throw Error("invalid weight ".concat(e,": must be positive"));this._value+=e,this._dispatchQueue()}},{key:"cancel",value:function(){var e=this;this._queue.forEach(function(t){return t.reject(e._cancelError)}),this._queue=[]}},{key:"_dispatchQueue",value:function(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}},{key:"_dispatchItem",value:function(e){var t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}},{key:"_newReleaser",value:function(e){var t=this,n=!1;return function(){n||(n=!0,t.release(e))}}},{key:"_drainUnlockWaiters",value:function(){if(0===this._queue.length)for(var e=this._value;e>0;e--){var t=this._weightedWaiters[e-1];t&&(t.forEach(function(e){return e.resolve()}),this._weightedWaiters[e-1]=[])}else for(var n=this._queue[0].priority,r=this._value;r>0;r--){var i=this._weightedWaiters[r-1];if(i){var o=i.findIndex(function(e){return e.priority<=n});(-1===o?i:i.splice(0,o)).forEach(function(e){return e.resolve()})}}}},{key:"_couldLockImmediately",value:function(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}]),e}();function ri(e,t){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return n;return -1}var ro=function(){function e(t){(0,ea._)(this,e),this._semaphore=new rr(1,t)}return(0,es._)(e,[{key:"acquire",value:function(){var e,t,n,r;return e=this,t=arguments,n=void 0,r=function(){var e,t=arguments;return(0,ef._)(this,function(n){switch(n.label){case 0:return e=t.length>0&&void 0!==t[0]?t[0]:0,[4,this._semaphore.acquire(1,e)];case 1:return[2,ed._.apply(void 0,[n.sent(),2])[1]]}})},new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,(0,ec._)(t,n)?t:new n(function(e){e(t)})).then(a,s)}l((r=r.apply(e,t||[])).next())})}},{key:"runExclusive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._semaphore.runExclusive(function(){return e()},1,t)}},{key:"isLocked",value:function(){return this._semaphore.isLocked()}},{key:"waitForUnlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._semaphore.waitForUnlock(1,e)}},{key:"release",value:function(){this._semaphore.isLocked()&&this._semaphore.release()}},{key:"cancel",value:function(){return this._semaphore.cancel()}}]),e}(),ra=new Map,rs=new ro;function rl(e,t){return(0,eo._)(function(e,t){var n,r,i,o,a,s=arguments;return(0,ef._)(this,function(l){switch(l.label){case 0:return i=void 0===(r=(n=s.length>2&&void 0!==s[2]?s[2]:{}).path)?"/ai/chort/auth":r,a=void 0===(o=n.cache)||o,[4,rs.runExclusive(function(){return(0,eo._)(function(){var n,r,o,s,l,c;return(0,ef._)(this,function(u){switch(u.label){case 0:if(n="".concat(e,"-").concat(null!=t?t:"none","-").concat(i),a&&(r=ra.get(n))&&r.expiration>Date.now())return[2,r.token];return[4,fetch(i,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t?{repl:{id:t}}:{})})];case 1:if(!(o=u.sent()).ok)throw Error("Failed to fetch Chort auth token: ".concat(o.status));return[4,o.json()];case 2:return s=u.sent(),l=eC.Value.Decode(nl,s),a&&(c=Date.now()+18e5,ra.set(n,{token:l,expiration:c})),[2,l]}})})()})];case 1:return[2,l.sent()]}})}).apply(this,arguments)}e.s(["fetchChortAuthToken",()=>rl],351677);let rc="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);for(var ru=new Uint8Array(16),rp=[],rd=0;rd<256;++rd)rp.push((rd+256).toString(16).slice(1));let ry=function(e,t,n){if(rc&&!t&&!e)return rc();var r,i,o,a=null!=(o=null!=(i=(e=e||{}).random)?i:null==(r=e.rng)?void 0:r.call(e))?o:function(){if(!en){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");en=crypto.getRandomValues.bind(crypto)}return en(ru)}();if(a.length<16)throw Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((n=n||0)<0||n+16>t.length)throw RangeError("UUID byte range ".concat(n,":").concat(n+15," is out of buffer bounds"));for(var s=0;s<16;++s)t[n+s]=a[s];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(rp[e[t+0]]+rp[e[t+1]]+rp[e[t+2]]+rp[e[t+3]]+"-"+rp[e[t+4]]+rp[e[t+5]]+"-"+rp[e[t+6]]+rp[e[t+7]]+"-"+rp[e[t+8]]+rp[e[t+9]]+"-"+rp[e[t+10]]+rp[e[t+11]]+rp[e[t+12]]+rp[e[t+13]]+rp[e[t+14]]+rp[e[t+15]]).toLowerCase()}(a)};e.i(242933);var rf=e.i(790164),rh=function(e){function t(e,n,r){var i;return(0,ea._)(this,t),i=(0,tT._)(this,t,[n,r]),(0,el._)(i,"wsGetter",void 0),i.wsGetter=e,i}return(0,tS._)(t,e),(0,es._)(t,[{key:"createNewOutgoingConnection",value:function(e){return(0,eo._)(function(){var t,n,r,i;return(0,ef._)(this,function(o){switch(o.label){case 0:return null==(t=this.log)||t.info("establishing a new websocket to ".concat(e),{clientId:this.clientId,connectedTo:e}),[4,this.wsGetter(e)];case 1:return r=o.sent(),[4,new Promise(function(e,t){r.readyState===r.OPEN?e():r.readyState===r.CLOSING||r.readyState===r.CLOSED?t(Error("ws is closing or closed")):(r.onopen=function(){e()},r.onclose=function(e){t(Error(e.reason))},r.onerror=function(e){t(Error(e.message))})})];case 2:return o.sent(),i=new no(r),null==(n=this.log)||n.info("raw websocket to ".concat(e," ok"),(0,eu._)({clientId:this.clientId,connectedTo:e},i.loggingMetadata)),[2,i]}})}).call(this)}}]),t}(nt),rg=function(){function e(t){var n=this,r=t.userId,i=t.connectImmediately,o=t.logger,a=t.getEndpoint,s=t.getToken,l=t.overrideWebsocket,c=t.onProtocolError,u=t.onRetriesExceeded;(0,ea._)(this,e),(0,el._)(this,"clientId",void 0),(0,el._)(this,"serverId",void 0),(0,el._)(this,"log",void 0),(0,el._)(this,"status",void 0),(0,el._)(this,"transport",void 0),(0,el._)(this,"client",void 0),(0,el._)(this,"dispose",null),this.clientId="".concat(r,"-").concat(ry()),this.serverId="SERVER",this.log=null!=o?o:null,this.status=new rf.ObservableState("disconnected"),this.transport=new rh(l?function(){return(0,eo._)(function(){return(0,ef._)(this,function(e){switch(e.label){case 0:return[4,a()];case 1:return[2,l.apply(void 0,[e.sent().toString()])]}})})()}:function(){return(0,eo._)(function(){var e;return(0,ef._)(this,function(t){switch(t.label){case 0:return e=WebSocket.bind,[4,a()];case 1:return[2,new(e.apply(WebSocket,[void 0,t.sent().toString()]))]}})})()},this.clientId,ns),o&&this.transport.bindLogger(o,"info"),this.client=tl(this.transport,this.serverId,{eagerlyConnect:!1,connectOnInvoke:!1,handshakeOptions:th(nl,function(){return(0,eo._)(function(){return(0,ef._)(this,function(e){switch(e.label){case 0:return[4,s()];case 1:return[2,e.sent()]}})})()})}),this.transport.addEventListener("sessionTransition",function(e){n.is("closed","error")||("Connected"===e.state?n.status.set("connected"):n.transport.reconnectOnConnectionDrop?n.status.set("connecting"):n.status.set("disconnected"))}),this.transport.addEventListener("sessionStatus",function(e){n.is("closed","error")||"closed"===e.status&&(n.transport.reconnectOnConnectionDrop?n.status.set("connecting"):n.status.set("disconnected"))}),this.transport.addEventListener("protocolError",function(e){var t,r;if(e.type===tM){null==(t=n.log)||t.call(n,"river handshake failed",{clientId:n.clientId},"error");return}if(e.type===tN){null==(r=n.log)||r.call(n,"river retry limit exceeded",{clientId:n.clientId},"error"),n.close(),null==u||u(e);return}n.error(),null==c||c(e)});var p=function(){return!n.is("closed","error")&&"visible"===document.visibilityState&&window.navigator.onLine},d=function(){var e=n.transport.reconnectOnConnectionDrop,t=p();n.transport.reconnectOnConnectionDrop=t,e&&!t&&n.is("connecting")&&n.status.set("disconnected"),t&&n.is("disconnected")&&n.connect()};this.transport.reconnectOnConnectionDrop=p(),document.addEventListener("visibilitychange",d),window.addEventListener("online",d),window.addEventListener("offline",d),this.dispose=function(){document.removeEventListener("visibilitychange",d),window.removeEventListener("online",d),window.removeEventListener("offline",d)},p()&&!1!==i&&this.connect(),!0===i&&this.connect()}return(0,es._)(e,[{key:"is",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes(this.status.current)}},{key:"connect",value:function(){if(this.is("closed","error"))throw Error("Cannot connect to a ".concat(this.status.current," ChortRiverConnection"));this.is("connected","connecting")||(this.status.set("connecting"),this.transport.connect(this.serverId))}},{key:"error",value:function(){if(!this.is("closed","error")){var e;this.status.set("error"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}},{key:"close",value:function(){if(!this.is("closed","error")){var e;this.status.set("closed"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}}]),e}();e.s(["ChortRiverConnection",()=>rg],187822);var rT=e.i(33699).default.env.CHORT_HOST_OVERRIDE||null,rv="chort-development-endpoint-override",rm={production:"wss://production-chort.replit.com/api/river",staging:"wss://staging-chort.replit.com/api/river",development:"ws://127.0.0.1:8100/api/river"};function rS(e){try{e?window.localStorage.setItem(rv,e):window.localStorage.removeItem(rv)}catch(e){}}function rE(){try{return window.localStorage.getItem(rv)||null}catch(e){return null}}function rb(e){if(rT)return console.warn("chort: using environment endpoint override",rT),"ws://".concat(rT,":8100/api/river");var t=rE();return t?(console.warn("chort: using development endpoint override",t),t):rm[e]}e.s(["CHORT_ENDPOINTS",()=>rm,"CHORT_ENVIRONMENT_HOST_OVERRIDE",()=>rT,"getChortEndpoint",()=>rb,"getChortLocalEndpointOverride",()=>rE,"setChortLocalEndpointOverride",()=>rS],170039);var rC=e.i(693482),r_=e.i(452723),rR=eh.Type.Object({path:eh.Type.Union([eh.Type.String(),eh.Type.Array(eh.Type.Union([eh.Type.Number(),eh.Type.String()]))]),op:eh.Type.Union([eh.Type.Literal("replace"),eh.Type.Literal("add"),eh.Type.Literal("remove")]),value:eh.Type.Optional(eh.Type.Any())});function rI(e){return(0,eo._)(function(){var t,n;return(0,ef._)(this,function(r){switch(r.label){case 0:return[4,(t=e.resReadable[Symbol.asyncIterator]()).next()];case 1:if((n=r.sent()).done)throw Error("Unexpected: initial result is done");if(n.value.ok&&"delta"in n.value.payload)throw Error("Unexpected: initial result is not a snapshot");return[2,{snapshot:n.value.ok?eF(n.value.payload.snapshot):eq(n.value.payload),deltas:(0,el._)({},Symbol.asyncIterator,function(){return(0,r_._)(function(){var e;return(0,ef._)(this,function(n){switch(n.label){case 0:return[4,(0,rC._)(t.next())];case 1:if((e=n.sent()).done)return[3,5];if(e.value.ok)return[3,3];return[4,eq(e.value.payload)];case 2:case 4:return n.sent(),[3,0];case 3:return[4,eF(e.value.payload.delta)];case 5:return[2]}})})()})}]}})})()}eh.Type.Array(rR),e.s(["getSyncResult",()=>rI],813702);var rO="remove",rk="replace",rA=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),rU=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),rw=Symbol.iterator,rN={mutable:"mutable",immutable:"immutable"},rM={};function rD(e,t){return(0,ec._)(e,Map)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function rx(e,t){if(t in e)for(var n=Reflect.getPrototypeOf(e);n;){var r=Reflect.getOwnPropertyDescriptor(n,t);if(r)return r;n=Reflect.getPrototypeOf(n)}}function rP(e){return Object.getPrototypeOf(e)===Set.prototype}function rL(e){return Object.getPrototypeOf(e)===Map.prototype}function rj(e){var t;return null!=(t=e.copy)?t:e.original}function rB(e){return!!rF(e)}function rF(e){return(void 0===e?"undefined":(0,tE._)(e))!=="object"?null:null==e?void 0:e[rA]}function rq(e){var t,n=rF(e);return n?null!=(t=n.copy)?t:n.original:e}function rG(e,t){var n;return!!e&&(void 0===e?"undefined":(0,tE._)(e))==="object"&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||(0,ec._)(e,Map)||(0,ec._)(e,Set)||!!(null==t?void 0:t.mark)&&((n=t.mark(e,rN))===rN.immutable||"function"==typeof n))}function rV(e){return Array.isArray(e)?1:(0,ec._)(e,Map)?2:3*!!(0,ec._)(e,Set)}function rH(e,t){return 2===rV(e)?e.get(t):e[t]}function rW(e,t,n){2===rV(e)?e.set(t,n):e[t]=n}function r$(e,t){var n=rF(e);return(n?rj(n):e)[t]}function rz(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function rK(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function rQ(e,t){return t?e:[""].concat(e).map(function(e){var t="".concat(e);return -1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}var rY=Object.prototype.propertyIsEnumerable;function rX(e,t){if(Array.isArray(e))return Array.prototype.concat.call(e);if((0,ec._)(e,Set))return rP(e)?Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values()):new(Object.getPrototypeOf(e)).constructor(e.values());if((0,ec._)(e,Map))return rL(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e);if((null==t?void 0:t.mark)&&void 0!==(n=t.mark(e,rN))&&n!==rN.mutable){if(n===rN.immutable)return r=Object.create(Object.getPrototypeOf(e)),Reflect.ownKeys(e).forEach(function(t){var n=Reflect.getOwnPropertyDescriptor(e,t);if(n.enumerable&&n.configurable&&n.writable){r[t]=e[t];return}n.writable||(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(n={configurable:!0,writable:!0,enumerable:n.enumerable,value:e[t]}),Reflect.defineProperty(r,t,n)}),r;if("function"==typeof n){if(t.enablePatches||t.enableAutoFreeze)throw Error("You can't use mark and patches or auto freeze together.");return n()}throw Error("Unsupported mark result: ".concat(n))}if((void 0===e?"undefined":(0,tE._)(e))==="object"&&Object.getPrototypeOf(e)===Object.prototype){var n,r,i={};return Object.keys(e).forEach(function(t){i[t]=e[t]}),Object.getOwnPropertySymbols(e).forEach(function(t){rY.call(e,t)&&(i[t]=e[t])}),i}else throw Error("Please check mark() to ensure that it is a stable marker draftable function.")}function rJ(e){e.copy||(e.copy=rX(e.original,e.options))}function rZ(e){if(!rG(e))return rq(e);if(Array.isArray(e))return e.map(rZ);if((0,ec._)(e,Map)){var t=Array.from(e.entries()).map(function(e){var t=(0,ed._)(e,2);return[t[0],rZ(t[1])]});return rL(e)?new Map(t):new(Object.getPrototypeOf(e)).constructor(t)}if((0,ec._)(e,Set)){var n=Array.from(e).map(rZ);return rP(e)?new Set(n):new(Object.getPrototypeOf(e)).constructor(n)}var r=Object.create(Object.getPrototypeOf(e));for(var i in e)r[i]=rZ(e[i]);return r}function r0(e){return rB(e)?rZ(e):e}function r1(e){var t;e.assignedMap=null!=(t=e.assignedMap)?t:new Map,!e.operated&&(e.operated=!0,e.parent&&r1(e.parent))}function r2(){throw Error("Cannot modify frozen object")}function r3(e,t){var n=rV(e);if(0===n)Reflect.ownKeys(e).forEach(function(n){t(n,e[n],e)});else if(1===n){var r=0,i=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;t(r,c,e),r+=1}}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}}else e.forEach(function(n,r){return t(r,n,e)})}function r4(e){3===e.type&&e.copy&&(e.copy.clear(),e.setMap.forEach(function(t){e.copy.add(rq(t))}))}function r6(e,t,n,r){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(n&&r){var i=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(Object.hasOwnProperty.call(t,"key")){var r=t.parent.copy,i=rF(rH(r,t.key));if(null!==i&&(null==i?void 0:i.original)!==t.original)return null;var o=3===t.parent.type,a=o?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key;if(!(o&&r.size>a||rD(r,a)))return null;n.push(a)}if(t.parent)return e(t.parent,n);n.reverse();try{for(var s=t.copy,l=n,c=0;c<l.length-1;c+=1){var u=l[c];if((void 0===(s=rH(3===rV(s)?Array.from(s):s,u))?"undefined":(0,tE._)(s))!=="object")throw Error("Cannot resolve patch at '".concat(l.join("/"),"'."))}}catch(e){return null}return n}(e);i&&t(e,i,n,r)}e.finalized=!0}}function r8(e,t,n,r){var i=rF(n);i&&(i.callbacks||(i.callbacks=[]),i.callbacks.push(function(o,a){var s,l=3===e.type?e.setMap:e.copy;if(rz(rH(l,t),n)){var c=i.original;i.copy&&(c=i.copy),r4(e),r6(e,r,o,a),e.options.enableAutoFreeze&&(e.options.updatedValues=null!=(s=e.options.updatedValues)?s:new WeakMap,e.options.updatedValues.set(c,i.original)),rW(l,t,c)}}),e.options.enableAutoFreeze&&i.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),rG(n,e.options)&&e.finalities.draft.push(function(){var r;rz(rH(3===e.type?e.setMap:e.copy,t),n)&&(r=3===e.type?e.setMap:e.copy,e.finalities.revoke.length>1&&e.assignedMap.get(t)&&r&&function e(t,n,r){if(!(rB(t)||!rG(t,r)||n.has(t)||Object.isFrozen(t))){var i=(0,ec._)(t,Set),o=i?new Map:void 0;if(n.add(t),r3(t,function(a,s){var l;if(rB(s)){var c=rF(s);rJ(c),rW(i?o:t,a,(null==(l=c.assignedMap)?void 0:l.size)||c.operated?c.copy:c.original)}else e(s,n,r)}),o){var a=Array.from(t);t.clear(),a.forEach(function(e){t.add(o.has(e)?o.get(e):e)})}}}(rH(r,t),e.finalities.handledSet,e.options))})}function r5(e,t,n,r){var i,o,a,s,l,c=e.options.enablePatches.pathAsArray,u=void 0===c||c;switch(e.type){case 0:case 2:return i=e.original,o=e.copy,void e.assignedMap.forEach(function(e,a){var s=rH(i,a),l=r0(rH(o,a)),c=e?rD(i,a)?rk:"add":rO;if(!rz(s,l)||c!==rk){var p=rQ(t.concat(a),u);n.push(c===rO?{op:c,path:p}:{op:c,path:p,value:l}),r.push("add"===c?{op:rO,path:p}:c===rO?{op:"add",path:p,value:s}:{op:rk,path:p,value:s})}});case 1:return function(e,t,n,r,i){var o,a,s=e.original,l=e.assignedMap,c=e.options,u=e.copy;u.length<s.length&&(s=(o=[u,s])[0],u=o[1],n=(a=[r,n])[0],r=a[1]);for(var p=0;p<s.length;p+=1)if(l.get(p.toString())&&u[p]!==s[p]){var d=rQ(t.concat([p]),i);n.push({op:rk,path:d,value:r0(u[p])}),r.push({op:rk,path:d,value:r0(s[p])})}for(var y=s.length;y<u.length;y+=1){var f=rQ(t.concat([y]),i);n.push({op:"add",path:f,value:r0(u[y])})}if(s.length<u.length){var h=c.enablePatches.arrayLengthAssignment;if(void 0===h||h){var g=rQ(t.concat(["length"]),i);r.push({op:rk,path:g,value:s.length})}else for(var T=u.length;s.length<T;T-=1){var v=rQ(t.concat([T-1]),i);r.push({op:rO,path:v})}}}(e,t,n,r,u);case 3:return a=e.original,s=e.copy,l=0,void(a.forEach(function(e){if(!s.has(e)){var i=rQ(t.concat([l]),u);n.push({op:rO,path:i,value:e}),r.unshift({op:"add",path:i,value:e})}l+=1}),l=0,s.forEach(function(e){if(!a.has(e)){var i=rQ(t.concat([l]),u);n.push({op:"add",path:i,value:e}),r.unshift({op:rO,path:i,value:e})}l+=1}))}}var r9=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((void 0===e?"undefined":(0,tE._)(e))==="object"&&null!==e&&(!rG(e,t)||n)&&1)throw Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},r7=(0,el._)({get size(){return rj(rF(this)).size},has:function(e){return rj(rF(this)).has(e)},set:function(e,t){var n=rF(this),r=rj(n);return r.has(e)&&rz(r.get(e),t)||(rJ(n),r1(n),n.assignedMap.set(e,!0),n.copy.set(e,t),r8(n,e,t,r5)),this},delete:function(e){if(!this.has(e))return!1;var t=rF(this);return rJ(t),r1(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear:function(){var e=rF(this);if(this.size){rJ(e),r1(e),e.assignedMap=new Map;var t=!0,n=!1,r=void 0;try{for(var i,o=e.original[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=(0,ed._)(i.value,1)[0];e.assignedMap.set(a,!1)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}e.copy.clear()}},forEach:function(e,t){var n=this;rj(rF(this)).forEach(function(r,i){e.call(t,n.get(i),i,n)})},get:function(e){var t,n,r=rF(this),i=rj(r).get(e),o=(null==(n=(t=r.options).mark)?void 0:n.call(t,i,rN))===rN.mutable;if(r.options.strict&&r9(i,r.options,o),o||r.finalized||!rG(i,r.options)||i!==r.original.get(e))return i;var a=rM.createDraft({original:i,parentDraft:r,key:e,finalities:r.finalities,options:r.options});return rJ(r),r.copy.set(e,a),a},keys:function(){return rj(rF(this)).keys()},values:function(){var e,t=this,n=this.keys();return e={},(0,el._)(e,rw,function(){return t.values()}),(0,el._)(e,"next",function(){var e=n.next();return e.done?e:{done:!1,value:t.get(e.value)}}),e},entries:function(){var e,t=this,n=this.keys();return e={},(0,el._)(e,rw,function(){return t.entries()}),(0,el._)(e,"next",function(){var e=n.next();if(e.done)return e;var r=t.get(e.value);return{done:!1,value:[e.value,r]}}),e}},rw,function(){return this.entries()}),ie=Reflect.ownKeys(r7),it=function(e,t,n){var r=n.isValuesIterator;return function(){var n,i,o=t.next();if(o.done)return o;var a=o.value,s=e.setMap.get(a),l=rF(s),c=(null==(i=(n=e.options).mark)?void 0:i.call(n,s,rN))===rN.mutable;if(e.options.strict&&r9(a,e.options,c),!c&&!l&&rG(a,e.options)&&!e.finalized&&e.original.has(a)){var u=rM.createDraft({original:a,parentDraft:e,key:a,finalities:e.finalities,options:e.options});e.setMap.set(a,u),s=u}else l&&(s=l.proxy);return{done:!1,value:r?s:[s,s]}}},ir=(er={get size(){return rF(this).setMap.size},has:function(e){var t=rF(this);if(t.setMap.has(e))return!0;rJ(t);var n=rF(e);return!!(n&&t.setMap.has(n.original))},add:function(e){var t=rF(this);return this.has(e)||(rJ(t),r1(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),r8(t,e,e,r5)),this},delete:function(e){if(!this.has(e))return!1;var t=rF(this);rJ(t),r1(t);var n=rF(e);return n&&t.setMap.has(n.original)?(t.assignedMap.set(n.original,!1),t.setMap.delete(n.original)):(!n&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear:function(){if(this.size){var e=rF(this);rJ(e),r1(e);var t=!0,n=!1,r=void 0;try{for(var i,o=e.original[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;e.assignedMap.set(a,!1)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}e.setMap.clear()}},values:function(){var e,t=this,n=rF(this);rJ(n);var r=n.setMap.keys();return e={},(0,el._)(e,Symbol.iterator,function(){return t.values()}),(0,el._)(e,"next",it(n,r,{isValuesIterator:!0})),e},entries:function(){var e,t=this,n=rF(this);rJ(n);var r=n.setMap.keys();return e={},(0,el._)(e,Symbol.iterator,function(){return t.entries()}),(0,el._)(e,"next",it(n,r,{isValuesIterator:!1})),e},keys:function(){return this.values()}},(0,el._)(er,rw,function(){return this.values()}),(0,el._)(er,"forEach",function(e,t){for(var n=this.values(),r=n.next();!r.done;)e.call(t,r.value,r.value,this),r=n.next()}),er);Set.prototype.difference&&Object.assign(ir,{intersection:function(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union:function(e){return Set.prototype.union.call(new Set(this.values()),e)},difference:function(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference:function(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf:function(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf:function(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom:function(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}});var ii=Reflect.ownKeys(ir),io=new WeakSet,ia={get:function(e,t,n){var r,i,o,a=null==(r=e.copy)?void 0:r[t];if(a&&io.has(a))return a;if(t===rA)return e;if(e.options.mark){var s="size"===t&&((0,ec._)(e.original,Map)||(0,ec._)(e.original,Set))?Reflect.get(e.original,t):Reflect.get(e.original,t,n);if((o=e.options.mark(s,rN))===rN.mutable)return e.options.strict&&r9(s,e.options,!0),s}var l=rj(e);if((0,ec._)(l,Map)&&ie.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(r7,"size").get.call(e.proxy);var c=r7[t];if(c)return c.bind(e.proxy)}if((0,ec._)(l,Set)&&ii.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(ir,"size").get.call(e.proxy);var u=ir[t];if(u)return u.bind(e.proxy)}if(!rD(l,t)){var p=rx(l,t);return p?"value"in p?p.value:null==(i=p.get)?void 0:i.call(e.proxy):void 0}var d=l[t];if(e.options.strict&&r9(d,e.options),e.finalized||!rG(d,e.options))return d;if(d===r$(e.original,t)){if(rJ(e),e.copy[t]=is({original:e.original[t],parentDraft:e,key:1===e.type?Number(t):t,finalities:e.finalities,options:e.options}),"function"==typeof o){var y=rF(e.copy[t]);return rJ(y),r1(y),y.copy}return e.copy[t]}return d},set:function(e,t,n){if(3===e.type||2===e.type)throw Error("Map/Set draft does not support any property assignment.");if(1===e.type&&"length"!==t&&!(Number.isInteger(i=Number(t))&&i>=0&&(0===t||0===i||String(i)===String(t))))throw Error("Only supports setting array indices and the 'length' property.");var r,i,o=rx(rj(e),t);if(null==o?void 0:o.set)return o.set.call(e.proxy,n),!0;var a=r$(rj(e),t),s=rF(a);return s&&rz(s.original,n)?(e.copy[t]=n,e.assignedMap=null!=(r=e.assignedMap)?r:new Map,e.assignedMap.set(t,!1),!0):!!(rz(n,a)&&(void 0!==n||rD(e.original,t)))||(rJ(e),r1(e),rD(e.original,t)&&rz(n,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=n,r8(e,t,n,r5),!0)},has:function(e,t){return t in rj(e)},ownKeys:function(e){return Reflect.ownKeys(rj(e))},getOwnPropertyDescriptor:function(e,t){var n=rj(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},getPrototypeOf:function(e){return Reflect.getPrototypeOf(e.original)},setPrototypeOf:function(){throw Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty:function(){throw Error("Cannot call 'defineProperty()' on drafts")},deleteProperty:function(e,t){var n;return 1===e.type?ia.set.call(this,e,t,void 0,e.proxy):(void 0!==r$(e.original,t)||t in e.original?(rJ(e),r1(e),e.assignedMap.set(t,!1)):(e.assignedMap=null!=(n=e.assignedMap)?n:new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}};function is(e){var t=e.original,n=e.parentDraft,r=e.key,i=e.finalities,o=e.options,a=rV(t),s={type:a,finalized:!1,parent:n,original:t,copy:null,proxy:null,finalities:i,options:o,setMap:3===a?new Map(t.entries()):void 0};(r||"key"in e)&&(s.key=r);var l=Proxy.revocable(1===a?Object.assign([],s):s,ia),c=l.proxy,u=l.revoke;if(i.revoke.push(u),io.add(c),s.proxy=c,n)n.finalities.draft.push(function(e,t){var i,o,a=rF(c),s=3===n.type?n.setMap:n.copy,l=rH(s,r),u=rF(l);if(u){var p=u.original;u.operated&&(p=rq(l)),r4(u),r6(u,r5,e,t),n.options.enableAutoFreeze&&(n.options.updatedValues=null!=(i=n.options.updatedValues)?i:new WeakMap,n.options.updatedValues.set(p,u.original)),rW(s,r,p)}null==(o=a.callbacks)||o.forEach(function(n){n(e,t)})});else{var p=rF(c);p.finalities.draft.push(function(e,t){r4(p),r6(p,r5,e,t)})}return c}function il(e){var t=e.rootDraft,n=e.value,r=e.useRawReturn,i=e.isRoot;r3(n,function(n,r,i){var o=rF(r);if(o&&t&&o.finalities===t.finalities){e.isContainDraft=!0;var a=o.original;if((0,ec._)(i,Set)){var s=Array.from(i);i.clear(),s.forEach(function(e){return i.add(n===e?a:e)})}else rW(i,n,a)}else(void 0===r?"undefined":(0,tE._)(r))==="object"&&null!==r&&(e.value=r,e.isRoot=!1,il(e))}),(void 0===i||i)&&(e.isContainDraft||console.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),void 0!==r&&r&&console.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function ic(e){if(!rB(e))throw Error("current() is only used for Draft, parameter: ".concat(e));return function e(t){var n,r,i=rF(t);if(!rG(t,null==i?void 0:i.options))return t;var o=rV(t);if(i&&!i.operated)return i.original;function a(){r=2===o?rL(t)?new Map(t):new(Object.getPrototypeOf(t)).constructor(t):3===o?Array.from(i.setMap.values()):rX(t,null==i?void 0:i.options)}if(i){i.finalized=!0;try{a()}finally{i.finalized=!1}}else r=t;if(r3(r,function(n,o){if(!(i&&rz(rH(i.original,n),o))){var s=e(o);s!==o&&(r===t&&a(),rW(r,n,s))}}),3===o){var s=null!=(n=null==i?void 0:i.original)?n:r;return rP(s)?new Set(r):new(Object.getPrototypeOf(s)).constructor(r)}return r}(e)}rM.createDraft=is;var iu=function(e){if(void 0!==e&&"[object Object]"!==Object.prototype.toString.call(e))throw Error("Invalid options: ".concat(String(e),", 'options' should be an object."));return function t(n,r,i){if("function"==typeof n&&"function"!=typeof r)return function(e){for(var i,o=this,a=arguments.length,s=Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];return t(e,function(e){return(i=n).call.apply(i,[o,e].concat((0,ey._)(s)))},r)};var o,a,s,l,c,u,p,d,y,f=i;if("function"!=typeof r&&(f=r),void 0!==f&&"[object Object]"!==Object.prototype.toString.call(f))throw Error("Invalid options: ".concat(f,", 'options' should be an object."));f=Object.assign(Object.assign({},e),f);var h=rB(n)?ic(n):n,g=Array.isArray(f.mark)?function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=f.mark[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if("function"!=typeof s)throw Error("Invalid mark: ".concat(s,", 'mark' should be a function."));var l=s(e,t);if(l)return l}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}:f.mark,T=null!=(o=f.enablePatches)&&o,v=null!=(a=f.strict)&&a,m={enableAutoFreeze:null!=(s=f.enableAutoFreeze)&&s,mark:g,strict:v,enablePatches:T};if(!rG(h,m)&&(void 0===h?"undefined":(0,tE._)(h))==="object"&&null!==h)throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");var S=(0,ed._)((d={draft:[],revoke:[],handledSet:new WeakSet},m.enablePatches&&(u=[],p=[]),[y=(null==(c=m.mark)?void 0:c.call(m,h,rN))!==rN.mutable&&rG(h,m)?is({original:h,parentDraft:null,finalities:d,options:m}):h,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,ed._)(function(e,t,n,r,i){var o,a=rF(e),s=null!=(o=null==a?void 0:a.original)?o:e,l=!!t.length;if(null==a?void 0:a.operated)for(;a.finalities.draft.length>0;)a.finalities.draft.pop()(n,r);var c=l?t[0]:a?a.operated?a.copy:a.original:e;return a&&rK(a),i&&function e(t,n,r,i,o){r=null!=r?r:new WeakMap,i=null!=i?i:[],o=null!=o?o:[];var a=r.has(t)?r.get(t):t;if(i.length>0){var s=i.indexOf(a);if(a&&(void 0===a?"undefined":(0,tE._)(a))==="object"&&-1!==s){if(i[0]===a)throw Error("Forbids circular reference");throw Error("Forbids circular reference: ~/".concat(o.slice(0,s).map(function(e,t){if((void 0===e?"undefined":(0,tE._)(e))==="symbol")return"[".concat(e.toString(),"]");var n=i[t];return(void 0===e?"undefined":(0,tE._)(e))==="object"&&((0,ec._)(n,Map)||(0,ec._)(n,Set))?Array.from(n.keys()).indexOf(e):e}).join("/")))}i.push(a),o.push(n)}else i.push(a);if(Object.isFrozen(t)||rB(t)){i.pop(),o.pop();return}switch(rV(t)){case 2:var l=!0,c=!1,u=void 0;try{for(var p,d=t[Symbol.iterator]();!(l=(p=d.next()).done);l=!0){var y=(0,ed._)(p.value,2),f=y[0],h=y[1];e(f,f,r,i,o),e(h,f,r,i,o)}}catch(e){c=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}t.set=t.clear=t.delete=r2;break;case 3:var g=!0,T=!1,v=void 0;try{for(var m,S=t[Symbol.iterator]();!(g=(m=S.next()).done);g=!0){var E=m.value;e(E,E,r,i,o)}}catch(e){T=!0,v=e}finally{try{g||null==S.return||S.return()}finally{if(T)throw v}}t.add=t.clear=t.delete=r2;break;case 1:Object.freeze(t);var b=0,C=!0,_=!1,R=void 0;try{for(var I,O=t[Symbol.iterator]();!(C=(I=O.next()).done);C=!0){var k=I.value;e(k,b,r,i,o),b+=1}}catch(e){_=!0,R=e}finally{try{C||null==O.return||O.return()}finally{if(_)throw R}}break;default:Object.freeze(t),Object.keys(t).forEach(function(n){e(t[n],n,r,i,o)})}i.pop(),o.pop()}(c,c,null==a?void 0:a.options.updatedValues),[c,n&&l?[{op:rk,path:[],value:t[0]}]:n,r&&l?[{op:rk,path:[],value:s}]:r]}(y,e,u,p,m.enableAutoFreeze),3),n=t[0],r=t[1],i=t[2];return m.enablePatches?[n,r,i]:n}]),2),E=S[0],b=S[1];if("function"!=typeof r){if(!rG(h,m))throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[E,b]}try{l=r(E)}catch(e){throw rK(rF(E)),e}var C=function(e){var t=rF(E);if(!rB(e)){if(void 0!==e&&!rz(e,E)&&(null==t?void 0:t.operated))throw Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");var n=null==e?void 0:e[rU];if(n){var r=n[0];return m.strict&&(void 0===e?"undefined":(0,tE._)(e))==="object"&&null!==e&&il({rootDraft:t,value:e,useRawReturn:!0}),b([r])}if(void 0!==e)return(void 0===e?"undefined":(0,tE._)(e))==="object"&&null!==e&&il({rootDraft:t,value:e}),b([e])}if(e===E||void 0===e)return b([]);var i=rF(e);if(m===i.options){if(i.operated)throw Error("Cannot return a modified child draft.");return b([ic(e)])}return b([e])};return(0,ec._)(l,Promise)?l.then(C,function(e){throw rK(rF(E)),e}):C(l)}}();function ip(e,t,n){for(r=t.length-1;r>=0;r-=1){var r,i=t[r],o=i.value,a=i.op,s=i.path;if(!s.length&&a===rk||""===s&&"add"===a){e=o;break}}r>-1&&(t=t.slice(r+1));var l=function(e){t.forEach(function(t){for(var n=t.path,r=t.op,i=Array.isArray(n)?n:n.split("/").map(function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}).slice(1),o=e,a=0;a<i.length-1;a+=1){var s=rV(o),l=i[a];if("string"!=typeof l&&"number"!=typeof l&&(l=String(l)),(0===s||1===s)&&("__proto__"===l||"constructor"===l)||"function"==typeof o&&"prototype"===l)throw Error("Patching reserved attributes like __proto__ and constructor is not allowed.");if((void 0===(o=rH(3===s?Array.from(o):o,l))?"undefined":(0,tE._)(o))!=="object")throw Error("Cannot apply patch at '".concat(i.join("/"),"'."))}var c=rV(o),u=rZ(t.value),p=i[i.length-1];switch(r){case rk:switch(c){case 2:return o.set(p,u);case 3:throw Error("Cannot apply replace patch to set.");default:return o[p]=u}case"add":switch(c){case 1:return"-"===p?o.push(u):o.splice(p,0,u);case 2:return o.set(p,u);case 3:return o.add(u);default:return o[p]=u}case rO:switch(c){case 1:return o.splice(p,1);case 2:return o.delete(p);case 3:return o.delete(t.value);default:return delete o[p]}default:throw Error("Unsupported patch operation: ".concat(r,"."))}})};if(rB(e)){if(void 0!==n)throw Error("Cannot apply patches with options to a draft.");return l(e),e}return iu(e,l,Object.assign(Object.assign({},n),{enablePatches:!1}))}Object.prototype.constructor.toString(),e.s(["apply",()=>ip,"create",()=>iu,"isDraftable",()=>rG],281128);var id=eh.Type.Object({id:eh.Type.String(),title:eh.Type.String(),sessionType:n7,sessionCreationEventId:eh.Type.String(),archived:eh.Type.Boolean(),readOnly:eh.Type.Boolean(),taskId:eh.Type.String(),created:eh.Type.Date(),updated:eh.Type.Date()});e.s(["SessionDataSchema",()=>id],957410),e.s([],660670)},952098,e=>{"use strict";e.i(33699);var t=e.i(297083),n=e.i(530658),r=e.i(817556),i=e.i(389959),o=e.i(906368),a=e.i(17886);e.i(660670);var s=e.i(993228),s=s,l=e.i(187822),c=e.i(351677),u=e.i(170039),p=e.i(98816),d=e.i(664152),y=window.location.search.includes("aiChatDebug=1"),f=function(e,t,n){var r;y&&console[null!=n?n:"info"]("[chort] "+e,t),d.logger[null!=n?n:"info"](e,{river:t,riverTarget:"chort",riverVersion:s.version}),(null==t||null==(r=t.tags)?void 0:r.includes("invariant-violation"))&&o.withScope(function(n){n.setTag("chort",!0),n.setExtras(t),o.captureException(Error(e))})};function h(){var e="production";return(0,a.isEnvProduction)()||(e="staging"),(0,u.getChortEndpoint)(e)}function g(e){var o=e.replId,a=e.userId,s=e.onRetriesExceeded,u=e.onProtocolError,d=(0,n._)((0,i.useState)(null),2),y=d[0],g=d[1],T=(0,p.default)(s),v=(0,p.default)(u);return(0,i.useEffect)(function(){var e=new l.ChortRiverConnection({userId:a,logger:f,getEndpoint:function(){return(0,t._)(function(){return(0,r._)(this,function(e){return[2,h()]})})()},getToken:function(){return(0,t._)(function(){return(0,r._)(this,function(e){return[2,(0,c.fetchChortAuthToken)(a,o)]})})()},onProtocolError:function(e){var t;null==(t=v.current)||t.call(v,e)},onRetriesExceeded:function(e){var t;null==(t=T.current)||t.call(T,e)}});return g(e),function(){g(null),Promise.resolve().then(function(){return e.close()})}},[o,a,T,v]),y}e.s(["getCurrentChortEndpoint",()=>h,"useCreateChortRiverConnection",()=>g],952098)},435106,e=>{"use strict";var t,n,r=e.i(297083),i=e.i(904851),o=e.i(711300),a=e.i(634203),s=e.i(35877),l=e.i(90659),c=e.i(721281),u=e.i(878420),p=e.i(64386),d=e.i(817556),y=e.i(908410);e.i(242933);var f=e.i(790164),h=e.i(828042),g=e.i(119468),T=e.i(167626),v=new TextEncoder,m=new TextDecoder;function S(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}var E=function(e,t){this.type=e,this.data=t},b=(t=function(e,n){return(t=Object.setPrototypeOf||(0,T._)({__proto__:[]},Array)&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}),C=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,Object.create(t.prototype)),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:t.name}),r}return b(t,e),t}(Error);function _(e,t,n){var r=Math.floor(n/0x100000000);e.setUint32(t,r),e.setUint32(t+4,n)}function R(e,t){return 0x100000000*e.getInt32(t)+e.getUint32(t+4)}var I={type:-1,encode:function(e){var t,n,r,i;return(0,T._)(e,Date)?function(e){var t=e.sec,n=e.nsec;if(t>=0&&n>=0&&t<=0x3ffffffff)if(0===n&&t<=0xffffffff){var r=new Uint8Array(4),i=new DataView(r.buffer);return i.setUint32(0,t),r}else{var o=t/0x100000000,r=new Uint8Array(8),i=new DataView(r.buffer);return i.setUint32(0,n<<2|3&o),i.setUint32(4,0|t),r}var r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,n),_(i,4,t),r}((n=Math.floor((t=e.getTime())/1e3),i=Math.floor((r=(t-1e3*n)*1e6)/1e9),{sec:n+i,nsec:r-1e9*i})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:var n=t.getUint32(0),r=0;return{sec:n,nsec:0};case 8:var i=t.getUint32(0),n=(3&i)*0x100000000+t.getUint32(4),r=i>>>2;return{sec:n,nsec:r};case 12:var n=R(t,4),r=t.getUint32(0);return{sec:n,nsec:r};default:throw new C("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},O=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(I)}return e.prototype.register=function(e){var t=e.type,n=e.encode,r=e.decode;if(t>=0)this.encoders[t]=n,this.decoders[t]=r;else{var i=1+t;this.builtInEncoders[i]=n,this.builtInDecoders[i]=r}},e.prototype.tryToEncode=function(e,t){for(var n=0;n<this.builtInEncoders.length;n++){var r=this.builtInEncoders[n];if(null!=r){var i=r(e,t);if(null!=i){var o=-1-n;return new E(o,i)}}}for(var n=0;n<this.encoders.length;n++){var r=this.encoders[n];if(null!=r){var i=r(e,t);if(null!=i){var o=n;return new E(o,i)}}}return(0,T._)(e,E)?e:null},e.prototype.decode=function(e,t,n){var r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,n):new E(t,e)},e.defaultCodec=new e,e}(),k=new TextEncoder;function A(e,t,n){for(var r=t,i=r+n,o=[],a="";r<i;){var s=e[r++];if((128&s)==0)o.push(s);else if((224&s)==192){var l=63&e[r++];o.push((31&s)<<6|l)}else if((240&s)==224){var l=63&e[r++],c=63&e[r++];o.push((31&s)<<12|l<<6|c)}else if((248&s)==240){var l=63&e[r++],c=63&e[r++],u=(7&s)<<18|l<<12|c<<6|63&e[r++];u>65535&&(u-=65536,o.push(u>>>10&1023|55296),u=56320|1023&u),o.push(u)}else o.push(s);o.length>=4096&&(a+=String.fromCharCode.apply(String,o),o.length=0)}return o.length>0&&(a+=String.fromCharCode.apply(String,o)),a}var U=new TextDecoder;function w(e){return(0,T._)(e,Uint8Array)?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):(0,T._)(e,ArrayBuffer)?new Uint8Array(e):Uint8Array.from(e)}var N=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,n){var r=this.caches[n-1];e:for(var i=0;i<r.length;i++){for(var o=r[i],a=o.bytes,s=0;s<n;s++)if(a[s]!==e[t+s])continue e;return o.str}return null},e.prototype.store=function(e,t){var n=this.caches[e.length-1],r={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},e.prototype.decode=function(e,t,n){var r=this.find(e,t,n);if(null!=r)return this.hit++,r;this.miss++;var i=A(e,t,n),o=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(o,i),i},e}(),M=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},D=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){var o,a,s;o=r,a=i,s=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){o({value:e,done:s})},a)})}}},x=function(e){return(0,T._)(this,x)?(this.v=e,this):new x(e)},P=function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||s(e,t)})})}function s(e,t){try{var n;n=i[e](t),(0,T._)(n.value,x)?Promise.resolve(n.value.v).then(l,c):u(o[0][2],n)}catch(e){u(o[0][3],e)}}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}},L="array",j="map_key",B=new DataView(new ArrayBuffer(0)),F=new Uint8Array(B.buffer);try{B.getInt8(0)}catch(e){if(!(0,T._)(e,RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var q=RangeError,G=new q("Insufficient data"),V=new N,H=function(){function e(e){var t,n,r,i,o,a,s;this.totalPos=0,this.pos=0,this.view=B,this.bytes=F,this.headByte=-1,this.stack=[],this.extensionCodec=null!=(t=null==e?void 0:e.extensionCodec)?t:O.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=null!=(n=null==e?void 0:e.useBigInt64)&&n,this.maxStrLength=null!=(r=null==e?void 0:e.maxStrLength)?r:0xffffffff,this.maxBinLength=null!=(i=null==e?void 0:e.maxBinLength)?i:0xffffffff,this.maxArrayLength=null!=(o=null==e?void 0:e.maxArrayLength)?o:0xffffffff,this.maxMapLength=null!=(a=null==e?void 0:e.maxMapLength)?a:0xffffffff,this.maxExtLength=null!=(s=null==e?void 0:e.maxExtLength)?s:0xffffffff,this.keyDecoder=(null==e?void 0:e.keyDecoder)!==void 0?e.keyDecoder:V}return e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=w(e),this.view=function(e){if((0,T._)(e,ArrayBuffer))return new DataView(e);var t=w(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),n=w(e),r=new Uint8Array(t.length+n.length);r.set(t),r.set(n,t.length),this.setBuffer(r)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,n=this.pos;return RangeError("Extra ".concat(t.byteLength-n," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return M(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return t.sent(),[3,1];case 3:return[2]}})},e.prototype.decodeAsync=function(e){var t,n,r,i,o,a,s,l,c,u,p;return l=this,c=void 0,u=void 0,p=function(){var l,c,u,p,d,y,f;return M(this,function(h){switch(h.label){case 0:l=!1,h.label=1;case 1:h.trys.push([1,6,7,12]),t=!0,n=D(e),h.label=2;case 2:return[4,n.next()];case 3:if(i=(r=h.sent()).done)return[3,5];s=r.value,t=!1;try{if(u=s,l)throw this.createExtraByteError(this.totalPos);this.appendBuffer(u);try{c=this.doDecodeSync(),l=!0}catch(e){if(!(0,T._)(e,q))throw e}this.totalPos+=this.pos}finally{t=!0}h.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return o={error:h.sent()},[3,12];case 7:if(h.trys.push([7,,10,11]),!(!t&&!i&&(a=n.return)))return[3,9];return[4,a.call(n)];case 8:h.sent(),h.label=9;case 9:return[3,11];case 10:if(o)throw o.error;return[7];case 11:return[7];case 12:if(l){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,c]}throw p=this,d=p.headByte,y=p.pos,f=p.totalPos,RangeError("Insufficient data in parsing ".concat(S(d)," at ").concat(f," (").concat(y," in the current buffer)"))}})},new(u||(u=Promise))(function(e,t){function n(e){try{i(p.next(e))}catch(e){t(e)}}function r(e){try{i(p.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,(0,T._)(i,u)?i:new u(function(e){e(i)})).then(n,r)}i((p=p.apply(l,c||[])).next())})},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return P(this,arguments,function(){var n,r,i,o,a,s,l,c,u,p,d;return M(this,function(y){switch(y.label){case 0:n=t,r=-1,y.label=1;case 1:y.trys.push([1,15,16,21]),i=!0,o=D(e),y.label=2;case 2:return[4,x(o.next())];case 3:if(c=(a=y.sent()).done)return[3,14];d=a.value,i=!1,y.label=4;case 4:if(y.trys.push([4,,12,13]),s=d,t&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(r=this.readArraySize(),n=!1,this.complete()),y.label=5;case 5:y.trys.push([5,10,,11]),y.label=6;case 6:return[4,x(this.doDecodeSync())];case 7:return[4,y.sent()];case 8:if(y.sent(),0==--r)return[3,9];return[3,6];case 9:return[3,11];case 10:if(l=y.sent(),!(0,T._)(l,q))throw l;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return i=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return u={error:y.sent()},[3,21];case 16:if(y.trys.push([16,,19,20]),!(!i&&!c&&(p=o.return)))return[3,18];return[4,x(p.call(o))];case 17:y.sent(),y.label=18;case 18:return[3,20];case 19:if(u)throw u.error;return[7];case 20:return[7];case 21:return[2]}})})},e.prototype.doDecodeSync=function(){t:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var n=e-128;if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(e<160){var n=e-144;if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else{var r=e-160;t=this.decodeUtf8String(r,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===e){var r=this.lookU8();t=this.decodeUtf8String(r,1)}else if(218===e){var r=this.lookU16();t=this.decodeUtf8String(r,2)}else if(219===e){var r=this.lookU32();t=this.decodeUtf8String(r,4)}else if(220===e){var n=this.readU16();if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else if(221===e){var n=this.readU32();if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else if(222===e){var n=this.readU16();if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(223===e){var n=this.readU32();if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(196===e){var n=this.lookU8();t=this.decodeBinary(n,1)}else if(197===e){var n=this.lookU16();t=this.decodeBinary(n,2)}else if(198===e){var n=this.lookU32();t=this.decodeBinary(n,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){var n=this.lookU8();t=this.decodeExtension(n,1)}else if(200===e){var n=this.lookU16();t=this.decodeExtension(n,2)}else if(201===e){var n=this.lookU32();t=this.decodeExtension(n,4)}else throw new C("Unrecognized type byte: ".concat(S(e)));this.complete();for(var i=this.stack;i.length>0;){var o,a=i[i.length-1];if(a.type===L)if(a.array[a.position]=t,a.position++,a.position===a.size)i.pop(),t=a.array;else continue t;else if(a.type===j){if("string"!=typeof(o=t)&&"number"!=typeof o)throw new C("The type of key must be string or number but "+(void 0===t?"undefined":(0,g._)(t)));if("__proto__"===t)throw new C("The key __proto__ is not allowed");a.key=t,a.type="map_value";continue t}else if(a.map[a.key]=t,a.readCount++,a.readCount===a.size)i.pop(),t=a.map;else{a.key=null,a.type=j;continue t}}return t}},e.prototype.readHeadByte=function(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new C("Unrecognized array type byte: ".concat(S(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new C("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:j,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new C("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:L,size:e,array:Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){if(e>this.maxStrLength)throw new C("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw G;var n,r,i=this.pos+t;return r=this.stateIsMapKey()&&(null==(n=this.keyDecoder)?void 0:n.canBeCached(e))?this.keyDecoder.decode(this.bytes,i,e):function(e,t,n){var r;return n>200?(r=e.subarray(t,t+n),U.decode(r)):A(e,t,n)}(this.bytes,i,e),this.pos+=t+e,r},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&this.stack[this.stack.length-1].type===j},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new C("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw G;var n=this.pos+t,r=this.bytes.subarray(n,n+e);return this.pos+=t+e,r},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new C("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,n,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e,t,n=(e=this.view,t=this.pos,0x100000000*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,n},e.prototype.readI64=function(){var e=R(this.view,this.pos);return this.pos+=8,e},e.prototype.readU64AsBigInt=function(){var e=this.view.getBigUint64(this.pos);return this.pos+=8,e},e.prototype.readI64AsBigInt=function(){var e=this.view.getBigInt64(this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},e}(),W=function(){function e(e){var t,n,r,i,o,a,s,l;this.extensionCodec=null!=(t=null==e?void 0:e.extensionCodec)?t:O.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=null!=(n=null==e?void 0:e.useBigInt64)&&n,this.maxDepth=null!=(r=null==e?void 0:e.maxDepth)?r:100,this.initialBufferSize=null!=(i=null==e?void 0:e.initialBufferSize)?i:2048,this.sortKeys=null!=(o=null==e?void 0:e.sortKeys)&&o,this.forceFloat32=null!=(a=null==e?void 0:e.forceFloat32)&&a,this.ignoreUndefined=null!=(s=null==e?void 0:e.ignoreUndefined)&&s,this.forceIntegerToFloat=null!=(l=null==e?void 0:e.forceIntegerToFloat)&&l,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return e.prototype.reinitializeState=function(){this.pos=0},e.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},e.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},e.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&(void 0===e?"undefined":(0,g._)(e))==="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),n=new Uint8Array(t),r=new DataView(t);n.set(this.bytes),this.view=r,this.bytes=n},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<0x100000000?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-0x80000000?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)},e.prototype.encodeNumberAsFloat=function(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.encodeBigInt64=function(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<0x100000000)this.writeU8(219),this.writeU32(e);else throw Error("Too long string: ".concat(e," bytes in UTF-8"))},e.prototype.encodeString=function(e){var t=function(e){for(var t=e.length,n=0,r=0;r<t;){var i=e.charCodeAt(r++);if((0xffffff80&i)==0){n++;continue}if((0xfffff800&i)==0)n+=2;else{if(i>=55296&&i<=56319&&r<t){var o=e.charCodeAt(r);(64512&o)==56320&&(++r,i=((1023&i)<<10)+(1023&o)+65536)}(0xffff0000&i)==0?n+=3:n+=4}}return n}(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,n){if(e.length>50)k.encodeInto(e,t.subarray(n));else!function(e,t,n){for(var r=e.length,i=n,o=0;o<r;){var a=e.charCodeAt(o++);if((0xffffff80&a)==0){t[i++]=a;continue}if((0xfffff800&a)==0)t[i++]=a>>6&31|192;else{if(a>=55296&&a<=56319&&o<r){var s=e.charCodeAt(o);(64512&s)==56320&&(++o,a=((1023&a)<<10)+(1023&s)+65536)}(0xffff0000&a)==0?t[i++]=a>>12&15|224:(t[i++]=a>>18&7|240,t[i++]=a>>12&63|128),t[i++]=a>>6&63|128}t[i++]=63&a|128}}(e,t,n)}(e,this.bytes,this.pos),this.pos+=t},e.prototype.encodeObject=function(e,t){var n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if((void 0===e?"undefined":(0,g._)(e))==="object")this.encodeMap(e,t);else throw Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<0x100000000)this.writeU8(198),this.writeU32(t);else throw Error("Too large binary: ".concat(t));var n=w(e);this.writeU8a(n)},e.prototype.encodeArray=function(e,t){var n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<0x100000000)this.writeU8(221),this.writeU32(n);else throw Error("Too large array: ".concat(n));for(var r=0;r<e.length;r++){var i=e[r];this.doEncode(i,t+1)}},e.prototype.countWithoutUndefined=function(e,t){for(var n=0,r=0;r<t.length;r++)void 0!==e[t[r]]&&n++;return n},e.prototype.encodeMap=function(e,t){var n=Object.keys(e);this.sortKeys&&n.sort();var r=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else if(r<0x100000000)this.writeU8(223),this.writeU32(r);else throw Error("Too large map object: ".concat(r));for(var i=0;i<n.length;i++){var o=n[i],a=e[o];this.ignoreUndefined&&void 0===a||(this.encodeString(o),this.doEncode(a,t+1))}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<0x100000000)this.writeU8(201),this.writeU32(t);else throw Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){var t,n;this.ensureBufferSizeToWrite(8),t=this.view,n=this.pos,t.setUint32(n,e/0x100000000),t.setUint32(n+4,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),_(this.view,this.pos,e),this.pos+=8},e.prototype.writeBigUint64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8},e.prototype.writeBigInt64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8},e}(),$=e.i(346715),z=e.i(886513),K={debug:-1,info:0,warn:1,error:2},Q=function(e){return function(t,n){if(!(null==n?void 0:n.transportMessage))return void e(t,n);var r=n.transportMessage;r.payload,n.transportMessage=(0,z._)(r,["payload"]),e(t,n)}},Y=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";(0,i._)(this,e),(0,c._)(this,"minLevel",void 0),(0,c._)(this,"output",void 0),this.minLevel=n,this.output=t}return(0,l._)(e,[{key:"debug",value:function(e,t){K[this.minLevel]<=K.debug&&this.output(e,null!=t?t:{},"debug")}},{key:"info",value:function(e,t){K[this.minLevel]<=K.info&&this.output(e,null!=t?t:{},"info")}},{key:"warn",value:function(e,t){K[this.minLevel]<=K.warn&&this.output(e,null!=t?t:{},"warn")}},{key:"error",value:function(e,t){K[this.minLevel]<=K.error&&this.output(e,null!=t?t:{},"error")}}]),e}(),X=function(e){return{debug:Q(e.debug.bind(e)),info:Q(e.info.bind(e)),warn:Q(e.warn.bind(e)),error:Q(e.error.bind(e))}},J=e.i(937500),Z=e.i(399119),ee=e.i(663355),et=e.i(862470),en=e.i(445789),er=e.i(131038),ei=e.i(862927),eo=e.i(884348),ea={heartbeatIntervalMs:1e3,heartbeatsUntilDead:2,sessionDisconnectGraceMs:5e3,connectionTimeoutMs:2e3,handshakeTimeoutMs:1e3,enableTransparentSessionReconnects:!0,codec:{toBuffer:function(e){return v.encode(JSON.stringify(e,function(e){var t,n=this[e];return(0,T._)(n,Uint8Array)?{$t:(t="",n.forEach(function(e){t+=String.fromCharCode(e)}),btoa(t))}:n}))},fromBuffer:function(e){try{var t=JSON.parse(m.decode(e),function(e,t){return(null==t?void 0:t.$t)?function(e){for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(t.$t):t});if((void 0===t?"undefined":(0,g._)(t))==="object")return t;return null}catch(e){return null}}}},es=(0,u._)({},ea,{baseIntervalMs:150,maxJitterMs:200,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:200});(0,u._)({},ea);var el=((n=el||{}).NoConnection="NoConnection",n.BackingOff="BackingOff",n.Connecting="Connecting",n.Handshaking="Handshaking",n.Connected="Connected",n.WaitingForHandshake="WaitingForHandshake",n),ec="session state has been consumed and is no longer valid",eu=function(e){function t(e){var n,r=e.from,o=e.options,a=e.log;return(0,i._)(this,t),n=(0,Z._)(this,t),(0,c._)(n,"from",void 0),(0,c._)(n,"options",void 0),(0,c._)(n,"log",void 0),n.from=r,n.options=o,n.log=a,n}return(0,en._)(t,e),(0,l._)(t,[{key:"parseMsg",value:function(e){var t,n=this.options.codec.fromBuffer(e);if(null===n){var r,i=new TextDecoder().decode(J.Buffer.from(e));return null==(r=this.log)||r.error("received malformed msg: ".concat(i),this.loggingMetadata),null}return ei.Value.Check(er.OpaqueTransportMessageSchema,n)?n:(null==(t=this.log)||t.error("received invalid msg: ".concat(JSON.stringify(n)),(0,p._)((0,u._)({},this.loggingMetadata),{validationErrors:(0,$._)(ei.Value.Errors(er.OpaqueTransportMessageSchema,n))})),null)}}]),t}(function(){function e(){return(0,i._)(this,e),(0,c._)(this,"_isConsumed",void 0),this._isConsumed=!1,new Proxy(this,{get:function(e,t){if("_isConsumed"===t||"id"===t||"state"===t)return Reflect.get(e,t);if("_handleStateExit"===t)return function(){e._isConsumed=!0,e._handleStateExit()};if("_handleClose"===t)return function(){e._isConsumed=!0,e._handleStateExit(),e._handleClose()};if(e._isConsumed)throw Error("".concat(ec,": getting ").concat(t.toString()," on consumed state"));return Reflect.get(e,t)},set:function(e,t,n){if(e._isConsumed)throw Error("".concat(ec,": setting ").concat(t.toString()," on consumed state"));return Reflect.set(e,t,n)}})}return(0,l._)(e,[{key:"close",value:function(){this._handleClose()}}]),e}()),ep=function(e){function t(e){(0,i._)(this,t);var n,r=e.id,o=e.to,a=e.seq,s=e.ack,l=e.sendBuffer,u=e.telemetry,p=e.log;return n=(0,Z._)(this,t,[e]),(0,c._)(n,"id",void 0),(0,c._)(n,"telemetry",void 0),(0,c._)(n,"to",void 0),(0,c._)(n,"seq",void 0),(0,c._)(n,"ack",void 0),(0,c._)(n,"sendBuffer",void 0),n.id=r,n.to=o,n.seq=a,n.ack=s,n.sendBuffer=l,n.telemetry=u,n.log=p,n}return(0,en._)(t,e),(0,l._)(t,[{key:"loggingMetadata",get:function(){var e=this.telemetry.span.spanContext(),t={clientId:this.from,connectedTo:this.to,sessionId:this.id};return this.telemetry.span.isRecording()&&(t.telemetry={traceId:e.traceId,spanId:e.spanId}),t}},{key:"constructMsg",value:function(e){var t=(0,p._)((0,u._)({},e),{id:(0,er.generateId)(),to:this.to,from:this.from,seq:this.seq,ack:this.ack});return this.seq++,t}},{key:"nextSeq",value:function(){return this.sendBuffer.length>0?this.sendBuffer[0].seq:this.seq}},{key:"send",value:function(e){var t=this.constructMsg(e);return this.sendBuffer.push(t),t.id}},{key:"_handleStateExit",value:function(){}},{key:"_handleClose",value:function(){this.sendBuffer.length=0,this.telemetry.span.end()}}]),t}(eu),ed=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,c._)(n,"graceExpiryTime",void 0),(0,c._)(n,"gracePeriodTimeout",void 0),(0,c._)(n,"listeners",void 0),n.listeners=e.listeners,n.graceExpiryTime=e.graceExpiryTime,n.gracePeriodTimeout=setTimeout(function(){n.listeners.onSessionGracePeriodElapsed()},n.graceExpiryTime-Date.now()),n}return(0,en._)(t,e),(0,l._)(t,[{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.gracePeriodTimeout&&(clearTimeout(this.gracePeriodTimeout),this.gracePeriodTimeout=void 0)}},{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this)}}]),t}(ep),ey=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,c._)(n,"state","Connecting"),(0,c._)(n,"connPromise",void 0),(0,c._)(n,"listeners",void 0),(0,c._)(n,"connectionTimeout",void 0),n.connPromise=e.connPromise,n.listeners=e.listeners,n.connPromise.then(function(e){n._isConsumed||n.listeners.onConnectionEstablished(e)},function(e){n._isConsumed||n.listeners.onConnectionFailed(e)}),n.connectionTimeout=setTimeout(function(){n.listeners.onConnectionTimeout()},n.options.connectionTimeoutMs),n}return(0,en._)(t,e),(0,l._)(t,[{key:"bestEffortClose",value:function(){var e=this.log,t=this.loggingMetadata;this.connPromise.then(function(n){n.close(),null==e||e.info("connection eventually resolved but session has transitioned, closed connection",(0,u._)({},t,n.loggingMetadata))}).catch(function(){})}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)}},{key:"_handleClose",value:function(){this.bestEffortClose(),(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this)}}]),t}(ed),ef=function(e){function t(){var e;return(0,i._)(this,t),e=(0,Z._)(this,t,arguments),(0,c._)(e,"state","NoConnection"),e}return(0,en._)(t,e),(0,l._)(t,[{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this)}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this)}}]),t}(ed),eh=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,c._)(n,"state","WaitingForHandshake"),(0,c._)(n,"conn",void 0),(0,c._)(n,"listeners",void 0),(0,c._)(n,"handshakeTimeout",void 0),(0,c._)(n,"onHandshakeData",function(e){var t=n.parseMsg(e);null===t?n.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE"):n.listeners.onHandshake(t)}),n.conn=e.conn,n.listeners=e.listeners,n.handshakeTimeout=setTimeout(function(){n.listeners.onHandshakeTimeout()},n.options.handshakeTimeoutMs),n.conn.addDataListener(n.onHandshakeData),n.conn.addErrorListener(n.listeners.onConnectionErrored),n.conn.addCloseListener(n.listeners.onConnectionClosed),n}return(0,en._)(t,e),(0,l._)(t,[{key:"loggingMetadata",get:function(){return(0,u._)({clientId:this.from,connId:this.conn.id},this.conn.loggingMetadata)}},{key:"sendHandshake",value:function(e){return this.conn.send(this.options.codec.toBuffer(e))}},{key:"_handleStateExit",value:function(){this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0}},{key:"_handleClose",value:function(){this.conn.close()}}]),t}(eu),eg=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,c._)(n,"state","Handshaking"),(0,c._)(n,"conn",void 0),(0,c._)(n,"listeners",void 0),(0,c._)(n,"handshakeTimeout",void 0),(0,c._)(n,"onHandshakeData",function(e){var t=n.parseMsg(e);null===t?n.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE"):n.listeners.onHandshake(t)}),n.conn=e.conn,n.listeners=e.listeners,n.handshakeTimeout=setTimeout(function(){n.listeners.onHandshakeTimeout()},n.options.handshakeTimeoutMs),n.conn.addDataListener(n.onHandshakeData),n.conn.addErrorListener(n.listeners.onConnectionErrored),n.conn.addCloseListener(n.listeners.onConnectionClosed),n}return(0,en._)(t,e),(0,l._)(t,[{key:"loggingMetadata",get:function(){return(0,u._)({},(0,ee._)((0,et._)(t.prototype),"loggingMetadata",this),this.conn.loggingMetadata)}},{key:"sendHandshake",value:function(e){return this.conn.send(this.options.codec.toBuffer(e))}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.handshakeTimeout&&(clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0)}},{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this),this.conn.close()}}]),t}(ed),eT=function(e){function t(e){if((0,i._)(this,t),a=(0,Z._)(this,t,[e]),(0,c._)(a,"state","Connected"),(0,c._)(a,"conn",void 0),(0,c._)(a,"listeners",void 0),(0,c._)(a,"heartbeatHandle",void 0),(0,c._)(a,"heartbeatMisses",0),(0,c._)(a,"isActivelyHeartbeating",void 0),(0,c._)(a,"onMessageData",function(e){var t=a.parseMsg(e);if(null===t)return void a.listeners.onInvalidMessage("could not parse message");if(t.seq!==a.ack){if(t.seq<a.ack)null==(i=a.log)||i.debug("received duplicate msg (got seq: ".concat(t.seq,", wanted seq: ").concat(a.ack,"), discarding"),(0,p._)((0,u._)({},a.loggingMetadata),{transportMessage:t}));else{var n,r,i,o,s="received out-of-order msg, closing connection (got seq: ".concat(t.seq,", wanted seq: ").concat(a.ack,")");null==(o=a.log)||o.warn(s,(0,p._)((0,u._)({},a.loggingMetadata),{transportMessage:t,tags:["invariant-violation"]})),a.telemetry.span.setStatus({code:eo.SpanStatusCode.ERROR,message:s}),a.closeConnection()}return}(null==(n=a.log)||n.debug("received msg",(0,p._)((0,u._)({},a.loggingMetadata),{transportMessage:t})),a.updateBookkeeping(t.ack,t.seq),(0,er.isAck)(t.controlFlags))?(null==(r=a.log)||r.debug("discarding msg (ack bit set)",(0,p._)((0,u._)({},a.loggingMetadata),{transportMessage:t})),a.isActivelyHeartbeating||a.sendHeartbeat()):a.listeners.onMessage(t)}),a.conn=e.conn,a.listeners=e.listeners,a.conn.addDataListener(a.onMessageData),a.conn.addCloseListener(a.listeners.onConnectionClosed),a.conn.addErrorListener(a.listeners.onConnectionErrored),a.sendBuffer.length>0){null==(s=a.log)||s.info("sending ".concat(a.sendBuffer.length," buffered messages, starting at seq ").concat(a.nextSeq()),a.loggingMetadata);var n=!0,r=!1,o=void 0;try{for(var a,s,l,d=a.sendBuffer[Symbol.iterator]();!(n=(l=d.next()).done);n=!0){var y=l.value;a.conn.send(a.options.codec.toBuffer(y))}}catch(e){r=!0,o=e}finally{try{n||null==d.return||d.return()}finally{if(r)throw o}}}return a.isActivelyHeartbeating=!1,a.heartbeatHandle=setInterval(function(){var e,t=a.heartbeatMisses,n=t*a.options.heartbeatIntervalMs;if(t>=a.options.heartbeatsUntilDead){null==(e=a.log)||e.info("closing connection to ".concat(a.to," due to inactivity (missed ").concat(t," heartbeats which is ").concat(n,"ms)"),a.loggingMetadata),a.telemetry.span.addEvent("closing connection due to inactivity"),a.conn.close(),clearInterval(a.heartbeatHandle),a.heartbeatHandle=void 0;return}a.isActivelyHeartbeating&&a.sendHeartbeat(),a.heartbeatMisses++},a.options.heartbeatIntervalMs),a}return(0,en._)(t,e),(0,l._)(t,[{key:"updateBookkeeping",value:function(e,t){this.sendBuffer=this.sendBuffer.filter(function(t){return t.seq>=e}),this.ack=t+1,this.heartbeatMisses=0}},{key:"send",value:function(e){var t=this.constructMsg(e);return this.sendBuffer.push(t),this.conn.send(this.options.codec.toBuffer(t)),t.id}},{key:"loggingMetadata",get:function(){return(0,u._)({},(0,ee._)((0,et._)(t.prototype),"loggingMetadata",this),this.conn.loggingMetadata)}},{key:"startActiveHeartbeat",value:function(){this.isActivelyHeartbeating=!0}},{key:"sendHeartbeat",value:function(){var e;null==(e=this.log)||e.debug("sending heartbeat",this.loggingMetadata),this.send({streamId:"heartbeat",controlFlags:1,payload:{type:"ACK"}})}},{key:"closeConnection",value:function(){this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.close()}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.heartbeatHandle&&(clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0)}},{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this),this.conn.close()}}]),t}(ep),ev=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,c._)(n,"state","BackingOff"),(0,c._)(n,"listeners",void 0),(0,c._)(n,"backoffTimeout",void 0),n.listeners=e.listeners,n.backoffTimeout=setTimeout(function(){n.listeners.onBackoffFinished()},e.backoffMs),n}return(0,en._)(t,e),(0,l._)(t,[{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this)}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.backoffTimeout&&(clearTimeout(this.backoffTimeout),this.backoffTimeout=void 0)}}]),t}(ed);function em(e){return{id:e.id,from:e.from,to:e.to,seq:e.seq,ack:e.ack,sendBuffer:e.sendBuffer,telemetry:e.telemetry,options:e.options,log:e.log}}function eS(e){return(0,p._)((0,u._)({},em(e)),{graceExpiryTime:e.graceExpiryTime})}var eE=function(e,t,n,r,i){var o,a="session-".concat((0,er.generateId)()),s=(0,er.createSessionTelemetryInfo)(a,e,t),l=new ef({listeners:n,id:a,from:t,to:e,seq:0,ack:0,graceExpiryTime:Date.now()+r.sessionDisconnectGraceMs,sendBuffer:[],telemetry:s,options:r,log:i});return null==(o=l.log)||o.info("session ".concat(l.id," created in NoConnection state"),(0,p._)((0,u._)({},l.loggingMetadata),{tags:["state-transition"]})),l},eb={NoConnectionToBackingOff:function(e,t,n){var r,i=eS(e);e._handleStateExit();var o=new ev((0,u._)({backoffMs:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from NoConnection to BackingOff"),(0,p._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o},BackingOffToConnecting:function(e,t,n){var r,i=eS(e);e._handleStateExit();var o=new ey((0,u._)({connPromise:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from BackingOff to Connecting"),(0,p._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o},ConnectingToHandshaking:function(e,t,n){var r,i=eS(e);e._handleStateExit();var o=new eg((0,u._)({conn:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from Connecting to Handshaking"),(0,p._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o},HandshakingToConnected:function(e,t){var n,r=em(e),i=e.conn;e._handleStateExit();var o=new eT((0,u._)({conn:i,listeners:t},r));return null==(n=o.log)||n.info("session ".concat(o.id," transition from Handshaking to Connected"),(0,p._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o},WaitingForHandshakeToConnected:function(e,t,n,r,i,o){var a,s=e.conn,l=e.from,c=e.options,d=t?em(t):{id:n,from:l,to:r,seq:0,ack:0,sendBuffer:[],telemetry:(0,er.createSessionTelemetryInfo)(n,r,l,i),options:c,log:e.log};e._handleStateExit(),null==t||t._handleStateExit();var y=new eT((0,u._)({conn:s,listeners:o},d));return null==(a=y.log)||a.info("session ".concat(y.id," transition from WaitingForHandshake to Connected"),(0,p._)((0,u._)({},y.loggingMetadata),{tags:["state-transition"]})),y},BackingOffToNoConnection:function(e,t){var n,r=eS(e);e._handleStateExit();var i=new ef((0,u._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from BackingOff to NoConnection"),(0,p._)((0,u._)({},i.loggingMetadata),{tags:["state-transition"]})),i},ConnectingToNoConnection:function(e,t){var n,r=eS(e);e.bestEffortClose(),e._handleStateExit();var i=new ef((0,u._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from Connecting to NoConnection"),(0,p._)((0,u._)({},i.loggingMetadata),{tags:["state-transition"]})),i},HandshakingToNoConnection:function(e,t){var n,r=eS(e);e.conn.close(),e._handleStateExit();var i=new ef((0,u._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from Handshaking to NoConnection"),(0,p._)((0,u._)({},i.loggingMetadata),{tags:["state-transition"]})),i},ConnectedToNoConnection:function(e,t){var n,r=em(e),i=Date.now()+e.options.sessionDisconnectGraceMs;e.conn.close(),e._handleStateExit();var o=new ef((0,u._)({listeners:t,graceExpiryTime:i},r));return null==(n=o.log)||n.info("session ".concat(o.id," transition from Connected to NoConnection"),(0,p._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o}},eC={entrypoint:eE,transition:{NoConnectionToBackingOff:eb.NoConnectionToBackingOff,BackingOffToConnecting:eb.BackingOffToConnecting,ConnectingToHandshaking:eb.ConnectingToHandshaking,HandshakingToConnected:eb.HandshakingToConnected,BackingOffToNoConnection:eb.BackingOffToNoConnection,ConnectingToNoConnection:eb.ConnectingToNoConnection,HandshakingToNoConnection:eb.HandshakingToNoConnection,ConnectedToNoConnection:eb.ConnectedToNoConnection}};eb.WaitingForHandshakeToConnected,eb.ConnectedToNoConnection;var e_="conn_retry_exceeded",eR="handshake_failed",eI=function(){function e(){(0,i._)(this,e),(0,c._)(this,"eventListeners",{})}return(0,l._)(e,[{key:"removeAllListeners",value:function(){this.eventListeners={}}},{key:"numberOfListeners",value:function(e){var t,n;return null!=(n=null==(t=this.eventListeners[e])?void 0:t.size)?n:0}},{key:"addEventListener",value:function(e,t){var n;this.eventListeners[e]||(this.eventListeners[e]=new Set),null==(n=this.eventListeners[e])||n.add(t)}},{key:"removeEventListener",value:function(e,t){var n;this.eventListeners[e]&&(null==(n=this.eventListeners[e])||n.delete(t))}},{key:"dispatchEvent",value:function(e,t){var n=this.eventListeners[e];if(n){var r=(0,$._)(n),i=!0,o=!1,a=void 0;try{for(var s,l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0)(0,s.value)(t)}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}}}}]),e}(),eO=function(){function e(t,n){(0,i._)(this,e),(0,c._)(this,"status",void 0),(0,c._)(this,"clientId",void 0),(0,c._)(this,"eventDispatcher",void 0),(0,c._)(this,"options",void 0),(0,c._)(this,"log",void 0),(0,c._)(this,"sessions",void 0),this.options=(0,u._)({},ea,n),this.eventDispatcher=new eI,this.clientId=t,this.status="open",this.sessions=new Map}return(0,l._)(e,[{key:"bindLogger",value:function(e,t){if("function"==typeof e){this.log=X(new Y(e,t));return}this.log=X(e)}},{key:"handleMsg",value:function(e){"open"===this.getStatus()&&this.eventDispatcher.dispatchEvent("message",e)}},{key:"addEventListener",value:function(e,t){this.eventDispatcher.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.eventDispatcher.removeEventListener(e,t)}},{key:"protocolError",value:function(e){this.eventDispatcher.dispatchEvent("protocolError",e)}},{key:"close",value:function(){this.status="closed";var e=!0,t=!1,n=void 0;try{for(var r,i,o=this.sessions.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this.deleteSession(a)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.eventDispatcher.dispatchEvent("transportStatus",{status:this.status}),this.eventDispatcher.removeAllListeners(),null==(r=this.log)||r.info("manually closed transport",{clientId:this.clientId})}},{key:"getStatus",value:function(){return this.status}},{key:"updateSession",value:function(e){var t=this.sessions.get(e.to);if(t&&t.id!==e.id)throw Error("attempt to transition active session for ".concat(e.to," but active session (").concat(t.id,") is different from handle (").concat(e.id,")"));return this.sessions.set(e.to,e),t||this.eventDispatcher.dispatchEvent("sessionStatus",{status:"connect",session:e}),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,session:e}),e}},{key:"deleteSession",value:function(e,t){if(!e._isConsumed){var n,r=e.loggingMetadata;r.tags&&(null==t?void 0:t.unhealthy)&&r.tags.push("unhealthy-session"),null==(n=e.log)||n.info("closing session ".concat(e.id),r),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"disconnect",session:e});var i=e.to;e.close(),this.sessions.delete(i)}}},{key:"onSessionGracePeriodElapsed",value:function(e){var t;null==(t=this.log)||t.warn("session to ".concat(e.to," grace period elapsed, closing"),e.loggingMetadata),this.deleteSession(e)}},{key:"onConnectingFailed",value:function(e){var t=this,n=eb.ConnectingToNoConnection(e,{onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(n)}});return this.updateSession(n)}},{key:"onConnClosed",value:function(e){var t,n=this;return t="Handshaking"===e.state?eb.HandshakingToNoConnection(e,{onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(t)}}):eb.ConnectedToNoConnection(e,{onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(t)}}),this.updateSession(t)}}]),e}(),ek=function(){function e(){(0,i._)(this,e),(0,c._)(this,"id",void 0),(0,c._)(this,"telemetry",void 0),(0,c._)(this,"_dataListeners",new Set),(0,c._)(this,"_closeListeners",new Set),(0,c._)(this,"_errorListeners",new Set),this.id="conn-".concat((0,er.generateId)())}return(0,l._)(e,[{key:"loggingMetadata",get:function(){var e,t,n={connId:this.id},r=null==(e=this.telemetry)?void 0:e.span.spanContext();return(null==(t=this.telemetry)?void 0:t.span.isRecording())&&r&&(n.telemetry={traceId:r.traceId,spanId:r.spanId}),n}},{key:"dataListeners",get:function(){return(0,$._)(this._dataListeners)}},{key:"closeListeners",get:function(){return(0,$._)(this._closeListeners)}},{key:"errorListeners",get:function(){return(0,$._)(this._errorListeners)}},{key:"addDataListener",value:function(e){this._dataListeners.add(e)}},{key:"removeDataListener",value:function(e){this._dataListeners.delete(e)}},{key:"addCloseListener",value:function(e){this._closeListeners.add(e)}},{key:"removeCloseListener",value:function(e){this._closeListeners.delete(e)}},{key:"addErrorListener",value:function(e){this._errorListeners.add(e)}},{key:"removeErrorListener",value:function(e){this._errorListeners.delete(e)}}]),e}(),eA=function(){function e(t){(0,i._)(this,e),(0,c._)(this,"budgetConsumed",void 0),(0,c._)(this,"intervalHandle",void 0),(0,c._)(this,"options",void 0),this.options=t,this.budgetConsumed=0}return(0,l._)(e,[{key:"getBackoffMs",value:function(){if(0===this.getBudgetConsumed())return 0;var e=Math.max(0,this.getBudgetConsumed()-1),t=Math.floor(Math.random()*this.options.maxJitterMs);return Math.min(this.options.baseIntervalMs*Math.pow(2,e),this.options.maxBackoffMs)+t}},{key:"totalBudgetRestoreTime",get:function(){return this.options.budgetRestoreIntervalMs*this.options.attemptBudgetCapacity}},{key:"consumeBudget",value:function(){this.stopLeak(),this.budgetConsumed=this.getBudgetConsumed()+1}},{key:"getBudgetConsumed",value:function(){return this.budgetConsumed}},{key:"hasBudget",value:function(){return this.getBudgetConsumed()<this.options.attemptBudgetCapacity}},{key:"startRestoringBudget",value:function(){var e=this;this.intervalHandle||(this.intervalHandle=setInterval(function(){var t=e.budgetConsumed;if(!t)return void e.stopLeak();var n=t-1;0!==n&&(e.budgetConsumed=n)},this.options.budgetRestoreIntervalMs))}},{key:"stopLeak",value:function(){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0)}},{key:"close",value:function(){this.stopLeak()}}]),e}(),eU=function(e){function t(e,n){var r;return(0,i._)(this,t),r=(0,Z._)(this,t,[e,n]),(0,c._)(r,"options",void 0),(0,c._)(r,"retryBudget",void 0),(0,c._)(r,"reconnectOnConnectionDrop",!0),(0,c._)(r,"handshakeExtensions",void 0),(0,c._)(r,"sessions",void 0),r.sessions=new Map,r.options=(0,u._)({},es,n),r.retryBudget=new eA(r.options),r}return(0,en._)(t,e),(0,l._)(t,[{key:"extendHandshake",value:function(e){this.handshakeExtensions=e}},{key:"tryReconnecting",value:function(e){var t=this.sessions.get(e);!this.options.enableTransparentSessionReconnects&&t&&this.deleteSession(t),this.reconnectOnConnectionDrop&&"open"===this.getStatus()&&this.connect(e)}},{key:"send",value:function(e,t){if("closed"===this.getStatus()){var n,r="transport is closed, cant send";throw null==(n=this.log)||n.error(r,{clientId:this.clientId,transportMessage:t,tags:["invariant-violation"]}),Error(r)}var i=this.sessions.get(e);return i||(i=this.createUnconnectedSession(e)),i.send(t)}},{key:"createUnconnectedSession",value:function(e){var t=this,n=eC.entrypoint(e,this.clientId,{onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(n)}},this.options,this.log);return this.updateSession(n),n}},{key:"onConnectingFailed",value:function(e){var n=(0,ee._)((0,et._)(t.prototype),"onConnectingFailed",this).call(this,e);return this.tryReconnecting(n.to),n}},{key:"onConnClosed",value:function(e){var n=(0,ee._)((0,et._)(t.prototype),"onConnClosed",this).call(this,e);return this.tryReconnecting(n.to),n}},{key:"onConnectionEstablished",value:function(e,t){var n=this,r=eC.transition.ConnectingToHandshaking(e,t,{onConnectionErrored:function(e){var t,i=(0,er.coerceErrorString)(e);null==(t=n.log)||t.error("connection to ".concat(r.to," errored during handshake: ").concat(i),r.loggingMetadata)},onConnectionClosed:function(){var e;null==(e=n.log)||e.warn("connection to ".concat(r.to," closed during handshake"),r.loggingMetadata),n.onConnClosed(r)},onHandshake:function(e){n.onHandshakeResponse(r,e)},onInvalidHandshake:function(t,i){var o;null==(o=n.log)||o.error("invalid handshake: ".concat(t),r.loggingMetadata),n.deleteSession(e,{unhealthy:!0}),n.protocolError({type:eR,code:i,message:t})},onHandshakeTimeout:function(){var e;null==(e=n.log)||e.error("connection to ".concat(r.to," timed out during handshake"),r.loggingMetadata),n.onConnClosed(r)},onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(r)}});return this.updateSession(r),this.sendHandshake(r),r}},{key:"rejectHandshakeResponse",value:function(e,t,n){var r,i;null==(r=e.conn.telemetry)||r.span.setStatus({code:eo.SpanStatusCode.ERROR,message:t}),null==(i=this.log)||i.warn(t,n),this.deleteSession(e,{unhealthy:!0})}},{key:"onHandshakeResponse",value:function(e,t){var n,r=this;if(!ei.Value.Check(er.ControlMessageHandshakeResponseSchema,t.payload))return void this.rejectHandshakeResponse(e,"received invalid handshake response",(0,p._)((0,u._)({},e.loggingMetadata),{transportMessage:t,validationErrors:(0,$._)(ei.Value.Errors(er.ControlMessageHandshakeResponseSchema,t.payload))}));if(!t.payload.status.ok){var i=ei.Value.Check(er.HandshakeErrorRetriableResponseCodes,t.payload.status.code),o="handshake failed: ".concat(t.payload.status.reason),a=e.to;this.rejectHandshakeResponse(e,o,(0,p._)((0,u._)({},e.loggingMetadata),{transportMessage:t})),i?this.tryReconnecting(a):this.protocolError({type:eR,code:t.payload.status.code,message:o});return}if(t.payload.status.sessionId!==e.id){var s="session id mismatch: expected ".concat(e.id,", got ").concat(t.payload.status.sessionId);this.rejectHandshakeResponse(e,s,(0,p._)((0,u._)({},e.loggingMetadata),{transportMessage:t}));return}null==(n=this.log)||n.info("handshake from ".concat(t.from," ok"),(0,p._)((0,u._)({},e.loggingMetadata),{transportMessage:t}));var l=eC.transition.HandshakingToConnected(e,{onConnectionErrored:function(e){var t,n=(0,er.coerceErrorString)(e);null==(t=r.log)||t.warn("connection to ".concat(l.to," errored: ").concat(n),l.loggingMetadata)},onConnectionClosed:function(){var e;null==(e=r.log)||e.info("connection to ".concat(l.to," closed"),l.loggingMetadata),r.onConnClosed(l)},onMessage:function(e){return r.handleMsg(e)},onInvalidMessage:function(e){r.deleteSession(l,{unhealthy:!0}),r.protocolError({type:"invalid_message",message:e})}});this.updateSession(l),this.retryBudget.startRestoringBudget()}},{key:"connect",value:function(e){var t=this;if("open"!==this.getStatus()){null==(i=this.log)||i.info("transport state is no longer open, cancelling attempt to connect to ".concat(e));return}var n=this.sessions.get(e);if(null!=n||(n=this.createUnconnectedSession(e)),"NoConnection"!==n.state){null==(o=this.log)||o.debug("session to ".concat(e," has state ").concat(n.state,", skipping connect attempt"),n.loggingMetadata);return}if(!this.retryBudget.hasBudget()){var r,i,o,a,s=this.retryBudget.getBudgetConsumed(),l="tried to connect to ".concat(e," but retry budget exceeded (more than ").concat(s," attempts in the last ").concat(this.retryBudget.totalBudgetRestoreTime,"ms)");null==(a=this.log)||a.error(l,n.loggingMetadata),this.protocolError({type:e_,message:l});return}var c=this.retryBudget.getBackoffMs();null==(r=this.log)||r.info("attempting connection to ".concat(e," (").concat(c,"ms backoff)"),n.loggingMetadata),this.retryBudget.consumeBudget();var u=eC.transition.NoConnectionToBackingOff(n,c,{onBackoffFinished:function(){t.onBackoffFinished(u)},onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(u)}});this.updateSession(u)}},{key:"onBackoffFinished",value:function(e){var t=this,n=er.tracing_default.startActiveSpan("connect",function(n){return(0,r._)(function(){var t,r;return(0,d._)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,3,4]),[4,this.createNewOutgoingConnection(e.to)];case 1:return[2,i.sent()];case 2:throw t=i.sent(),r=(0,er.coerceErrorString)(t),n.recordException(r),n.setStatus({code:eo.SpanStatusCode.ERROR}),t;case 3:return n.end(),[7];case 4:return[2]}})}).call(t)}),i=eC.transition.BackingOffToConnecting(e,n,{onConnectionEstablished:function(e){var n;null==(n=t.log)||n.debug("connection to ".concat(i.to," established"),(0,u._)({},e.loggingMetadata,i.loggingMetadata)),t.onConnectionEstablished(i,e)},onConnectionFailed:function(e){var n,r=(0,er.coerceErrorString)(e);null==(n=t.log)||n.error("error connecting to ".concat(i.to,": ").concat(r),i.loggingMetadata),t.onConnectingFailed(i)},onConnectionTimeout:function(){var e;null==(e=t.log)||e.error("connection to ".concat(i.to," timed out"),i.loggingMetadata),t.onConnectingFailed(i)},onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(i)}});this.updateSession(i)}},{key:"sendHandshake",value:function(e){return(0,r._)(function(){var t,n,r;return(0,d._)(this,function(i){switch(i.label){case 0:if(n=void 0,!this.handshakeExtensions)return[3,2];return[4,this.handshakeExtensions.construct()];case 1:n=i.sent(),i.label=2;case 2:if(e._isConsumed)return[2];return r=(0,er.handshakeRequestMessage)({from:this.clientId,to:e.to,sessionId:e.id,expectedSessionState:{nextExpectedSeq:e.ack,nextSentSeq:e.nextSeq()},metadata:n,tracing:(0,er.getPropagationContext)(e.telemetry.ctx)}),null==(t=this.log)||t.debug("sending handshake request to ".concat(e.to),(0,p._)((0,u._)({},e.loggingMetadata),{transportMessage:r})),e.sendHandshake(r),[2]}})}).call(this)}},{key:"close",value:function(){this.retryBudget.close(),(0,ee._)((0,et._)(t.prototype),"close",this).call(this)}}]),t}(eO),ew=function(e){function t(e,n){(0,i._)(this,t),r=(0,Z._)(this,t),(0,c._)(r,"ws",void 0),(0,c._)(r,"extras",void 0),r.ws=e,r.extras=n,r.ws.binaryType="arraybuffer";var r,o=!1;return r.ws.onerror=function(){o=!0},r.ws.onclose=function(e){var t=e.code,n=e.reason;if(o){var i=Error("websocket closed with code and reason: ".concat(t," - ").concat(n)),a=!0,s=!1,l=void 0;try{for(var c,u=r.errorListeners[Symbol.iterator]();!(a=(c=u.next()).done);a=!0)(0,c.value)(i)}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}}var p=!0,d=!1,y=void 0;try{for(var f,h=r.closeListeners[Symbol.iterator]();!(p=(f=h.next()).done);p=!0)(0,f.value)()}catch(e){d=!0,y=e}finally{try{p||null==h.return||h.return()}finally{if(d)throw y}}},r.ws.onmessage=function(e){var t=!0,n=!1,i=void 0;try{for(var o,a=r.dataListeners[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)(0,o.value)(e.data)}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}},r}return(0,en._)(t,e),(0,l._)(t,[{key:"loggingMetadata",get:function(){var e=(0,ee._)((0,et._)(t.prototype),"loggingMetadata",this);return this.extras&&(e.extras=this.extras),e}},{key:"send",value:function(e){return this.ws.readyState===this.ws.OPEN&&(this.ws.send(e),!0)}},{key:"close",value:function(){this.ws.close(1e3)}}]),t}(ek),eN=function(e){function t(e,n,r){var o;return(0,i._)(this,t),o=(0,Z._)(this,t,[n,r]),(0,c._)(o,"wsGetter",void 0),o.wsGetter=e,o}return(0,en._)(t,e),(0,l._)(t,[{key:"createNewOutgoingConnection",value:function(e){return(0,r._)(function(){var t,n,r,i;return(0,d._)(this,function(o){switch(o.label){case 0:return null==(t=this.log)||t.info("establishing a new websocket to ".concat(e),{clientId:this.clientId,connectedTo:e}),[4,this.wsGetter(e)];case 1:return r=o.sent(),[4,new Promise(function(e,t){r.readyState===r.OPEN?e():r.readyState===r.CLOSING||r.readyState===r.CLOSED?t(Error("ws is closing or closed")):(r.onopen=function(){e()},r.onclose=function(e){t(Error(e.reason))},r.onerror=function(e){t(Error(e.message))})})];case 2:return o.sent(),i=new ew(r),null==(n=this.log)||n.info("raw websocket to ".concat(e," ok"),(0,u._)({clientId:this.clientId,connectedTo:e},i.loggingMetadata)),[2,i]}})}).call(this)}}]),t}(eU);function eM(e){throw Error("Unhandled discriminated union member: ".concat(JSON.stringify(e)))}var eD=(0,p._)((0,u._)({},{codec:{toBuffer:function(e){return new W({ignoreUndefined:!0}).encodeSharedRef(e)},fromBuffer:function(e){try{var t=new H(void 0).decode(e);if((void 0===t?"undefined":(0,g._)(t))!=="object")return null;return t}catch(e){return null}}},heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!1,connectionTimeoutMs:1e4,handshakeTimeoutMs:15e3,sessionDisconnectGraceMs:15e3}),{baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3}),ex=new WeakMap,eP=new WeakMap,eL=function(){function e(t){var n=this,l=t.clientId,y=t.serverId,g=t.connectImmediately,T=t.logger,v=t.getEndpoint,m=t.overrideWebsocket,S=t.onProtocolError,E=t.onRetriesExceeded;(0,i._)(this,e),(0,c._)(this,"clientId",void 0),(0,c._)(this,"serverId",void 0),(0,c._)(this,"log",void 0),(0,c._)(this,"transport",void 0),(0,a._)(this,ex,{writable:!0,value:void 0}),(0,a._)(this,eP,{writable:!0,value:void 0}),(0,c._)(this,"session",void 0),(0,c._)(this,"dispose",null),this.clientId=l,this.serverId=y,this.log=null!=T?T:null;var b={};this.transport=new eN(function(){return(0,r._)(function(){var e,t,n,r,i,o;return(0,d._)(this,function(a){switch(a.label){case 0:if(n=Date.now(),!m)return[3,2];return[4,v()];case 1:return i=m.apply(void 0,[a.sent().toString()]),[3,4];case 2:return o=WebSocket.bind,[4,v()];case 3:i=new(o.apply(WebSocket,[void 0,a.sent().toString()])),a.label=4;case 4:return r=i,null==(e=(t=this).log)||e.call(t,"ai-chat: ws open",{extras:{duration:Date.now()-n}}),[2,r]}})}).call(n)},this.clientId,eD),T&&this.transport.bindLogger(T,"info"),this.session=new f.ObservableState(null),(0,s._)(this,ex,new f.ObservableState("disconnected")),(0,s._)(this,eP,(0,h.createClient)(this.transport,y,{eagerlyConnect:!1,connectOnInvoke:!1})),this.transport.addEventListener("sessionTransition",function(e){var t,r,i,a,s;"BackingOff"===e.state||("Connecting"===e.state?(b.connectionStart=Date.now(),null==(t=n.log)||t.call(n,"ai-chat: connecting",{clientId:n.clientId})):"Handshaking"===e.state?(b.handshakeStart=Date.now(),null==(r=n.log)||r.call(n,"ai-chat: handshaking",{clientId:n.clientId})):"Connected"===e.state?(b.connectionStart&&b.handshakeStart&&(null==(i=n.log)||i.call(n,"ai-chat: connected",{clientId:n.clientId,extras:(0,p._)((0,u._)({},b),{connectionDuration:b.handshakeStart-b.connectionStart,handshakeDuration:Date.now()-b.handshakeStart,totalDuration:Date.now()-b.connectionStart})})),b.connectionStart=void 0,b.handshakeStart=void 0):"NoConnection"===e.state?(null==(a=n.log)||a.call(n,"ai-chat: no connection",{clientId:n.clientId}),b.connectionStart=void 0,b.handshakeStart=void 0):eM(e)),n.is("closed","error")||("Connected"===e.state?(n.session.set(null!=(s=n.transport.sessions.values().next().value)?s:null),(0,o._)(n,ex).set("connected")):(n.session.set(null),n.transport.reconnectOnConnectionDrop?(0,o._)(n,ex).set("connecting"):(0,o._)(n,ex).set("disconnected")))}),this.transport.addEventListener("sessionStatus",function(e){var t,r;"connect"===e.status?(b.sessionStart=Date.now(),null==(t=n.log)||t.call(n,"ai-chat: session started",{sessionId:e.session.id,clientId:n.clientId})):"disconnect"===e.status?b.sessionStart&&(null==(r=n.log)||r.call(n,"ai-chat: session ended",{sessionId:e.session.id,clientId:n.clientId,extras:{sessionDuration:Date.now()-b.sessionStart}})):eM(e.status),n.is("closed","error")||"disconnect"===e.status&&(n.session.set(null),n.transport.reconnectOnConnectionDrop?n.status.set("connecting"):n.status.set("disconnected"))}),this.transport.addEventListener("protocolError",function(e){var t,r;e.type===eR&&(null==(t=n.log)||t.call(n,"river handshake failed",{clientId:l},"error")),e.type===e_?(null==(r=n.log)||r.call(n,"ai-chat: retry budget exhausted",{clientId:l},"error"),n.close(),null==E||E(e)):(n.error(),null==S||S(e))});var C=function(){return!n.is("closed","error")&&"visible"===document.visibilityState&&window.navigator.onLine},_=function(){var e=n.transport.reconnectOnConnectionDrop,t=C();n.transport.reconnectOnConnectionDrop=t,e&&!t&&!n.session.current&&n.is("connecting")&&(0,o._)(n,ex).set("disconnected"),t&&n.is("disconnected")&&n.connect()};this.transport.reconnectOnConnectionDrop=C(),document.addEventListener("visibilitychange",_),window.addEventListener("online",_),window.addEventListener("offline",_),this.dispose=function(){document.removeEventListener("visibilitychange",_),window.removeEventListener("online",_),window.removeEventListener("offline",_)},C()&&!1!==g&&this.connect(),!0===g&&this.connect()}return(0,l._)(e,[{key:"status",get:function(){return(0,o._)(this,ex)}},{key:"service",get:function(){return(0,o._)(this,eP).chatService}},{key:"is",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes((0,o._)(this,ex).current)}},{key:"connect",value:function(){if(this.is("closed","error"))throw Error("Cannot connect to a ".concat((0,o._)(this,ex).current," ChatConnection"));this.is("connected","connecting")||((0,o._)(this,ex).set("connecting"),this.transport.connect(this.serverId))}},{key:"error",value:function(){if(!this.is("closed","error")){var e;(0,o._)(this,ex).set("error"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}},{key:"close",value:function(){if(!this.is("closed","error")){var e;(0,o._)(this,ex).set("closed"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}}]),e}();function ej(e){var t=e.currentUserId;return"chat-client-".concat(t,"-").concat((0,y.nanoid)())}e.s(["ChatConnection",()=>eL,"createClientId",()=>ej],435106)},600637,416143,63846,924908,885505,e=>{"use strict";var t=e.i(297083),n=e.i(530658),r=e.i(817556),i=e.i(389959),o=e.i(906368),a=e.i(435106),s=e.i(131038),s=s,l=e.i(267710),c=e.i(33699),u=e.i(17886),p={production:"wss://production-ai-chat.replit.com/river",staging:"wss://staging-ai-chat.replit.com/river",development:"ws://127.0.0.1:8000/river"};e.s(["AiEndpoints",()=>p],416143);var d=e.i(282453),y="ghostwriter-chat-env",f=c.default.env.CHAT_SERVICE_OVERRIDE,h=d.default.get(y,"string"),g=function(){return f||h||((0,u.isEnvProduction)()?p.production:p.staging)};function T(e){d.default.set(y,e)}e.s(["endpointOverride",()=>f,"getAiEndpoint",()=>g,"setAiEndpoint",()=>T],63846);var v=e.i(98816),m=e.i(664152),S="SERVER",E=window.location.search.includes("aiChatDebug=1"),b=function(e,t,n){var r;E&&console[null!=n?n:"info"]("[ai-chat]"+e,t),m.logger[null!=n?n:"info"](e,{river:t,riverTarget:"ai-chat",riverVersion:s.version}),(null==t||null==(r=t.tags)?void 0:r.includes("invariant-violation"))&&o.withScope(function(n){n.setTag("ai-chat",!0),n.setExtras(t),o.captureException(Error(e))})};function C(e){var o=e.endpoint,s=e.replId,c=e.currentUserId,u=e.orgId,p=e.onRetriesExceeded,d=e.onProtocolError,y=(0,n._)((0,i.useState)(null),2),f=y[0],h=y[1],T=(0,v.default)(p),m=(0,v.default)(d);return(0,i.useEffect)(function(){var e=(0,a.createClientId)({currentUserId:c}),n=new a.ChatConnection({clientId:e,serverId:S,logger:b,getEndpoint:function(){return(0,t._)(function(){var t,n;return(0,r._)(this,function(r){switch(r.label){case 0:if(o)return[2,o];return[4,(0,l.auth)(s,e,u)];case 1:return t=r.sent(),(n=new URL(g())).searchParams.set("auth_token",t),[2,n]}})})()},onProtocolError:function(e){var t;null==(t=m.current)||t.call(m,e)},onRetriesExceeded:function(e){var t;null==(t=T.current)||t.call(T,e)}});return h(n),function(){h(null),Promise.resolve().then(function(){return n.close()})}},[o,s,c,u,T,m]),f}e.s(["AI_CHAT_SERVER_ID",()=>S,"useCreateChatConnection",()=>C],600637);var _=e.i(276385),R=e.i(161322),I=e.i(719518);e.i(824359);var O=(0,i.createContext)(null);function k(e){var t=(0,i.useMemo)(function(){return{store:e.store,yapper:e.yapper}},[e.store,e.yapper]);return(0,_.jsx)(O.Provider,{value:t,children:e.children})}function A(){var e=(0,i.useContext)(O);if(!e)throw Error("Expected Yapper in context");return e.yapper}function U(){var e=(0,i.useContext)(O);if(!e)throw Error("Expected Yapper in context");return e.yapper.chatter()}function w(e,t){var n=A(),r=(0,i.useRef)(t);r.current=t,(0,i.useEffect)(function(){return n.hook(e,function(e){return r.current(e)})},[n,e])}function N(){var e=(0,i.useContext)(O);if(!e)throw Error("Expected store in context");return e.store}function M(e){return(0,R.useAtomValue)(e,{store:N()})}var D=function(e){return(0,R.useSetAtom)(e,{store:N()})};function x(e){return(0,I.useAtomCallback)((0,i.useCallback)(function(t){return t(e)},[e]),{store:N()})}e.s(["StoreProvider",()=>k,"useChatHook",()=>w,"useChatter",()=>U,"useGet",()=>x,"useSet",()=>D,"useValue",()=>M,"useYapper",()=>A],924908);var P=e.i(399119),L=e.i(904851),j=e.i(721281),B=e.i(445789),F=e.i(167626),q=e.i(346715),G=e.i(119468),V=e.i(463348),H=e.i(960933),W=e.i(862927);e.i(242933);var $=e.i(279606),z=function e(t){(0,L._)(this,e),(0,j._)(this,"ok",!0),(0,j._)(this,"payload",void 0),this.payload=t},K=H.Type.Object({code:H.Type.String(),message:H.Type.Optional(H.Type.String()),extras:H.Type.Optional(H.Type.Unknown())}),Q=H.Type.Object({ok:H.Type.Literal(!1),payload:K}),Y=function(e){function t(e){(0,L._)(this,t);var n,r,i={code:"UNCAUGHT_ERROR",message:"An unexpected error occurred"};if((0,F._)(e,$.CompletionError))i.code="UNEXPECTED_DISCONNECT",i.message="Unexpected disconnect",r=e.stack;else if((0,F._)(e,Error))i.message=e.message,r=e.stack;else if("UNEXPECTED_DISCONNECT"===e)i.code="UNEXPECTED_DISCONNECT",i.message="Unexpected disconnect";else if("UNCAUGHT_ERROR"===e)i.code="UNCAUGHT_ERROR",i.message="An unexpected error occurred";else if("string"==typeof e)i.message=e;else if(e&&(void 0===e?"undefined":(0,G._)(e))==="object"){var o=null;W.Value.Check(K,e)?o=e:W.Value.Check(Q,e)&&(o=e.payload),o&&(i.code=o.code,i.message=o.message,i.extras=o.extras)}return n=(0,P._)(this,t,[i.message]),(0,j._)(n,"ok",!1),(0,j._)(n,"payload",void 0),(0,j._)(n,"input",void 0),(0,j._)(n,"reported",void 0),n.name="ChatError",n.payload=i,n.input=e,r&&(n.stack=r),n}return(0,B._)(t,e),t}((0,V._)(Error));function X(e){return new z(e)}function J(e){return(0,F._)(e,Y)?e:new Y(e)}function Z(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?!e.ok&&n.includes(e.payload.code):!e.ok}function ee(e){if("function"==typeof e)try{var t,n=e();if((0,F._)(n,Promise))return n.then(function(e){return X(e)}).catch(function(e){return J(e)});return X(n)}catch(e){return J(e)}if((0,F._)(e,Promise))return e.then(function(e){return X(e)}).catch(function(e){return J(e)});if(Array.isArray(e)){if(0===e.length)throw Error("At least one observable is required");return(t=$.Observable).combine.apply(t,(0,q._)(e)).once().then(function(e){return X(e)}).catch(function(e){return J(e)})}return $.Observable.from(e).once().then(function(e){return X(e)}).catch(function(e){return J(e)})}e.s(["Err",()=>J,"Ok",()=>X,"get",()=>ee,"isError",()=>Z],885505)},986194,e=>{"use strict";var t=e.i(721281),n=e.i(878420),r=e.i(119468);function i(e){if(!e.$kind)throw Error("Object has an empty or undefined $kind property");if(!Object.prototype.hasOwnProperty.call(e,e.$kind))throw Error("Object has a $kind property that does not match the object");return e[e.$kind]}function o(e){var t=i(e);if((void 0===t?"undefined":(0,r._)(t))!=="object"||null===t)throw Error("Contents is not an object");if("$kind"in t)throw Error("Contents has an unexpected $kind property");return(0,n._)({$kind:e.$kind},t)}function a(e,n){return(0,t._)({$kind:e},e,n)}function s(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e&&n.includes(e.$kind)}e.s(["isKind",()=>s,"unkind",()=>i,"unwrapKind",()=>o,"withKind",()=>a])},353838,e=>{"use strict";var t=e.i(346715),n=e.i(131141),r=e.i(986194),i=e.i(188507),o={messageEventContents:{messageContentsUpdate:function(e,t){e.content+=t.content},messageContentsSet:function(e,t){e.content=t.content},addSourcesUpdate:function(e,n){var r;(r=e.sources).push.apply(r,(0,t._)(n.sources))},updateProposedFileChange:function(e,t){if((0,r.isKind)(e.extraActions,"proposedFileChanges")){var n=(0,r.unkind)(e.extraActions).changes,i=t.Update,o=t.Replacement;if(null!=i){var a=i.update,s=a.filePath,l=a.content,c=a.changeSummary,u=a.messageContentsOffset,p=a.state,d=n.find(function(e){return e.filePath===s});null!=d&&(d.content+=l,d.state=p,d.messageContentsOffset=u,c&&(d.changeSummary=c))}else if(null!=o){var y=o.replacement,f=y.filePath,h=y.content,g=y.changeSummary,T=y.state,v=y.messageContentsOffset,m=n.find(function(e){return e.filePath===f});null!=m&&(m.content=h,m.state=T,m.messageContentsOffset=v,g&&(m.changeSummary=g))}}},addProposedFileChange:function(e,t){(0,r.isKind)(e.extraActions,"proposedFileChanges")||(e.extraActions=(0,r.withKind)("proposedFileChanges",{changes:[],commitId:"",summary:""})),e.extraActions.proposedFileChanges.commitId=t.commitId,e.extraActions.proposedFileChanges.changes.push(t.change)},addProposedFileChangesMetadata:function(e,t){(0,r.isKind)(e.extraActions,"proposedFileChanges")&&(e.extraActions.proposedFileChanges.summary=t.summary)},addProposedShellCommand:function(e,t){e.assistantProposedActions.shellCommands.push(t.command)},addProposedPackageInstall:function(e,t){e.assistantProposedActions.packageInstalls.push(t.packageInstalls)},addProposedWorkspaceToolNudge:function(e,t){e.assistantProposedActions.workspaceToolNudges.push(t.nudge)},addProposedActionsMetadata:function(e,t){t.commitId&&(e.assistantProposedActions.commitId=t.commitId),t.summary&&(e.assistantProposedActions.summary=t.summary),void 0!==t.didCreateCheckpoint&&(e.assistantProposedActions.didCreateCheckpoint=t.didCreateCheckpoint),t.didCountEditRequest&&(e.assistantProposedActions.didCountEditRequest=!0),(0,r.isKind)(e.extraActions,"proposedFileChanges")&&(e.extraActions.proposedFileChanges.commitId=t.commitId,e.extraActions.proposedFileChanges.summary=t.summary)},addProposedRunConfiguration:function(e,t){e.assistantProposedActions.runConfigurations.push(t.runConfiguration)},addProposedDeploymentConfiguration:function(e,t){e.assistantProposedActions.deploymentConfigurations.push(t.deploymentConfiguration)},addProposedWorkflowConfiguration:function(e,t){e.assistantProposedActions.workflowConfigurations.push(t.workflowConfiguration)},updateAttachedFormStringFieldAppend:function(e,t){a(e,t,!0)},updateAttachedFormStringFieldSet:function(e,t){a(e,t,!1)},addRagContext:function(e,t){e.ragContext=t.newContext}},inlineActionEventContents:{messageContentsUpdate:function(e,t){e.content+=t.content},messageContentsSet:function(e,t){e.content=t.content},addSourcesUpdate:function(e,n){var r;(r=e.sources).push.apply(r,(0,t._)(n.sources))}},localShellExecutionEventContents:{localShellExecutionEventSet:function(e,t){return t.contents}},shellSuggestionEventContents:{shellSuggestionContentsUpdate:function(e,t){e.content+=t.content}},byoPromptEventContents:{byoPromptResultUpdate:function(e,t){e.jsonResult=t.jsonResult}},agentTimelineEventContents:{agentTimelineEventSet:function(e,t){return t.contents},agentTimelineEventCreateFileAddContent:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="createFileData"&&(e.toolData.createFileData.content+=t.content)},updateRevertStatus:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="revertData"&&(e.toolData.revertData.status=t.newStatus)},appendTimelineMessageContentsUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="messageData"&&(e.toolData.messageData.content+=t.content)},appendThoughtContentsUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="thoughts"&&(e.toolData.thoughts.thoughts+=t.content,e.toolData.thoughts.totalTimeTakenMs=t.totalTimeTakenMs)},newThoughtSummaryUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="thoughts"&&(e.toolData.thoughts.summary=t.summary)},appendRedactedThoughtsMarker:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="thoughts"&&e.toolData.thoughts.redactedThoughtsMarkers.push(t.marker)}},hostingDebugSummaryEventContents:{hostingDebugSummaryEventSet:function(e,t){return t.contents}},agentAskUserForActionRequest:{agentAskUserForActionRequestSet:function(e,t){return t.request}},integrationTestEventContents:{integrationTestEventContents:function(e,t){e.expectedResponseString+=t.content}},agentPlanEventContents:{addDesignReferenceFile:function(e,t){e.designReferenceFilePaths.push(t.filePath)},updatePlanContents:function(e,t){t.step&&(e.step=t.step),t.planId&&(e.planId=t.planId),t.objective&&t.objective.description&&(e.objective=t.objective),t.initialCommitId&&(e.initialCommitId=t.initialCommitId),void 0!==t.stackBlueprint&&t.stackBlueprint!==i.StackBlueprint.STACK_BLUEPRINT_NONE&&(e.stackBlueprint=t.stackBlueprint),void 0!==t.agentStackTriggerType&&t.agentStackTriggerType!==i.AgentStackTriggerType.UNKNOWN_TRIGGER_TYPE&&(e.agentStackTriggerType=t.agentStackTriggerType)}},subagentRunning:{subagentRunningDataUpdate:function(e,t){if(t.state){e.subagentId=t.state.subagentId,e.childSessionId=t.state.childSessionId,e.contents=t.state.contents;var n,r,i=Math.max(null!=(n=t.totalExecutionTimeSeconds)?n:0,null!=(r=t.state.totalExecutionTimeSeconds)?r:0);i>0&&(e.totalExecutionTimeSeconds=i)}}},uiTestingSubagentExecutionEventContents:{uiTestingSubagentExecutionEventUpdate:function(e,t){e.gcsDownloadUrl=t.state.gcsDownloadUrl,e.mimeType=t.state.mimeType,e.narration=t.state.narration,e.miniNarration=t.state.miniNarration}}};function a(e,t,n){if((null==(r=e.attachedForm)?void 0:r.formType)&&e.attachedForm.formType!==i.AttachedFormType.ATTACHED_FORM_TYPE_UNKNOWN){var r,o,a=e.attachedForm.fields.find(function(e){return e.path===t.path});a||(a={path:t.path,formType:{$kind:"string",string:{value:""}}},e.attachedForm.fields.push(a)),(null==(o=a.formType)?void 0:o.$kind)==="string"&&(a.formType.string.value=n?a.formType.string.value+t.value:t.value)}}function s(e,t){var n=new Set,i=!0,a=!1,s=void 0;try{for(var l,c=t[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u,p,d=l.value;if(!(!d.operation||n.has(d.id))){n.add(d.id);var y=null==(p=o[e.$kind])||null==(u=p[d.operation.$kind])?void 0:u.call(p,(0,r.unkind)(e),(0,r.unkind)(d.operation));y&&(e[e.$kind]=y)}}}catch(e){a=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}}function l(e){e.contents.contents&&e.typedUpdateEventOperations.length&&(s(e.contents.contents,e.typedUpdateEventOperations),e.typedUpdateEventOperations=[])}function c(e,t){var r=null;if(t.state!==e.state&&(null!=r||(r=Object.assign({},e)),r.state=t.state),(t.error.type!==e.error.type||t.error.message!==e.error.message)&&(null!=r||(r=Object.assign({},e)),r.error=t.error),!t.typedOperations.length||!e.contents.contents)return null!=r?r:e;var i=(0,n.createDraft)(e.contents.contents);s(i,t.typedOperations);var o=(0,n.finishDraft)(i);return o!==e.contents.contents&&(null!=r||(r=Object.assign({},e)),r.contents={benchmarkParameters:{datasetId:"",instanceId:"",runId:"",replDescription:"",disableSandbox:!1,commandPrefix:[],overrideShellExecuteTimeoutSeconds:0,overrideMaxSteps:0},contents:o}),null!=r?r:e}e.s(["applyEventOperations",()=>l,"applyEventUpdateMessage",()=>c])},910951,e=>{"use strict";var t=e.i(862927),n=e.i(131141),r=e.i(188507),i=e.i(878420),o=e.i(986194),a=e.i(119468),s=e.i(15053);function l(e){return(void 0===e?"undefined":(0,a._)(e))==="object"?e:"string"==typeof e?{type:r.ModelType.OVERRIDE,overrideModelName:e}:{type:e,overrideModelName:""}}var c=(0,n.freeze)(t.Value.Create(r.EventSchema),!0);function u(e){var t=e.session,n=e.parent,i=e.sender,o=e.contents,a=e.context,l=e.benchmark,u=(0,s.v4)(),p=new Date,d="localShellExecutionEventContents"===o.$kind?r.EventState.IN_PROGRESS:r.EventState.COMPLETE,y={type:r.EventErrorType.EVENT_ERROR_TYPE_UNKNOWN,message:"",shortMessage:""},f=Object.assign({},c);return f.id=u,f.parentEventId=n,f.sessionId=t,f.created=p,f.updated=p,f.state=d,f.error=y,f.sender=i,f.contents={benchmarkParameters:null!=l?l:{datasetId:"",instanceId:"",runId:"",replDescription:"",disableSandbox:!1,commandPrefix:[],overrideShellExecuteTimeoutSeconds:0,overrideMaxSteps:0},contents:o},f.context={metadata:a||void 0},f}var p={contents:(0,n.freeze)(t.Value.Create(r.AgentAskUserForActionRequestSchema),!0)},d={contents:(0,n.freeze)(t.Value.Create(r.AgentAskUserForActionResponseSchema),!0)},y={contents:(0,n.freeze)(t.Value.Create(r.AgentPlanEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.AgentPlanEventContextSchema),!0)},f={contents:(0,n.freeze)(t.Value.Create(r.ApprovePlanEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.ApprovePlanEventContextSchema),!0)},h={contents:(0,n.freeze)(t.Value.Create(r.BYOPromptEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.BYOPromptEventContextSchema),!0)},g={contents:(0,n.freeze)(t.Value.Create(r.InlineActionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.InlineActionEventContextSchema),!0),reference:(0,n.freeze)(t.Value.Create(r.CodeReferenceSchema),!0)},T=e.i(64386),v=e.i(886513),m={applied:(0,n.freeze)(t.Value.Create(r.IterativeAgentAppliedFileChangesSchema),!0),reverted:(0,n.freeze)(t.Value.Create(r.IterativeAgentRevertedFileChangesSchema),!0),contents:(0,n.freeze)(t.Value.Create(r.IterativeAgentEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.IterativeAgentEventContextSchema),!0)},S={contents:(0,n.freeze)(t.Value.Create(r.LocalShellExecutionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.LocalShellExecutionEventContextSchema),!0)},E={contents:(0,n.freeze)(t.Value.Create(r.MessageEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.MessageEventContextSchema),!0),reference:(0,n.freeze)(t.Value.Create(r.CodeReferenceSchema),!0),proposedFileChanges:(0,n.freeze)((0,o.withKind)("proposedFileChanges",{changes:[],commitId:"",summary:""}),!0)},b={contents:(0,n.freeze)(t.Value.Create(r.RevertEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.RevertEventContextSchema),!0)},C={contents:(0,n.freeze)(t.Value.Create(r.SetupImportedProjectEventContentsSchema),!0)},_={contents:(0,n.freeze)(t.Value.Create(r.ShellSuggestionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.ShellSuggestionEventContextSchema),!0)},R={contents:(0,n.freeze)(t.Value.Create(r.StepTooComplexEventContentsSchema),!0)},I={contents:(0,n.freeze)(t.Value.Create(r.TranslateEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.TranslateEventContextSchema),!0)},O={contents:(0,n.freeze)(t.Value.Create(r.TriggerCheckpointEventContentsSchema),!0)},k=(0,n.freeze)(t.Value.Create(r.CreateEventRequestSchema),!0);function A(e){var t=function(e){var t,n,a,s,c,k,A,U,w,N,M,D,x,P,L,j,B,F,q,G,V,H,W,$,z,K,Q,Y,X,J,Z,ee,et,en,er,ei,eo,ea,es,el,ec,eu,ep,ed,ey,ef,eh,eg,eT,ev,em,eS,eE,eb,eC,e_,eR,eI,eO,ek,eA,eU,ew,eN,eM,eD,ex,eP,eL,ej,eB,eF,eq=e.session,eG=e.parent,eV=e.sender,eH=e.model,eW=e.data,e$=e.benchmark;"type"in eV||(eV={id:eV.id.toString(),type:r.UserType.USER,isTeam:!1,roles:[],membership:eV.membership,orgId:"",username:"",timeCreated:eV.timeCreated,flaggingContext:"",modelfarmDisabled:!1,openrouterDisabled:!1,openaiDisabled:!1,anthropicDisabled:!1,geminiDisabled:!1,isEnterprise:!1});var ez=(0,i._)({session:eq,parent:eG,sender:eV,model:eH,benchmark:e$},eW);switch(ez.kind){case"agentPlan":return(t=Object.assign({},y.contents)).planId=ez.planId,t.objective=ez.objective,t.step=ez.step,t.stackBlueprint=ez.stackBlueprint,t.requiresApproval=ez.requiresApproval,t.Approver=ez.approved?(0,o.withKind)("approver",ez.sender):void 0,ez.approvedDesignReferenceFilePath&&(t.approvedDesignReferenceFilePath=ez.approvedDesignReferenceFilePath),ez.agentStackTriggerType&&(t.agentStackTriggerType=ez.agentStackTriggerType),u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("agentPlanEventContents",t),context:(0,o.withKind)("agentPlanEventContext",y.context)});case"approvePlan":return(a=Object.assign({},f.contents)).planEventId=ez.planEventId,a.approver=ez.approver,a.initialBuildMode=ez.initialBuildMode,a.userSecretsResponse=null!=(n=ez.userSecretsResponse)?n:{providedSecrets:[]},a.agentConfig=ez.agentConfig,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("approvePlanEventContents",a),context:null});case"byoPrompt":return s=Object.assign({},h.contents),c=Object.assign({},h.context),k=l(ez.model),s.messages=ez.messages,s.parameters=ez.parameters,s.forceJson=!1,c.modelSelector=k,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("byoPromptEventContents",s),context:(0,o.withKind)("byoPromptEventContext",c)});case"inlineAction":return M=Object.assign({},g.contents),D=Object.assign({},g.context),x=l(ez.model),M.content=ez.message,M.messageType=ez.messageType,M.codeReference=null!=(A=ez.codeReference)?A:g.reference,M.usedModelSelector=x,D.mostRecentFile=null!=(U=ez.mostRecentFile)?U:"",D.fileContext=null!=(w=ez.fileContext)?w:[],D.modelSelector=x,D.useRag=null!=(N=ez.useRag)&&N,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("inlineActionEventContents",M),context:(0,o.withKind)("inlineActionEventContext",D)});case"iterativeAgent":return function(e){var t=Object.assign({},m.contents);if("appliedChanges"in e.action){var n=Object.assign({},m.applied);n.eventWhichProposedChanges=e.action.eventIdWhichProposedChanges,n.appliedChanges=e.action.appliedChanges,n.commitHash=e.action.commitHash,t.contents=(0,o.withKind)("appliedFileChanges",n)}else if("revertedChanges"in e.action){var r=Object.assign({},m.reverted);r.eventWhichProposedChanges=e.action.eventIdWhichProposedChanges,r.eventWhichAppliedChanges=e.action.eventIdWhichAppliedChanges,r.revertedChanges=e.action.revertedChanges,t.contents=(0,o.withKind)("revertedFileChanges",r)}else if("eventIdWhichProposedPackageInstall"in e.action)if("installationOutput"in e.action){var a=e.action,s=a.eventIdWhichProposedPackageInstall,l=(0,v._)(a,["eventIdWhichProposedPackageInstall"]);t.contents=(0,o.withKind)("installedPackages",(0,T._)((0,i._)({},l),{eventWhichProposedPackageInstall:s}))}else{var c=e.action,p=c.eventIdWhichProposedPackageInstall,d=(0,v._)(c,["eventIdWhichProposedPackageInstall"]);t.contents=(0,o.withKind)("installingPackages",(0,T._)((0,i._)({},d),{eventWhichProposedPackageInstall:p}))}else if("eventIdWhichProposedShellExecution"in e.action)if("commandOutput"in e.action){var y=e.action,f=y.eventIdWhichProposedShellExecution,h=(0,v._)(y,["eventIdWhichProposedShellExecution"]);t.contents=(0,o.withKind)("finishedShellExecution",(0,T._)((0,i._)({},h),{eventWhichProposedShellExecution:f}))}else{var g=e.action,S=g.eventIdWhichProposedShellExecution,E=(0,v._)(g,["eventIdWhichProposedShellExecution"]);t.contents=(0,o.withKind)("startedShellExecution",(0,T._)((0,i._)({},E),{eventWhichProposedShellExecution:S}))}else if("eventIdWhichProposedRunConfiguration"in e.action){var b=e.action,C=b.eventIdWhichProposedRunConfiguration,_=(0,v._)(b,["eventIdWhichProposedRunConfiguration"]);t.contents=(0,o.withKind)("appliedRunConfiguration",(0,T._)((0,i._)({},_),{eventWhichProposedRunConfiguration:C}))}else if("eventIdWhichProposedDeploymentConfiguration"in e.action){var R=e.action,I=R.eventIdWhichProposedDeploymentConfiguration,O=(0,v._)(R,["eventIdWhichProposedDeploymentConfiguration"]);t.contents=(0,o.withKind)("appliedDeploymentConfiguration",(0,T._)((0,i._)({},O),{eventWhichProposedDeploymentConfiguration:I}))}else if("eventIdWhichProposedWorkflowConfiguration"in e.action){var k=e.action,A=k.eventIdWhichProposedWorkflowConfiguration,U=(0,v._)(k,["eventIdWhichProposedWorkflowConfiguration"]);t.contents=(0,o.withKind)("appliedWorkflowConfiguration",(0,T._)((0,i._)({},U),{eventWhichProposedWorkflowConfiguration:A}))}return u({session:e.session,parent:e.parent,sender:e.sender,contents:(0,o.withKind)("iterativeAgentEventContents",t),context:(0,o.withKind)("iterativeAgentEventContext",m.context)})}(ez);case"localShellExecution":return(P=Object.assign({},S.contents)).command=ez.command,P.channelName=ez.channelName,P.eventId=ez.event,P.index=0,P.result="",P.exitCode=0,P.executed=!1,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("localShellExecutionEventContents",P),context:(0,o.withKind)("localShellExecutionEventContext",S.context)});case"message":return eI=Object.assign({},E.contents),eO=Object.assign({},E.context),ek=l(ez.model),eI.content=ez.message,eI.intent=ez.intent,eI.media=null!=(z=ez.media)?z:[],eI.codeReference=null!=(K=ez.codeReference)?K:E.reference,eI.usedModelSelector=ek,eI.sources=null!=(Q=ez.sources)?Q:[],eI.extraActions=null!=(Y=ez.extraActions)?Y:E.proposedFileChanges,eI.agentAction=null!=(X=ez.agentAction)?X:{},eI.uploadedFiles=null!=(J=ez.uploadedFiles)?J:[],eI.attachedUrls=null!=(Z=ez.attachedUrls)?Z:[],ez.requestedStackBlueprint&&(eI.requestedStackBlueprint=ez.requestedStackBlueprint),ez.agentStackTriggerType&&(eI.agentStackTriggerType=ez.agentStackTriggerType),eI.customStackReplId=null!=(ee=ez.customStackReplId)?ee:"",eI.themeConfig=null!=(et=ez.themeConfig)?et:"",eI.attachedForm=null!=(en=ez.attachedForm)?en:{formType:r.AttachedFormType.ATTACHED_FORM_TYPE_UNKNOWN,fields:[]},eI.enableDeepThinking=null!=(er=ez.enableDeepThinking)&&er,eO.intent=ez.intent,eO.mostRecentFile=null!=(ei=ez.mostRecentFile)?ei:"",eO.fileContext=null!=(eo=ez.fileContext)?eo:[],eO.modelSelector=ek,eO.useRag=null!=(ea=ez.useRag)&&ea,eO.extraResources=null!=(es=ez.extraResources)?es:[],eO.agentConfig={maxSteps:0,modelProfile:null!=(el=null==(L=ez.agentConfig)?void 0:L.modelProfile)?el:r.ModelProfile.MODEL_PROFILE_STANDARD,thinkingEnabled:null==(j=ez.agentConfig)?void 0:j.thinkingEnabled,enableAutomatedTesting:null==(B=ez.agentConfig)?void 0:B.enableAutomatedTesting,samplingRate:null!=(ec=null==(F=ez.agentConfig)?void 0:F.samplingRate)?ec:0,webSearchEnabled:null!=(eu=null==(q=ez.agentConfig)?void 0:q.webSearchEnabled)&&eu,imageGenerationEnabled:null!=(ep=null==(G=ez.agentConfig)?void 0:G.imageGenerationEnabled)&&ep,agentMode:null!=(ed=null==(V=ez.agentConfig)?void 0:V.agentMode)?ed:r.AgentMode.AGENT_MODE_UNSPECIFIED,initialBuildMode:null!=(ey=null==(H=ez.agentConfig)?void 0:H.initialBuildMode)?ey:r.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_UNSPECIFIED,maxAutonomyEnabled:null!=(ef=null==(W=ez.agentConfig)?void 0:W.maxAutonomyEnabled)&&ef,autonomyLevel:null!=(eh=null==($=ez.agentConfig)?void 0:$.autonomyLevel)?eh:r.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED},ez.webviewTargetedElement&&(eI.targetedElement=ez.webviewTargetedElement),void 0!==ez.quickEdit&&(eI.quickEdit=ez.quickEdit),ez.agentConfig&&(eI.agentConfig={maxSteps:0,modelProfile:null!=(ev=ez.agentConfig.modelProfile)?ev:r.ModelProfile.MODEL_PROFILE_STANDARD,thinkingEnabled:ez.agentConfig.thinkingEnabled,enableAutomatedTesting:ez.agentConfig.enableAutomatedTesting,samplingRate:null!=(em=ez.agentConfig.samplingRate)?em:0,webSearchEnabled:null!=(eS=null==(eg=ez.agentConfig)?void 0:eg.webSearchEnabled)&&eS,imageGenerationEnabled:null!=(eE=null==(eT=ez.agentConfig)?void 0:eT.imageGenerationEnabled)&&eE,agentMode:null!=(eb=ez.agentConfig.agentMode)?eb:r.AgentMode.AGENT_MODE_UNSPECIFIED,initialBuildMode:null!=(eC=ez.agentConfig.initialBuildMode)?eC:r.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_UNSPECIFIED,maxAutonomyEnabled:null!=(e_=ez.agentConfig.maxAutonomyEnabled)&&e_,autonomyLevel:null!=(eR=ez.agentConfig.autonomyLevel)?eR:r.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED}),u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("messageEventContents",eI),context:(0,o.withKind)("messageEventContext",eO)});case"revert":return(eA=Object.assign({},b.contents)).eventIdBeforeRevert=ez.eventIdBeforeRevert,eA.commitId=ez.commitHash,eA.message=ez.commitMessage,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("revertEventContents",eA),context:(0,o.withKind)("revertEventContext",b.context)});case"shellSuggestion":return eU=Object.assign({},_.contents),ew=Object.assign({},_.context),eN=l(ez.model),eU.content=ez.message,ew.modelSelector=eN,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("shellSuggestionEventContents",eU),context:(0,o.withKind)("shellSuggestionEventContext",ew)});case"translate":return(eM=Object.assign({},I.contents)).content=ez.content,eM.inputTarget=ez.inputTarget,eM.outputTarget=ez.outputTarget,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("translateEventContents",eM),context:(0,o.withKind)("translateEventContext",I.context)});case"stepTooComplex":return(eD=Object.assign({},R.contents)).state=ez.state,eD.stepId=ez.stepId,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("stepTooComplexEventContents",eD),context:null});case"agentAskUserForActionResponse":return(ex=Object.assign({},d.contents)).response=ez.response,ex.requestEventId=ez.requestEventId,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("agentAskUserForActionResponse",ex),context:null});case"agentAskUserForActionRequest":return(eP=Object.assign({},p.contents)).request=ez.request,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("agentAskUserForActionRequest",eP),context:null});case"requestFeatureAdd":return u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:{$kind:"requestFeatureAddData",requestFeatureAddData:{type:ez.feature}},context:null});case"triggerCheckpoint":return(eB=Object.assign({},O.contents)).description=ez.description,eB.onlyIfDiff=null!=(eL=ez.onlyIfDiff)&&eL,eB.author=null!=(ej=ez.author)?ej:r.CommitAuthor.COMMIT_AUTHOR_AGENT,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("triggerCheckpointEventContents",eB),context:null});case"setupImportedProject":return(eF=Object.assign({},C.contents)).importSource=ez.importSource,eF.agentConfig=ez.agentConfig,u({session:ez.session,parent:ez.parent,sender:ez.sender,contents:(0,o.withKind)("setupImportedProjectEventContents",eF),context:null})}}(e),n=Object.assign({},k);return n.addToChild=e.addToChild,n.state=t.state,n.sessionId=t.sessionId,n.parentEventId=t.parentEventId,n.eventId=t.id,n.context=t.context,n.contents=t.contents,{event:t,request:n}}e.s(["createEventRequest",()=>A],910951)},590225,e=>{"use strict";var t=e.i(862927),n=e.i(131141),r=e.i(188507),i=(0,n.freeze)(t.Value.Create(r.UpdateEventMessageSchema),!0);function o(e){var t,n,o=Object.assign({},i);return o.eventId=e.id,o.state=null!=(t=e.state)?t:r.EventState.COMPLETE,o.typedOperations=null!=(n=e.typedOperations)?n:[],o}e.s(["createUpdateEventRequest",()=>o])},576106,e=>{"use strict";var t=e.i(862927),n=e.i(131141);e.i(660670);var r=e.i(957410),i=e.i(986194),o=e.i(188507),a={session:(0,n.freeze)(t.Value.Create(o.SessionSchema),!0),data:(0,n.freeze)(t.Value.Create(r.SessionDataSchema),!0),create:(0,n.freeze)(t.Value.Create(o.CreateSessionRequestSchema),!0),update:(0,n.freeze)(t.Value.Create(o.UpdateSessionRequestSchema),!0)};function s(e){var t,n=Object.assign({},a.create);return n.title=null!=(t=e.title)?t:"",n.sessionType=e.sessionType,n.replId=e.replId,n.SeededAiFirstEventContents=e.seededEvent?(0,i.withKind)("seededAiFirstEventContents",{benchmarkParameters:{datasetId:"",instanceId:"",runId:"",replDescription:"",disableSandbox:!1,commandPrefix:[],overrideShellExecuteTimeoutSeconds:0,overrideMaxSteps:0},contents:e.seededEvent}):void 0,e.taskId&&(n.taskId=e.taskId),n}function l(e,t){var r=(0,n.produce)(e,function(e){var n,r,i,o,a;e.title=null!=(n=t.title)?n:e.title,e.sessionType=null!=(r=t.sessionType)?r:e.sessionType,e.archived=null!=(i=t.archived)?i:e.archived,e.readOnly=null!=(o=t.readOnly)?o:e.readOnly,e.taskId=null!=(a=t.taskId)?a:e.taskId}),i=Object.assign({},a.update);return i.id=r.id,i.title=r.title,i.sessionType=r.sessionType,i.replId=r.replId,i.activeEventId=r.activeEventId,void 0!==t.archived&&r.archived!==e.archived&&(i.archived=r.archived),void 0!==t.readOnly&&r.readOnly!==e.readOnly&&(i.readOnly=r.readOnly),void 0!==t.taskId&&r.taskId!==e.taskId&&(i.taskId=r.taskId),void 0!==t.isActiveAgentSession&&(i.isActiveAgentSession=t.isActiveAgentSession,r===e&&(r=Object.assign({},r))),{session:r,request:i}}function c(e){var t=Object.assign({},a.session),n=new Date;return t.id=e.sessionId,t.title=e.title,t.sessionType=e.sessionType,t.replId=e.replId,t.sessionCreationEventId=e.sessionCreationEventId,t.archived=!!e.archived,t.taskId=e.taskId,t.lastEventTime=n,t.created=n,t.updated=n,t.revertedToSessionId=e.revertedToSessionId,t.revertedToEventId=e.revertedToEventId,t}function u(e,t){return(0,n.produce)(e,function(e){var n,r;e.title=t.title,e.sessionType=t.sessionType,e.archived=null!=(n=t.archived)?n:e.archived,e.activeEventId=t.activeEventId,e.readOnly=null!=(r=t.readOnly)?r:e.readOnly})}function p(e,t){var n=Object.assign({},a.session);return n.id=t.id,n.title=t.title,n.sessionType=t.sessionType,n.replId=e,n.sessionCreationEventId=t.sessionCreationEventId,n.archived=t.archived,n.lastEventTime=t.created,n.created=t.created,n.updated=t.updated,n.readOnly=t.readOnly,n.taskId=t.taskId,n}function d(e){var t=Object.assign({},a.data);return t.id=e.id,t.title=e.title,t.sessionType=e.sessionType,t.sessionCreationEventId=e.sessionCreationEventId,t.archived=e.archived,t.readOnly=e.readOnly,t.taskId=e.taskId,t.created=e.created,t.updated=e.updated,t}e.s(["applySessionUpdateMessage",()=>u,"compatDataToSession",()=>p,"compatSessionToData",()=>d,"createSessionFromCreateSessionMessage",()=>c,"createSessionRequest",()=>s,"createUpdateSessionRequest",()=>l])},877212,51553,204203,970187,765695,334712,145864,165680,805763,e=>{"use strict";e.i(267710),e.i(33699);var t=e.i(530658),n=e.i(276385),r=e.i(389959),i=e.i(971131),o=e.i(906368),a=e.i(541793),s=e.i(188507),l=e.i(644464),c=e.i(952098),u=e.i(600637),p=e.i(924908),d=e.i(904851),y=e.i(90659),f=e.i(721281),h=e.i(297083),g=e.i(817556);e.i(242933);var T=e.i(424360),v=e.i(885505),m=e.i(394212),S=e.i(119468),E=e.i(281128);e.i(660670);var b=e.i(813702),C=e.i(353838),_=e.i(910951),R=e.i(590225),I=e.i(576106),O=e.i(986194);function k(e){return{state:e.runState,reason:e.transitionReason.reasons?(0,O.unwrapKind)(e.transitionReason.reasons):null}}var A=function(){function e(t,n){var r=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"active",new T.Multicast(function(e){return r.api.currentAgentSession.select(function(e){return!!e&&e.id===r.session.id}).subscribe(e)})),(0,f._)(this,"state",new T.Multicast(function(e){var t=null,n=null,i=!1,o=r.api.state.register({snapshot:function(){return t},rollback:function(e){return t=e},notify:function(){return e.next(t)},update:function(e){var n=!1;if("agent-state-modified"===e.kind&&e.session===r.session.id&&(t=e.state,n=!0),e.optimistic||c(),n)return!0}}),a=function(){return(0,h._)(function(){var r,a,s,l;return(0,g._)(this,function(u){switch(u.label){case 0:n=null,i=!0,u.label=1;case 1:return u.trys.push([1,,3,4]),[4,this.api.service.getAgentState.rpc({replId:this.api.replId,sessionId:this.session.id})];case 2:if(r=u.sent(),(0,v.isError)(r,"UNEXPECTED_DISCONNECT"))return[2];if(!r.ok)return[2,this.api.error(r,e)];return(a=k(r.payload)).state!==(null==t?void 0:t.state)&&(null==(s=(l=this.api.logger).warn)||s.call(l,"state transition was manually corrected"),t=a,o.commit(),e.next(t)),[3,4];case 3:return i=!1,c(),[7];case 4:return[2]}})}).call(r)},l=function(){null!==n&&(clearTimeout(n),n=null)},c=function(){l(),i||(null==t?void 0:t.state)!==s.AgentRunState.AGENT_STATE_RUNNING||(n=setTimeout(a,1e4))},u=r.api.connected.lift(e,function(n){return(0,h._)(function(){var r,i;return(0,g._)(this,function(a){switch(a.label){case 0:return[4,(0,v.get)(this.active)];case 1:if(r=a.sent(),n.aborted||(0,v.isError)(r,"UNEXPECTED_DISCONNECT"))return[2];if(!r.ok)return[2,this.api.error(r,e)];if(!r.payload)return t=null,o.commit(),e.next(t),[2];return[4,this.api.service.getAgentState.rpc({replId:this.api.replId,sessionId:this.session.id})];case 2:if(i=a.sent(),n.aborted||(0,v.isError)(i,"UNEXPECTED_DISCONNECT"))return[2];if(!i.ok)return[2,this.api.error(i,e)];return t=k(i.payload),o.commit(),e.next(t),c(),[2]}})}).call(r)});return function(){l(),o.unsubscribe(),u.unsubscribe()}})),this.api=t,this.session=n}return(0,y._)(e,[{key:"update",value:function(e){return(0,h._)(function(){var n,r,i,o,a,s;return(0,g._)(this,function(l){switch(l.label){case 0:return[4,(0,v.get)(this.state)];case 1:if(!(n=l.sent()).ok)return[2,this.api.error(n)];if(!n.payload)return[2,this.api.error("session is not an agent session")];if(r=(0,E.create)(n.payload,function(t){t.state=e}),n.payload===r)return[2,(0,v.Ok)(n.payload)];return o=(i=(0,t._)(this.api.state.stage({kind:"agent-state-modified",session:this.session.id,state:{state:e,reason:null}}),2))[0],a=i[1],[4,this.api.service.updateAgentState.rpc({replId:this.api.replId,sessionId:this.session.id,runState:e,transitionReason:{}})];case 2:if(!(s=l.sent()).ok)return a(),[2,this.api.error(s)];if(s.payload.runState!==e)return a(),[2,(0,v.Ok)(k(s.payload))];return this.api.hooks.trigger("client-updated-agent-state",{session:this.session,prev:n.payload,next:r}),o(),[2,(0,v.Ok)(r)]}})}).call(this)}},{key:"warmup",value:function(){return(0,h._)(function(){var t,n,r,i,o;return(0,g._)(this,function(a){switch(a.label){case 0:if((t=e.lastWarmTimeMap.get(this.api))||(t=new Map,e.lastWarmTimeMap.set(this.api,t)),n=Date.now(),(r=t.get(this.session.id))&&n-r<24e4)return[2,(0,v.Ok)(null)];return[4,(0,v.get)(this.state)];case 1:if(!(i=a.sent()).ok)return[2,this.api.error(i)];if(!i.payload)return[2,this.api.error("session is not an agent session")];if(i.payload.state===s.AgentRunState.AGENT_STATE_RUNNING||i.payload.state===s.AgentRunState.AGENT_STATE_PAUSING)return[2,(0,v.Ok)(null)];return t.set(this.session.id,n),[4,this.api.service.warmAgent.rpc({replId:this.api.replId,sessionId:this.session.id})];case 2:if(!(o=a.sent()).ok)return[2,this.api.error(o)];return[2,(0,v.Ok)(null)]}})}).call(this)}},{key:"usage",value:function(e){return this.api.createUsageWatcher({sessionId:this.session.id,start:e})}}]),e}();(0,f._)(A,"lastWarmTimeMap",new WeakMap);var U=e.i(399119),w=e.i(445789),N=e.i(279606),M=function(){function e(n){if((0,d._)(this,e),(0,f._)(this,"forward",new Map),(0,f._)(this,"reverse",new Map),n){var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=(0,t._)(a.value,2),c=l[0],u=l[1];this.set(c,u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}return(0,y._)(e,[{key:"size",get:function(){return this.forward.size}},{key:"keys",value:function(){return this.forward.keys()}},{key:"values",value:function(){return this.reverse.keys()}},{key:"entries",value:function(){return this.forward.entries()}},{key:"hasKey",value:function(e){return this.forward.has(e)}},{key:"hasValue",value:function(e){return this.reverse.has(e)}},{key:"getValue",value:function(e){var t=this.forward.get(e);if(void 0===t)throw Error("key does not exist");return t}},{key:"getKey",value:function(e){var t=this.reverse.get(e);if(void 0===t)throw Error("value does not exist");return t}},{key:"set",value:function(e,t){var n=this.reverse.get(t),r=this.forward.get(e);this.forward.set(e,t),this.reverse.set(t,e),void 0!==n&&n!==e&&this.forward.delete(n),void 0!==r&&r!==t&&this.reverse.delete(r)}},{key:"deleteKey",value:function(e){var t=this.forward.get(e);void 0!==t&&(this.forward.delete(e),this.reverse.delete(t))}},{key:"deleteValue",value:function(e){var t=this.reverse.get(e);void 0!==t&&(this.reverse.delete(e),this.forward.delete(t))}},{key:"clear",value:function(){this.forward.clear(),this.reverse.clear()}},{key:Symbol.iterator,value:function(){return this.forward.entries()}}]),e}(),D=function(){function e(t){if((0,d._)(this,e),(0,f._)(this,"map",new M),(0,f._)(this,"offset",0),(0,f._)(this,"length",0),t){for(var n=0;n<t.length;n++)this.map.set(n,t[n]);this.length=t.length}}return(0,y._)(e,[{key:"first",get:function(){return this.length?this.map.getValue(0+this.offset):null}},{key:"last",get:function(){return this.length?this.map.getValue(this.map.size-1+this.offset):null}},{key:"peek",value:function(e){return -1===e?this.first:this.last}},{key:"has",value:function(e){return"number"==typeof e?this.map.hasKey(e-this.offset):this.map.hasValue(e)}},{key:"index",value:function(e){return this.map.getKey(e)-this.offset}},{key:"id",value:function(e){return this.map.getValue(e+this.offset)}},{key:"dir",value:function(e,t){var n=this.map.getKey(e),r=this.map.getKey(t);return n<r?1:n>r?-1:0}},{key:"append",value:function(e){for(var t=0;t<e.length;t++)this.map.set(this.map.size+this.offset,e[t]);this.length=this.map.size}},{key:"prepend",value:function(e){for(var t=e.length-1;t>=0;t--)this.offset--,this.map.set(0+this.offset,e[t]);this.length=this.map.size}},{key:"pop",value:function(){if(!this.last)return null;var e=this.last;return this.map.deleteValue(e),this.length=this.map.size,this.offset=this.map.size?this.offset:0,e}},{key:"shift",value:function(){if(!this.first)return null;var e=this.first;return this.map.deleteValue(e),this.length=this.map.size,this.offset=this.map.size?this.offset+1:0,e}},{key:"parent",value:function(e){var t=this.map.getKey(e);return t!==0+this.offset?this.map.getValue(t-1):null}},{key:"child",value:function(e){var t=this.map.getKey(e);return t!==this.map.size-1+this.offset?this.map.getValue(t+1):null}},{key:"adjacent",value:function(e,t){return -1===t?this.parent(e):this.child(e)}},{key:"slice",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-1;if(0===this.length)return[];var r=0+this.offset,i=this.map.size-1+this.offset,o="number"==typeof t?Math.min(Math.max(t+this.offset,r),i):this.map.getKey(t),a="number"==typeof n?Math.max(Math.min(n+this.offset,i),r):this.map.getKey(n),s=o>a;s&&(o=(e=[a,o])[0],a=e[1]);for(var l=[],c=o;c<=a;c++)l.push(this.map.getValue(c));return s?l.reverse():l}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.first,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.last;if(t&&!e.has(t)||n&&!e.has(n))throw Error("invalid merge");if(!t||!n){if(this.map.size){var r=Array.from(this.map.values());return this.clear(),{removed:r,added:[]}}return null}var i=e.slice(t,n),o=new Set(this.map.values()),a=new Set(o),s=new Set(i),l=!0,c=!1,u=void 0;try{for(var p,d=i[Symbol.iterator]();!(l=(p=d.next()).done);l=!0){var y=p.value;a.delete(y)}}catch(e){c=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}var f=!0,h=!1,g=void 0;try{for(var T,v=o[Symbol.iterator]();!(f=(T=v.next()).done);f=!0){var m=T.value;s.delete(m)}}catch(e){h=!0,g=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw g}}return a.size||s.size?(this.clear(),this.append(i),{removed:Array.from(a),added:Array.from(s)}):null}},{key:"clear",value:function(){this.map.clear(),this.offset=0,this.length=0}},{key:"clone",value:function(){var t=new e;return t.map=new M(this.map),t.offset=this.offset,t.length=this.length,t}}]),e}(),x=function(){function e(t){(0,d._)(this,e),(0,f._)(this,"ids",new D),(0,f._)(this,"events",new Map),(0,f._)(this,"incomplete",new Set),(0,f._)(this,"length",0),t&&this.append(t)}return(0,y._)(e,[{key:"set",value:function(e){this.events.set(e.id,e),e.state!==s.EventState.COMPLETE?this.incomplete.add(e.id):this.incomplete.delete(e.id)}},{key:"delete",value:function(e){this.events.delete(e),this.incomplete.delete(e)}},{key:"first",get:function(){return this.ids.first?this.get(this.ids.first):null}},{key:"last",get:function(){return this.ids.last?this.get(this.ids.last):null}},{key:"peek",value:function(e){return -1===e?this.first:this.last}},{key:"index",value:function(e){return this.ids.index(e)}},{key:"id",value:function(e){return this.ids.id(e)}},{key:"dir",value:function(e,t){return this.ids.dir(e,t)}},{key:"has",value:function(e){return this.ids.has(e)}},{key:"get",value:function(e){e="number"==typeof e?this.id(e):e;var t=this.events.get(e);if(!t)throw Error("event does not exist");return t}},{key:"append",value:function(e){this.ids.append(e.map(function(e){return e.id})),this.length=this.ids.length;var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.set(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"prepend",value:function(e){this.ids.prepend(e.map(function(e){return e.id})),this.length=this.ids.length;var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.set(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"pop",value:function(){var e,t=this.ids.pop(),n=t&&null!=(e=this.events.get(t))?e:null;if(t&&!n)throw Error("Unexpected null for popped event");return t&&n&&(this.delete(t),this.length--),n}},{key:"shift",value:function(){var e,t=this.ids.shift(),n=t&&null!=(e=this.events.get(t))?e:null;if(t&&!n)throw Error("Unexpected null for shifted event");return t&&n&&(this.delete(t),this.length--),n}},{key:"parent",value:function(e){var t=this.index(e);return t>0?this.get(t-1):null}},{key:"child",value:function(e){var t=this.index(e);return t<this.length-1?this.get(t+1):null}},{key:"adjacent",value:function(e,t){return -1===t?this.parent(e):this.child(e)}},{key:"slice",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-1;return this.ids.slice(t,n).map(function(t){return e.get(t)})}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.ids.first,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.ids.last,r=this.ids.patch(e.ids,t,n);this.length=this.ids.length;var i=!this.events.size,o=null,a=null;if(r){null!=o||(o={removed:[],added:[],changed:[]});var l=!0,c=!1,u=void 0;try{for(var p,d=r.removed[Symbol.iterator]();!(l=(p=d.next()).done);l=!0){var y=p.value;o.removed.push(this.get(y)),this.delete(y)}}catch(e){c=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}var f=!0,h=!1,g=void 0;try{for(var T,v=r.added[Symbol.iterator]();!(f=(T=v.next()).done);f=!0){var m=T.value,S=e.get(m);o.added.push(S),this.set(S),i||(null!=a||(a=new Set),a.add(m))}}catch(e){h=!0,g=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw g}}}if(i)return o;for(var E=new Set(this.incomplete),b=this.length-1;b>=0;b--){var C=this.ids.id(b);if(E.delete(C),null==a||!a.has(C)){var _=e.events.get(C);if(_&&_!==this.events.get(C)){null!=o||(o={removed:[],added:[],changed:[]}),o.changed.push(_),this.set(_);continue}if(!E.size&&_&&_.state===s.EventState.COMPLETE)break}}return o}},{key:"adopt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.first,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.last;if(!n||!r){if(!this.length)return null;var i=Array.from(this.events.values());return this.clear(),{removed:i,added:[],changed:[],missing:[]}}if(!(null==t?void 0:t.size)&&!this.length)return{removed:[],added:[],changed:[],missing:e.slice(n,r)};for(var o=[],a=[],s=null,l=null,c=e.index(n),u=e.index(r),p=u;p>=c;p--){var d=e.id(p);if(!(null==t?void 0:t.has(d))&&!this.events.has(d)){o.push(d),l&&!s&&(s=e.child(d));continue}if(null!=l||(l=d),s){o.push(d);continue}if((null==t?void 0:t.has(d))&&this.events.has(d)){var y=null==t?void 0:t.get(d);y&&this.events.get(d)!==y&&(a.push(y),this.set(y))}}if(!l&&!s){if(!this.length&&!o.length)return null;var f=Array.from(this.events.values());return this.clear(),{removed:f,added:[],changed:[],missing:o}}s||(s=n),l||(l=r);var h=this.ids.patch(e,s,l);if(this.length=this.ids.length,!h)return o.length||a.length?{removed:[],added:[],changed:a,missing:o}:null;var g=[],T=[],v=!0,m=!1,S=void 0;try{for(var E,b=h.removed[Symbol.iterator]();!(v=(E=b.next()).done);v=!0){var C=E.value;g.push(this.get(C)),this.delete(C)}}catch(e){m=!0,S=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw S}}var _=!0,R=!1,I=void 0;try{for(var O,k=h.added[Symbol.iterator]();!(_=(O=k.next()).done);_=!0){var A=O.value,U=null==t?void 0:t.get(A);if(!U)throw Error("unexpected null");T.push(U),this.set(U)}}catch(e){R=!0,I=e}finally{try{_||null==k.return||k.return()}finally{if(R)throw I}}return{removed:g,added:T,changed:a,missing:o}}},{key:"clear",value:function(){this.ids.clear(),this.events.clear(),this.incomplete.clear(),this.length=0}},{key:"clone",value:function(){var t=new e;return t.ids=this.ids.clone(),t.events=new Map(this.events),t.incomplete=new Set(this.incomplete),t}}]),e}(),P=Object.prototype.hasOwnProperty;function L(e,t,n){var r=!0,i=!1,o=void 0;try{for(var a,s=e.keys()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0)if(n=a.value,j(n,t))return n}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}function j(e,t){var n,r,i;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((r=e.length)===t.length)for(;r--&&j(e[r],t[r]););return -1===r}if(n===Set){if(e.size!==t.size)return!1;var o=!0,a=!1,s=void 0;try{for(var l,c=e[Symbol.iterator]();!(o=(l=c.next()).done);o=!0)if((i=r=l.value)&&(void 0===i?"undefined":(0,S._)(i))==="object"&&!(i=L(t,i))||!t.has(i))return!1}catch(e){a=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(a)throw s}}return!0}if(n===Map){if(e.size!==t.size)return!1;var u=!0,p=!1,d=void 0;try{for(var y,f=e[Symbol.iterator]();!(u=(y=f.next()).done);u=!0)if((i=(r=y.value)[0])&&(void 0===i?"undefined":(0,S._)(i))==="object"&&!(i=L(t,i))||!j(r[1],t.get(i)))return!1}catch(e){p=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(p)throw d}}return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((r=e.byteLength)===t.byteLength)for(;r--&&e.getInt8(r)===t.getInt8(r););return -1===r}if(ArrayBuffer.isView(e)){if((r=e.byteLength)===t.byteLength)for(;r--&&e[r]===t[r];);return -1===r}if(!n||(void 0===e?"undefined":(0,S._)(e))==="object"){for(n in r=0,e)if(P.call(e,n)&&++r&&!P.call(t,n)||!(n in t)||!j(e[n],t[n]))return!1;return Object.keys(t).length===r}}return e!=e&&t!=t}var B=function(){function e(t){var n=t.api,r=t.session,i=t.direction,o=t.initial,a=t.transducer;if((0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"direction",void 0),(0,f._)(this,"initial",void 0),(0,f._)(this,"transducer",void 0),this.api=n,this.session=r,this.direction=i,this.initial=o,this.transducer=a,!(0,E.isDraftable)(o))throw Error("state must be draftable")}return(0,y._)(e,[{key:"compute",value:function(e,n,r){var i=(0,t._)((0,E.create)([n,void 0]),2),o=i[0],a=i[1];o[1]=this.transducer(e,o[0]);var s=a();return s[0]!==n&&r&&j(s[0],r)&&(s[0]=r),s}},{key:"step",value:function(e,n,r){var i=r.id,o=-this.direction,a=e.peek(o);a&&(a=i===a||r===a?a:e.adjacent(i,o)),a&&(a="string"!=typeof a?a.id:a);var s=i===a?this.initial:a&&n.get(a),l=n.get(i);if(!s)throw Error("starting state not found");var c=(0,t._)(this.compute(r,s,l),2),u=c[0],p=c[1],d=u!==s||!l||u!==l;return d&&n.set(i,u),{ret:p,recomputing:d}}},{key:"indexed",value:function(e,t){for(var n=this,r=Array(t.length),i=0;i<t.length;i++){var o=t[i],a="string"==typeof o?o:o.id;r[i]=e.index(a)}return r.sort(function(e,t){return(e-t)*n.direction}),r}}]),e}(),F=((ee=F||{})[ee.PEEK=10]="PEEK",ee[ee.SCAN=150]="SCAN",ee[ee.TRAVERSE=500]="TRAVERSE",ee),q=function(e){function t(e,n,r){var i,o;return(0,d._)(this,t),i=(0,U._)(this,t,[{api:e,session:n,direction:"forward"===r.direction?1:-1,initial:r.state,transducer:r.reducer}]),(0,f._)(i,"map",void 0),(0,f._)(i,"result",new T.Multicast(function(e){var t=new D,n=new Set,r=new Map,o=null,a=null,s=10,l=function(){if(!n.size)return!1;for(var e=i.indexed(t,Array.from(n)),o=e[0],l=!1;o>=0&&o<t.length;){var c=t.id(o),u=o===e[0];if(a&&a!==c&&t.dir(c,a)!==i.direction)break;var p=i.api.materializer.get(c);if(!p){if(n.add(c),l)switch(s){case 10:s=150;break;case 150:s=500}var d=Math.max(o+(s-1)*i.direction,0);u&&e.length>1&&(d=1===i.direction?Math.min(d,e[e.length-1]):Math.max(d,e[e.length-1]));var y=t.slice(o,d);return i.api.materializer.enqueue(i.session.id,y),!1}u&&(e.shift(),n.delete(c));var f=i.step(t,r,p),h=f.ret,g=f.recomputing;if(l||(l=u||g||!1===h),!1===h){a=p.id;break}if(p.id===a&&(a=null),g||e.length){o=g?o+i.direction:e[0];continue}break}return n.size||(s=10),l},c=function(){var n;if(t.length){var s=null!=a?a:t.peek(i.direction);n=s?r.get(s):void 0}else n=i.initial;if(void 0===n)throw Error("unexpected undefined");o!==n&&(o=n,e.next(i.map(n)))},u=i.api.state.register({snapshot:function(){return{ids:t.clone(),pending:new Set(n),states:new Map(r),stop:a,batchSize:s}},rollback:function(e){t=e.ids,n=e.pending,r=e.states,a=e.stop,s=e.batchSize},notify:function(){return c()},update:function(e){if("event-modified"===e.kind&&t.has(e.event.id))return n.add(e.event.id),l()}}),p=i.api.materializer.events.lift(e,function(e){e.filter(function(e){var t=e.id;return n.has(t)}).length&&l()&&c()}),d=i.session.ids.lift(e,function(e){var i=t.patch(e);if(i){var o=!0,s=!1,u=void 0;try{for(var p,d=i.removed[Symbol.iterator]();!(o=(p=d.next()).done);o=!0){var y=p.value;r.delete(y),n.delete(y),y===a&&(a=null)}}catch(e){s=!0,u=e}finally{try{o||null==d.return||d.return()}finally{if(s)throw u}}var f=!0,h=!1,g=void 0;try{for(var T,v=i.added[Symbol.iterator]();!(f=(T=v.next()).done);f=!0){var m=T.value;n.add(m)}}catch(e){h=!0,g=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw g}}l()&&c()}});return function(){u.unsubscribe(),p.unsubscribe(),d.unsubscribe()}})),(0,f._)(i,"subscribe",i.result.subscribe.bind(i.result)),i.map=null!=(o=r.map)?o:function(e){return e},i}return(0,w._)(t,e),(0,y._)(t,[{key:Symbol.observable,value:function(){return this.result}}]),t}(B),G=function(e){function n(e,r,i,o){var a,s;return(0,d._)(this,n),a=(0,U._)(this,n,[{api:e,session:r,direction:"forward"===i.direction?1:-1,initial:i.state,transducer:i.reducer}]),(0,f._)(a,"window",void 0),(0,f._)(a,"map",void 0),(0,f._)(a,"exhaustive",new T.Multicast(function(e){return N.Observable.combine(a.session.ids.select(function(e){return e.length}),a.window.size).select(function(e){var n=(0,t._)(e,2);return n[0]<=n[1]}).subscribe(e)})),(0,f._)(a,"result",new T.Multicast(function(e){var t=new x,n=null,r=null,i=new Map,o=new Set,s=function(){if(o.size)for(var s=a.indexed(t,Array.from(o)),l=s[0];l>=0&&l<t.length;){var c=t.get(l),u=c.id,p=l===s[0];if(r&&r!==u&&t.dir(u,r)!==a.direction)break;p&&(s.shift(),o.delete(c.id));var d=a.step(t,i,c),y=d.ret,f=d.recomputing;if(!1===y){r=c.id;break}if(u===r&&(r=null),f||s.length){l=f?l+a.direction:s[0];continue}break}if(t.length){var h,g,T=null!=r?r:null==(g=t.peek(a.direction))?void 0:g.id;h=T?i.get(T):void 0}else h=a.initial;if(void 0===h)throw Error("unexpected undefined");n!==h&&(n=h,e.next(a.map(h)))},l=a.window.events.lift(e,function(e){var n=t.patch(e);if(n){var a=!0,l=!1,c=void 0;try{for(var u,p=n.removed[Symbol.iterator]();!(a=(u=p.next()).done);a=!0){var d=u.value;i.delete(d.id),o.delete(d.id),d.id===r&&(r=null)}}catch(e){l=!0,c=e}finally{try{a||null==p.return||p.return()}finally{if(l)throw c}}var y=!0,f=!1,h=void 0;try{for(var g,T=n.added[Symbol.iterator]();!(y=(g=T.next()).done);y=!0){var v=g.value;o.add(v.id)}}catch(e){f=!0,h=e}finally{try{y||null==T.return||T.return()}finally{if(f)throw h}}var m=!0,S=!1,E=void 0;try{for(var b,C=n.changed[Symbol.iterator]();!(m=(b=C.next()).done);m=!0){var _=b.value;o.add(_.id)}}catch(e){S=!0,E=e}finally{try{m||null==C.return||C.return()}finally{if(S)throw E}}s()}});return function(){l.unsubscribe()}})),(0,f._)(a,"subscribe",a.result.subscribe.bind(a.result)),a.window=a.session.window(o),a.map=null!=(s=i.map)?s:function(e){return e},a}return(0,w._)(n,e),(0,y._)(n,[{key:"size",get:function(){return this.window.size}},{key:Symbol.observable,value:function(){return this.result}}]),n}(B),V=e.i(377930),H=function(e){function n(e,r,i,o){var a;return(0,d._)(this,n),a=(0,U._)(this,n,[{api:e,session:r,direction:"forward"===i.direction?1:-1,initial:i.state,transducer:i.transformer}]),(0,f._)(a,"window",void 0),(0,f._)(a,"exhaustive",new T.Multicast(function(e){return N.Observable.combine(a.session.ids.select(function(e){return e.length}),a.window.size).select(function(e){var n=(0,t._)(e,2);return n[0]<=n[1]}).subscribe(e)})),(0,f._)(a,"state",new T.Multicast(function(e){var t=new x,n=new Map,r=new Map;return a.window.events.lift(e,function(i){var o=t.patch(i);if(o){var s=!1,l=!1;if(!t.length){s||(s=!!(n.size||r.size)),l||(l=s),s&&(n.clear(),r.clear(),e.next({events:t,transformed:r,scaled:s}));return}var c=!0,u=!1,p=void 0;try{for(var d,y=o.removed[Symbol.iterator]();!(c=(d=y.next()).done);c=!0){var f=d.value;s||(s=r.has(f.id)),l||(l=s),n.delete(f.id),r.delete(f.id)}}catch(e){u=!0,p=e}finally{try{c||null==y.return||y.return()}finally{if(u)throw p}}if(o.added.length||o.changed.length)for(var h=a.indexed(t,o.added.concat(o.changed)),g=h[0];g>=0&&g<t.length;){var T=g===h[0];T&&h.shift();var v=t.get(g),m=r.get(v.id),S=a.step(t,n,v),E=S.ret,b=S.recomputing;if((b||T)&&(void 0!==E?r.set(v.id,E):void 0!==m&&r.delete(v.id)),s||(s=!!m!=!!E),l||(l=b||T||s),b||h.length){g=b?g+a.direction:h[0];continue}break}(s||l)&&e.next({events:t,transformed:r,scaled:s})}})})),(0,f._)(a,"tuples",new T.Multicast(function(e){var t=new Map,n=!0;return a.state.lift(e,function(r){if(r.scaled||n){n=!1;for(var i=[],o=0;o<r.events.length;o++){var s=r.events.get(o);if(s&&r.transformed.has(s.id)){var l,c=null!=(l=t.get(s.id))?l:a.create(s.id);t.set(s.id,c),i.push([s.id,c])}}e.next(i)}})})),(0,f._)(a,"flat",new T.Multicast(function(e){return a.state.lift(e,function(t){for(var n=[],r=0;r<t.events.length;r++){var i=t.events.get(r),o=i&&t.transformed.get(i.id);void 0!==o&&n.push(o)}e.next(n)})})),(0,f._)(a,"mapped",a.tuples.map(function(e){return new Map(e)})),(0,f._)(a,"subscribe",a.tuples.subscribe.bind(a.tuples)),a.window=a.session.window(o),a}return(0,w._)(n,e),(0,y._)(n,[{key:"size",get:function(){return this.window.size}},{key:"create",value:function(e){var t=this;return new T.Multicast(function(n){var r=V.None;return t.state.lift(n,function(t){var i=t.transformed.get(e);if(void 0===i)return n.complete();r!==i&&(r=i,n.next(i))})})}},{key:"map",value:function(e){var t=this;return new T.Multicast(function(n){var r=new Map,i=V.None;return t.state.lift(n,function(o){for(var a=[],s=0;s<o.events.length;s++){var l,c=null==(l=o.events.get(s))?void 0:l.id,u=c&&o.transformed.get(c);if(c&&u){var p=r.get(c);p||(p=t.create(c),r.set(c,p)),a.push({id:c,value:u,observable:p})}}var d=e(a);j(d,i)||(i=d,n.next(d))})})}},{key:"chunked",value:function(e){var n=this;return new T.Multicast(function(r){var i=null;return N.Observable.combine(n.mapped,n.state).lift(r,function(n){for(var o=(0,t._)(n,2),a=o[0],s=o[1],l=[],c=function(e){if(e<0||e>=s.events.length)return null;var t=s.events.get(e),n=s.transformed.get(t.id);return a.has(t.id)&&n?{event:t,transformed:n}:null},u=[],p=null,d=0;d<s.events.length;d++){var y=c(d);if(y){for(var f=null,h=d+1;h<s.events.length;h++)if(a.has(s.events.get(h).id)){f=c(h);break}var g=e(y,p,f);switch(p=y,g){case"continue":u.push(y.event.id);break;case"break":u.length&&(l.push(u),u=[]),u.push(y.event.id);break;case"isolate":u.length&&(l.push(u),u=[]),l.push([y.event.id])}}}u.length&&l.push(u),j(l,i)||(i=l,r.next(l.map(function(e){return e.map(function(e){return[e,a.get(e)]})})))})})}},{key:Symbol.observable,value:function(){return this.tuples}}]),n}(B),W=function(){function e(){(0,d._)(this,e),(0,f._)(this,"nodes",new Set),(0,f._)(this,"up",new Map),(0,f._)(this,"down",new Map),(0,f._)(this,"leafs",new Map)}return(0,y._)(e,[{key:"size",get:function(){return this.nodes.size}},{key:"ids",value:function(){return new Set(this.nodes.keys())}},{key:"has",value:function(e){return this.nodes.has(e)}},{key:"parent",value:function(e){var t;return null!=(t=this.up.get(e))?t:null}},{key:"children",value:function(e){var t;return null!=(t=this.down.get(e))?t:null}},{key:"siblings",value:function(e){var t=this.parent(e);return t?this.children(t):null}},{key:"hierarchy",value:function(e){for(var t=[e],n=e;this.up.has(n);)t.unshift(n=this.up.get(n));return t}},{key:"isLeaf",value:function(e){return this.leafs.has(e)}},{key:"latest",value:function(){var e=null,n=-1,r=!0,i=!1,o=void 0;try{for(var a,s=this.leafs[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=(0,t._)(a.value,2),c=l[0],u=l[1];u>n&&(e=c,n=u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return e}},{key:"walk",value:function(e,t){if(!this.nodes.has(e))throw Error("node not in graph");if(!1!==t(e,this.isLeaf(e))){for(var n=this.children(e);(null==n?void 0:n.size)===1;){if(!1===t(e=n.values().next().value,this.isLeaf(e)))return;n=this.children(e)}if(null==n?void 0:n.size){var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;this.walk(l,t)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}}},{key:"append",value:function(e){var t=this.nodes.size,n=new Set,r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;if(!n.has(l.id)&&this.nodes.has(l.id)){var c=this.up.get(l.id);if(c&&c!==l.parent)throw Error("parent mismatch");continue}if(this.nodes.add(l.id),n.add(l.id),this.down.has(l.id)||this.leafs.set(l.id,l.priority),l.parent){this.leafs.delete(l.parent);var u=this.down.get(l.parent);u||(u=new Set,this.down.set(l.parent,u),this.nodes.add(l.parent),n.add(l.parent)),this.up.set(l.id,l.parent),u.add(l.id)}}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return this.nodes.size!==t}},{key:"clone",value:function(){var n=new e;n.nodes=new Set(this.nodes),n.up=new Map(this.up),n.leafs=new Map(this.leafs);var r=!0,i=!1,o=void 0;try{for(var a,s=this.down[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=(0,t._)(a.value,2),c=l[0],u=l[1];n.down.set(c,new Set(u))}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}]),e}(),$=function(){function e(){(0,d._)(this,e),(0,f._)(this,"queue",[]),(0,f._)(this,"locked",!1)}return(0,y._)(e,[{key:"acquire",value:function(){var e=this;return this.locked?new Promise(function(t){e.queue.push(t)}):(this.locked=!0,Promise.resolve())}},{key:"release",value:function(){if(this.queue.length>0){var e=this.queue.shift();null==e||e()}else this.locked=!1}},{key:"run",value:function(e){return(0,h._)(function(){return(0,g._)(this,function(t){switch(t.label){case 0:return[4,this.acquire()];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,,4,5]),[4,e()];case 3:return[2,t.sent()];case 4:return this.release(),[7];case 5:return[2]}})}).call(this)}},{key:"clear",value:function(){this.queue.length=0,this.locked=!1}}]),e}(),z=e.i(99145),K=e.i(862927),Q=e.i(131141),Y={messageEventContents:{$kind:"messageEventContext",messageEventContext:K.Value.Create(s.MessageEventContextSchema)},inlineActionEventContents:{$kind:"inlineActionEventContext",inlineActionEventContext:K.Value.Create(s.InlineActionEventContextSchema)},shellSuggestionEventContents:{$kind:"shellSuggestionEventContext",shellSuggestionEventContext:K.Value.Create(s.ShellSuggestionEventContextSchema)},sessionCreationEventContents:{$kind:"sessionCreationEventContext",sessionCreationEventContext:K.Value.Create(s.SessionCreationEventContextSchema)},localShellExecutionEventContents:{$kind:"localShellExecutionEventContext",localShellExecutionEventContext:K.Value.Create(s.LocalShellExecutionEventContextSchema)},translateEventContents:{$kind:"translateEventContext",translateEventContext:K.Value.Create(s.TranslateEventContextSchema)},byoPromptEventContents:{$kind:"byoPromptEventContext",byoPromptEventContext:K.Value.Create(s.BYOPromptEventContextSchema)},agentPlanEventContents:{$kind:"agentPlanEventContext",agentPlanEventContext:K.Value.Create(s.AgentPlanEventContextSchema)},agentTimelineEventContents:{$kind:"agentTimelineEventContext",agentTimelineEventContext:K.Value.Create(s.AgentTimelineEventContextSchema)},iterativeAgentEventContents:{$kind:"iterativeAgentEventContext",iterativeAgentEventContext:K.Value.Create(s.IterativeAgentEventContextSchema)}},X=!0,J=!1,Z=void 0;try{for(var ee,et,en=Object.values(Y)[Symbol.iterator]();!(X=(et=en.next()).done);X=!0){var er=et.value;(0,Q.freeze)(er,!0)}}catch(e){J=!0,Z=e}finally{try{X||null==en.return||en.return()}finally{if(J)throw Z}}var ei=(0,Q.freeze)(K.Value.Create(s.EventSchema),!0),eo=function(){function e(){var t=this;(0,d._)(this,e),(0,f._)(this,"stockpile",new Map),(0,f._)(this,"registry",new FinalizationRegistry(function(e){t.stockpile.delete(e)})),(0,f._)(this,"listeners",new z.ListenerList)}return(0,y._)(e,[{key:"empty",get:function(){return 0===this.stockpile.size}},{key:"has",value:function(e){var t;return this.stockpile.has(e)&&(null==(t=this.stockpile.get(e))?void 0:t.deref())!==void 0}},{key:"get",value:function(e){var t,n;return null!=(n=null==(t=this.stockpile.get(e))?void 0:t.deref())?n:null}},{key:"add",value:function(e){var t,n=null==(t=this.stockpile.get(e.id))?void 0:t.deref();return n===e?n:(n&&this.registry.unregister(n),this.stockpile.set(e.id,new WeakRef(e)),this.registry.register(e,e.id,e),this.listeners.notify(e),e)}},{key:"emplace",value:function(e){var t,n=null==(t=this.stockpile.get(e.id))?void 0:t.deref();return n||(this.stockpile.set(e.id,new WeakRef(e)),this.registry.register(e,e.id,e),this.listeners.notify(e),e)}},{key:"delete",value:function(e){var t=this.stockpile.get(e);if(t){this.stockpile.delete(e);var n=t.deref();n&&this.registry.unregister(n)}}},{key:"store",value:function(e){var t=this;null!=e||(e=[]),"string"==typeof e&&(e=[e]);var n=new Set,r=new Map,i=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;n.add(c),r.set(c,this.get(c))}}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}var u=!1,p=this.listeners.add(function(e){n.has(e.id)&&r.set(e.id,e)});return(0,f._)({has:function(e){return n.has(e)},get:function(e){var t;return null!=(t=r.get(e))?t:null},track:function(e){if(u)throw Error("Store has been released");e=Array.isArray(e)?e:[e];var i=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;n.add(c),r.set(c,t.get(c))}}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}},untrack:function(e){if(u)throw Error("Store has been released");e=Array.isArray(e)?e:[e];var t=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var l=a.value;l="string"==typeof l?l:l.id,n.delete(l),r.delete(l)}}catch(e){i=!0,o=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw o}}},release:function(){u||(u=!0,p(),n.clear(),r.clear())}},Symbol.iterator,function(){var e,t,i,o,a,s,l,c;return(0,g._)(this,function(u){switch(u.label){case 0:e=!0,t=!1,i=void 0,u.label=1;case 1:u.trys.push([1,6,7,8]),o=n[Symbol.iterator](),u.label=2;case 2:if(e=(a=o.next()).done)return[3,5];if(s=a.value,!(l=r.get(s)))return[3,4];return[4,l];case 3:u.sent(),u.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return c=u.sent(),t=!0,i=c,[3,8];case 7:try{e||null==o.return||o.return()}finally{if(t)throw i}return[7];case 8:return[2]}})})}},{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.stockpile.keys()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.delete(o)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}]),e}(),ea={events:new(function(e){function t(){return(0,d._)(this,t),(0,U._)(this,t,arguments)}return(0,w._)(t,e),(0,y._)(t,[{key:"invalidate",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.stockpile.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value.deref();o&&o.state!==s.EventState.COMPLETE&&this.delete(o.id)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"create",value:function(e){var t,n,r;return this.add(((n=Object.assign({},ei)).id=e.eventId,n.parentEventId=e.parentEventId,n.sessionId=e.sessionId,n.state=e.state,n.error=e.error,n.sender=e.sender,n.contents=e.contents,n.created=new Date,(r=null==(t=e.contents.contents)?void 0:t.$kind)&&Y[r]&&(n.context={metadata:Y[r]}),n))}},{key:"update",value:function(e){var t=this.get(e.eventId);return t?this.add((0,C.applyEventUpdateMessage)(t,e)):null}}]),t}(eo)),sessions:new(function(e){function t(){return(0,d._)(this,t),(0,U._)(this,t,arguments)}return(0,w._)(t,e),(0,y._)(t,[{key:"invalidate",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.stockpile.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value.deref();o&&!o.archived&&this.delete(o.id)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"create",value:function(e){return this.add((0,I.createSessionFromCreateSessionMessage)(e))}},{key:"update",value:function(e){var t=this.get(e.sessionId);return t?this.add((0,I.applySessionUpdateMessage)(t,e)):null}}]),t}(eo))},es=function(){function e(t,n,r,i,o){var a=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"id",void 0),(0,f._)(this,"eventId",void 0),(0,f._)(this,"parent",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"event",new T.Multicast(function(e){var t=ea.events.store(a.eventId),n=a.api.materializer.get(a.eventId);n&&e.next(n);var r=a.api.state.register({snapshot:function(){return n},rollback:function(e){return n=e},notify:function(){n&&e.next(n)},update:function(e){if("event-modified"===e.kind&&e.event.id===a.eventId)return n=e.event,!0}}),i=a.api.connected.lift(e,function(t){return(0,h._)(function(){var i,o,a;return(0,g._)(this,function(s){switch(s.label){case 0:return(i=ea.events.get(this.eventId))&&n!==i&&(n=i,r.commit(),e.next(n)),[4,(0,v.get)(this.api.materializer.materialize(this.parent.id,[this.eventId]))];case 1:if(o=s.sent(),t.aborted||(0,v.isError)(o,"UNEXPECTED_DISCONNECT"))return[2];if(!o.ok)return[2,this.api.error(o,e)];return a=ea.events.emplace(o.payload[0]),n!==a&&(n=a,r.commit(),e.next(n)),[2]}})}).call(a)});return function(){t.release(),r.unsubscribe(),i.unsubscribe()}})),(0,f._)(this,"data",this.event.select(function(e){return e.contents.contents.subagentRunning})),(0,f._)(this,"kind",this.data.filter(function(e){return void 0!==e.contents}).select(function(e){return e.contents.$kind})),(0,f._)(this,"running",this.event.select(function(e){return e.state!==s.EventState.COMPLETE})),(0,f._)(this,"totalExecutionTimeSeconds",this.data.select(function(e){return e.totalExecutionTimeSeconds})),this.api=t,this.id=n,this.eventId=r,this.parent=i,this.session=o}return(0,y._)(e,[{key:"contents",value:function(e){return this.data.filter(function(t){var n;return(null==(n=t.contents)?void 0:n.$kind)===e}).select(function(e){return(0,O.unkind)(e.contents)})}},{key:"abort",value:function(){return(0,h._)(function(){var e;return(0,g._)(this,function(t){switch(t.label){case 0:return[4,this.api.service.abortSubagent.rpc({replId:this.api.replId,sessionId:this.parent.id,subagentId:this.id})];case 1:if(!(e=t.sent()).ok)return[2,this.api.error(e)];return[2,(0,v.Ok)(null)]}})}).call(this)}}],[{key:"create",value:function(t,n,r,i,o){var a=this.subagents.get(t);a||(a=new Map,this.subagents.set(t,a));var s=a.get(n),l=null==s?void 0:s.deref();if(s&&l||(s=new WeakRef(l=new e(t,n,r,i,o)),a.set(n,s)),l.eventId!==r)throw Error("Subagent event ID mismatch");if(l.parent!==i)throw Error("Subagent parent mismatch");if(l.session!==o)throw Error("Subagent session mismatch");return l}}]),e}();(0,f._)(es,"subagents",new WeakMap);var el=e.i(790164),ec=function(){function e(n,r,i){var o=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"size",void 0),(0,f._)(this,"events",new T.Multicast(function(e){var n=new D,r=new x,i=function(e){var t=(null==e?void 0:e.length)?new Map(e.map(function(e){return[e.id,e]})):null,i=r.adopt(n,t);return!!i&&(i.missing.length&&o.api.materializer.enqueue(o.session.id,i.missing),!0)},a=o.api.state.register({snapshot:function(){return{ids:n.clone(),events:r.clone()}},rollback:function(e){n=e.ids,r=e.events},notify:function(){return e.next(r)},update:function(e){if("event-modified"===e.kind&&n.has(e.event.id))return i([e.event])}}),s=o.api.materializer.events.lift(e,function(t){var o=t.filter(function(e){var t=e.id;return n.has(t)});o.length&&i(o)&&e.next(r)}),l=N.Observable.combine(o.session.ids,o.size).lift(e,function(a){var s=(0,t._)(a,2),l=s[0],c=s[1],u=l.length?l.id(Math.max(0,l.length-c)):null,p=n.patch(l,u);p&&i(p.added.map(function(e){return o.api.materializer.get(e)}).filter(function(e){return null!==e}))&&e.next(r)});return function(){a.unsubscribe(),s.unsubscribe(),l.unsubscribe()}})),(0,f._)(this,"subscribe",this.events.subscribe.bind(this.events)),this.api=n,this.session=r,this.size=new el.ObservableState(i)}return(0,y._)(e,[{key:Symbol.observable,value:function(){return this.events}}]),e}();function eu(e){var t=e.api,n=e.sessionId,r=e.tip,i=e.onGraphFetched;return new T.Multicast(function(e){var o=!0,a=!0,s=new W,l=function(){if(r&&!s.has(r))return t.error("Tip event ".concat(r," not found in graph"),e);var n=null!=r?r:s.latest();if(!n)return t.error("Unexpected empty graph",e);var i=s.hierarchy(n),o=new D;o.append(i),e.next(o)},c=t.state.register({snapshot:function(){return s.clone()},rollback:function(e){return s=e},notify:function(){return l()},update:function(e){if(!a&&"event-modified"===e.kind&&"created"===e.type&&e.event.sessionId===n)return s.append([{id:e.event.id,parent:e.event.parentEventId,priority:e.event.created.getTime()}])}}),u=t.connected.lift(e,function(u){return(0,h._)(function(){var p,d,y,f,h,T,m,S,E,b,C,_,R,I,O,k,A,U,w,N,M;return(0,g._)(this,function(g){switch(g.label){case 0:if(h=Date.now(),c.rollback(),a=!0,null==(p=(d=t.logger).info)||p.call(d,r?"Starting to fetch session graph from tip":"Starting to fetch session graph",{sessionId:n,tip:r}),T=0,m=!1,S=null!=r?r:null,E=[],!r)return[3,2];return[4,t.service.batchGetEvents.rpc({sessionId:n,eventIds:[r]})];case 1:if(b=g.sent(),u.aborted||(0,v.isError)(b,"UNEXPECTED_DISCONNECT"))return[2];if(!b.ok)return[2,t.error(b,e)];b.payload.events.length>0&&(C=b.payload.events[0],E.push({id:C.id,parent:C.parentEventId||null,priority:C.created.getTime()})),g.label=2;case 2:_=200,g.label=3;case 3:if(!(_>0))return[3,6];return T++,[4,t.service.getEventList.rpc({sessionId:n,limit:500,AncestorsOf:S?{$kind:"ancestorsOf",ancestorsOf:S}:void 0})];case 4:if(R=g.sent(),(u.aborted||!R.ok)&&(null==(I=(O=t.logger).info)||I.call(O,r?"Aborted fetching session graph from tip":"Aborted fetching session graph",{sessionId:n,tip:r,numPagesFetched:T,amountFetched:E.length,duration:Date.now()-h})),u.aborted||(0,v.isError)(R,"UNEXPECTED_DISCONNECT"))return[2];if(!R.ok)return[2,t.error(R,e)];k=!0,A=!1,U=void 0;try{for(w=R.payload.shapes[Symbol.iterator]();!(k=(N=w.next()).done);k=!0)M=N.value,E.push({id:M.id,parent:M.parentEventId||null,priority:M.created.getTime()})}catch(e){A=!0,U=e}finally{try{k||null==w.return||w.return()}finally{if(A)throw U}}if(R.payload.shapes.length<500||(S=R.payload.shapes[R.payload.shapes.length-1].id,s.has(S)))return[3,6];g.label=5;case 5:return _--,[3,3];case 6:return E.length&&(m=s.append(E)),a=!1,(m||o)&&(o=!1,c.commit(),l()),null==(y=(f=t.logger).info)||y.call(f,r?"Finished fetching session graph from tip":"Finished fetching session graph",{sessionId:n,tip:r,numPagesFetched:T,amountFetched:E.length,duration:Date.now()-h}),null==i||i(Date.now()-h,E.length),[2]}})})()});return function(){c.unsubscribe(),u.unsubscribe()}})}var ep=function(){function e(t,n,r){var i=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"agent",void 0),(0,f._)(this,"id",void 0),(0,f._)(this,"created",void 0),(0,f._)(this,"mutex",new $),(0,f._)(this,"data",new T.Multicast(function(e){var t=null,n=ea.sessions.get(i.id);n&&(t=(0,I.compatSessionToData)(n),e.next(n));var r=i.api.state.register({snapshot:function(){return t},rollback:function(e){return t=e},notify:function(){t&&e.next((0,I.compatDataToSession)(i.api.replId,t))},update:function(e){if(t&&e.optimistic&&"session-modified"===e.kind&&e.session.id===i.id){var n=(0,E.create)(t,function(t){t.title=e.session.title,t.archived=e.session.archived,t.readOnly=e.session.readOnly,t.taskId=e.session.taskId}),r=t!==n;return t=n,r&&(t.updated=new Date),r}}}),o=i.api.connected.lift(e,function(n){return(0,h._)(function(){var i,o,a,s,l,c,u,p,d,y,f,h,T;return(0,g._)(this,function(g){switch(g.label){case 0:return i=this,[4,(0,b.getSyncResult)(this.api.chort.sessions.data.subscribe({sessionId:this.id},{signal:n}))];case 1:if(a=(o=g.sent()).snapshot,s=o.deltas,(0,v.isError)(a,"UNEXPECTED_DISCONNECT","CANCEL"))return[2];if(!a.ok)return[2,this.api.error(a,e)];ea.sessions.add((0,I.compatDataToSession)(this.api.replId,a.payload)),r.rollback(),r.rebase(function(){return t=a.payload,!0}),l=!1,c=!1,g.label=2;case 2:g.trys.push([2,7,8,13]),d=function(){var n=f.value;if((0,v.isError)(n,"UNEXPECTED_DISCONNECT","CANCEL"))return{v:void 0};if(!n.ok)return{v:p.api.error(n,e)};var o=n.payload;if(!t)return{v:p.api.error(Error("Unexpected: no data"),e)};r.rebase(function(){var e=(0,E.apply)(t,o),n=t!==e;return t=e,n&&ea.sessions.add((0,I.compatDataToSession)(i.api.replId,t)),n})},y=(0,m._)(s),g.label=3;case 3:return[4,y.next()];case 4:if(!(l=!(f=g.sent()).done))return[3,6];if(p=this,h=d(),"object"===(0,S._)(h))return[2,h.v];g.label=5;case 5:return l=!1,[3,3];case 6:return[3,13];case 7:return T=g.sent(),c=!0,u=T,[3,13];case 8:if(g.trys.push([8,,11,12]),!(l&&null!=y.return))return[3,10];return[4,y.return()];case 9:g.sent(),g.label=10;case 10:return[3,12];case 11:if(c)throw u;return[7];case 12:return[7];case 13:return[2]}})}).call(i)});return function(){r.unsubscribe(),o.unsubscribe()}})),(0,f._)(this,"type",this.data.select(function(e){return e.sessionType})),(0,f._)(this,"ids",void 0),(0,f._)(this,"leaf",void 0),this.api=t,this.agent=new A(t,this),this.id=n,this.created=r,this.ids=eu({api:this.api,sessionId:this.id,onGraphFetched:function(e,t){i.api.hooks.trigger("session-graph-fetched",{session:i,duration:e,size:t})}}),this.leaf=this.ids.select(function(e){return e.last}).filter(function(e){return null!==e}),this.api.teardown(function(){return i.mutex.clear()})}return(0,y._)(e,[{key:"subagent",value:function(t,n,r,i){return es.create(this.api,t,n,this,e.create(this.api,r,i))}},{key:"window",value:function(e){return new ec(this.api,this,e)}},{key:"from",value:function(e){return new ed(this,e)}},{key:"reduce",value:function(e,t){return"global"===t?new q(this.api,this,e):new G(this.api,this,e,t)}},{key:"transform",value:function(e,t){return new H(this.api,this,e,t)}},{key:"updateSession",value:function(e){return(0,h._)(function(){var n,r,i,o,a,s,l,c,u;return(0,g._)(this,function(p){switch(p.label){case 0:return[4,(0,v.get)(this.data)];case 1:if(!(n=p.sent()).ok)return[2,this.api.error(n)];if(r=n.payload,o=(i=(0,I.createUpdateSessionRequest)(r,e)).session,a=i.request,r===o)return[2,(0,v.Ok)(r)];return l=(s=(0,t._)(this.api.state.stage({kind:"session-modified",type:"updated",session:o}),2))[0],c=s[1],[4,this.api.service.updateSession.rpc(a)];case 2:if(!(u=p.sent()).ok)return c(),[2,this.api.error(u)];return l(),this.api.hooks.trigger("client-updated-session",{session:this,request:a,prev:r,next:o}),[2,(0,v.Ok)(o)]}})}).call(this)}},{key:"updateEvent",value:function(e){var n=this;return this.mutex.run(function(){return(0,h._)(function(){var n,r,i,o,a,s,l,c,u,p,d,y;return(0,g._)(this,function(f){switch(f.label){case 0:return[4,(0,v.get)(this.ids.map(function(t){return t.has(e.id)}))];case 1:if(!(n=f.sent()).ok)return[2,this.api.error(n)];if(!n.payload)return[2,this.api.error("Event does not exist in the session")];return[4,(0,v.get)(this.api.materializer.materialize(this.id,[e.id]))];case 2:if(!(r=f.sent()).ok)return[2,this.api.error(r)];if(i=(0,t._)(r.payload,1)[0],o=(0,R.createUpdateEventRequest)(e),(a=(0,C.applyEventUpdateMessage)(i,o))===i)return[2,(0,v.Ok)(a)];return l=(s=(0,t._)(this.api.state.stage({kind:"event-modified",type:"updated",event:a}),2))[0],c=s[1],[4,this.api.service.updateEvent.upload()];case 3:return p=(u=t._.apply(void 0,[f.sent(),2]))[0],d=u[1],p.push(o),p.end(),[4,d];case 4:if(!(y=f.sent()).ok)return c(),[2,this.api.error(y)];return this.api.hooks.trigger("client-updated-event",{session:this,request:o,prev:i,next:a}),l(),[2,(0,v.Ok)(a)]}})}).call(n)})}},{key:"appendEvent",value:function(e,n){var r=this;return this.mutex.run(function(){return(0,h._)(function(){var r,i,o,a,l,c,u,p,d,y,f,h,T;return(0,g._)(this,function(g){switch(g.label){case 0:return[4,(0,v.get)([this.leaf,this.data.select(function(e){return e.sessionType})])];case 1:if(!(r=g.sent()).ok)return[2,this.api.error(r)];if(o=(i=(0,t._)(r.payload,2))[0],a=i[1],void 0!==e.modelType&&a===s.SessionType.AGENT_SESSION)return[2,this.api.error("Agent sessions do not support model type configuration")];if(l=s.ModelType.BASIC,e.modelType===s.ModelType.ADVANCED&&(l=this.api.hasAdvancedModel.current?this.api.overrideModel.current?{type:s.ModelType.OVERRIDE,overrideModelName:this.api.overrideModel.current}:s.ModelType.ADVANCED:s.ModelType.BASIC),e.modelType===s.ModelType.OVERRIDE){if(!this.api.overrideModel.current)return[2,this.api.error("No override model set")];l={type:s.ModelType.OVERRIDE,overrideModelName:this.api.overrideModel.current}}return u=(c=(0,_.createEventRequest)({session:this.id,sender:this.api.user.current,addToChild:!0,parent:o,model:l,data:e,benchmark:n})).event,p=c.request,y=(d=(0,t._)(this.api.state.stage({kind:"event-modified",type:"created",event:u,condition:function(e){return!("event-modified"===e.kind&&"created"===e.type&&(e.event.id===u.id?e.event.parentEventId!==u.parentEventId:e.event.parentEventId===u.parentEventId))}}),2))[0],f=d[1],[4,this.api.service.createEvent.rpc(p)];case 2:if(!(h=g.sent()).ok)return f(),[2,this.api.error(h)];if(h.payload.eventId===u.id&&h.payload.parentEventId===u.parentEventId)return[3,4];return f(),[4,(0,v.get)(this.api.materializer.materialize(this.id,[h.payload.eventId]))];case 3:if(!(T=g.sent()).ok)return[2,this.api.error(T)];return this.api.hooks.trigger("client-appended-event",{session:this,event:T.payload[0]}),[2,(0,v.Ok)(T.payload[0])];case 4:return y(),this.api.hooks.trigger("client-appended-event",{session:this,event:u}),[2,(0,v.Ok)(u)]}})}).call(r)})}},{key:"abortLastEvent",value:function(){var e=this;return this.mutex.run(function(){return(0,h._)(function(){var e,t;return(0,g._)(this,function(n){switch(n.label){case 0:return[4,(0,v.get)(this.leaf)];case 1:if(!(e=n.sent()).ok)return[2,this.api.error(e)];return[4,this.api.service.abortEvent.rpc({eventId:e.payload})];case 2:if(!(t=n.sent()).ok)return[2,this.api.error(t)];return[2,(0,v.Ok)(null)]}})}).call(e)})}},{key:"submitUserFeedback",value:function(e){return(0,h._)(function(){var n,r,i,o,a;return(0,g._)(this,function(s){switch(s.label){case 0:return[4,(0,v.get)([this.data.select(function(e){return e.sessionType}),this.leaf])];case 1:if(!(n=s.sent()).ok)return[2,this.api.error(n)];return i=(r=(0,t._)(n.payload,2))[0],o=r[1],[4,this.api.service.submitAgentUserFeedback.rpc({sessionId:this.id,sessionType:i,feedback:e,sourceEventId:o})];case 2:if(!(a=s.sent()).ok)return[2,this.api.error(a)];return[2,(0,v.Ok)(null)]}})}).call(this)}}],[{key:"create",value:function(t,n,r){var i=this.sessions.get(t);i||(i=new Map,this.sessions.set(t,i));var o=i.get(n),a=null==o?void 0:o.deref();return o&&a||(o=new WeakRef(a=new e(t,n,r)),i.set(n,o)),a}}]),e}();(0,f._)(ep,"sessions",new WeakMap);var ed=function(){function e(t,n){(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"id",void 0),(0,f._)(this,"tip",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"ids",void 0),this.api=t.api,this.id=t.id,this.tip=n,this.session=t,this.ids=eu({api:this.api,sessionId:this.id,tip:this.tip})}return(0,y._)(e,[{key:"window",value:function(e){return new ec(this.api,this,e)}},{key:"reduce",value:function(e,t){return"global"===t?new q(this.api,this,e):new G(this.api,this,e,t)}},{key:"transform",value:function(e,t){return new H(this.api,this,e,t)}}]),e}(),ey=function(){function e(t){var n,r,i,o,a=this,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"archived",void 0),(0,f._)(this,"readonly",void 0),(0,f._)(this,"limit",void 0),(0,f._)(this,"types",void 0),(0,f._)(this,"map",new T.Multicast(function(e){var t=!1,n=ea.sessions.store(),r=new Map,i=a.api.state.register({snapshot:function(){return new Map(r)},rollback:function(e){r=new Map(e);var t=n;n=ea.sessions.store(Array.from(r.keys())),t.release()},notify:function(){return e.next(new Map(r))},update:function(e){if(t&&"session-modified"===e.kind){var n=e.session,i=a.types.includes(n.sessionType)&&(null===a.archived||n.archived===a.archived)&&(null===a.readonly||n.readOnly===a.readonly);if(!r.has(n.id)&&i)return r.set(n.id,ep.create(a.api,n.id,n.created)),!0;if(r.has(n.id)&&!i)return r.delete(n.id),!0}}}),o=a.api.connected.lift(e,function(o){a.api.queryFetchCounter.scope(function(){return(0,h._)(function(){var a,s,l,c,u,p,d,y,f,h,T,m,S,E,b,C,_;return(0,g._)(this,function(g){switch(g.label){case 0:return[4,this.api.service.getReplSessions.rpc({beforeTimestamp:new Date("2099-01-01"),limit:this.limit,includeFirstSessionEvents:!1,firstSessionEventsLimit:1,replId:this.api.replId,sessionTypes:this.types,archived:null!=(a=this.archived)?a:void 0})];case 1:if(s=g.sent(),o.aborted||(0,v.isError)(s,"UNEXPECTED_DISCONNECT"))return[2];if(!s.ok)return[2,this.api.error(s,e)];i.rollback(),l=new Set(r.keys()),c=!1,u=!0,p=!1,d=void 0;try{for(y=s.payload.sessions[Symbol.iterator]();!(u=(f=y.next()).done);u=!0)(h=f.value).events=[],ea.sessions.emplace(h),(null===this.readonly||h.readOnly===this.readonly)&&(l.delete(h.id),r.has(h.id)||(T=ep.create(this.api,h.id,h.created),n.track(h.id),r.set(h.id,T),c=!0))}catch(e){p=!0,d=e}finally{try{u||null==y.return||y.return()}finally{if(p)throw d}}m=!0,S=!1,E=void 0;try{for(b=l[Symbol.iterator]();!(m=(C=b.next()).done);m=!0)_=C.value,n.untrack(_),r.delete(_),c=!0}catch(e){S=!0,E=e}finally{try{m||null==b.return||b.return()}finally{if(S)throw E}}return(c||!t)&&(t=!0,i.commit(),e.next(new Map(r))),[2]}})}).call(a)})});return function(){n.release(),i.unsubscribe(),o.unsubscribe()}})),(0,f._)(this,"list",this.map.select(function(e){return Array.from(e.values()).sort(function(e,t){return t.created.getTime()-e.created.getTime()})},function(e,t){return e.length===t.length&&e.every(function(e,n){return e===t[n]})})),(0,f._)(this,"latest",this.map.select(function(e){var t=null,n=!0,r=!1,i=void 0;try{for(var o,a=e.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;(!t||s.created>t.created)&&(t=s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t})),(0,f._)(this,"subscribe",this.map.subscribe.bind(this.map)),this.api=t,this.archived=null!=(n=l.archived)?n:null,this.readonly=null!=(r=l.readonly)?r:null,this.limit=null!=(i=l.limit)?i:1e3,this.types=null!=(o=l.types)?o:[s.SessionType.CHAT,s.SessionType.AGENT_SESSION]}return(0,y._)(e,[{key:Symbol.observable,value:function(){return this.map}}]),e}(),ef=e.i(167626),eh=e.i(878420),eg=e.i(64386),eT=e.i(886513),ev=function(){function e(){(0,d._)(this,e),(0,f._)(this,"__brand",void 0)}return(0,y._)(e,[{key:"is",value:function(e){return"effect"===e.kind&&e.effect===this}}]),e}(),em=function(){function e(n){var r=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"handles",new Map),(0,f._)(this,"onUpdateHandlers",null),(0,f._)(this,"refs",new Set),(0,f._)(this,"buffer",[]),(0,f._)(this,"conditions",new Set),(0,f._)(this,"listeners",new z.ListenerList),(0,f._)(this,"optimistic",!1),(0,f._)(this,"emitter",new N.Observable(function(e){return r.api.connected.lift(e,function(n){return(0,h._)(function(){var r,i,o,a,l,c,u,p,d,y,f,h,T,S,E,b,C,_,R,I,A,U,w,N,M;return(0,g._)(this,function(g){switch(g.label){case 0:return r=ea.events.store(),i=ea.sessions.store(),[4,this.api.service.subscribeToReplEvents.subscribe({replId:this.api.replId})];case 1:if(a=(o=t._.apply(void 0,[g.sent(),2]))[0],l=o[1],c=function(){l(),r.release(),i.release()},n.aborted)return[2,c()];n.addEventListener("abort",l),u=!1,p=!1,g.label=2;case 2:g.trys.push([2,7,8,13]),y=(0,m._)(a),g.label=3;case 3:return[4,y.next()];case 4:if(!(u=!(f=g.sent()).done)||(h=f.value,n.aborted||(0,v.isError)(h,"UNEXPECTED_DISCONNECT")))return[3,6];if(!h.ok)return this.api.error(h,e),[3,6];if(!h.payload.message)return[3,5];switch(T=void 0,(S=(0,O.unwrapKind)(h.payload.message)).$kind){case"subscriptionStatusMessage":case"abortEventMessage":return[3,5];case"createEventMessage":(E=ea.events.create(S)).state===s.EventState.COMPLETE?this.api.hooks.trigger("received-completed-event",{event:E}):this.api.hooks.has("received-completed-event")&&r.track(E.id),void 0===E.contents.contents&&this.api.hooks.has("received-event")?i.track(E.id):this.api.hooks.trigger("received-event",{event:E}),T={kind:"event-modified",optimistic:!1,type:"created",event:E};break;case"updateEventMessage":if(!(b=ea.events.update(S)))return[3,5];r.has(b.id)&&b.state===s.EventState.COMPLETE&&(r.untrack(b.id),this.api.hooks.trigger("received-completed-event",{event:b})),i.has(b.id)&&void 0!==b.contents.contents&&(i.untrack(b.id),this.api.hooks.trigger("received-event",{event:b})),T={kind:"event-modified",optimistic:!1,type:"updated",event:b};break;case"createSessionMessage":T={kind:"session-modified",optimistic:!1,type:"created",session:ea.sessions.create(S)};break;case"updateSessionMessage":if(!(C=ea.sessions.update(S)))return[3,5];T={kind:"session-modified",optimistic:!1,type:"updated",session:C};break;case"updateAgentStateMessage":_=k(S),this.api.hooks.trigger("agent-state-changed",{sessionId:S.sessionId,state:_}),T={kind:"agent-state-modified",optimistic:!1,session:S.sessionId,state:_}}R=!0,I=!1,A=void 0;try{for(U=this.conditions[Symbol.iterator]();!(R=(w=U.next()).done);R=!0)if(N=w.value,!1===N(T)){this.rollback();break}}catch(e){I=!0,A=e}finally{try{R||null==U.return||U.return()}finally{if(I)throw A}}e.next(T),g.label=5;case 5:return u=!1,[3,3];case 6:return[3,13];case 7:return M=g.sent(),p=!0,d=M,[3,13];case 8:if(g.trys.push([8,,11,12]),!(u&&null!=y.return))return[3,10];return[4,y.return()];case 9:g.sent(),g.label=10;case 10:return[3,12];case 11:if(p)throw d;return[7];case 12:return[7];case 13:return n.removeEventListener("abort",c),c(),[2]}})}).call(r)})})),(0,f._)(this,"updates",new T.StatelessMulticast(function(e){var t=r.listeners.add(function(t){e.next(t)}),n=r.emitter.subscribe(e);return function(){t(),n.unsubscribe()}})),this.api=n;var i=this.api.status.subscribe(function(e){"connected"!==e&&(ea.events.invalidate(),ea.sessions.invalidate(),r.optimistic&&r.rollback())}),o=null,a=this.api.hooks.subscribe(function(e){if("agent-state-changed"===e.type||"received-completed-event"===e.type||"received-event"===e.type){var t=r.api.hooks.has("agent-state-changed")||r.api.hooks.has("received-completed-event")||r.api.hooks.has("received-event");t&&!o?o=r.updates.subscribe(function(){}):!t&&o&&(o.unsubscribe(),o=null)}});this.api.teardown(function(){i.unsubscribe(),a(),null==o||o.unsubscribe()})}return(0,y._)(e,[{key:"isOptimisticEvent",value:function(e){var t=this.buffer.filter(function(e){return"event-modified"===e.kind}).find(function(t){return t.event.id===e});return!!t&&t.type}},{key:"getOptimisticEvent",value:function(e){var t=this.buffer.filter(function(e){return"event-modified"===e.kind}).find(function(t){return t.event.id===e});if(!t)throw Error("Event not found in optimistic state");return t.event}},{key:"apply",value:function(e){var n=new Set,r=!0,i=!1,o=void 0;try{for(var a,s=this.handles[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l,c=(0,t._)(a.value,2),u=c[0],p=c[1];if(e.optimistic&&p!==V.None){(null==(d=u.update)?void 0:d.call(u,e))&&n.add(u);continue}if(e.optimistic&&p===V.None){var d,y,f=u.snapshot();(null==(y=u.update)?void 0:y.call(u,e))&&(this.handles.set(u,f),n.add(u));continue}if(!e.optimistic&&p!==V.None){u.rollback(p),(null==(m=u.update)?void 0:m.call(u,e))&&n.add(u);var h=u.snapshot(),g=!0,T=!1,v=void 0;try{for(var m,S,E=this.buffer[Symbol.iterator]();!(g=(S=E.next()).done);g=!0){var b,C=S.value;(null==(b=u.update)?void 0:b.call(u,C))&&(this.handles.set(u,h),n.add(u))}}catch(e){T=!0,v=e}finally{try{g||null==E.return||E.return()}finally{if(T)throw v}}continue}!e.optimistic&&p===V.None&&(null==(l=u.update)?void 0:l.call(u,e))&&n.add(u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}var _=!0,R=!1,I=void 0;try{for(var O,k=n[Symbol.iterator]();!(_=(O=k.next()).done);_=!0){var A,U=O.value;null==(A=U.notify)||A.call(U)}}catch(e){R=!0,I=e}finally{try{_||null==k.return||k.return()}finally{if(R)throw I}}}},{key:"rollback",value:function(){if(!this.optimistic)throw Error("Cannot rollback while not optimistic");this.optimistic=!1,this.buffer.length=0,this.refs.clear(),this.conditions.clear();var e=new Set,n=!0,r=!1,i=void 0;try{for(var o,a=this.handles[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=(0,t._)(o.value,2),l=s[0],c=s[1];c!==V.None&&(l.rollback(c),this.handles.set(l,V.None),e.add(l))}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}var u=!0,p=!1,d=void 0;try{for(var y,f=e[Symbol.iterator]();!(u=(y=f.next()).done);u=!0){var h,g=y.value;null==(h=g.notify)||h.call(g)}}catch(e){p=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(p)throw d}}}},{key:"commit",value:function(){if(!this.optimistic)throw Error("Cannot commit while not optimistic");var e=!0,t=!1,n=void 0;try{for(var r,i=this.buffer[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;switch(o.kind){case"event-modified":ea.events.emplace(o.event);break;case"session-modified":ea.sessions.emplace(o.session)}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.optimistic=!1,this.buffer.length=0,this.refs.clear(),this.conditions.clear();var a=!0,s=!1,l=void 0;try{for(var c,u=this.handles.keys()[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var p=c.value;this.handles.set(p,V.None)}}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}}},{key:"stage",value:function(e,t){var n,r=this;if((0,ef._)(e,ev))n={kind:"effect",effect:e,data:t};else if(e)n=e;else throw Error("Invalid effect or update");if("connected"!==this.api.status.current)throw Error("Cannot notify while not connected");var i=n.condition,o=(0,eT._)(n,["condition"]),a=(0,eg._)((0,eh._)({},o),{optimistic:!0});this.buffer.push(a),i&&this.conditions.add(i);var s=function(e){r.refs.has(s)&&(r.refs.delete(s),e?0===r.refs.size&&r.commit():(r.rollback(),r.api.hooks.trigger("client-state-rollback",{failed:a})),i&&r.conditions.delete(i))};return this.refs.add(s),this.optimistic=!0,this.listeners.notify(a),[function(){return s(!0)},function(){return s(!1)}]}},{key:"register",value:function(e){var t=this;return null!=this.onUpdateHandlers||(this.onUpdateHandlers=this.updates.subscribe(function(e){t.apply(e)})),this.handles.set(e,V.None),this.optimistic&&e.update&&Promise.resolve().then(function(){if(t.handles.has(e)&&t.optimistic){var n,r=e.snapshot(),i=!1,o=!0,a=!1,s=void 0;try{for(var l,c=t.buffer[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var u,p=l.value;(null==(u=e.update)?void 0:u.call(e,p))&&(i=!0)}}catch(e){a=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(a)throw s}}i&&(t.handles.set(e,r),null==(n=e.notify)||n.call(e))}}),{get optimistic(){return t.handles.get(e)!==V.None},rollback:function(){var n=t.handles.get(e);n!==V.None&&(e.rollback(n),t.handles.set(e,V.None))},commit:function(){t.handles.set(e,V.None)},rebase:function(n){var r=t.handles.get(e);if(r===V.None){n()&&(null==(p=e.notify)||p.call(e));return}var i=e.snapshot();if(e.rollback(r),t.handles.set(e,V.None),!n()){t.handles.set(e,r),e.rollback(i);return}var o=!1,a=e.snapshot(),s=!0,l=!1,c=void 0;try{for(var u,p,d,y=t.buffer[Symbol.iterator]();!(s=(d=y.next()).done);s=!0){var f,h=d.value;(null==(f=e.update)?void 0:f.call(e,h))&&!o&&(t.handles.set(e,a),o=!0)}}catch(e){l=!0,c=e}finally{try{s||null==y.return||y.return()}finally{if(l)throw c}}null==(u=e.notify)||u.call(e)},unsubscribe:function(){if(t.handles.delete(e),0===t.handles.size){var n;null==(n=t.onUpdateHandlers)||n.unsubscribe(),t.onUpdateHandlers=null}}}}}]),e}(),eS=new ev,eE=new ev,eb=new ev,eC=function(){function e(t){var n=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"state",new T.Multicast(function(e){var t=null,r=n.api.state.register({snapshot:function(){return t},rollback:function(e){return t=e},notify:function(){t&&e.next(t)},update:function(e){if(t){if(eS.is(e)){var n=(0,E.create)(t,function(t){var n=t.find(function(t){return t.id===e.data.id});n&&(n.contents=e.data.contents)}),r=n!==t;return t=n,r}if(eE.is(e)){var i=(0,E.create)(t,function(t){var n=!0,r=!1,i=void 0;try{for(var o,a=e.data.ids[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)!function(){var e=o.value,n=t.findIndex(function(t){return t.id===e});-1!==n&&t.splice(n,1)}()}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}),o=i!==t;return t=i,o}if(eb.is(e)){var a=(0,E.create)(t,function(t){var n=t.findIndex(function(t){return t.id===e.data.id}),r=t[n];if(r){if(null===e.data.after){t.splice(n,1),t.unshift(r);return}var i=t.findIndex(function(t){return t.id===e.data.after});-1!==i&&(n<i&&i--,t.splice(n,1),t.splice(i+1,0,r))}}),s=a!==t;return t=a,s}}}}),i=n.api.connected.lift(e,function(i){return(0,h._)(function(){var n,o,a,s,l,c,u,p,d,y;return(0,g._)(this,function(f){switch(f.label){case 0:n=this.api.chort.queue.state.subscribe({},{signal:i}).resReadable,o=!1,a=!1,f.label=1;case 1:f.trys.push([1,6,7,12]),c=function(){var n=p.value;return(0,v.isError)(n,"UNEXPECTED_DISCONNECT","CANCEL")?{v:void 0}:n.ok?void r.rebase(function(){return t=n.payload,!0}):{v:l.api.error(n,e)}},u=(0,m._)(n),f.label=2;case 2:return[4,u.next()];case 3:if(!(o=!(p=f.sent()).done))return[3,5];if(l=this,d=c(),"object"===(0,S._)(d))return[2,d.v];f.label=4;case 4:return o=!1,[3,2];case 5:return[3,12];case 6:return y=f.sent(),a=!0,s=y,[3,12];case 7:if(f.trys.push([7,,10,11]),!(o&&null!=u.return))return[3,9];return[4,u.return()];case 8:f.sent(),f.label=9;case 9:return[3,11];case 10:if(a)throw s;return[7];case 11:return[7];case 12:return[2]}})}).call(n)});return function(){i(),r.unsubscribe()}})),this.api=t}return(0,y._)(e,[{key:"get",value:function(){return(0,h._)(function(){var e;return(0,g._)(this,function(t){switch(t.label){case 0:return[4,this.api.chort.queue.get.rpc({})];case 1:if(!(e=t.sent()).ok)return[2,this.api.error(e)];return[2,(0,v.Ok)(e.payload)]}})}).call(this)}},{key:"enqueue",value:function(e){return(0,h._)(function(e){var t,n;return(0,g._)(this,function(r){switch(r.label){case 0:return t=e.contents,[4,this.api.chort.queue.enqueue.rpc({contents:t})];case 1:if(!(n=r.sent()).ok)return[2,this.api.error(n)];return[2,(0,v.Ok)(n.payload)]}})}).apply(this,arguments)}},{key:"update",value:function(e){return(0,h._)(function(e){var n,r,i,o,a,s;return(0,g._)(this,function(l){switch(l.label){case 0:return n=e.id,r=e.contents,o=(i=(0,t._)(this.api.state.stage(eS,{id:n,contents:r}),2))[0],a=i[1],[4,this.api.chort.queue.update.rpc({id:n,contents:r})];case 1:if(!(s=l.sent()).ok)return a(),[2,this.api.error(s)];return o(),[2,(0,v.Ok)(s.payload)]}})}).apply(this,arguments)}},{key:"reorder",value:function(e){return(0,h._)(function(e){var n,r,i,o,a,s;return(0,g._)(this,function(l){switch(l.label){case 0:return n=e.id,r=e.after,o=(i=(0,t._)(this.api.state.stage(eb,{id:n,after:r}),2))[0],a=i[1],[4,this.api.chort.queue.reorder.rpc({id:n,after:r})];case 1:if(!(s=l.sent()).ok)return a(),[2,this.api.error(s)];return o(),[2,(0,v.Ok)(s.payload)]}})}).apply(this,arguments)}},{key:"flush",value:function(e){return(0,h._)(function(e){var n,r,i,o,a,s;return(0,g._)(this,function(l){switch(l.label){case 0:return n=e.ids,r=e.session,o=(i=(0,t._)(this.api.state.stage(eE,{ids:n}),2))[0],a=i[1],[4,this.api.chort.queue.flush.rpc({ids:n,session:r})];case 1:if(!(s=l.sent()).ok)return a(),[2,this.api.error(s)];return o(),[2,(0,v.Ok)(s.payload)]}})}).apply(this,arguments)}},{key:"delete",value:function(e){return(0,h._)(function(e){var n,r,i,o,a;return(0,g._)(this,function(s){switch(s.label){case 0:return n=e.ids,i=(r=(0,t._)(this.api.state.stage(eE,{ids:n}),2))[0],o=r[1],[4,this.api.chort.queue.delete.rpc({ids:n})];case 1:if(!(a=s.sent()).ok)return o(),[2,this.api.error(a)];return i(),[2,(0,v.Ok)(a.payload)]}})}).apply(this,arguments)}}]),e}(),e_=function(){function e(t){var n=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"sessions",void 0),(0,f._)(this,"queue",void 0),this.api=t,this.sessions={query:function(e){return new ey(n.api,e)},create:function(e){return n.api.createSession(e)},rollback:function(e){return n.api.revertToCommit(e)},get:function(e){return n.api.getSessionObservableById(e)},chat:{all:new ey(t,{types:[s.SessionType.CHAT]}),open:new ey(t,{types:[s.SessionType.CHAT],archived:!1}),archived:new ey(t,{types:[s.SessionType.CHAT],archived:!0})},agent:{all:new ey(t,{types:[s.SessionType.AGENT_SESSION]}),current:this.api.currentAgentSession,readonly:new ey(t,{types:[s.SessionType.AGENT_SESSION],readonly:!0})}},this.queue=new eC(this.api)}return(0,y._)(e,[{key:"hook",value:function(e,t){return this.api.hooks.add(e,t)}},{key:"usage",value:function(e){return this.api.createUsageWatcher({start:e})}}]),e}(),eR=e.i(346715),eI=function(){function e(t){(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"hooks",{}),(0,f._)(this,"listeners",new z.ListenerList),this.api=t}return(0,y._)(e,[{key:"has",value:function(e){return void 0!==this.hooks[e]}},{key:"add",value:function(e,t){var n=this,r=this.hooks[e];r||(r=new Map,this.hooks[e]=r);var i=function(){r&&r.has(i)&&(r.delete(i),0===r.size&&(delete n.hooks[e],r=void 0),n.listeners.notify({kind:"hook-unregistered",type:e}))};return r.set(i,t),this.listeners.notify({kind:"hook-registered",type:e}),i}},{key:"trigger",value:function(e,t){var n=this.hooks[e];if(n){var r=!0,i=!1,o=void 0;try{for(var a,s=(0,eR._)(n.values())[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;try{l(t)}catch(e){this.api.error(e)}}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}},{key:"subscribe",value:function(e){return this.listeners.add(e)}},{key:"dispose",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=Object.values(this.hooks)[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=!0,s=!1,l=void 0;try{for(var c,u=o.keys()[Symbol.iterator]();!(a=(c=u.next()).done);a=!0)(0,c.value)()}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}]),e}(),eO=e.i(395266),ek=function(){function e(n){var r,i,o,a,l=this,c=n.connection,u=n.chortConnection,p=n.user,y=n.hasAdvancedModel,m=n.overrideModel,S=n.logger,E=n.onError;(0,d._)(this,e),(0,f._)(this,"connection",void 0),(0,f._)(this,"chortConnection",void 0),(0,f._)(this,"user",void 0),(0,f._)(this,"hasAdvancedModel",void 0),(0,f._)(this,"overrideModel",void 0),(0,f._)(this,"onError",void 0),(0,f._)(this,"hooks",void 0),(0,f._)(this,"disposed",!1),(0,f._)(this,"teardowns",new z.ListenerList),(0,f._)(this,"logger",void 0),(0,f._)(this,"status",void 0),(0,f._)(this,"connected",new T.Multicast(function(e){var t=null,n=l.teardowns.add(function(){null==t||t.abort(),t=null,e.complete()}),r=l.status.subscribe(function(n){"connected"!==n?(null==t||t.abort(),t=null,"closed"===n?e.complete():"error"===n&&e.error(Error("Connection error"))):t||(t=new AbortController,e.next(t.signal))});return function(){null==t||t.abort(),t=null,n(),r.unsubscribe()}})),(0,f._)(this,"closed",new T.Multicast(function(e){var t=l.teardowns.add(function(){e.next(),e.complete()}),n=l.status.subscribe(function(t){("closed"===t||"error"===t)&&(e.next(),e.complete())});return function(){t(),n.unsubscribe()}})),(0,f._)(this,"models",new T.Multicast(function(e){var n=0;return N.Observable.combine(l.connected,l.overrideModel).filter(function(e){return!(0,t._)(e,1)[0].aborted}).lift(e,function(r){var i=(0,t._)(r,2),o=i[0],a=i[1];return(0,h._)(function(){var t,r,i,l,c;return(0,g._)(this,function(u){switch(u.label){case 0:return t=++n,[4,this.service.getAvailableModels.rpc({overrideModel:null!=a?a:""})];case 1:if(r=u.sent(),n!==t||o.aborted||(0,v.isError)(r,"UNEXPECTED_DISCONNECT"))return[2];if(!r.ok)return[2,this.error(r,e)];return i=r.payload.basicModel.map(function(e){return new eO.ChatModel({type:s.ModelType.BASIC,readable:e.readable,qualified:e.qualified})}),l=r.payload.advancedModel.map(function(e){return new eO.ChatModel({type:s.ModelType.ADVANCED,readable:e.readable,qualified:e.qualified})}),c=null,a&&r.payload.overrideModel&&r.payload.overrideModel.qualified===a&&(c=new eO.ChatModel({type:s.ModelType.OVERRIDE,readable:r.payload.overrideModel.readable,qualified:r.payload.overrideModel.qualified})),e.next({basic:i,advanced:l,override:c}),[2]}})}).call(l)})})),this.connection=c,this.chortConnection=null!=u?u:null,this.user=new el.ObservableState(p),this.hasAdvancedModel=new el.ObservableState(y),this.overrideModel=new el.ObservableState(null!=m?m:null),this.logger=function(e){var t={},n="chatter: ";if(e.debug){var r=e.debug;t.debug=function(e,t){r(n+e,t)}}if(e.info){var i=e.info;t.info=function(e,t){i(n+e,t)}}if(e.warn){var o=e.warn;t.warn=function(e,t){o(n+e,t)}}if(e.error){var a=e.error;t.error=function(e,t){a(n+e,t)}}return t}(null!=S?S:{}),this.onError=E,this.hooks=new eI(this),this.teardown(function(){return l.hooks.dispose()});var b=new el.ObservableState(eA(this.connection.status.current,null!=(a=null==(r=this.chortConnection)?void 0:r.status.current)?a:null));this.teardown(function(){"closed"!==b.current&&"error"!==b.current&&b.set("closed")}),this.status=b;var C=this.connection.status.subscribe(function(e){var t,n,r,i,o=null!=(i=null==(t=l.chortConnection)?void 0:t.status.current)?i:null;null==(n=(r=l.logger).info)||n.call(r,"connection status changed",{connectionStatus:e,chortConnectionStatus:o}),b.set(eA(e,o)),("closed"===e||"error"===e)&&l.dispose()});if(this.teardown(function(){return C.unsubscribe()}),this.chortConnection){var _=this.chortConnection.status.subscribe(function(e){var t,n,r=l.connection.status.current;null==(t=(n=l.logger).info)||t.call(n,"connection status changed",{connectionStatus:r,chortConnectionStatus:e}),b.set(eA(r,e)),("closed"===e||"error"===e)&&l.dispose()});this.teardown(function(){return _.unsubscribe()})}null==(i=(o=this.logger).info)||i.call(o,"API initialized")}return(0,y._)(e,[{key:"service",get:function(){return this.connection.service}},{key:"chort",get:function(){if(!this.chortConnection)throw Error("Chort connection is not set");return this.chortConnection.client}},{key:"error",value:function(e,t){var n=(0,v.Err)(e);if(!(0,v.isError)(n,"UNEXPECTED_DISCONNECT")&&!n.reported)if(n.reported=!0,this.onError){var r=null;(void 0===e?"undefined":(0,S._)(e))==="object"&&"payload"in e&&(r=n.payload),this.onError(n,r)}else setTimeout(function(){throw n},0);return t&&t.error(n),(0,v.isError)(n,"UNEXPECTED_DISCONNECT")?this.hooks.trigger("unexpected-disconnect",{error:n}):this.hooks.trigger("unhandled-exception",{error:n}),n}},{key:"teardown",value:function(e){return this.disposed?(e(),function(){}):this.teardowns.add(e)}},{key:"ping",value:function(){return(0,h._)(function(){var e,t;return(0,g._)(this,function(n){switch(n.label){case 0:return[4,this.service.pingPong.rpc({})];case 1:if(e=n.sent(),(0,v.isError)(e,"UNEXPECTED_DISCONNECT"))return[2,(0,v.Ok)(!1)];if(!e.ok)return[2,this.error(e)];if(!this.chortConnection)return[3,3];return[4,this.chort.debug.ping.rpc({})];case 2:if(t=n.sent(),(0,v.isError)(t,"UNEXPECTED_DISCONNECT"))return[2,(0,v.Ok)(!1)];if(!t.ok)return[2,this.error(t)];n.label=3;case 3:return[2,(0,v.Ok)(!0)]}})}).call(this)}},{key:"dispose",value:function(){if(!this.disposed){var e,t;this.disposed=!0,this.teardowns.notify(),this.teardowns.clear(),null==(t=this.logger)||null==(e=t.info)||e.call(t,"API disposed")}}},{key:"enhancePrompt",value:function(e,t){return(0,h._)(function(e){var t,n,r,i,o=arguments;return(0,g._)(this,function(a){switch(a.label){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:[],n=o.length>2&&void 0!==o[2]?o[2]:[],r=o.length>3?o[3]:void 0,[4,this.service.enhanceAgentPrompt.rpc({userPrompt:e,uploadedFiles:t,attachedUrls:n,selectedTheme:r||""})];case 1:if(!(i=a.sent()).ok)return[2,this.error(i)];return[2,(0,v.Ok)(i.payload.enhancedPrompt)]}})}).apply(this,arguments)}},{key:"generateReplName",value:function(e,t){return(0,h._)(function(){var n;return(0,g._)(this,function(r){switch(r.label){case 0:return[4,this.service.generateReplName.rpc({replId:e,prompt:t})];case 1:if(!(n=r.sent()).ok)return[2,this.error(n)];return[2,(0,v.Ok)(n.payload.replName)]}})}).call(this)}},{key:"getUrlScrapedContent",value:function(e){return(0,h._)(function(){var t;return(0,g._)(this,function(n){switch(n.label){case 0:return[4,this.service.getUrlScrapedContent.rpc({url:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,v.Ok)(t.payload.content)]}})}).call(this)}},{key:"getUrlScreenshot",value:function(e){return(0,h._)(function(){var t;return(0,g._)(this,function(n){switch(n.label){case 0:return[4,this.service.getUrlScreenshot.rpc({url:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,v.Ok)(t.payload.imageDownloadUrl)]}})}).call(this)}},{key:"getUrlBranding",value:function(e){return(0,h._)(function(){var t;return(0,g._)(this,function(n){switch(n.label){case 0:return[4,this.service.getUrlBranding.rpc({url:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,v.Ok)(t.payload.branding)]}})}).call(this)}},{key:"generateReplIcon",value:function(e,t){return(0,h._)(function(){var n;return(0,g._)(this,function(r){switch(r.label){case 0:return[4,this.service.generateIcon.rpc({replId:e,prompt:t})];case 1:if(!(n=r.sent()).ok)return[2,this.error(n)];return[2,(0,v.Ok)(n.payload.imageUrl)]}})}).call(this)}},{key:"getResourceUploadUrl",value:function(e){return(0,h._)(function(){var t;return(0,g._)(this,function(n){switch(n.label){case 0:return[4,this.service.getResourceUploadUrl.rpc({mimeType:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,v.Ok)(t.payload)]}})}).call(this)}}]),e}();function eA(e,t){return null===t?e:"closed"===e||"closed"===t?"closed":"error"===e||"error"===t?"error":"disconnected"===e||"disconnected"===t?"disconnected":"connecting"===e||"connecting"===t?"connecting":"connected"}var eU=function(){function e(){(0,d._)(this,e),(0,f._)(this,"current",0),(0,f._)(this,"resolves",[])}return(0,y._)(e,[{key:"count",get:function(){return this.current}},{key:"increment",value:function(){this.current++}},{key:"decrement",value:function(){if(this.current--,this.current<0)throw this.current=0,Error("Reference count cannot be negative");for(;0===this.current&&this.resolves.length>0;){var e=this.resolves.shift();null==e||e()}}},{key:"drained",value:function(){return(0,h._)(function(){var e;return(0,g._)(this,function(t){switch(t.label){case 0:if(e=this,0!==this.current)return[3,2];return[4,Promise.resolve()];case 1:if(t.sent(),0===this.current)return[2];t.label=2;case 2:return[2,new Promise(function(t){e.resolves.push(t)})]}})}).call(this)}},{key:"scope",value:function(e){return(0,h._)(function(){return(0,g._)(this,function(t){switch(t.label){case 0:this.increment(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,e()];case 2:return[2,t.sent()];case 3:return this.decrement(),[7];case 4:return[2]}})}).call(this)}}]),e}(),ew=function(){function e(n){var r=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"queue",new Map),(0,f._)(this,"store",ea.events.store()),(0,f._)(this,"enqueued",null),(0,f._)(this,"events",new T.StatelessMulticast(function(e){var n=!1,i=r.api.closed.subscribe(function(){e.complete()});return r.enqueued=function(){n||(n=!0,(0,h._)(function(){var r,i,o,a,s,l,c,u,p,d,y,f,h,T,m,S,E,b,_,R,I,O,k,A,U,w,N,M,D,x,P,L,j,B,F,q,G,V,H,W,$,z,K,Q,Y,X,J,Z,ee,et,en,er,ei,eo,es,el;return(0,g._)(this,function(g){switch(g.label){case 0:if(!this.queue.size)return[3,9];r=!0,i=!1,o=void 0,g.label=1;case 1:g.trys.push([1,6,7,8]),a=this.queue[Symbol.iterator](),g.label=2;case 2:if(r=(s=a.next()).done)return[3,5];if(c=(l=(0,t._)(s.value,2))[0],u=l[1],this.api.state.optimistic){y=[],f=!0,h=!1,T=void 0;try{for(m=u[Symbol.iterator]();!(f=(S=m.next()).done);f=!0)E=S.value,(b=this.api.state.isOptimisticEvent(E))&&(I=this.api.state.getOptimisticEvent(E),y.push(I),u.delete(E),null==(_=(R=this.api.logger).warn)||_.call(R,"materialized optimistic event",{sessionId:c,eventId:E,eventOptimisticType:b}))}catch(e){h=!0,T=e}finally{try{f||null==m.return||m.return()}finally{if(h)throw T}}if(y.length&&(this.store.untrack(y),e.next(y)),!u.size)return this.queue.delete(c),[3,4]}if(!ea.events.empty){O=[],k=!0,A=!1,U=void 0;try{for(w=u[Symbol.iterator]();!(k=(N=w.next()).done);k=!0)M=N.value,(D=ea.events.get(M))&&(O.push(D),u.delete(M))}catch(e){A=!0,U=e}finally{try{k||null==w.return||w.return()}finally{if(A)throw U}}O.length&&(this.store.untrack(O),e.next(O))}if(!u.size)return this.queue.delete(c),[3,4];return x=Date.now(),P=Array.from(u).slice(0,500),[4,this.api.service.batchGetEvents.rpc({sessionId:c,eventIds:P})];case 3:if(L=g.sent(),!n)return[2];if((0,v.isError)(L,"UNEXPECTED_DISCONNECT"))return[3,4];if(L.ok&&!L.payload.events.length){F=!0,q=!1,G=void 0;try{for(V=P[Symbol.iterator]();!(F=(H=V.next()).done);F=!0)W=H.value,u.delete(W)}catch(e){q=!0,G=e}finally{try{F||null==V.return||V.return()}finally{if(q)throw G}}return u.size||this.queue.delete(c),this.store.untrack(P),null==(j=(B=this.api.logger).warn)||j.call(B,"detected infinite materialization loop",{sessionId:c,eventIds:P}),[3,4]}if(!L.ok){$=!0,z=!1,K=void 0;try{for(Q=P[Symbol.iterator]();!($=(Y=Q.next()).done);$=!0)X=Y.value,u.delete(X)}catch(e){z=!0,K=e}finally{try{$||null==Q.return||Q.return()}finally{if(z)throw K}}return u.size||this.queue.delete(c),this.store.untrack(P),[2,this.api.error(L,e)]}J=L.payload.events,null==(d=this.api.logger)||null==(p=d.info)||p.call(d,"materialized events",{sessionId:c,duration:Date.now()-x,count:J.length}),this.api.hooks.trigger("events-materialized",{sessionId:c,duration:Date.now()-x,count:J.length}),Z=[],ee=!0,et=!1,en=void 0;try{for(er=J[Symbol.iterator]();!(ee=(ei=er.next()).done);ee=!0)eo=ei.value,(es=ea.events.get(eo.id))?eo=es:((0,C.applyEventOperations)(eo),ea.events.add(eo)),u.has(eo.id)&&(Z.push(eo),u.delete(eo.id))}catch(e){et=!0,en=e}finally{try{ee||null==er.return||er.return()}finally{if(et)throw en}}u.size||this.queue.delete(c),Z.length&&(this.store.untrack(Z),e.next(Z)),g.label=4;case 4:return r=!0,[3,2];case 5:return[3,8];case 6:return el=g.sent(),i=!0,o=el,[3,8];case 7:try{r||null==a.return||a.return()}finally{if(i)throw o}return[7];case 8:return[3,0];case 9:return n=!1,[2]}})}).call(r).catch(function(t){return e.error(t)}))},r.queue.size&&r.enqueued(),function(){n=!1,r.enqueued=null,i.unsubscribe()}})),this.api=n}return(0,y._)(e,[{key:"enqueue",value:function(e,t){if(t.length){var n=this.queue.get(e);n||(n=new Set,this.queue.set(e,n));var r=!0,i=!1,o=void 0;try{for(var a,s,l=t[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;n.add(c)}}catch(e){i=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}this.store.track(t),null==(a=this.enqueued)||a.call(this)}}},{key:"materialize",value:function(e,t){return(0,h._)(function(){var n,r,i,o,a,s,l,c,u,p,d,y,f,h,T,v,m;return(0,g._)(this,function(g){switch(g.label){case 0:n=this,r=new Set(t),i=ea.events.store(t),o=!0,a=!1,s=void 0;try{for(l=i[Symbol.iterator]();!(o=(c=l.next()).done);o=!0)u=c.value,r.delete(u.id)}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}if(!r.size)return[3,2];return this.enqueue(e,Array.from(r)),[4,new Promise(function(e,t){var o=n.events.subscribe({next:function(t){var n=!0,i=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;r.has(c.id)&&r.delete(c.id)}}catch(e){i=!0,a=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw a}}r.size||(o.unsubscribe(),e())},error:function(e){i.release(),t(e)},complete:function(){i.release(),t(new N.CompletionError)}})})];case 1:g.sent(),g.label=2;case 2:p=[],d=!0,y=!1,f=void 0;try{for(h=t[Symbol.iterator]();!(d=(T=h.next()).done);d=!0){if(v=T.value,!(m=this.get(v)))throw i.release(),this.api.error("Unexpected missing event");p.push(m)}}catch(e){y=!0,f=e}finally{try{d||null==h.return||h.return()}finally{if(y)throw f}}return i.release(),[2,p]}})}).call(this)}},{key:"get",value:function(e){return this.api.state.isOptimisticEvent(e)?this.api.state.getOptimisticEvent(e):ea.events.get(e)}}]),e}(),eN=function(e){function t(e){var n;if((0,d._)(this,t),!e.replId)throw Error("Chatter API is disabled");return n=(0,U._)(this,t,[e]),(0,f._)(n,"replId",void 0),(0,f._)(n,"materializer",void 0),(0,f._)(n,"state",void 0),(0,f._)(n,"queryFetchCounter",void 0),(0,f._)(n,"sessionObservables",new Map),(0,f._)(n,"currentAgentSession",new T.Multicast(function(e){var t=!1,r="",i=null,o=function(t){return(0,h._)(function(){var r,o,a,s;return(0,g._)(this,function(l){switch(l.label){case 0:if(null==i||i.abort(),!t)return[2,e.next(null)];if(r=ea.sessions.get(t))return e.next(ep.create(n,t,r.created)),i=null,[2];return o=(i=new AbortController).signal,[4,n.service.getSessionEvents.rpc({excludeContents:!0,sessionId:t,limit:1})];case 1:if(a=l.sent(),o.aborted||(0,v.isError)(a,"UNEXPECTED_DISCONNECT"))return[2];if(!a.ok)return[2,n.error(a,e)];return a.payload.session.events=[],i=null,s=ea.sessions.emplace(a.payload.session),e.next(ep.create(n,t,s.created)),[2]}})})()},a=n.state.updates.filter(function(e){return"agent-state-modified"===e.kind}).select(function(e){return e.session}).lift(e,function(e){r!==e&&(r=e,o(e))}),l=n.connected.lift(e,function(i){return(0,h._)(function(){var a,l,c,u,p,d,y,f,h,T;return(0,g._)(this,function(g){switch(g.label){case 0:return[4,n.service.getReplSessions.rpc({beforeTimestamp:new Date("2099-01-01"),limit:5,includeFirstSessionEvents:!1,firstSessionEventsLimit:1,replId:n.replId,sessionTypes:[s.SessionType.AGENT_SESSION],archived:void 0})];case 1:if(a=g.sent(),i.aborted||(0,v.isError)(a,"UNEXPECTED_DISCONNECT"))return[2];if(!a.ok)return[2,n.error(a,e)];l=!0,c=!1,u=void 0;try{for(p=a.payload.sessions[Symbol.iterator]();!(l=(d=p.next()).done);l=!0)(y=d.value).events=[],ea.sessions.emplace(y)}catch(e){c=!0,u=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw u}}return f=a.payload.replAgentState.activeAgentSessionId,h=a.payload.sessions.filter(function(e){return!e.readOnly}).sort(function(e,t){return t.created.getTime()-e.created.getTime()})[0],T=f||(null==h?void 0:h.id)||"",r===T&&t||(t=!0,r=T,o(T)),[2]}})})()});return function(){null==i||i.abort(),a.unsubscribe(),l.unsubscribe()}})),n.replId=e.replId,n.materializer=new ew(n),n.state=new em(n),n.queryFetchCounter=new eU,n}return(0,w._)(t,e),(0,y._)(t,[{key:"getSessionObservableById",value:function(e){var t=this,n=this.sessionObservables.get(e);return n||(n=new T.Multicast(function(n){var r=null,i=ea.sessions.get(e);i?n.next(ep.create(t,e,i.created)):r=t.connected.lift(n,function(i){return(0,h._)(function(){var t,o;return(0,g._)(this,function(a){switch(a.label){case 0:return[4,this.service.getSessionEvents.rpc({excludeContents:!0,sessionId:e,limit:1})];case 1:if(t=a.sent(),i.aborted||(0,v.isError)(t,"UNEXPECTED_DISCONNECT"))return[2];if(!t.ok)return[2,this.error(t,n)];return t.payload.session.events=[],o=ea.sessions.emplace(t.payload.session),n.next(ep.create(this,e,o.created)),null==r||r.unsubscribe(),r=null,[2]}})}).call(t)});var o=t.teardown(function(){n.complete()});return function(){null==r||r.unsubscribe(),o()}}),this.sessionObservables.set(e,n)),n}},{key:"createSession",value:function(e){return(0,h._)(function(){var t,n,r;return(0,g._)(this,function(i){switch(i.label){case 0:return t=(0,I.createSessionRequest)((0,eg._)((0,eh._)({},e),{replId:this.replId})),[4,this.service.createSession.rpc(t)];case 1:if(!(n=i.sent()).ok)return[2,this.error(n)];return r=ep.create(this,n.payload.sessionId,new Date),this.hooks.trigger("client-created-session",{session:r,request:t}),[2,(0,v.Ok)(r)]}})}).call(this)}},{key:"revertToCommit",value:function(e){return(0,h._)(function(){var t,n,r,i,o,a,s,l,c,u;return(0,g._)(this,function(p){switch(p.label){case 0:return r=(0,eh._)({replId:this.replId,databaseRollbackTimestamp:null!=(t=e.databaseRollbackTimestamp)?t:"",deploymentBuildId:null!=(n=e.deploymentBuildId)?n:""},e),[4,this.service.revertToCommit.rpc(r)];case 1:if(!(i=p.sent()).ok)return[2,this.error(i)];if(o=i.payload.revertedSessionId,a=ea.sessions.get(o))return s=ep.create(this,o,a.created),this.hooks.trigger("client-reverted-session",{session:s,request:r}),[2,(0,v.Ok)(s)];return[4,this.service.getSessionEvents.rpc({excludeContents:!0,sessionId:o,limit:1})];case 2:if(!(l=p.sent()).ok)return[2,this.error(l)];return l.payload.session.events=[],c=ea.sessions.emplace(l.payload.session),u=ep.create(this,o,c.created),this.hooks.trigger("client-reverted-session",{session:u,request:r}),[2,(0,v.Ok)(u)]}})}).call(this)}},{key:"createUsageWatcher",value:function(e){var t=this,n=e.sessionId,r=e.start;return new T.Multicast(function(e){return t.connected.lift(e,function(i){return(0,h._)(function(){var t,o,a,s,l,c,u,p;return(0,g._)(this,function(d){switch(d.label){case 0:t=this.chort.agent.watchUsage.subscribe({sessionId:n,start:r},{signal:i}).resReadable,o=!1,a=!1,d.label=1;case 1:d.trys.push([1,6,7,12]),l=(0,m._)(t),d.label=2;case 2:return[4,l.next()];case 3:if(!(o=!(c=d.sent()).done))return[3,5];if(u=c.value,(0,v.isError)(u,"UNEXPECTED_DISCONNECT","CANCEL"))return[2];if(!u.ok)return[2,this.error(u,e)];e.next({cents:u.payload.cents}),d.label=4;case 4:return o=!1,[3,2];case 5:return[3,12];case 6:return p=d.sent(),a=!0,s=p,[3,12];case 7:if(d.trys.push([7,,10,11]),!(o&&null!=l.return))return[3,9];return[4,l.return()];case 8:d.sent(),d.label=9;case 9:return[3,11];case 10:if(a)throw s;return[7];case 11:return[7];case 12:return[2]}})}).call(t)})})}}]),t}(ek),eM=function(){function e(t){(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"_chatter",void 0),t.replId?(this.api=new eN(t),this._chatter=new e_(this.api)):(this.api=new ek(t),this._chatter=null)}return(0,y._)(e,[{key:"chatter",value:function(){if(!this._chatter)throw Error("Chatter API is disabled");return this._chatter}},{key:"hook",value:function(e,t){return this.api.hooks.add(e,t)}},{key:"status",get:function(){return this.api.status}},{key:"user",get:function(){return this.api.user}},{key:"hasAdvancedModel",get:function(){return this.api.hasAdvancedModel}},{key:"overrideModel",get:function(){return this.api.overrideModel}},{key:"models",get:function(){return this.api.models}},{key:"enhancePrompt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0;return this.api.enhancePrompt(e,t,n,r)}},{key:"getUrlScrapedContent",value:function(e){return this.api.getUrlScrapedContent(e)}},{key:"getUrlScreenshot",value:function(e){return this.api.getUrlScreenshot(e)}},{key:"getUrlBranding",value:function(e){return this.api.getUrlBranding(e)}},{key:"generateReplName",value:function(e,t){return this.api.generateReplName(e,t)}},{key:"generateReplIcon",value:function(e,t){return this.api.generateReplIcon(e,t)}},{key:"getResourceUploadUrl",value:function(e){return this.api.getResourceUploadUrl(e)}},{key:"dispose",value:function(){this.api.dispose()}}]),e}(),eD=e.i(98816),ex=e.i(664152),eP=e.i(814563);e.i(925218);var eL=e.i(641555),ej=(0,a.atom)({hasAccessToAdvancedModel:!1,defaultAssistantChatMode:"basic",defaultAssistantInlineMode:"basic"});function eB(){return(0,p.useValue)(ej)}function eF(){var e=(0,p.useYapper)();return(0,eL.useObservableMemo)(function(){return e.status.map(function(e){return"connected"===e})},[e],{default:!1})}function eq(){var e=(0,p.useYapper)();return(0,eL.useObservableMemo)(function(){return e.status.map(function(e){return"error"===e})},[e],{default:!1})}var eG=(0,eP.atomWithDefault)(function(e){return e(ej).defaultAssistantChatMode}),eV=(0,eP.atomWithDefault)(function(e){return e(ej).defaultAssistantInlineMode});e.s(["assistantChatModeAtom",()=>eG,"assistantInlineModeAtom",()=>eV,"configAtom",()=>ej,"useConfig",()=>eB,"useIsAiClientConnected",()=>eF,"useIsRiverProtocolError",()=>eq],51553);var eH=e.i(61524),eW=(0,a.atom)(!1);function e$(){return(0,p.useValue)(eW)}function ez(e){var d,y,f,h,g,T,v,m,S,E,b,C,_,R,I,O,k,A,U,w,N,M,D,x,P,L,j,B,F=e.replId,q=e.currentUser,G=e.hasAccessToAdvancedModel,V=e.children,H=e.mockStore,W=e.mockYapper,$=e.orgId,z=e.renderEmptyState,K=(y=(d={replId:F,currentUser:q,hasAccessToAdvancedModel:G,mockStore:H,mockYapper:W,orgId:$}).replId,f=d.currentUser,h=d.orgId,g=d.hasAccessToAdvancedModel,T=d.mockStore,v=d.mockYapper,m=(0,eH.usePreferences)("assistantAdvancedModelOverride").preferences.assistantAdvancedModelOverride,S=(0,u.useCreateChatConnection)({replId:y,currentUserId:f.id,orgId:h,onProtocolError:function(e){(0,l.sendErrorToSentry)(e.message,{code:e.type})},onRetriesExceeded:function(e){(0,i.flushSync)(function(){return b.set(eW,!0)}),o.captureException("Chat service connection retries exhausted in AiProvider"),(0,l.sendErrorToSentry)(e.message,{code:e.type})}}),E=(0,c.useCreateChortRiverConnection)({replId:y,userId:f.id,onProtocolError:function(e){(0,l.sendErrorToSentry)(e.message,{code:e.type})},onRetriesExceeded:function(e){(0,l.sendErrorToSentry)(e.message,{code:e.type})}}),b=(0,t._)((0,r.useState)(function(){return T&&console.error("mockStore in only meant for tests or development, not production"),null!=T?T:(0,a.createStore)()}),1)[0],C=f.id,_=f.timeCreated,(0,r.useEffect)(function(){b.set(ej,{hasAccessToAdvancedModel:g,defaultAssistantChatMode:g?"advanced":"basic",defaultAssistantInlineMode:g?"advanced":"basic"})},[b,g,m]),I=(R={connection:S,chortConnection:E,replId:y,user:(0,r.useMemo)(function(){return{id:C.toString(),type:s.UserType.USER,isTeam:!1,roles:[],membership:g?s.MembershipType.CORE:s.MembershipType.FREE,orgId:"",username:"",timeCreated:new Date(_),flaggingContext:"",modelfarmDisabled:!1,openrouterDisabled:!1,openaiDisabled:!1,anthropicDisabled:!1,geminiDisabled:!1,isEnterprise:!1}},[C,g,_]),hasAdvancedModel:g,overrideModel:m||null,onError:function(e,t){setTimeout(function(){(0,l.sendErrorToSentry)(e,null!=t?t:void 0)})}}).connection,O=R.chortConnection,k=R.replId,A=R.user,U=R.hasAdvancedModel,N=void 0===(w=R.overrideModel)?null:w,M=R.onError,x=(D=(0,t._)((0,r.useState)(null),2))[0],P=D[1],L=(0,eD.default)(M),j=!!M,(0,r.useEffect)(function(){if(I&&O){var e=new eM({connection:I,chortConnection:O,replId:k,user:A,hasAdvancedModel:U,overrideModel:N,logger:ex.logger,onError:j?function(e,t){var n;return null==(n=L.current)?void 0:n.call(L,e,t)}:void 0});return P(e),function(){P(null),Promise.resolve().then(function(){return e.dispose()})}}},[I,O,k,j]),(0,r.useEffect)(function(){x&&(x.user.current!==A&&x.user.set(A),x.hasAdvancedModel.current!==U&&x.hasAdvancedModel.set(U),x.overrideModel.current!==N&&x.overrideModel.set(null!=N?N:null))},[x,A,U,N]),B=x,{store:b,yapper:null!=v?v:B}),Q=K.store,Y=K.yapper;return Y?(0,n.jsx)(p.StoreProvider,{store:Q,yapper:Y,children:V}):(0,n.jsx)(void 0===z?function(){return null}:z,{})}function eK(){var e=(0,p.useValue)(eG),t=(0,p.useSet)(eG),n=(0,p.useGet)(eG),i=(0,r.useCallback)(function(){return"basic"===n()?s.MessageAction.NONE:s.MessageAction.ITERATIVE_AGENT},[n]),o=(0,r.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n();return e.isAuthorized?"advanced"===t?s.ModelType.ADVANCED:s.ModelType.BASIC:s.ModelType.MODEL_TYPE_UNKNOWN},[n]);return{assistantMode:e,setAssistantMode:t,getAssistantMode:n,getAssistantMessageIntent:i,getAssistantMessageModel:o}}function eQ(){return{assistantInlineMode:(0,p.useValue)(eV)}}e.s(["AiProvider",()=>ez,"useIsRiverRetryBudgetExceeded",()=>e$],204203),e.s(["useAssistantChatMode",()=>eK,"useAssistantInlineMode",()=>eQ],970187);var eY=e.i(629536),eX=e.i(55796),eJ=e.i(267103),eZ=e.i(993796);function e0(){var e=eK().assistantMode,t=e1(),n=t.basicModel,r=t.advancedModel,i=t.overrideModel;return null!=i?i:"advanced"===e?r:n}function e1(){var e=(0,p.useYapper)(),n=(0,eJ.useObservable)(e.models),i=e2();return(0,r.useMemo)(function(){var e,r,o=(0,t._)(null!=(e=null==n?void 0:n.basic)?e:[],1)[0],a=null!=(r=null==n?void 0:n.advanced)?r:[],s=null==n?void 0:n.override,l=a.find(function(e){return e.name.readable===(null==i?void 0:i.readable)}),c=(0,t._)(a.filter(function(e){return e.name.readable!==(null==i?void 0:i.readable)}),1)[0],u=(0,eX.isGhostwriterChatModelName)(null==c?void 0:c.name)?c:eY.CHAT_ENGINE_DEFAULT_MODELS.advanced,p=(0,eX.isGhostwriterChatModelName)(null==s?void 0:s.name)?s:void 0;return{basicModel:(0,eX.isGhostwriterChatModelName)(null==o?void 0:o.name)?o:eY.CHAT_ENGINE_DEFAULT_MODELS.basic,advancedModel:(0,eX.isGhostwriterChatModelName)(null==l?void 0:l.name)?l:u,overrideModel:p}},[n,i])}function e2(){var e=(0,eZ.useFlag)({controlName:"flag-assistant-advanced-model",type:"string",default:eY.CHAT_ENGINE_PREFERRED_ADVANCED_MODEL.name.qualified});return(0,r.useMemo)(function(){return(0,eX.getModelNameFromQualified)(e)},[e])}function e3(){var e=(0,p.useYapper)(),n=(0,eJ.useObservable)(e.models);return(0,r.useMemo)(function(){var e,r,i=(0,t._)(null!=(e=null==n?void 0:n.basic)?e:[],1)[0],o=(null!=(r=null==n?void 0:n.advanced)?r:[]).filter(function(e){return e.name.qualified!==eY.CHAT_ENGINE_PREFERRED_ADVANCED_MODEL.name.qualified})[0];return{basicModel:(0,eX.isGhostwriterChatModelName)(null==i?void 0:i.name)?i:eY.INLINE_ACTION_ENGINE_DEFAULT_MODELS.basic,advancedModel:(0,eX.isGhostwriterChatModelName)(null==o?void 0:o.name)?o:eY.INLINE_ACTION_ENGINE_DEFAULT_MODELS.advanced,overrideModel:void 0}},[n])}e.s(["useChatEngine",()=>e0,"useChatEngineModels",()=>e1,"usePreferredAdvancedModelName",()=>e2],765695),e.s(["useInlineActionModels",()=>e3],334712),e.i(17886);var e4=(0,a.atom)(null);function e6(){return(0,p.useValue)(e4)}function e8(){return(0,p.useGet)(e4)}function e5(){var e=(0,p.useSet)(e4);return(0,r.useCallback)(function(t){return e(t)},[e])}var e9=(0,a.atom)(void 0),e7=(0,a.atom)(void 0);function te(){return(0,p.useValue)(e9)}function tt(){var e=(0,p.useSet)(e9);return(0,r.useCallback)(function(t){return e(t)},[e])}function tn(){var e=(0,p.useSet)(e7);return(0,r.useCallback)(function(t){return e(t)},[e])}var tr=(0,a.atom)(void 0);function ti(){var e=(0,p.useGet)(tr);return(0,r.useCallback)(function(){return e()},[e])}function to(){var e=(0,p.useSet)(tr);return(0,r.useCallback)(function(){return e(void 0)},[e])}e.s(["useAgentPlanApprovalState",()=>e6,"useClearPlanProposalUserSecretsResponse",()=>to,"useGetAgentPlanApprovalState",()=>e8,"useGetPlanProposalUserSecretsResponse",()=>ti,"useProposedPlan",()=>te,"useSetAgentPlanApprovalState",()=>e5,"useSetApprovedPlan",()=>tn,"useSetProposedPlan",()=>tt],145864);var ta=(0,a.atom)(!1);function ts(){return(0,p.useValue)(ta)}function tl(){var e=(0,p.useSet)(ta);return(0,r.useCallback)(function(t){return e(t)},[e])}e.s(["useAgentPausedByUser",()=>ts,"useSetAgentPausedByUser",()=>tl],165680);var tc=e.i(63846),tu=e.i(842891),tp=e.i(416143);function td(e,t){var n,r,i=(n=(0,tc.getAiEndpoint)(),r=window.location.host.startsWith("staging")||n===tp.AiEndpoints.development||n===tp.AiEndpoints.staging,t===s.SessionType.AGENT_SESSION?r?"2a95b8aa-201c-481e-8ee3-858a19efdc53":"430ef9d3-abfe-4318-8a6d-4cadfe35d0ce":r?"c50da37d-4044-4795-b28e-8e1d21473f96":"cf9ea4d0-b92a-4076-b8f9-44441d907f6a"),o="".concat("https://smith.langchain.com","/o/").concat("ed54f928-4630-409b-b66a-947e0fbac288","/projects/p/").concat(i),a=encodeURIComponent('{"duration":"7d"}'),l=(0,tu.stringify)({timeModel:a,searchModel:'{"filter":"and(eq(is_root, true), and(eq(metadata_key, \\"session_id\\"), eq(metadata_value, \\"'.concat(e,'\\")))"}')});return"".concat(o,"?").concat(l)}function ty(e){var t,n=(0,tc.getAiEndpoint)(),r="https://cloud.temporal.io";switch(n){case tp.AiEndpoints.development:r="http://localhost:8233",t="default";break;case tp.AiEndpoints.staging:t="staging.ndbzr";break;case tp.AiEndpoints.production:default:t="production.ndbzr"}var i="".concat(r,"/namespaces/").concat(t,"/workflows"),o=(0,tu.stringify)({query:'session_id = "'.concat(e,'"')});return"".concat(i,"?").concat(o)}function tf(e){switch((0,tc.getAiEndpoint)()){case tp.AiEndpoints.development:t="5ad850f0-3a1a-4980-b889-d21d4116b5d7";break;case tp.AiEndpoints.staging:t="45b3aed2-3dde-4f0d-a22c-9af69ee8508e";break;case tp.AiEndpoints.production:default:t="ce8b1d97-5fef-4a21-bc60-8910fa6852d5"}var t,n=[{field:"is_root",operator:"=",value:"true"}];n.push({field:"metadata.session_id",operator:"=",value:e});var r=encodeURIComponent(btoa(JSON.stringify(n)));return"".concat("https://traceforge.app","/projects/").concat(t,"?filters=").concat(r)}function th(e){switch((0,tc.getAiEndpoint)()){case tp.AiEndpoints.development:t="development";break;case tp.AiEndpoints.staging:t="staging";break;case tp.AiEndpoints.production:default:t="production"}var t,n="agent-".concat(t),r='is_root AND metadata.session_id = "'.concat(e,'"'),i=JSON.stringify({filter:[{label:r,text:r,originType:"btql"}]}),o=(0,tu.stringify)({qs:"spans",search:i});return"".concat("https://www.braintrust.dev/app/ai-replit","/p/").concat(n,"/logs?").concat(o)}function tg(e){return"https://us5.datadoghq.com/logs?query=%40replid%3A".concat(e)}function tT(e){return"https://us5.datadoghq.com/apm/traces?query=%40replid%3A".concat(e)}function tv(){return!0}e.s(["generateAiSessionBraintrustUrl",()=>th,"generateAiSessionDatadogTracesUrl",()=>tT,"generateAiSessionDatadogUrl",()=>tg,"generateAiSessionLangSmithUrl",()=>td,"generateAiSessionTemporalUrl",()=>ty,"generateAiSessionTraceforgeUrl",()=>tf],805763),e.s(["useSupportsAgent",()=>tv],877212)}]);

//# debugId=d77c76ed-9145-9896-4c3e-ae1ce76b39d4
//# sourceMappingURL=e1acba6cb0c6ba7a.js.map